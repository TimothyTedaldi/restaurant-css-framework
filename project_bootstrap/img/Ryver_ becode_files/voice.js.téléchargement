webpackJsonp([2],{1112:function(e,t,n){function r(){}function i(e){var n=""+e.type;return t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data&&(n+=JSON.stringify(e.data)),u("encoded %j as %s",e,n),n}function o(e,t){function n(e){var n=h.deconstructPacket(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)}h.removeBlobs(e,n)}function a(){this.reconstructor=null}function s(e){var n=0,r={type:Number(e.charAt(0))};if(null==t.types[r.type])return p("unknown packet type "+r.type);if(t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type){for(var i="";"-"!==e.charAt(++n)&&(i+=e.charAt(n),n!=e.length););if(i!=Number(i)||"-"!==e.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(n+1))for(r.nsp="";++n;){var o=e.charAt(n);if(","===o)break;if(r.nsp+=o,n===e.length)break}else r.nsp="/";var a=e.charAt(n+1);if(""!==a&&Number(a)==a){for(r.id="";++n;){var o=e.charAt(n);if(null==o||Number(o)!=o){--n;break}if(r.id+=e.charAt(n),n===e.length)break}r.id=Number(r.id)}if(e.charAt(++n)){var s=c(e.substr(n));if(!(!1!==s&&(r.type===t.ERROR||g(s))))return p("invalid payload");r.data=s}return u("decoded %s as %j",e,r),r}function c(e){try{return JSON.parse(e)}catch(e){return!1}}function d(e){this.reconPack=e,this.buffers=[]}function p(e){return{type:t.ERROR,data:"parser error: "+e}}var u=n(9)("socket.io-parser"),l=n(407),f=n(1653),h=n(2650),g=n(1654),m=n(1655);t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=a,r.prototype.encode=function(e,n){if(e.type!==t.EVENT&&e.type!==t.ACK||!f(e.data)||(e.type=e.type===t.EVENT?t.BINARY_EVENT:t.BINARY_ACK),u("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)o(e,n);else{n([i(e)])}},l(a.prototype),a.prototype.add=function(e){var n;if("string"==typeof e)n=s(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new d(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!m(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=h.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},1113:function(e,t,n){(function(t){var r=n(1202);e.exports=function(e){var n=e.xdomain,i=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(e){}if(!n)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(t,n(65))},1114:function(e,t,n){function r(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var i=n(408),o=n(407);e.exports=r,o(r.prototype),r.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},r.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)},r.prototype.onPacket=function(e){this.emit("packet",e)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},1196:function(e,t,n){(function(t,n,r,i){!function(o){"use strict";function a(){this._dataChannels={},this._dataTransfers={},this._dataStreams={},this._peerCandidatesQueue={},this._peerEndOfCandidatesCounter={},this._gatheredCandidates={},this._retryCounters={},this._peerConnections={},this._peerStats={},this._peerBandwidth={},this._peerCustomConfigs={},this._peerInformations={},this._user=null,this._userData="",this._peerPriorityWeight=0,this._autoIntroduce=!0,this._isPrivileged=!1,this._peerList=null,this._selectedRoom=null,this._roomLocked=!1,this._inRoom=!1,this._EVENTS={},this._onceEvents={},this._timestamp={socketMessage:null,shareScreen:null,refreshConnection:null,getUserMedia:null,lastRestart:null},this._socketSession={},this._socketMessageQueue=[],this._socketMessageTimeout=null,this._socketPorts={"http:":[80,3e3],"https:":[443,3443]},this._channelOpen=!1,this._signalingServer=null,this._signalingServerProtocol=window.location.protocol,this._signalingServerPort=null,this._socket=null,this._socketUseXDR=!1,this._enableIceRestart=!1,this._hasMCU=!1,this._path=null,this._readyState=null,this._key=null,this._appKeyOwner=null,this._room=null,this._peerMessagesStamps={},this._streams={userMedia:null,screenshare:null},this._streamsDefaultSettings={userMedia:{audio:{stereo:!1},video:{resolution:{width:640,height:480},frameRate:50}},screenshare:{video:!0}},this._streamsMutedSettings={audioMuted:!1,videoMuted:!1},this._streamsBandwidthSettings={googleX:{},bAS:{}},this._streamsStoppedCbs={},this._streamsSession={},this._sdpSettings={connection:{audio:!0,video:!0,data:!0},direction:{audio:{send:!0,receive:!0},video:{send:!0,receive:!0}}},this._publishOnly=!1,this._parentId=null,this._recordings={},this._currentRecordingId=!1,this._recordingStartInterval=null,this._currentCodecSupport=null,this._sdpSessions={},this._voiceActivityDetection=!0,this._binaryChunkType=this.DATA_TRANSFER_DATA_TYPE.ARRAY_BUFFER,this._peerConnectionConfig={},this._bandwidthAdjuster=null,this._peerConnStatus={},this._joinRoomManager={timestamp:0,socketsFn:[]},this._initOptions={},this._statIdRandom=Date.now()+Math.floor(1e8*Math.random())}!function(){Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(i){if("object"!=typeof i&&"function"!=typeof i||null===i)throw new TypeError("Object.keys called on non-object");var o=[];for(var a in i)e.call(i,a)&&o.push(a);if(t)for(var s=0;r>s;s++)e.call(i,n[s])&&o.push(n[s]);return o}}())}(),function(){function e(e){return 10>e?"0"+e:e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}(),function(){"function"!=typeof Date.now&&(Date.now=function(){return(new Date).getTime()})}(),function(e,t){function n(e){var n=t[e];t[e]=function(e){return i(n(e))}}function r(t,n,r){return(r=this).attachEvent("on"+t,function(t){var t=t||e.event;t.preventDefault=t.preventDefault||function(){t.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){t.cancelBubble=!0},n.call(r,t)})}function i(e,t){if(t=e.length)for(;t--;)e[t].addEventListener=r;else e.addEventListener=r;return e}e.addEventListener||(i([t,e]),"Element"in e?e.Element.prototype.addEventListener=r:(t.attachEvent("onreadystatechange",function(){i(t.all)}),n("getElementsByTagName"),n("getElementById"),n("createElement"),i(t.all)))}(window,document),function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}}(),window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Array.prototype.forEach||(Array.prototype.forEach=function(e){var t,n;if(null==this)throw new TypeError("this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),n=0;n<i;){var o;n in r&&(o=r[n],e.call(t,o,n,r)),n++}});var s=function(e){if(null===e||"object"!=typeof e)return e;var t=function(e){var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};if("object"==typeof e&&!Array.isArray(e))try{return JSON.parse(JSON.stringify(e))}catch(n){return t(e)}return t(e)};a.prototype.DATA_CHANNEL_STATE={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed",ERROR:"error",CREATE_ERROR:"createError",BUFFERED_AMOUNT_LOW:"bufferedAmountLow",SEND_MESSAGE_ERROR:"sendMessageError"},a.prototype.DATA_CHANNEL_TYPE={MESSAGING:"messaging",DATA:"data"},a.prototype.DATA_CHANNEL_MESSAGE_ERROR={MESSAGE:"message",TRANSFER:"transfer"},a.prototype.DATA_TRANSFER_DATA_TYPE={BINARY_STRING:"binaryString",ARRAY_BUFFER:"arrayBuffer",BLOB:"blob",STRING:"string"},a.prototype.DT_PROTOCOL_VERSION="0.1.3",a.prototype.DATA_TRANSFER_TYPE={UPLOAD:"upload",DOWNLOAD:"download"},a.prototype.DATA_TRANSFER_SESSION_TYPE={BLOB:"blob",DATA_URL:"dataURL"},a.prototype.DATA_TRANSFER_STATE={UPLOAD_REQUEST:"request",UPLOAD_STARTED:"uploadStarted",DOWNLOAD_STARTED:"downloadStarted",REJECTED:"rejected",CANCEL:"cancel",ERROR:"error",UPLOADING:"uploading",DOWNLOADING:"downloading",UPLOAD_COMPLETED:"uploadCompleted",DOWNLOAD_COMPLETED:"downloadCompleted",USER_REJECTED:"userRejected",USER_UPLOAD_REQUEST:"userRequest",START_ERROR:"startError"},a.prototype.DATA_STREAM_STATE={SENDING_STARTED:"sendStart",SENDING_STOPPED:"sendStop",RECEIVING_STARTED:"receiveStart",RECEIVING_STOPPED:"receiveStop",RECEIVED:"received",SENT:"sent",ERROR:"error",START_ERROR:"startError"},a.prototype.CANDIDATE_GENERATION_STATE={NEW:"new",GATHERING:"gathering",COMPLETED:"completed"},a.prototype.CANDIDATE_PROCESSING_STATE={RECEIVED:"received",DROPPED:"dropped",BUFFERED:"buffered",PROCESSING:"processing",PROCESS_SUCCESS:"processSuccess",PROCESS_ERROR:"processError"},a.prototype.ICE_CONNECTION_STATE={STARTING:"starting",CHECKING:"checking",CONNECTED:"connected",COMPLETED:"completed",CLOSED:"closed",FAILED:"failed",TRICKLE_FAILED:"trickleFailed",DISCONNECTED:"disconnected"},a.prototype.TURN_TRANSPORT={UDP:"udp",TCP:"tcp",ANY:"any",NONE:"none",ALL:"all"},a.prototype.PEER_CONNECTION_STATE={STABLE:"stable",HAVE_LOCAL_OFFER:"have-local-offer",HAVE_REMOTE_OFFER:"have-remote-offer",CLOSED:"closed"},a.prototype.GET_CONNECTION_STATUS_STATE={RETRIEVING:0,RETRIEVE_SUCCESS:1,RETRIEVE_ERROR:-1},a.prototype.SERVER_PEER_TYPE={MCU:"mcu"},a.prototype.BUNDLE_POLICY={MAX_COMPAT:"max-compat",BALANCED:"balanced",MAX_BUNDLE:"max-bundle",NONE:"none"},a.prototype.RTCP_MUX_POLICY={REQUIRE:"require",NEGOTIATE:"negotiate"},a.prototype.PEER_CERTIFICATE={RSA:"RSA",ECDSA:"ECDSA",AUTO:"AUTO"},a.prototype.HANDSHAKE_PROGRESS={ENTER:"enter",WELCOME:"welcome",OFFER:"offer",ANSWER:"answer",ERROR:"error"},a.prototype.GET_PEERS_STATE={ENQUIRED:"enquired",RECEIVED:"received"},a.prototype.INTRODUCE_STATE={INTRODUCING:"introducing",ERROR:"error"},a.prototype.SYSTEM_ACTION={WARNING:"warning",REJECT:"reject"},a.prototype.SYSTEM_ACTION_REASON={CREDENTIALS_EXPIRED:"oldTimeStamp",CREDENTIALS_ERROR:"credentialError",DUPLICATED_LOGIN:"duplicatedLogin",ROOM_NOT_STARTED:"notStart",EXPIRED:"expired",ROOM_LOCKED:"locked",FAST_MESSAGE:"fastmsg",ROOM_CLOSING:"toclose",ROOM_CLOSED:"roomclose",SERVER_ERROR:"serverError",KEY_ERROR:"keyFailed"},a.prototype.VERSION="0.6.37",a.prototype.READY_STATE_CHANGE={INIT:0,LOADING:1,COMPLETED:2,ERROR:-1},a.prototype.READY_STATE_CHANGE_ERROR={API_INVALID:4001,API_DOMAIN_NOT_MATCH:4002,API_CORS_DOMAIN_NOT_MATCH:4003,API_CREDENTIALS_INVALID:4004,API_CREDENTIALS_NOT_MATCH:4005,API_INVALID_PARENT_KEY:4006,API_NO_MEETING_RECORD_FOUND:4010,API_OVER_SEAT_LIMIT:4020,API_RETRIEVAL_FAILED:4021,API_WRONG_ACCESS_DOMAIN:5005,XML_HTTP_REQUEST_ERROR:-1,XML_HTTP_NO_REPONSE_ERROR:-2,NO_SOCKET_IO:1,NO_XMLHTTPREQUEST_SUPPORT:2,NO_WEBRTC_SUPPORT:3,NO_PATH:4,ADAPTER_NO_LOADED:7,PARSE_CODECS:8},a.prototype.REGIONAL_SERVER={APAC1:"",US1:""},a.prototype.PRIORITY_WEIGHT_SCHEME={ENFORCE_OFFERER:"enforceOfferer",ENFORCE_ANSWERER:"enforceAnswerer",AUTO:"auto"},a.prototype.LOG_LEVEL={DEBUG:4,LOG:3,INFO:2,WARN:1,ERROR:0,NONE:-1},a.prototype.SOCKET_ERROR={CONNECTION_FAILED:0,RECONNECTION_FAILED:-1,CONNECTION_ABORTED:-2,RECONNECTION_ABORTED:-3,RECONNECTION_ATTEMPT:-4},a.prototype.SOCKET_FALLBACK={NON_FALLBACK:"nonfallback",FALLBACK_PORT:"fallbackPortNonSSL",FALLBACK_SSL_PORT:"fallbackPortSSL",LONG_POLLING:"fallbackLongPollingNonSSL",LONG_POLLING_SSL:"fallbackLongPollingSSL"},a.prototype.SM_PROTOCOL_VERSION="0.1.2.4",a.prototype.VIDEO_CODEC={AUTO:"auto",VP8:"VP8",H264:"H264",VP9:"VP9"},a.prototype.AUDIO_CODEC={AUTO:"auto",ISAC:"ISAC",OPUS:"opus",ILBC:"ILBC",G722:"G722",PCMU:"PCMU",PCMA:"PCMA"},a.prototype.MEDIA_SOURCE={SCREEN:"screen",WINDOW:"window",TAB:"tab",TAB_AUDIO:"audio",APPLICATION:"application",BROWSER:"browser",CAMERA:"camera"},a.prototype.VIDEO_RESOLUTION={QQVGA:{width:160,height:120},HQVGA:{width:240,height:160},QVGA:{width:320,height:240},WQVGA:{width:384,height:240},HVGA:{width:480,height:320},VGA:{width:640,height:480},WVGA:{width:768,height:480},FWVGA:{width:854,height:480},SVGA:{width:800,height:600},DVGA:{width:960,height:640},WSVGA:{width:1024,height:576},HD:{width:1280,height:720},HDPLUS:{width:1600,height:900},FHD:{width:1920,height:1080},QHD:{width:2560,height:1440},WQXGAPLUS:{width:3200,height:1800},UHD:{width:3840,height:2160},UHDPLUS:{width:5120,height:2880},FUHD:{width:7680,height:4320},QUHD:{width:15360,height:8640}},a.prototype.MEDIA_ACCESS_FALLBACK_STATE={FALLBACKING:0,FALLBACKED:1,ERROR:-1},a.prototype.RECORDING_STATE={START:0,STOP:1,LINK:2,ERROR:-1},a.prototype._CHUNK_FILE_SIZE=49152,a.prototype._MOZ_CHUNK_FILE_SIZE=12288,a.prototype._BINARY_FILE_SIZE=65456,a.prototype._MOZ_BINARY_FILE_SIZE=16384,a.prototype._CHUNK_DATAURL_SIZE=1212,a.prototype._DC_PROTOCOL_TYPE={WRQ:"WRQ",ACK:"ACK",ERROR:"ERROR",CANCEL:"CANCEL",MESSAGE:"MESSAGE"},a.prototype._SIG_MESSAGE_TYPE={JOIN_ROOM:"joinRoom",IN_ROOM:"inRoom",ENTER:"enter",WELCOME:"welcome",RESTART:"restart",OFFER:"offer",ANSWER:"answer",CANDIDATE:"candidate",BYE:"bye",REDIRECT:"redirect",UPDATE_USER:"updateUserEvent",ROOM_LOCK:"roomLockEvent",MUTE_VIDEO:"muteVideoEvent",MUTE_AUDIO:"muteAudioEvent",PUBLIC_MESSAGE:"public",PRIVATE_MESSAGE:"private",STREAM:"stream",GROUP:"group",GET_PEERS:"getPeers",PEER_LIST:"peerList",INTRODUCE:"introduce",INTRODUCE_ERROR:"introduceError",APPROACH:"approach",START_RECORDING:"startRecordingRoom",STOP_RECORDING:"stopRecordingRoom",RECORDING:"recordingEvent",END_OF_CANDIDATES:"endOfCandidates"},a.prototype._GROUP_MESSAGE_LIST=[a.prototype._SIG_MESSAGE_TYPE.STREAM,a.prototype._SIG_MESSAGE_TYPE.UPDATE_USER,a.prototype._SIG_MESSAGE_TYPE.MUTE_AUDIO,a.prototype._SIG_MESSAGE_TYPE.MUTE_VIDEO,a.prototype._SIG_MESSAGE_TYPE.PUBLIC_MESSAGE],a.prototype.STATS_API_VERSION="1.1",a.prototype.VIDEO_QUALITY={HD:{video:3200,audio:150},HQ:{video:1200,audio:80},SQ:{video:800,audio:30},LQ:{video:400,audio:20}},a.prototype._createDataChannel=function(e,n,r,i){var o=this,a=(o._user&&o._user.sid?o._user.sid:"-")+"_"+e,s=i?o.DATA_CHANNEL_TYPE.MESSAGING:o.DATA_CHANNEL_TYPE.DATA,c=s===o.DATA_CHANNEL_TYPE.MESSAGING?"main":a;if(!o._user)return void T.error([e,"RTCDataChannel",c,"Aborting of creating or initializing Datachannel as User does not have Room session"]);if(!o._peerConnections[e]||o._peerConnections[e].signalingState===o.PEER_CONNECTION_STATE.CLOSED)return void T.error([e,"RTCDataChannel",c,"Aborting of creating or initializing Datachannel as Peer connection does not exists"]);if(n&&"object"==typeof n?a=n.label:"string"==typeof n&&(a=n,n=null),o._dataChannels[e]?o._dataChannels[e].main&&o._dataChannels[e].main.channel.label===a&&(c="main",s=o.DATA_CHANNEL_TYPE.MESSAGING):(c="main",s=o.DATA_CHANNEL_TYPE.MESSAGING,o._dataChannels[e]={},T.debug([e,"RTCDataChannel",c,"initializing main DataChannel"])),!n)try{n=o._peerConnections[e].createDataChannel(a,{reliable:!0,ordered:!0})}catch(t){return T.error([e,"RTCDataChannel",c,"Failed creating Datachannel ->"],t),o._handleDatachannelStats("error",e,{label:a},c,t),void o._trigger("dataChannelState",o.DATA_CHANNEL_STATE.CREATE_ERROR,e,t,a,s,null,o._getDataChannelBuffer(n))}n.onerror=function(t){var r=t.error||t;T.error([e,"RTCDataChannel",c,"Datachannel has an exception ->"],r),o._handleDatachannelStats("error",e,n,c,r),o._trigger("dataChannelState",o.DATA_CHANNEL_STATE.ERROR,e,r,a,s,null,o._getDataChannelBuffer(n))},n.onbufferedamountlow=function(){T.debug([e,"RTCDataChannel",c,"Datachannel buffering data transfer low"]),o._trigger("dataChannelState",o.DATA_CHANNEL_STATE.BUFFERED_AMOUNT_LOW,e,null,a,s,null,o._getDataChannelBuffer(n))},n.onmessage=function(t){o._processDataChannelData(t.data,e,a,s)};var d=function(){T.debug([e,"RTCDataChannel",c,"Datachannel has opened"]),n.bufferedAmountLowThreshold=r||0,o._handleDatachannelStats("open",e,n,c),o._trigger("dataChannelState",o.DATA_CHANNEL_STATE.OPEN,e,null,a,s,null,o._getDataChannelBuffer(n))};n.readyState===o.DATA_CHANNEL_STATE.OPEN?setTimeout(d,1):(o._handleDatachannelStats("connecting",e,n,c),o._trigger("dataChannelState",n.readyState,e,null,a,s,null,o._getDataChannelBuffer(n)),n.onopen=d);var p=function(e){for(var t in o._dataTransfers)if(-1!==t.indexOf(e))return t;return null},u=function(){var t=p(e);T.debug([e,"RTCDataChannel",c,"Datachannel has closed"]),o._handleDatachannelStats("closed",e,n,c),o._trigger("dataChannelState",o.DATA_CHANNEL_STATE.CLOSED,e,null,a,s,null,o._getDataChannelBuffer(n)),t&&o._trigger("dataTransferState",o.DATA_TRANSFER_STATE.ERROR,t,e,o._getTransferInfo(t,e,!0,!1,!1),new Error("Datachannel has closed")),o._peerConnections[e]&&o._peerConnections[e].remoteDescription&&o._peerConnections[e].remoteDescription.sdp&&(-1===o._peerConnections[e].remoteDescription.sdp.indexOf("m=application")||o._peerConnections[e].remoteDescription.sdp.indexOf("m=application 0")>0)||s===o.DATA_CHANNEL_TYPE.MESSAGING&&setTimeout(function(){o._peerConnections[e]&&o._peerConnections[e].signalingState!==o.PEER_CONNECTION_STATE.CLOSED&&o._peerConnections[e].localDescription&&o._peerConnections[e].localDescription.type===o.HANDSHAKE_PROGRESS.OFFER&&(T.debug([e,"RTCDataChannel",c,"Reviving Datachannel connection"]),o._handleDatachannelStats("reconnecting",e,{label:a},"main"),o._createDataChannel(e,a,r,!0))},100)};if("firefox"===t.webrtcDetectedBrowser){var l=!1,f=0;n.onclose=function(){l||(l=!0,u())};var h=setInterval(function(){n.readyState===o.DATA_CHANNEL_STATE.CLOSED||l||5===f?(clearInterval(h),l||(l=!0,u())):n.readyState===o.DATA_CHANNEL_STATE.CLOSING&&f++},1e3)}else n.onclose=u;s===o.DATA_CHANNEL_TYPE.MESSAGING?o._dataChannels[e].main={channelName:a,channelType:s,transferId:null,streamId:null,channel:n}:o._dataChannels[e][a]={channelName:a,channelType:s,transferId:null,streamId:null,channel:n}},a.prototype.refreshDatachannel=function(e){var t=this;if(t._dataChannels[e]&&t._dataChannels[e].main&&t._dataChannels[e].main.channel){var n=t._dataChannels[e].main.channelName,r=t._dataChannels[e].main.channelType,i=t._dataChannels[e].main.channel.bufferedAmountLowThreshold||0;r===t.DATA_CHANNEL_TYPE.MESSAGING&&setTimeout(function(){t._peerConnections[e]&&t._peerConnections[e].signalingState!==t.PEER_CONNECTION_STATE.CLOSED&&t._peerConnections[e].localDescription&&t._peerConnections[e].localDescription.type===t.HANDSHAKE_PROGRESS.OFFER&&(t._closeDataChannel(e,"main",!0),T.debug([e,"RTCDataChannel","main","Reviving Datachannel connection"]),t._createDataChannel(e,n,i,!0))},100)}else T.debug([e,"RTCDataChannel","Not a valid Datachannel connection"])},a.prototype._getDataChannelBuffer=function(e,t){if("object"==typeof e)return{bufferedAmountLow:"number"==typeof e.bufferedAmountLow?e.bufferedAmountLow:parseInt(e.bufferedAmountLow,10)||0,bufferedAmountLowThreshold:"number"==typeof e.bufferedAmountLowThreshold?e.bufferedAmountLowThreshold:parseInt(e.bufferedAmountLowThreshold,10)||0};if(!(this._dataChannels[e]&&this._dataChannels[e][t]&&this._dataChannels[e][t].channel))return{bufferedAmountLow:0,bufferedAmountLowThreshold:0};var n=this._dataChannels[e][t].channel;return{bufferedAmountLow:"number"==typeof n.bufferedAmountLow?n.bufferedAmountLow:parseInt(n.bufferedAmountLow,10)||0,bufferedAmountLowThreshold:"number"==typeof n.bufferedAmountLowThreshold?n.bufferedAmountLowThreshold:parseInt(n.bufferedAmountLowThreshold,10)||0}},a.prototype._sendMessageToDataChannel=function(e,t,n,r){var i=this;if(n&&n!==e||(n="main"),!("object"==typeof t&&t||t&&"string"==typeof t))return void T.warn([e,"RTCDataChannel",n,"Dropping invalid data ->"],t);if(!i._peerConnections[e]||i._peerConnections[e].signalingState===i.PEER_CONNECTION_STATE.CLOSED)return void T.warn([e,"RTCDataChannel",n,"Dropping for sending message as Peer connection does not exists or is closed ->"],t);if(!i._dataChannels[e]||!i._dataChannels[e][n])return void T.warn([e,"RTCDataChannel",n,"Dropping for sending message as Datachannel connection does not exists ->"],t);var o=i._dataChannels[e][n].channelName,a=i._dataChannels[e][n].channelType,s=i._dataChannels[e][n].channel.readyState,c="object"==typeof t&&t.type===i._DC_PROTOCOL_TYPE.MESSAGE?i.DATA_CHANNEL_MESSAGE_ERROR.MESSAGE:i.DATA_CHANNEL_MESSAGE_ERROR.TRANSFER;if(s!==i.DATA_CHANNEL_STATE.OPEN){var d='Failed sending message as Datachannel connection state is not opened. Current readyState is "'+s+'"';throw T.error([e,"RTCDataChannel",n,d+" ->"],t),i._trigger("dataChannelState",i.DATA_CHANNEL_STATE.SEND_MESSAGE_ERROR,e,new Error(d),o,a,c,i._getDataChannelBuffer(e,n)),new Error(d)}try{r||"object"!=typeof t?(T.debug([e,"RTCDataChannel",n,"Sending data with size ->"],t.size||t.length||t.byteLength),i._dataChannels[e][n].channel.send(t)):(T.debug([e,"RTCDataChannel",n,'Sending "'+t.type+'" protocol message ->'],t),i._dataChannels[e][n].channel.send(JSON.stringify(t)))}catch(s){throw T.error([e,"RTCDataChannel",n,"Failed sending "+(r||"object"!=typeof t?"data":'"'+t.type+'" protocol message')+" ->"],s),i._trigger("dataChannelState",i.DATA_CHANNEL_STATE.SEND_MESSAGE_ERROR,e,s,o,a,c,i._getDataChannelBuffer(e,n)),s}},a.prototype._closeDataChannel=function(e,t,n){var r=this;if(!r._dataChannels[e])return void T.warn([e,"RTCDataChannel",t||null,"Aborting closing Datachannels as Peer connection does not have Datachannel sessions"]);var i=function(n){var i=r._dataChannels[e][n].channelName,o=r._dataChannels[e][n].channelType;r._dataChannels[e][n].readyState!==r.DATA_CHANNEL_STATE.CLOSED&&(T.debug([e,"RTCDataChannel",t,"Closing Datachannel"]),r._handleDatachannelStats("closing",e,r._dataChannels[e][n].channel,n),r._trigger("dataChannelState",r.DATA_CHANNEL_STATE.CLOSING,e,null,i,o,null,r._getDataChannelBuffer(e,n)),r._dataChannels[e][n].channel.close(),delete r._dataChannels[e][n])};if(n)i(t);else if(t&&"main"!==t){if(!r._dataChannels[e][t])return void T.warn([e,"RTCDataChannel",t,"Aborting closing Datachannel as it does not exists"]);i(t)}else{for(var o in r._dataChannels[e])r._dataChannels[e].hasOwnProperty(o)&&r._dataChannels[e][o]&&i(o);delete r._dataChannels[e]}},a.prototype._base64ToBlob=function(e){for(var t=atob(e),n=new ArrayBuffer(t.length),r=new Uint8Array(n),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return new Blob([n])},a.prototype._blobToBase64=function(e,t){var n=new FileReader;n.onload=function(){var e=n.result.split(",")[1];t(e)},n.readAsDataURL(e)},a.prototype._blobToArrayBuffer=function(e,n){var r=new FileReader;r.onload=function(){n("plugin"===t.webrtcDetectedType?new Int8Array(r.result):r.result)},r.readAsArrayBuffer(e)},a.prototype._chunkBlobData=function(e,t){var n=[],r=0,i=0,o=e.size;if(o>t){for(;o-1>i;)i=r+t,n.push(e.slice(r,i)),r+=t;o-(r+1)>0&&n.push(e.slice(r,o-1))}else n.push(e);return n},a.prototype._chunkDataURL=function(e,t){var n=e,r=[],i=0,o=0,a=e.size||e.length;if(a>t){for(;a-1>o;)o=i+t,r.push(n.slice(i,o)),i+=t;a-(i+1)>0&&chunksArray.push(n.slice(i,a-1))}else r.push(n);return r},a.prototype.sendBlobData=function(e,t,n,r,i){this._startDataTransfer(e,t,n,r,i,"blob")},a.prototype.sendURLData=function(e,t,n,r){this._startDataTransfer(e,t,n,r,null,"data")},a.prototype.respondBlobRequest=a.prototype.acceptDataTransfer=function(e,t,n){var r=this;if("string"!=typeof t&&"string"!=typeof e)return void T.error([e,"RTCDataChannel",t,"Aborting accept data transfer as data transfer ID or peer ID is not provided"]);if(!r._dataChannels[e])return void T.error([e,"RTCDataChannel",t,"Aborting accept data transfer as Peer does not have any Datachannel connections"]);if(!r._dataTransfers[t])return void T.error([e,"RTCDataChannel",t,"Aborting accept data transfer as invalid transfer ID is provided"]);var i="main",o=null;r._dataChannels[e][t]&&(i=t),r.once("dataTransferState",function(){o&&r.off("dataChannelState",o),delete r._dataTransfers[t],r._dataChannels[e]&&("main"===i&&r._dataChannels[e].main&&(r._dataChannels[e].main.transferId=null),i===t&&r._closeDataChannel(e,t))},function(n,i,o){return i===t&&o===e&&[r.DATA_TRANSFER_STATE.ERROR,r.DATA_TRANSFER_STATE.CANCEL,r.DATA_TRANSFER_STATE.DOWNLOAD_COMPLETED,r.DATA_TRANSFER_STATE.USER_REJECTED].indexOf(n)>-1}),n?(T.debug([e,"RTCDataChannel",t,"Accepted data transfer and starting ..."]),o=function(n,o,a,s,c){T.error([e,"RTCDataChannel",i,'Data transfer "'+t+'" has been terminated due to connection.']),r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.ERROR,t,e,r._getTransferInfo(t,e,!0,!1,!1),{transferType:r.DATA_TRANSFER_TYPE.DOWNLOAD,message:new Error("Data transfer terminated as Peer Datachannel connection closed abruptly.")})},r.once("dataChannelState",o,function(n,a,s,c,d){return r._dataTransfers[t]&&r._dataTransfers[t].sessions[e]?a===e&&("main"===i?d===r.DATA_CHANNEL_STATE.MESSAGING:c===t)&&[r.DATA_CHANNEL_STATE.CLOSING,r.DATA_CHANNEL_STATE.CLOSED,r.DATA_CHANNEL_STATE.ERROR].indexOf(n)>-1:void r.off("dataChannelState",o)}),r._sendMessageToDataChannel(e,{type:r._DC_PROTOCOL_TYPE.ACK,sender:r._user.sid,ackN:0},i),r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.DOWNLOAD_STARTED,t,e,r._getTransferInfo(t,e,!0,!1,!1),null)):(T.warn([e,"RTCDataChannel",t,"Rejected data transfer and data transfer request has been aborted"]),r._sendMessageToDataChannel(e,{type:r._DC_PROTOCOL_TYPE.ACK,sender:r._user.sid,ackN:-1},i),r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.USER_REJECTED,t,e,r._getTransferInfo(t,e,!0,!1,!1),{message:new Error("Data transfer terminated as User has rejected data transfer request."),transferType:r.DATA_TRANSFER_TYPE.DOWNLOAD}))},a.prototype.cancelBlobTransfer=a.prototype.cancelDataTransfer=function(e,t){var n=this;if(!t||"string"!=typeof t)return void T.error([e,"RTCDataChannel",t,"Aborting cancel data transfer as data transfer ID is not provided"]);if(!e||"string"!=typeof e)return void T.error([e,"RTCDataChannel",t,"Aborting cancel data transfer as peer ID is not provided"]);if(!n._dataTransfers[t])return void T.error([e,"RTCDataChannel",t,"Aborting cancel data transfer as data transfer session does not exists."]);T.debug([e,"RTCDataChannel",t,"Canceling data transfer ..."]);var r=function(e,r){for(var i=0;i<e.length;i++)n._trigger("dataTransferState",n.DATA_TRANSFER_STATE.CANCEL,t,e[i],n._getTransferInfo(t,r,!1,!1,!1),{transferType:n._dataTransfers[t].direction,message:new Error("User cancelled download transfer")})};if(n._hasMCU&&n._dataTransfers[t].direction===n.DATA_TRANSFER_TYPE.UPLOAD){if(!n._dataChannels.MCU)return void T.error([e,"RTCDataChannel",t,"Aborting cancel data transfer as Peer does not have any Datachannel connections"]);T.warn([e,"RTCDataChannel",t,"Aborting all data transfers to Peers"]),Object.keys(n._dataTransfers[t].peers.main).length>0&&n._sendMessageToDataChannel("MCU",{type:n._DC_PROTOCOL_TYPE.CANCEL,sender:n._user.sid,content:"Peer cancelled download transfer",name:n._dataTransfers[t].name,ackN:0},"main"),Object.keys(n._dataTransfers[t].peers[t]).length>0&&n._sendMessageToDataChannel("MCU",{type:n._DC_PROTOCOL_TYPE.CANCEL,sender:n._user.sid,content:"Peer cancelled download transfer",name:n._dataTransfers[t].name,ackN:0},t),r(Object.keys(n._dataTransfers[t].peers.main).concat(Object.keys(n._dataTransfers[t].peers[t])))}else{var i="main";if(!n._dataChannels[e])return void T.error([e,"RTCDataChannel",t,"Aborting cancel data transfer as Peer does not have any Datachannel connections"]);n._dataChannels[e][t]&&(i=t),n._sendMessageToDataChannel(e,{type:n._DC_PROTOCOL_TYPE.CANCEL,sender:n._user.sid,content:"Peer cancelled download transfer",name:n._dataTransfers[t].name,ackN:0},i),r([e],e)}},a.prototype.sendP2PMessage=function(e,t){var n=Object.keys(this._dataChannels),r=!1;if(Array.isArray(t)?(n=t,r=!0):t&&"string"==typeof t&&(n=[t],r=!0),!this._inRoom||!this._user||!this._user.sid)return void T.error("Unable to send message as User is not in Room. ->",e);if(!this._initOptions.enableDataChannel)return void T.error("Unable to send message as User does not have Datachannel enabled. ->",e);for(var i=0;i<n.length;i++){var o=n[i];this._dataChannels[o]?"MCU"===o?(n.splice(i,1),i--):this._hasMCU||(T.debug([o,"RTCDataChannel",null,"Sending "+(r?"private":"")+" P2P message to Peer"]),this._sendMessageToDataChannel(o,{type:this._DC_PROTOCOL_TYPE.MESSAGE,isPrivate:r,sender:this._user.sid,target:o,data:e},"main")):(T.error([o,"RTCDataChannel",null,"Dropping of sending message to Peer as Datachannel connection does not exists"]),n.splice(i,1),i--)}0===n.length&&T.warn("Currently there are no Peers to send P2P message to (unless the message is queued and there are Peer connected by then)."),this._hasMCU&&(T.debug(["MCU","RTCDataChannel",null,"Broadcasting "+(r?"private":"")+" P2P message to Peers"]),this._sendMessageToDataChannel("MCU",{type:this._DC_PROTOCOL_TYPE.MESSAGE,isPrivate:r,sender:this._user.sid,target:n,data:e},"main")),this._trigger("incomingMessage",{content:e,isPrivate:r,targetPeerId:t||null,listOfPeers:n,isDataChannel:!0,senderPeerId:this._user.sid},this._user.sid,this.getPeerInfo(),!0)},a.prototype.startStreamingData=function(e,n){var r=this,i=Object.keys(r._dataChannels),o=!1,a="binary";Array.isArray(n)?(i=n,o=!0):n&&"string"==typeof n&&(i=[n],o=!0),Array.isArray(e)?(i=e,n=e,o=!0):e&&"string"==typeof e?(i=[e],n=e,o=!0):e&&"boolean"==typeof e&&(a="string");var c={chunk:null,chunkSize:0,chunkType:"string"===a?r.DATA_TRANSFER_DATA_TYPE.STRING:r._binaryChunkType,isPrivate:o,isStringStream:"string"===a,senderPeerId:r._user&&r._user.sid?r._user.sid:null};i.indexOf("MCU")>-1&&i.splice(i.indexOf("MCU"),1);var d=function(e){T.error(e)};if(!this._inRoom||!this._user||!this._user.sid)return d("Unable to start data streaming as User is not in Room.");if(!this._initOptions.enableDataChannel)return d("Unable to start data streaming as User does not have Datachannel enabled.");if(0===i.length)return d("Unable to start data streaming as there are no Peers to start session with.");if(r._hasMCU)return d("Unable to start data streaming as this feature is current not supported by MCU yet.");if(!r._initOptions.enableSimultaneousTransfers)return d("Unable to start data streaming as this feature requires simultaneous data transfers to be enabled");for(var p="stream_"+(r._user&&r._user.sid?r._user.sid:"-")+"_"+(new Date).getTime(),u=[],l=[],f={},h=0;h<i.length;h++){var g=i[h],m=null,_=((r._peerInformations[g]||{}).agent||{}).DTProtocolVersion||"",v=r._isLowerThanVersion(_,"0.1.2")||!r._initOptions.enableSimultaneousTransfers?"main":p;if(r._dataChannels[g]&&r._dataChannels[g].main)if(!r._hasMCU||r._dataChannels.MCU&&r._dataChannels.MCU.main)if(r._isLowerThanVersion(_,"0.1.3"))m='Peer DTProtocolVersion does not support data streaming. (received: "'+_+'", expected: "0.1.3")';else if("main"===v){var y=r._hasMCU?r._dataChannels.MCU.main.transferId:r._dataChannels[g].main.transferId;r._dataChannels[g].main.streamId?m="Peer Datachannel currently has an active data transfer session.":r._hasMCU&&r._dataChannels.MCU.main.streamId?m="MCU Peer Datachannel currently has an active data transfer session.":r._dataTransfers[y]&&r._dataTransfers[y].sessionChunkType===a?m=(r._hasMCU?"MCU ":"")+"Peer Datachannel currently has an active "+a+" data transfer.":u.push(g)}else l.push(g);else m="MCU Datachannel connection does not exists";else m="Datachannel connection does not exists";m?(r._trigger("dataStreamState",r.DATA_STREAM_STATE.START_ERROR,p,g,c,new Error(m)),i.splice(h,1),h--):function(e,t){var n=!1;f[e]=t,r.once("dataStreamState",function(){},function(i,o,a,c){if(o===p&&a===e){c.chunk;return delete s(c).chunk,i===r.DATA_STREAM_STATE.SENDING_STARTED?void(n=!0):n&&[r.DATA_STREAM_STATE.ERROR,r.DATA_STREAM_STATE.SENDING_STOPPED].indexOf(i)>-1?(t===p&&r._closeDataChannel(e,p),r._dataStreams[p]&&r._dataStreams[p].sessions[e]&&(delete r._dataStreams[p].sessions[e],0===Object.keys(r._dataStreams[p].sessions).length&&delete r._dataStreams[p]),!0):void 0}})}(g,v)}if(0===i.length)return void T.warn("There are no Peers to start data session with.");r._dataStreams[p]={sessions:f,chunkType:"string"===a?r.DATA_TRANSFER_DATA_TYPE.STRING:r._binaryChunkType,sessionChunkType:a,isPrivate:o,isStringStream:"string"===a,senderPeerId:r._user&&r._user.sid?r._user.sid:null,isUpload:!0};var S=function(e,n,i){if(r.once("dataChannelState",function(){},function(t,o,a,s,d){if(!r._dataStreams[p])return!0;if(o===e&&("main"===n?s===r.DATA_CHANNEL_TYPE.MESSAGING:a===p&&s===r.DATA_CHANNEL_TYPE.DATA)&&[r.DATA_CHANNEL_STATE.ERROR,r.DATA_CHANNEL_STATE.CLOSED].indexOf(t)>-1){var u=new Error(d&&d.message?d.message:'Failed data transfer as datachannel state is "'+t+'".');if("MCU"===e)for(var l=0;l<i.length;l++)r._trigger("dataStreamState",r.DATA_STREAM_STATE.ERROR,p,i[l],c,u);else r._trigger("dataStreamState",r.DATA_STREAM_STATE.ERROR,p,e,c,u);return!0}}),!r._dataChannels[e][n]||r._dataChannels[e][n].channel.readyState!==r.DATA_CHANNEL_STATE.OPEN){var d=new Error("Failed starting data streaming session as channel is not opened.");if("MCU"===e)for(h=0;h<i.length;h++)r._trigger("dataStreamState",r.DATA_STREAM_STATE.START_ERROR,p,i[h],c,d);else r._trigger("dataStreamState",r.DATA_STREAM_STATE.START_ERROR,p,e,c,d)}r._sendMessageToDataChannel(e,{type:r._DC_PROTOCOL_TYPE.WRQ,transferId:p,name:p,size:0,originalSize:0,dataType:"fastBinaryStart",mimeType:null,chunkType:a,chunkSize:0,timeout:0,isPrivate:o,sender:r._user.sid,agent:t.webrtcDetectedBrowser,version:t.webrtcDetectedVersion,target:"MCU"===e?i:e},n),r._dataChannels[e][n].streamId=p;var u=s(c);if(delete u.chunk,"MCU"===e)for(var l=0;l<i.length;l++)r._trigger("dataStreamState",r.DATA_STREAM_STATE.SENDING_STARTED,p,i[l],c,null),r._trigger("incomingDataStreamStarted",p,i[l],u,!0);else r._trigger("dataStreamState",r.DATA_STREAM_STATE.SENDING_STARTED,p,e,c,null),r._trigger("incomingDataStreamStarted",p,e,u,!0)},C=function(e,n){r.once("dataChannelState",function(t,i,o){if(t!==r.DATA_CHANNEL_STATE.CREATE_ERROR)S(e,p,n);else if("MCU"===e)for(var a=0;a<n.length;a++)r._trigger("dataStreamState",r.DATA_STREAM_STATE.START_ERROR,p,n[a],c,o);else r._trigger("dataStreamState",r.DATA_STREAM_STATE.START_ERROR,p,e,c,o)},function(t,n,i,o,a){if(n===e&&o===p&&a===r.DATA_CHANNEL_TYPE.DATA)return[r.DATA_CHANNEL_STATE.CREATE_ERROR,r.DATA_CHANNEL_STATE.OPEN].indexOf(t)>-1}),r._createDataChannel(e,p,"string"===a?r._CHUNK_DATAURL_SIZE:"firefox"===t.webrtcDetectedBrowser?r._MOZ_BINARY_FILE_SIZE:r._BINARY_FILE_SIZE)};if(l.length>0)if(r._hasMCU)C("MCU",l);else for(var E=0;E<l.length;E++)C(l[E],null);if(u.length>0)if(r._hasMCU)S("MCU","main",u);else for(var R=0;R<u.length;R++)S(u[R],"main",null)},a.prototype.streamData=function(e,n){var r=this;if(!e||"string"!=typeof e)return void T.error("Failed streaming data chunk as stream session ID is not provided.");if(!n||"object"!=typeof n||!(n instanceof Blob||n instanceof ArrayBuffer))return void T.error("Failed streaming data chunk as it is not provided.");if(!(r._inRoom&&r._user&&r._user.sid))return void T.error("Failed streaming data chunk as User is not in the Room.");if(!r._dataStreams[e])return void T.error("Failed streaming data chunk as session does not exists.");if(!r._dataStreams[e].isUpload)return void T.error("Failed streaming data chunk as session is not sending.");if("string"===r._dataStreams[e].sessionChunkType?"string"!=typeof n:"object"!=typeof n)return void T.error("Failed streaming data chunk as data chunk does not match expected data type.");if(r._hasMCU)return void T.error("Failed streaming data chunk as MCU does not support this feature yet.");var i=n instanceof ArrayBuffer?new Blob(n):n;if("string"===r._dataStreams[e].sessionChunkType?i.length>r._CHUNK_DATAURL_SIZE:i.length>r._BINARY_FILE_SIZE)return void T.error("Failed streaming data chunk as data chunk exceeds maximum chunk limit.");var o={chunk:i,chunkSize:i.size||i.length||i.byteLength,chunkType:"string"===r._dataStreams[e].sessionChunkType?r.DATA_TRANSFER_DATA_TYPE.STRING:r._binaryChunkType,isPrivate:r._dataStreams[e].sessionChunkType.isPrivate,isStringStream:"string"===r._dataStreams[e].sessionChunkType,senderPeerId:r._user&&r._user.sid?r._user.sid:null},a=[],c=[],d=function(i,a,c){var d=function(t){r._sendMessageToDataChannel(i,t,a,!0);var d=s(o);if(delete d.chunk,c)for(var p=0;p<c.length;p++)r._trigger("dataStreamState",r.DATA_STREAM_STATE.SENT,e,c[p],o,null),r._trigger("incomingDataStream",n,e,c[p],d,!0);else r._trigger("dataStreamState",r.DATA_STREAM_STATE.SENT,e,i,o,null),r._trigger("incomingDataStream",n,e,i,d,!0)};n instanceof Blob&&o.chunkType===r.DATA_TRANSFER_DATA_TYPE.ARRAY_BUFFER?r._blobToArrayBuffer(n,d):d(n instanceof Blob||o.chunkType!==r.DATA_TRANSFER_DATA_TYPE.BLOB?"plugin"===t.webrtcDetectedType&&"string"!=typeof n?new Int8Array(n):n:new Blob([n]))};for(var p in r._dataStreams[e].sessions)if(r._dataStreams[e].sessions.hasOwnProperty(p)&&r._dataStreams[e].sessions[p]){var u=r._dataStreams[e].sessions[p];if(!r._dataChannels[r._hasMCU?"MCU":p]||!r._dataChannels[r._hasMCU?"MCU":p][u]||r._dataChannels[r._hasMCU?"MCU":p][u].channel.readyState!==r.DATA_CHANNEL_STATE.OPEN||r._dataChannels[r._hasMCU?"MCU":p][u].streamId!==e)return T.error([p,"RTCDataChannel",e,"Failed streaming data as it has not started or is ready."]),void r._trigger("dataStreamState",r.DATA_STREAM_STATE.ERROR,e,p,o,new Error("Streaming as it has not started or Datachannel connection is not open."));r._hasMCU?"main"===u?a.push(p):c.push(p):d(p,u)}r._hasMCU&&(a.length>0&&d(p,"main",a),c.length>0&&d(p,e,c))},a.prototype.stopStreamingData=function(e){var n=this;if(!e||"string"!=typeof e)return void T.error("Failed streaming data chunk as stream session ID is not provided.");if(!(n._inRoom&&n._user&&n._user.sid))return void T.error("Failed streaming data chunk as User is not in the Room.");if(!n._dataStreams[e])return void T.error("Failed stopping data streaming session as it does not exists.");if(!n._dataStreams[e].isUpload)return void T.error("Failed stopping data streaming session as it is not sending.");if(n._hasMCU)return void T.error("Failed stopping data streaming session as MCU does not support this feature yet.");var r={chunk:null,chunkSize:0,chunkType:"string"===n._dataStreams[e].sessionChunkType?n.DATA_TRANSFER_DATA_TYPE.STRING:n._binaryChunkType,isPrivate:n._dataStreams[e].sessionChunkType.isPrivate,isStringStream:"string"===n._dataStreams[e].sessionChunkType,senderPeerId:n._user&&n._user.sid?n._user.sid:null},i=[],o=[],a=function(i,o,a){n._sendMessageToDataChannel(i,{type:n._DC_PROTOCOL_TYPE.WRQ,transferId:e,name:e,size:0,originalSize:0,dataType:"fastBinaryStop",mimeType:null,chunkType:n._dataStreams[e].sessionChunkType,chunkSize:0,timeout:0,isPrivate:n._dataStreams[e].isPrivate,sender:n._user.sid,agent:t.webrtcDetectedBrowser,version:t.webrtcDetectedVersion,target:a||i},o);var c=s(r);if(delete c.chunk,a)for(var d=0;d<a.length;d++)n._trigger("dataStreamState",n.DATA_STREAM_STATE.SENDING_STOPPED,e,a[d],r,null),n._trigger("incomingDataStreamStopped",e,a[d],c,!0);else n._trigger("dataStreamState",n.DATA_STREAM_STATE.SENDING_STOPPED,e,i,r,null),n._trigger("incomingDataStreamStopped",e,i,c,!0)};for(var c in n._dataStreams[e].sessions)if(n._dataStreams[e].sessions.hasOwnProperty(c)&&n._dataStreams[e].sessions[c]){var d=n._dataStreams[e].sessions[c];if(!n._dataChannels[n._hasMCU?"MCU":c]||!n._dataChannels[n._hasMCU?"MCU":c][d]||n._dataChannels[n._hasMCU?"MCU":c][d].channel.readyState!==n.DATA_CHANNEL_STATE.OPEN||n._dataChannels[n._hasMCU?"MCU":c][d].streamId!==e)return T.error([c,"RTCDataChannel",e,"Failed stopping data streaming session as channel is closed."]),void n._trigger("dataStreamState",n.DATA_STREAM_STATE.ERROR,e,c,r,new Error("Failed stopping data streaming session as Datachannel connection is not open or is active."));n._hasMCU?"main"===n._dataStreams[e].sessions[c]?i.push(c):o.push(c):a(c,d)}n._hasMCU&&(i.length>0&&a(c,"main",i),o.length>0&&a(c,e,o))},a.prototype._startDataTransfer=function(e,n,r,i,o,a){var c=this,d=(c._user?c._user.sid:"")+"_"+(new Date).getTime(),p={},u=[],l=[],f=Object.keys(c._peerConnections),h="string",g={name:null,size:null,chunkSize:null,chunkType:null,dataType:null,mimeType:null,direction:c.DATA_TRANSFER_TYPE.UPLOAD,timeout:60,isPrivate:!1,percentage:0};"number"==typeof n?g.timeout=n:Array.isArray(n)?f=n:n&&"string"==typeof n?f=[n]:n&&"boolean"==typeof n?h="binary":"function"==typeof n&&(o=n),Array.isArray(r)?f=r:r&&"string"==typeof r?f=[r]:r&&"boolean"==typeof r?h="binary":"function"==typeof r&&(o=r),i&&"boolean"==typeof i?h="binary":"function"==typeof i&&(o=i),f.indexOf("MCU")>-1&&f.splice(f.indexOf("MCU"),1);var m=function(e){if(T.error(e),"function"==typeof o){var t={};if(0===f.length)t.self=new Error(e);else for(var n=0;n<f.length;n++)t[f[n]]=new Error(e);o({transferId:null,transferInfo:g,listOfPeers:f,transferErrors:t},null)}};if("blob"===a){c._hasMCU&&"binary"===h&&(T.warn("Binary data chunks transfer is not yet supported with MCU environment. Fallbacking to binary string data chunks transfer."),h="string");var _="string"===h?"firefox"===t.webrtcDetectedBrowser?c._MOZ_CHUNK_FILE_SIZE:c._CHUNK_FILE_SIZE:"firefox"===t.webrtcDetectedBrowser?c._MOZ_BINARY_FILE_SIZE:c._BINARY_FILE_SIZE;if(g.dataType=c.DATA_TRANSFER_SESSION_TYPE.BLOB,g.chunkSize="string"===h?4*Math.ceil(_/3):_,g.chunkType="binary"===h?c._binaryChunkType:c.DATA_TRANSFER_DATA_TYPE.BINARY_STRING,!(e&&"object"==typeof e&&e instanceof Blob))return void m("Provided data is not a Blob data");if(g.name=e.name||d,g.mimeType=e.type||null,e.size<1)return void m("Provided data is not a valid Blob data.");g.originalSize=e.size,g.size="string"===h?4*Math.ceil(e.size/3):e.size,l=c._chunkBlobData(e,_)}else{if(g.dataType=c.DATA_TRANSFER_SESSION_TYPE.DATA_URL,g.chunkSize=c._CHUNK_DATAURL_SIZE,g.chunkType=c.DATA_TRANSFER_DATA_TYPE.STRING,!e||"string"!=typeof e)return void m("Provided data is not a dataURL");g.originalSize=g.size=e.length||e.size,l=c._chunkDataURL(e,g.chunkSize)}if(!c._user||!c._user.sid)return void m("Unable to send any "+a.replace("data","dataURL")+" data. User is not in Room.");if(!c._initOptions.enableDataChannel)return void m("Unable to send any "+a.replace("data","dataURL")+" data. Datachannel is disabled");if(0===f.length)return void m("Unable to send any "+a.replace("data","dataURL")+" data. There are no Peers to start data transfer with");if(c._dataTransfers[d]=s(g),c._dataTransfers[d].peers={},c._dataTransfers[d].peers.main={},c._dataTransfers[d].peers[d]={},c._dataTransfers[d].sessions={},c._dataTransfers[d].chunks=l,c._dataTransfers[d].enforceBSPeers=[],c._dataTransfers[d].enforcedBSInfo={},c._dataTransfers[d].sessionType=a,c._dataTransfers[d].sessionChunkType=h,c._dataTransfers[d].senderPeerId=c._user.sid,"blob"===a&&"binary"===h){for(var v=0;v<f.length;v++){var y=((c._peerInformations[f[v]]||{}).agent||{}).DTProtocolVersion||"0.1.0";c._isLowerThanVersion(y,"0.1.3")&&c._dataTransfers[d].enforceBSPeers.push(f[v])}if(c._dataTransfers[d].enforceBSPeers.length>0){var S="firefox"===t.webrtcDetectedBrowser?c._MOZ_CHUNK_FILE_SIZE:c._CHUNK_FILE_SIZE,C=c._chunkBlobData(new Blob(l),S);c._dataTransfers[d].enforceBSInfo={chunkSize:4*Math.ceil(S/3),chunkType:c.DATA_TRANSFER_DATA_TYPE.BINARY_STRING,size:4*Math.ceil(g.originalSize/3),chunks:C}}}for(var E=function(e,t){u.indexOf(e)>-1||(T.debug([e,"RTCDataChannel",d,"Data transfer result. Is errors present? ->"],t),u.push(e),t&&(p[e]=new Error(t)),f.length===u.length&&(T.log([null,"RTCDataChannel",d,"Data transfer request completed"]),"function"==typeof o&&(Object.keys(p).length>0?o({transferId:d,transferInfo:c._getTransferInfo(d,e,!1,!0,!1),transferErrors:p,listOfPeers:f},null):o(null,{transferId:d,transferInfo:c._getTransferInfo(d,e,!1,!0,!1),listOfPeers:f}))))},R=0;R<f.length;R++){var b=c._startDataTransferToPeer(d,f[R],E,null,null);"boolean"==typeof b&&(!0===b?c._dataTransfers[d].peers.main[f[R]]=!0:c._dataTransfers[d].peers[d][f[R]]=!0)}c._hasMCU&&(Object.keys(c._dataTransfers[d].peers.main).length>0&&c._startDataTransferToPeer(d,"MCU",E,"main",Object.keys(c._dataTransfers[d].peers.main)),Object.keys(c._dataTransfers[d].peers[d]).length>0&&c._startDataTransferToPeer(d,"MCU",E,d,Object.keys(c._dataTransfers[d].peers[d])))},a.prototype._startDataTransferToPeer=function(e,n,r,i,o){var a=this,s=null,c=null,d=function(e){for(var t=o||[n],r=0;r<t.length;r++)e(t[r])},p=function(t){var r="MCU"===n?t.replace(/Peer/g,"MCU Peer"):t;d(function(t){a._trigger("dataTransferState",a.DATA_TRANSFER_STATE.ERROR,e,t,a._getTransferInfo(e,n,!0,!0,!1),{message:new Error(r),transferType:a.DATA_TRANSFER_TYPE.UPLOAD})})},u=function(){var r=a._dataTransfers[e].size,s=a._dataTransfers[e].chunkSize,c=a._dataTransfers[e].sessionChunkType;a._dataTransfers[e].enforceBSPeers.indexOf(n)>-1&&(T.warn([n,"RTCDataChannel",e,"Binary data chunks transfer is not yet supported with Peer connecting from Android, iOS and C++ SDK. Fallbacking to binary string data chunks transfer."]),r=a._dataTransfers[e].enforceBSInfo.size,s=a._dataTransfers[e].enforceBSInfo.chunkSize,c="string"),a._sendMessageToDataChannel(n,{type:a._DC_PROTOCOL_TYPE.WRQ,transferId:e,name:a._dataTransfers[e].name,size:r,originalSize:a._dataTransfers[e].originalSize,dataType:a._dataTransfers[e].sessionType,mimeType:a._dataTransfers[e].mimeType,chunkType:c,chunkSize:s,timeout:a._dataTransfers[e].timeout,isPrivate:a._dataTransfers[e].isPrivate,sender:a._user.sid,agent:t.webrtcDetectedBrowser,version:t.webrtcDetectedVersion,target:o||n},i),d(function(t){a._trigger("incomingDataRequest",e,t,a._getTransferInfo(e,n,!1,!1,!1),!0),a._trigger("dataTransferState",a.DATA_TRANSFER_STATE.USER_UPLOAD_REQUEST,e,t,a._getTransferInfo(e,n,!0,!1,!1),null)})};if("MCU"!==n){var l=function(t,o,d,p,u){s&&a.off("peerConnectionState",s),c&&a.off("dataChannelState",c),i&&delete a._dataTransfers[e].peers[i][n],r(n,t===a.DATA_TRANSFER_STATE.UPLOAD_COMPLETED?null:u.message.message||u.message.toString()),delete a._dataTransfers[e].sessions[n],a._hasMCU&&0===Object.keys(a._dataTransfers[e].peers.main).length&&a._dataChannels.MCU&&a._dataChannels.MCU.main?a._dataChannels.MCU.main.transferId=null:"main"===i&&a._dataChannels[n]&&a._dataChannels[n].main&&(a._dataChannels[n].main.transferId=null),0===Object.keys(a._dataTransfers[e].sessions).length&&delete a._dataTransfers[e]};a.once("dataTransferState",l,function(t,r,i){return a._dataTransfers[e]&&(a._hasMCU?a._dataTransfers[e].peers.main[n]||a._dataTransfers[e].peers[e][n]:a._dataTransfers[e].sessions[n])?r===e&&i===n&&[a.DATA_TRANSFER_STATE.UPLOAD_COMPLETED,a.DATA_TRANSFER_STATE.ERROR,a.DATA_TRANSFER_STATE.CANCEL,a.DATA_TRANSFER_STATE.REJECTED].indexOf(t)>-1:(l&&a.off("dataTransferState",l),s&&a.off("peerConnectionState",s),void(c&&a.off("dataChannelState",c)))})}if(!a._peerConnections[n])return void p("Unable to start data transfer as Peer connection does not exists.");if(!a._peerInformations[n])return void p("Unable to start data transfer as Peer connection does not exists.");if(a._peerConnections[n].signalingState!==a.PEER_CONNECTION_STATE.STABLE)return void p("Unable to start data transfer as Peer connection is not stable.");if(!a._dataTransfers[e])return void p("Unable to start data transfer as data transfer session is not in order.");if(!a._dataChannels[n]||!a._dataChannels[n].main)return void p("Unable to start data transfer as Peer Datachannel connection does not exists.");if(a._dataChannels[n].main.channel.readyState!==a.DATA_CHANNEL_STATE.OPEN)return void p("Unable to start data transfer as Peer Datachannel connection is not opened.");var f=a._dataChannels[n].main.streamId;if(f&&"main"===i&&a._dataStreams[f]&&("string"===a._dataStreams[f].sessionChunkType&&("string"===a._dataTransfers[e].sessionChunkType||a._dataTransfers[e].enforceBSPeers.indexOf(n)>-1)||"binary"===a._dataStreams[f].sessionChunkType&&"binary"===a._dataStreams[f].sessionChunkType&&-1===a._dataTransfers[e].enforceBSPeers.indexOf(n)))return void p("Unable to start data transfer as Peer Datachannel currently has an active "+a._dataStreams[f].sessionChunkType+" data streaming session.");var h=(a._peerInformations[n].agent||{}).DTProtocolVersion||"0.1.0",g=a._isLowerThanVersion(h,"0.1.2")||!a._initOptions.enableSimultaneousTransfers;return a._isLowerThanVersion(h,"0.1.2")&&"data"===a._dataTransfers[e].sessionType&&"string"===a._dataTransfers[e].sessionChunkType?void p("Unable to start data transfer as Peer do not support DATA_URL type of data transfers"):"MCU"!==n&&a._hasMCU?(i=g?"main":e,s=function(){p("Data transfer terminated as Peer connection is not stable.")},a.once("peerConnectionState",s,function(t,r){return a._dataTransfers[e]?t!==a.PEER_CONNECTION_STATE.STABLE&&r===n:void a.off("peerConnectionState",s)}),g):(g||"main"===i)&&a._dataChannels[n].main.transferId?void p("Unable to start data transfer as Peer Datachannel has a data transfer in-progress."):(a._dataTransfers[e].sessions[n]={timer:null,ackN:0},c=function(t,r,i){a._dataTransfers[e].sessions[n].ackN>=a._dataTransfers[e].chunks.length-1||p(i?i.message||i.toString():"Data transfer terminated as Peer Datachannel connection closed abruptly.")},a.once("dataChannelState",c,function(t,r,o,s,d){if(!a._dataTransfers[e]||!a._dataTransfers[e].sessions[n])return void a.off("dataChannelState",c);if(r===n&&("main"===i?d===a.DATA_CHANNEL_TYPE.MESSAGING:s===e))return t===a.DATA_CHANNEL_STATE.OPEN&&"main"!==i&&s===e?(a._dataChannels[n][i].transferId=e,u(),!1):[a.DATA_CHANNEL_STATE.CREATE_ERROR,a.DATA_CHANNEL_STATE.ERROR,a.DATA_CHANNEL_STATE.CLOSING,a.DATA_CHANNEL_STATE.CLOSED].indexOf(t)>-1}),void(g&&"MCU"!==n||"main"===i?(i="main",a._dataChannels[n].main.transferId=e,u()):(i=e,a._createDataChannel(n,e,"data"===a._dataTransfers[e].sessionType?a._CHUNK_DATAURL_SIZE:"string"===a._dataTransfers[e].sessionChunkType?"firefox"===t.webrtcDetectedBrowser?16384:65546:"firefox"===t.webrtcDetectedBrowser?a._MOZ_BINARY_FILE_SIZE:a._BINARY_FILE_SIZE))))},a.prototype._getTransferInfo=function(e,t,n,r,i){if(!this._dataTransfers[e])return{};var o={name:this._dataTransfers[e].name,size:this._dataTransfers[e].size,dataType:this._dataTransfers[e].dataType||this.DATA_TRANSFER_SESSION_TYPE.BLOB,mimeType:this._dataTransfers[e].mimeType||null,chunkSize:this._dataTransfers[e].chunkSize,chunkType:this._dataTransfers[e].chunkType,timeout:this._dataTransfers[e].timeout,isPrivate:this._dataTransfers[e].isPrivate,direction:this._dataTransfers[e].direction};if(this._dataTransfers[e].originalSize?o.size=this._dataTransfers[e].originalSize:this._dataTransfers[e].chunkType===this.DATA_TRANSFER_DATA_TYPE.BINARY_STRING&&(o.size=Math.ceil(3*o.size/4)),!r){if(o.percentage=0,!this._dataTransfers[e].sessions[t])return n&&(o.data=null),o;if(this._dataTransfers[e].direction===this.DATA_TRANSFER_TYPE.DOWNLOAD)this._dataTransfers[e].sessions[t].receivedSize===this._dataTransfers[e].sessions[t].size?o.percentage=100:o.percentage=parseFloat((this._dataTransfers[e].sessions[t].receivedSize/this._dataTransfers[e].size*100).toFixed(2),10);else{var a=this._dataTransfers[e].enforceBSPeers.indexOf(t)>-1?this._dataTransfers[e].enforceBSInfo.chunks.length:this._dataTransfers[e].chunks.length;this._dataTransfers[e].sessions[t].ackN===a?o.percentage=100:o.percentage=parseFloat((this._dataTransfers[e].sessions[t].ackN/a*100).toFixed(2),10)}n&&("number"!=typeof i?100===o.percentage?o.data=this._getTransferData(e):o.data=null:(o.percentage=i,0===i&&(o.data=this._getTransferData(e))))}return o},a.prototype._getTransferData=function(e){if(!this._dataTransfers[e])return null;if(this._dataTransfers[e].dataType===this.DATA_TRANSFER_SESSION_TYPE.BLOB){var t={name:this._dataTransfers[e].name};return this._dataTransfers[e].mimeType&&(t.type=this._dataTransfers[e].mimeType),new Blob(this._dataTransfers[e].chunks,t)}return this._dataTransfers[e].chunks.join("")},a.prototype._handleDataTransferTimeoutForPeer=function(e,t,n){var r=this;if(!r._dataTransfers[e]||!r._dataTransfers[e].sessions[t])return void T.debug([t,"RTCDataChannel",e,"Data transfer does not exists for Peer. Ignoring timeout."]);T.debug([t,"RTCDataChannel",e,"Clearing data transfer timer for Peer."]),r._dataTransfers[e].sessions[t].timer&&clearTimeout(r._dataTransfers[e].sessions[t].timer),r._dataTransfers[e].sessions[t].timer=null,n&&(T.debug([t,"RTCDataChannel",e,"Setting data transfer timer for Peer."]),r._dataTransfers[e].sessions[t].timer=setTimeout(function(){if(!r._dataTransfers[e]||!r._dataTransfers[e].sessions[t])return void T.debug([t,"RTCDataChannel",e,"Data transfer already ended for Peer. Ignoring expired timeout."]);if(!r._user||!r._user.sid)return void T.debug([t,"RTCDataChannel",e,"User is not in Room. Ignoring expired timeout."]);if(!r._dataChannels[t])return void T.debug([t,"RTCDataChannel",e,"Datachannel connection does not exists. Ignoring expired timeout."]);T.error([t,"RTCDataChannel",e,"Data transfer response has timed out."]);var n="Connection Timeout. Longer than "+r._dataTransfers[e].timeout+" seconds. Connection is abolished.";r._sendMessageToDataChannel(t,{type:r._DC_PROTOCOL_TYPE.ERROR,content:n,isUploadError:r._dataTransfers[e].direction===r.DATA_TRANSFER_TYPE.UPLOAD,sender:r._user.sid,name:r._dataTransfers[e].name},r._dataChannels[t][e]?e:"main"),function(n){if("MCU"===t){for(var i=[r._dataTransfers[e].peers.main,r._dataTransfers[e].peers[e]],o=0;o<i.length;o++)if(i[o])for(var a in i[o])i[o].hasOwnProperty(a)&&i[o][a]&&n(a)}else n(t)}(function(i){r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.ERROR,e,t,r._getTransferInfo(e,t,!0,!1,!1),{transferType:r.DATA_TRANSFER_TYPE.DOWNLOAD,message:new Error(n)})})},1e3*r._dataTransfers[e].timeout))},a.prototype._processDataChannelData=function(e,n,r,i){var o=this,a=null,s=null,c=!1,d=i===o.DATA_CHANNEL_TYPE.MESSAGING?"main":r,p=o._dataChannels[n]||{};if(p.hasOwnProperty(d)&&"object"==typeof p[d]){if(a=p[d].transferId,s=p[d].streamId,s&&o._dataStreams[s]&&(c="string"===o._dataStreams[s].sessionChunkType?"string"==typeof e:"object"==typeof e),!o._peerConnections[n])return void T.warn([n,"RTCDataChannel",d,"Dropping data received from Peer as connection is not present ->"],e);if(!o._dataChannels[n]||!o._dataChannels[n][d])return void T.warn([n,"RTCDataChannel",d,"Dropping data received from Peer as Datachannel connection is not present ->"],e);if("string"==typeof e)try{var u=JSON.parse(e);if(c=!1,T.debug([n,"RTCDataChannel",d,'Received protocol "'+u.type+'" message ->'],u),[o._DC_PROTOCOL_TYPE.ACK,o._DC_PROTOCOL_TYPE.ERROR,o._DC_PROTOCOL_TYPE.CANCEL].indexOf(u.type)>-1&&!(a&&o._dataTransfers[a]&&o._dataTransfers[a].sessions[n]))return void T.warn([n,"RTCDataChannel",d,"Discarded protocol message as data transfer session is not present ->"],u);switch(u.type){case o._DC_PROTOCOL_TYPE.WRQ:if(a&&o._dataTransfers[a]&&o._dataTransfers[a].sessions[n])return T.warn([n,"RTCDataChannel",d,"Rejecting bidirectional data transfer request as it is currently not supported in the SDK ->"],u),void o._sendMessageToDataChannel(n,{type:o._DC_PROTOCOL_TYPE.ACK,ackN:-1,sender:o._user.sid},d);o._WRQProtocolHandler(n,u,d);break;case o._DC_PROTOCOL_TYPE.ACK:o._ACKProtocolHandler(n,u,d);break;case o._DC_PROTOCOL_TYPE.ERROR:o._ERRORProtocolHandler(n,u,d);break;case o._DC_PROTOCOL_TYPE.CANCEL:o._CANCELProtocolHandler(n,u,d);break;case o._DC_PROTOCOL_TYPE.MESSAGE:o._MESSAGEProtocolHandler(n,u,d);break;default:T.warn([n,"RTCDataChannel",d,'Discarded unknown "'+u.type+'" message ->'],u)}}catch(t){if(e.indexOf("{")>-1&&e.indexOf("}")>0)throw T.error([n,"RTCDataChannel",d,"Failed parsing protocol step data error ->"],{data:e,error:t}),o._trigger("dataChannelState",o.DATA_CHANNEL_STATE.ERROR,n,t,r,i,null,o._getDataChannelBuffer(n,d)),t;if(!(c||a&&o._dataTransfers[a]&&o._dataTransfers[a].sessions[n]))return void T.warn([n,"RTCDataChannel",d,"Discarded data chunk without session ->"],e);if(!c&&a&&o._dataTransfers[a].chunks[o._dataTransfers[a].sessions[n].ackN])return void T.warn([n,"RTCDataChannel",a,"Dropping data chunk "+(c?"":"@"+o._dataTransfers[a].sessions[n].ackN)+" as it has already been added ->"],e);o.DATA_TRANSFER_DATA_TYPE.BINARY_STRING;if(c||o._dataTransfers[a].dataType===o.DATA_TRANSFER_SESSION_TYPE.DATA_URL)T.debug([n,"RTCDataChannel",d,"Received string data chunk "+(c?"":"@"+o._dataTransfers[a].sessions[n].ackN)+" with size ->"],e.length||e.size),o._DATAProtocolHandler(n,e,o.DATA_TRANSFER_DATA_TYPE.STRING,e.length||e.size||0,d);else{var l=e.replace(/\s|\r|\n/g,"");T.debug([n,"RTCDataChannel",d,"Received binary string data chunk @"+o._dataTransfers[a].sessions[n].ackN+" with size ->"],l.length||l.size),o._DATAProtocolHandler(n,o._base64ToBlob(l),o.DATA_TRANSFER_DATA_TYPE.BINARY_STRING,l.length||l.size||0,d)}}else{if(!(c||a&&o._dataTransfers[a]&&o._dataTransfers[a].sessions[n]))return void T.warn([n,"RTCDataChannel",d,"Discarded data chunk without session ->"],e);if(!c&&a&&o._dataTransfers[a].chunks[o._dataTransfers[a].sessions[n].ackN])return void T.warn([n,"RTCDataChannel",a,"Dropping data chunk "+(c?"":"@"+o._dataTransfers[a].sessions[n].ackN)+" as it has already been added ->"],e);if(e instanceof Blob)T.debug([n,"RTCDataChannel",d,"Received blob data chunk "+(c?"":"@"+o._dataTransfers[a].sessions[n].ackN)+" with size ->"],e.size),o._DATAProtocolHandler(n,e,o.DATA_TRANSFER_DATA_TYPE.BLOB,e.size,d);else{var f=e,h=null;if(e.constructor&&"Array"===e.constructor.name&&(f=new Int8Array(e)),"IE"===t.webrtcDetectedBrowser){if(window.BlobBuilder){var g=new BlobBuilder;g.append(e.constructor&&"ArrayBuffer"===e.constructor.name?f:new Uint8Array(f).buffer),h=g.getBlob()}}else h=new Blob([f]);T.debug([n,"RTCDataChannel",d,"Received arraybuffer data chunk "+(c?"":"@"+o._dataTransfers[a].sessions[n].ackN)+" with size ->"],h.size),o._DATAProtocolHandler(n,h,o.DATA_TRANSFER_DATA_TYPE.ARRAY_BUFFER,h.size,d)}}}},a.prototype._WRQProtocolHandler=function(e,t,n){var r=this,i="main"===n?t.transferId||null:n,o=t.sender||e;if(["fastBinaryStart","fastBinaryStop"].indexOf(t.dataType)>-1)if("fastBinaryStart"===t.dataType){i||(i="stream_"+e+"_"+(new Date).getTime()),r._dataStreams[i]={chunkSize:0,chunkType:"string"===t.chunkType?r.DATA_TRANSFER_DATA_TYPE.STRING:r._binaryChunkType,sessionChunkType:t.chunkType,isPrivate:!!t.isPrivate,isStringStream:"string"===t.chunkType,senderPeerId:o,isUpload:!1},r._dataChannels[e][n].streamId=i;r.once("dataChannelState",function(){},function(t,a,s,c,d){if(!r._dataStreams[i])return!0;if(a===e&&("main"===n?c===r.DATA_CHANNEL_TYPE.MESSAGING:s===i&&c===r.DATA_CHANNEL_TYPE.DATA)&&[r.DATA_CHANNEL_STATE.ERROR,r.DATA_CHANNEL_STATE.CLOSED].indexOf(t)>-1){var p=new Error(d&&d.message?d.message:'Failed data transfer as datachannel state is "'+t+'".');return r._trigger("dataStreamState",r.DATA_STREAM_STATE.ERROR,i,o,{chunk:null,chunkSize:0,chunkType:r._dataStreams[i].chunkType,isPrivate:r._dataStreams[i].isPrivate,isStringStream:"string"===r._dataStreams[i].sessionChunkType,senderPeerId:o},p),!0}}),r._trigger("dataStreamState",r.DATA_STREAM_STATE.RECEIVING_STARTED,i,o,{chunk:null,chunkSize:0,chunkType:r._dataStreams[i].chunkType,isPrivate:r._dataStreams[i].isPrivate,isStringStream:"string"===r._dataStreams[i].sessionChunkType,senderPeerId:o},null),r._trigger("incomingDataStreamStarted",i,o,{chunkSize:0,chunkType:r._dataStreams[i].chunkType,isPrivate:r._dataStreams[i].isPrivate,isStringStream:"string"===r._dataStreams[i].sessionChunkType,senderPeerId:o},!1)}else i=r._dataChannels[e][n].streamId,r._dataStreams[i]&&!r._dataStreams[i].isUpload&&(r._trigger("dataStreamState",r.DATA_STREAM_STATE.RECEIVING_STOPPED,i,o,{chunk:null,chunkSize:0,chunkType:r._dataStreams[i].chunkType,isPrivate:r._dataStreams[i].isPrivate,isStringStream:"string"===r._dataStreams[i].sessionChunkType,senderPeerId:o},null),r._trigger("incomingDataStreamStopped",i,o,{chunkSize:0,chunkType:r._dataStreams[i].chunkType,isPrivate:r._dataStreams[i].isPrivate,isStringStream:"string"===r._dataStreams[i].sessionChunkType,senderPeerId:o},!1),r._dataChannels[e][n].streamId=null,"main"!==n&&r._closeDataChannel(e,n),delete r._dataStreams[i]);else i||(i="transfer_"+e+"_"+(new Date).getTime()),r._dataTransfers[i]={name:t.name||i,size:t.size||0,chunkSize:t.chunkSize,originalSize:t.originalSize||0,timeout:t.timeout||60,isPrivate:!!t.isPrivate,senderPeerId:t.sender||e,dataType:r.DATA_TRANSFER_SESSION_TYPE.BLOB,mimeType:t.mimeType||null,chunkType:r.DATA_TRANSFER_DATA_TYPE.BINARY_STRING,direction:r.DATA_TRANSFER_TYPE.DOWNLOAD,chunks:[],sessions:{},sessionType:t.dataType||"blob",sessionChunkType:t.chunkType||"string"},"data"===r._dataTransfers[i].sessionType&&"string"===r._dataTransfers[i].sessionChunkType?(r._dataTransfers[i].dataType=r.DATA_TRANSFER_SESSION_TYPE.DATA_URL,r._dataTransfers[i].chunkType=r.DATA_TRANSFER_DATA_TYPE.STRING):"blob"===r._dataTransfers[i].sessionType&&"binary"===r._dataTransfers[i].sessionChunkType&&(r._dataTransfers[i].chunkType=r._binaryChunkType),r._dataChannels[e][n].transferId=i,r._dataTransfers[i].sessions[e]={timer:null,ackN:0,receivedSize:0},r._trigger("incomingDataRequest",i,o,r._getTransferInfo(i,e,!1,!1,!1),!1),r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.UPLOAD_REQUEST,i,o,r._getTransferInfo(i,e,!0,!1,!1),null)},a.prototype._ACKProtocolHandler=function(e,t,n){var r=this,i=n,o=t.sender||e;"main"===n&&(i=r._dataChannels[e].main.transferId),r._handleDataTransferTimeoutForPeer(i,e,!1);var a=function(t){if("MCU"===e){if(!r._dataTransfers[i].peers[n])return void T.warn([e,"RTCDataChannel",n,"Dropping triggering of ACK event as Peers list does not exists"]);for(var a in r._dataTransfers[i].peers[n])r._dataTransfers[i].peers[n].hasOwnProperty(a)&&r._dataTransfers[i].peers[n][a]&&t(a)}else t(o)};if(t.ackN>-1){if(0===t.ackN)a(function(t){r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.UPLOAD_STARTED,i,t,r._getTransferInfo(i,e,!0,!1,0),null)});else if(r._dataTransfers[i].enforceBSPeers.indexOf(e)>-1?t.ackN===r._dataTransfers[i].enforceBSInfo.chunks.length:t.ackN===r._dataTransfers[i].chunks.length)return r._dataTransfers[i].sessions[e].ackN=t.ackN,a(function(t){r._trigger("incomingData",r._getTransferData(i),i,t,r._getTransferInfo(i,e,!1,!1,!1),!0),r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.UPLOAD_COMPLETED,i,t,r._getTransferInfo(i,e,!0,!1,100),null)}),void(r._dataChannels[e][n]&&(r._dataChannels[e][n].transferId=null,"main"!==n&&r._closeDataChannel(e,n)));var s=function(o){r._sendMessageToDataChannel(e,o,n,!0),t.ackN<r._dataTransfers[i].chunks.length&&a(function(t){r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.UPLOADING,i,t,r._getTransferInfo(i,e,!0,!1,!1),null)}),r._handleDataTransferTimeoutForPeer(i,e,!0)};r._dataTransfers[i].sessions[e].ackN=t.ackN,r._dataTransfers[i].enforceBSPeers.indexOf(e)>-1?r._blobToBase64(r._dataTransfers[i].enforceBSInfo.chunks[t.ackN],s):r._dataTransfers[i].chunkType===r.DATA_TRANSFER_DATA_TYPE.BINARY_STRING?r._blobToBase64(r._dataTransfers[i].chunks[t.ackN],s):r._dataTransfers[i].chunkType===r.DATA_TRANSFER_DATA_TYPE.ARRAY_BUFFER?r._blobToArrayBuffer(r._dataTransfers[i].chunks[t.ackN],s):s(r._dataTransfers[i].chunks[t.ackN])}else r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.REJECTED,i,o,r._getTransferInfo(i,e,!0,!1,!1),{message:new Error("Data transfer terminated as Peer has rejected data transfer request"),transferType:r.DATA_TRANSFER_TYPE.UPLOAD})},a.prototype._MESSAGEProtocolHandler=function(e,t,n){var r=t.sender||e;T.log([r,"RTCDataChannel",n,"Received P2P message from peer:"],t),this._trigger("incomingMessage",{content:t.data,isPrivate:t.isPrivate,isDataChannel:!0,targetPeerId:this._user.sid,senderPeerId:r},r,this.getPeerInfo(r),!1)},a.prototype._ERRORProtocolHandler=function(e,t,n){var r=this,i=n,o=t.sender||e;"main"===n&&(i=r._dataChannels[e].main.transferId),r._handleDataTransferTimeoutForPeer(i,e,!1);T.error([e,"RTCDataChannel",n,"Received an error from peer ->"],t),function(t){if("MCU"===e){if(!r._dataTransfers[i].peers[n])return void T.warn([e,"RTCDataChannel",n,"Dropping triggering of ERROR event as Peers list does not exists"]);for(var a in r._dataTransfers[i].peers[n])r._dataTransfers[i].peers[n].hasOwnProperty(a)&&r._dataTransfers[i].peers[n][a]&&t(a)}else t(o)}(function(e){r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.ERROR,i,e,r._getTransferInfo(i,peerID,!0,!1,!1),{message:new Error(t.content),transferType:r._dataTransfers[i].direction})})},a.prototype._CANCELProtocolHandler=function(e,t,n){var r=this,i=n;"main"===n&&(i=r._dataChannels[e].main.transferId),r._handleDataTransferTimeoutForPeer(i,e,!1);T.error([e,"RTCDataChannel",n,"Received data transfer termination from peer ->"],t),function(t){if("MCU"===e){if(!r._dataTransfers[i].peers[n])return void T.warn([e,"RTCDataChannel",n,"Dropping triggering of CANCEL event as Peers list does not exists"]);for(var o in r._dataTransfers[i].peers[n])r._dataTransfers[i].peers[n].hasOwnProperty(o)&&r._dataTransfers[i].peers[n][o]&&t(o)}else t(e)}(function(n){r._trigger("dataTransferState",r.DATA_TRANSFER_STATE.CANCEL,i,n,r._getTransferInfo(i,e,!0,!1,!1),{message:new Error(t.content||"Peer has terminated data transfer."),transferType:r._dataTransfers[i].direction})})},a.prototype._DATAProtocolHandler=function(e,t,n,r,i){var o=this,a=i,s=e;if(o._dataChannels[e]&&o._dataChannels[e][i]){var c=o._dataChannels[e][i].streamId;if(c&&o._dataStreams[c]&&("string"==typeof t&&"string"===o._dataStreams[c].sessionChunkType||t instanceof Blob&&"binary"===o._dataStreams[c].sessionChunkType))return s=o._dataStreams[c].senderPeerId||e,o._trigger("dataStreamState",o.DATA_STREAM_STATE.RECEIVED,c,s,{chunk:t,chunkSize:r,chunkType:n,isPrivate:o._dataStreams[c].sessionChunkType.isPrivate,isStringStream:"string"===o._dataStreams[c].sessionChunkType,senderPeerId:s},null),void o._trigger("incomingDataStream",t,a,s,{chunkSize:r,chunkType:n,isPrivate:o._dataStreams[c].sessionChunkType.isPrivate,isStringStream:"string"===o._dataStreams[c].sessionChunkType,senderPeerId:s},!1);if("main"===i&&(a=o._dataChannels[e].main.transferId),o._dataTransfers[a].senderPeerId&&(s=o._dataTransfers[a].senderPeerId),o._handleDataTransferTimeoutForPeer(a,e,!1),o._dataTransfers[a].chunkType=n,o._dataTransfers[a].sessions[e].receivedSize+=r,o._dataTransfers[a].chunks[o._dataTransfers[a].sessions[e].ackN]=t,o._dataTransfers[a].sessions[e].receivedSize>=o._dataTransfers[a].size)return T.log([e,"RTCDataChannel",i,"Data transfer has been completed. Computed size ->"],o._dataTransfers[a].sessions[e].receivedSize),o._sendMessageToDataChannel(e,{type:o._DC_PROTOCOL_TYPE.ACK,sender:o._user.sid,ackN:o._dataTransfers[a].sessions[e].ackN+1},i),o._trigger("incomingData",o._getTransferData(a),a,s,o._getTransferInfo(a,e,!1,!1,!1),null),void o._trigger("dataTransferState",o.DATA_TRANSFER_STATE.DOWNLOAD_COMPLETED,a,s,o._getTransferInfo(a,e,!0,!1,!1),null);o._dataTransfers[a].sessions[e].ackN+=1,o._sendMessageToDataChannel(e,{type:o._DC_PROTOCOL_TYPE.ACK,sender:o._user.sid,ackN:o._dataTransfers[a].sessions[e].ackN},i),o._handleDataTransferTimeoutForPeer(a,e,!0),o._trigger("dataTransferState",o.DATA_TRANSFER_STATE.DOWNLOADING,a,s,o._getTransferInfo(a,e,!0,!1,!1),null)}},a.prototype._onIceCandidate=function(e,t){var n=this,r=n._peerConnections[e];if(!r)return void T.warn([e,"RTCIceCandidate",null,"Ignoring of ICE candidate event as Peer connection does not exists ->"],t);if(t.candidate){r.gathering||(T.log([e,"RTCIceCandidate",null,"ICE gathering has started."]),r.gathering=!0,r.gathered=!1,n._handleIceGatheringStats("gathering",e,!1),n._trigger("candidateGenerationState",n.CANDIDATE_GENERATION_STATE.GATHERING,e));var i=t.candidate.split(" ")[7];if(T.debug([e,"RTCIceCandidate",i,"Generated ICE candidate ->"],t),"endOfCandidates"===i||!(n._peerConnections[e]&&n._peerConnections[e].localDescription&&n._peerConnections[e].localDescription.sdp&&n._peerConnections[e].localDescription.sdp.indexOf("\r\na=mid:"+t.sdpMid+"\r\n")>-1))return T.warn([e,"RTCIceCandidate",i,"Dropping of sending ICE candidate end-of-candidates signal or unused ICE candidates to prevent errors ->"],t),void n._handleIceCandidateStats("dropped",e,null,t);if(n._initOptions.filterCandidatesType[i]){if(!n._hasMCU||!n._initOptions.forceTURN)return T.warn([e,"RTCIceCandidate",i,"Dropping of sending ICE candidate as it matches ICE candidate filtering flag ->"],t),void n._handleIceCandidateStats("dropped",e,null,t);T.warn([e,"RTCIceCandidate",i,"Not dropping of sending ICE candidate as TURN connections are enforced as MCU is present (and act as a TURN itself) so filtering of ICE candidate flags are not honoured ->"],t)}if(n._gatheredCandidates[e]||(n._gatheredCandidates[e]={sending:{host:[],srflx:[],relay:[]},receiving:{host:[],srflx:[],relay:[]}}),n._gatheredCandidates[e].sending[i].push({sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate}),!n._initOptions.enableIceTrickle)return T.warn([e,"RTCIceCandidate",i,"Dropping of sending ICE candidate as trickle ICE is disabled ->"],t),void n._handleIceCandidateStats("non_trickle",e,null,t);T.debug([e,"RTCIceCandidate",i,"Sending ICE candidate ->"],t),n._sendChannelMessage({type:n._SIG_MESSAGE_TYPE.CANDIDATE,label:t.sdpMLineIndex,id:t.sdpMid,candidate:t.candidate,mid:n._user.sid,target:e,rid:n._room.id}),n._handleIceCandidateStats("received",e,null,t)}else{if(T.log([e,"RTCIceCandidate",null,"ICE gathering has completed."]),r.gathered)return;if(r.gathering=!1,r.gathered=!0,n._handleIceGatheringStats("complete",e,!1),n._trigger("candidateGenerationState",n.CANDIDATE_GENERATION_STATE.COMPLETED,e),n._initOptions.enableIceTrickle){if(n._gatheredCandidates[e]){var o=function(){n._gatheredCandidates[e]&&n._gatheredCandidates[e].sending&&n._sendChannelMessage({type:n._SIG_MESSAGE_TYPE.END_OF_CANDIDATES,noOfExpectedCandidates:n._gatheredCandidates[e].sending.srflx.length+n._gatheredCandidates[e].sending.host.length+n._gatheredCandidates[e].sending.relay.length,mid:n._user.sid,target:e,rid:n._room.id})};setTimeout(o,6e3)}}else{var a=n._peerConnections[e].localDescription;if(!(a&&a.type&&a.sdp))return void T.warn([e,"RTCSessionDescription",null,"Not sending any session description after ICE gathering completed as it is not present."]);n._sendChannelMessage({type:a.type,sdp:n._renderSDPOutput(e,a),mid:n._user.sid,userInfo:n._getUserInfo(e),target:e,rid:n._room.id})}}},a.prototype._addIceCandidateToQueue=function(e,t,n){var r=n.candidate.split(" ")[7];T.debug([e,"RTCIceCandidate",t+":"+r,"Buffering ICE candidate."]),this._handleIceCandidateStats("buffered",e,t,n),this._trigger("candidateProcessingState",this.CANDIDATE_PROCESSING_STATE.BUFFERED,e,t,r,{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex},null),this._peerCandidatesQueue[e]=this._peerCandidatesQueue[e]||[],this._peerCandidatesQueue[e].push([t,n])},a.prototype._addIceCandidateFromQueue=function(e){this._peerCandidatesQueue[e]=this._peerCandidatesQueue[e]||[];for(var n=0;n<this._peerCandidatesQueue[e].length;n++){var r=this._peerCandidatesQueue[e][n];if(r){var i=r[1].candidate.split(" ")[7];T.debug([e,"RTCIceCandidate",r[0]+":"+i,"Adding buffered ICE candidate."]),this._addIceCandidate(e,r[0],r[1])}else if(this._peerConnections[e]&&this._peerConnections[e].signalingState!==this.PEER_CONNECTION_STATE.CLOSED&&t&&!this._isLowerThanVersion(t.VERSION,"0.14.0"))try{this._peerConnections[e].addIceCandidate(null),T.debug([e,"RTCPeerConnection",null,"Signaling of end-of-candidates remote ICE gathering."])}catch(t){T.error([e,"RTCPeerConnection",null,"Failed signaling of end-of-candidates remote ICE gathering."])}}delete this._peerCandidatesQueue[e],this._signalingEndOfCandidates(e)},a.prototype._addIceCandidate=function(e,t,n){var r=this,i=n.candidate.split(" ")[7],o=function(){T.log([e,"RTCIceCandidate",t+":"+i,"Added ICE candidate successfully."]),r._handleIceCandidateStats("process_success",e,t,n),r._trigger("candidateProcessingState",r.CANDIDATE_PROCESSING_STATE.PROCESS_SUCCESS,e,t,i,{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex},null)},a=function(o){T.error([e,"RTCIceCandidate",t+":"+i,"Failed adding ICE candidate ->"],o),r._handleIceCandidateStats("process_failed",e,t,n,o),r._trigger("candidateProcessingState",r.CANDIDATE_PROCESSING_STATE.PROCESS_ERROR,e,t,i,{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex},o)};if(T.debug([e,"RTCIceCandidate",t+":"+i,"Adding ICE candidate."]),r._handleIceCandidateStats("processing",e,t,n),r._trigger("candidateProcessingState",r.CANDIDATE_PROCESSING_STATE.PROCESSING,e,t,i,{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex},null),!(r._peerConnections[e]&&r._peerConnections[e].signalingState!==r.PEER_CONNECTION_STATE.CLOSED&&r._peerConnections[e].remoteDescription&&r._peerConnections[e].remoteDescription.sdp&&r._peerConnections[e].remoteDescription.sdp.indexOf("\r\na=mid:"+n.sdpMid+"\r\n")>-1))return T.warn([e,"RTCIceCandidate",t+":"+i,"Dropping ICE candidate as Peer connection does not exists or is closed"]),r._handleIceCandidateStats("process_failed",e,t,n,"Peer connection does not exist"),void r._trigger("candidateProcessingState",r.CANDIDATE_PROCESSING_STATE.DROPPED,e,t,i,{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex},new Error("Failed processing ICE candidate as Peer connection does not exists or is closed."));try{r._peerConnections[e].addIceCandidate(n,o,a)}catch(e){a(e)}},a.prototype._setIceServers=function(e){var n=this,r=null,i="stun",o={udp:[3478,19302,19303,19304],tcp:[80,443],both:[19305,19306,19307,19308]},a=[{urls:[]},{urls:[]}];return e.forEach(function(e){if(0===e.url.indexOf("stun:"))e.url.indexOf("temasys")>0?r=(e.url.split(":")[1]||"").split("?")[0]||null:a[0].urls.push(e.url);else if(0===e.url.indexOf("turn:")&&e.url.indexOf("@")>0&&e.credential&&!a[1].username&&!a[1].credential){var t=e.url.split(":"),n=(t[1]||"").split("@");r=(n[1]||"").split("?")[0],a[1].username=n[0],a[1].credential=e.credential,i="turn"}}),n._initOptions.iceServer?a=[{urls:n._initOptions.iceServer.urls,username:a[1].username||null,credential:a[1].credential||null}]:(r=r||"turn.temasys.io","turn"!==i||n._initOptions.enableTURNServer||n._initOptions.forceTURNSSL?"edge"===t.webrtcDetectedBrowser?(o.udp=[3478],o.tcp=[],o.both=[],i="turn"):n._initOptions.forceTURNSSL?"firefox"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion<53?(o.udp=[],o.tcp=[443],o.both=[],i="turn"):(o.udp=[],i="turns"):"firefox"===t.webrtcDetectedBrowser&&(o.udp=[3478],o.tcp=[443,80]):i="stun",n._initOptions.TURNServerTransport!==n.TURN_TRANSPORT.UDP||n._initOptions.forceTURNSSL?n._initOptions.TURNServerTransport===n.TURN_TRANSPORT.TCP?(o.tcp=o.tcp.concat(o.both),o.udp=[],o.both=[]):n._initOptions.TURNServerTransport===n.TURN_TRANSPORT.NONE&&(o.tcp=[],o.udp=[]):(o.udp=o.udp.concat(o.both),o.tcp=[],o.both=[]),"stun"===i&&(o.tcp=[]),"stun"!==i||n._initOptions.enableSTUNServer?(o.tcp.forEach(function(e){a[1].urls.push(i+":"+r+":"+e+"?transport=tcp")}),o.udp.forEach(function(e){a[1].urls.push(i+":"+r+":"+e+"?transport=udp")}),o.both.forEach(function(e){a[1].urls.push(i+":"+r+":"+e)}),n._initOptions.usePublicSTUN||a.splice(0,1)):a=[]),T.log("Output iceServers configuration:",a),{iceServers:a}},a.prototype.refreshConnection=function(e,n,r,i){var o=this,a=Object.keys(o._peerConnections),s=!1,c={};Array.isArray(e)?a=e:"string"==typeof e?a=[e]:"boolean"==typeof e?s=e:e&&"object"==typeof e?c=e:"function"==typeof e&&(i=e),"boolean"==typeof n?s=n:n&&"object"==typeof n?c=n:"function"==typeof n&&(i=n),r&&"object"==typeof r?c=r:"function"==typeof r&&(i=r);var d=function(e){if(T.error(e),"function"==typeof i){var t={};if(0===a.length)t.self=new Error(e);else for(var n=0;n<a.length;n++)t[a[n]]=new Error(e);i({refreshErrors:listOfPeerRestartErrors,listOfPeers:a},null)}};return 0!==a.length||o._hasMCU&&!o._initOptions.mcuUseRenegoRestart?"edge"===t.webrtcDetectedBrowser?void d("Edge browser currently does not support renegotiation."):void o._throttle(function(e){if(!e&&o._hasMCU&&!o._initOptions.mcuUseRenegoRestart)return void(o._initOptions.throttlingShouldThrowError&&d("Unable to run as throttle interval has not reached ("+o._initOptions.throttleIntervals.refreshConnection+"ms)."));o._refreshPeerConnection(a,s,c,i)},"refreshConnection",o._initOptions.throttleIntervals.refreshConnection):void d("There is currently no peer connections to restart")},a.prototype._refreshPeerConnection=function(e,t,n,r){var i=this,o=[],a="",s={},c={},d=function(n){return function(a){-1===o.indexOf(n)&&(a?(T.error([n,"RTCPeerConnection",null,"Failed restarting for peer"],a),s[n]=a):c[n]={iceRestart:!i._hasMCU&&i._peerInformations[n]&&i._peerInformations[n].config&&i._peerInformations[n].config.enableIceRestart&&i._enableIceRestart&&t,customSettings:i.getPeersCustomSettings()[n]||{}},o.push(n)),o.length===e.length&&"function"==typeof r&&(T.log([null,"PeerConnection",null,"Invoked all peers to restart. Firing callback"]),Object.keys(s).length>0?r({refreshErrors:s,listOfPeers:e,refreshSettings:c},null):r(null,{listOfPeers:e,refreshSettings:c}))}};if(i._hasMCU)i._restartMCUConnection(r,t,n);else{var p;for(p=0;p<e.length;p++){var u=e[p];Object.keys(i._peerConnections).indexOf(u)>-1?function(e,r){if(!i._peerConnections[e])return a="There is currently no existing peer connection made with the peer. Unable to restart connection",T.error([e,null,null,a]),void r(a);T.log([e,"PeerConnection",null,"Restarting peer connection"]),i._restartPeerConnection(e,t,n,r)}(u,d(u)):(a="Peer connection with peer does not exists. Unable to restart",T.error([u,"PeerConnection",null,a]),d(u)(a))}}},a.prototype.getConnectionStatus=function(e,n){var r=this,i=Object.keys(r._peerConnections),o={},a={};if(Array.isArray(e)?i=e:"string"==typeof e&&e?i=[e]:"function"==typeof e&&(n=e,e=void 0),0===i.length)return a.self=new Error("There is currently no peer connections to retrieve connection status"),T.error([null,"RTCStatsReport",null,"Retrieving request failure ->"],a.self),void("function"==typeof n&&n({listOfPeers:i,retrievalErrors:a,connectionStats:o},null));"edge"===t.webrtcDetectedBrowser&&T.warn("Edge browser does not have well support for stats.");for(var s=[],c=function(e){-1===s.indexOf(e)&&s.push(e),s.length===i.length&&"function"==typeof n&&(Object.keys(a).length>0?n({listOfPeers:i,retrievalErrors:a,connectionStats:o},null):n(null,{listOfPeers:i,connectionStats:o}))},d=0;d<i.length;d++){var p=i[d];r._trigger("getConnectionStatusStateChange",r.GET_CONNECTION_STATUS_STATE.RETRIEVING,p,null,null),r._peerConnections.hasOwnProperty(p)&&r._peerConnections[p]?function(e){var t=function(t,n){return function(i,s){if(i)return T.error([e,"RTCStatsReport",null,"Retrieval failure ->"],i),a[e]=i,r._trigger("getConnectionStatusStateChange",r.GET_CONNECTION_STATUS_STATE.RETRIEVE_ERROR,e,null,i),c(e),void(t&&delete r._peerStats[e]);t?n():(o[e]=s,r._trigger("getConnectionStatusStateChange",r.GET_CONNECTION_STATUS_STATE.RETRIEVE_SUCCESS,e,o[e],null),c(e))}};if(!r._peerStats[e])return r._peerStats[e]={},T.debug([e,"RTCStatsReport",null,"Retrieving first report to tabulate results"]),void r._retrieveStats(e,t(!0,function(){r._retrieveStats(e,t())}),!0);r._retrieveStats(e,t())}(p):(a[p]=new Error("The peer connection object does not exists"),T.error([p,"RTCStatsReport",null,"Retrieval failure ->"],a[p]),r._trigger("getConnectionStatusStateChange",r.GET_CONNECTION_STATUS_STATE.RETRIEVE_ERROR,p,null,a[p]),c(p))}},a.prototype._retrieveStats=function(e,n,r,i){var o=this,a=o._peerConnections[e],s={raw:{},connection:{},audio:{sending:{},receiving:{}},video:{sending:{},receiving:{}},selectedCandidate:{local:{},remote:{},consentResponses:{},consentRequests:{},responses:{},requests:{}},certificate:{}};if(!o._peerStats[e]&&!i)return n(new Error("No stats initiated yet."));if(!a)return n(new Error("Peer connection is not initialised"));"edge"!==t.webrtcDetectedBrowser&&"AppleWebKit"!==t.webrtcDetectedType||T.warn("Current connection stats may not be complete as it is in beta"),s.connection.iceConnectionState=a.iceConnectionState,s.connection.iceGatheringState=a.iceGatheringState,s.connection.signalingState=a.signalingState,s.connection.remoteDescription={type:a.remoteDescription&&a.remoteDescription.type||"",sdp:a.remoteDescription&&a.remoteDescription.sdp||""},s.connection.localDescription={type:a.localDescription&&a.localDescription.type||"",sdp:a.localDescription&&a.localDescription.sdp||""},s.connection.candidates={sending:o._getSDPICECandidates(e,a.localDescription,r),receiving:o._getSDPICECandidates(e,a.remoteDescription,r)},s.connection.dataChannels={},s.connection.constraints=o._peerConnStatus[e]?o._peerConnStatus[e].constraints:null,s.connection.optional=o._peerConnStatus[e]?o._peerConnStatus[e].optional:null,s.connection.sdpConstraints=o._peerConnStatus[e]?o._peerConnStatus[e].sdpConstraints:null,s.audio.sending.codec=o._getSDPSelectedCodec(e,a.remoteDescription,"audio",r),s.video.sending.codec=o._getSDPSelectedCodec(e,a.remoteDescription,"video",r),s.audio.receiving.codec=o._getSDPSelectedCodec(e,a.localDescription,"audio",r),s.video.receiving.codec=o._getSDPSelectedCodec(e,a.localDescription,"video",r),s.certificate.local=o._getSDPFingerprint(e,a.localDescription,r),s.certificate.remote=o._getSDPFingerprint(e,a.remoteDescription,r);var c=o._getSDPMediaSSRC(e,a.remoteDescription,r);s.audio.receiving.ssrc=c.audio,s.video.receiving.ssrc=c.video;var d=o._getSDPMediaSSRC(e,a.localDescription,r);s.audio.sending.ssrc=d.audio,s.video.sending.ssrc=d.video,Object.keys(o._dataChannels[e]||{}).forEach(function(t){var n=o._dataChannels[e][t];s.connection.dataChannels[n.channel.label]={label:n.channel.label,readyState:n.channel.readyState,channelType:o.DATA_CHANNEL_TYPE["main"===t?"MESSAGING":"DATA"],currentTransferId:n.transferId||null,currentStreamId:n.streamId||null}});var p=function(e,t){if(0===t.indexOf("RTCCertificate_"))e.fingerprint===s.certificate.local.fingerprint?(s.certificate.local.derBase64=e.base64Certificate,s.certificate.local.fingerprintAlgorithm=e.fingerprintAlgorithm):e.fingerprint===s.certificate.remote.fingerprint&&(s.certificate.remote.derBase64=e.base64Certificate,s.certificate.remote.fingerprintAlgorithm=e.fingerprintAlgorithm);else if(0===t.indexOf("ssrc_")&&e.transportId){var n=s.raw[e.transportId]||{};s.certificate.srtpCipher=n.srtpCipher,s.certificate.dtlsCipher=n.dtlsCipher;var r=s.raw[n.localCertificateId||""]||{};s.certificate.local.fingerprint=r.googFingerprint,s.certificate.local.fingerprintAlgorithm=r.googFingerprintAlgorithm,s.certificate.local.derBase64=r.googDerBase64;var i=s.raw[n.remoteCertificateId||""]||{};s.certificate.remote.fingerprint=i.googFingerprint,s.certificate.remote.fingerprintAlgorithm=i.googFingerprintAlgorithm,s.certificate.remote.derBase64=i.googDerBase64}},u=function(t,n){if(0===n.indexOf("RTCIceCandidatePair_")){if("succeeded"!==t.state||s.selectedCandidate.nominated||t.prioirty<(s.selectedCandidate.priority||0))return;for(var r=i?o._peerBandwidth[e][n]:o._peerStats[e][n],c=a.localDescription&&a.localDescription.sdp&&a.localDescription.sdp.match(/a=candidate:.*\r\n/gi)||[],d=a.remoteDescription&&a.remoteDescription&&a.remoteDescription.sdp.match(/a=candidate:.*\r\n/gi)||[],p=function(e,t){return Math.pow(2,32)*Math.min(e,t)+2*Math.max(e,t)+(e>t?1:0)},u=function(e){return"relay"===e?"relayed":"host"===e?"local":"srflx"===e?"serverreflexive":e},l=0;l<c.length;l++)for(var f=c[l].split(" "),h=0;h<d.length;h++){var g=d[h].split(" ");if((t.writable?p(parseInt(f[3],10),parseInt(g[3],10)):p(parseInt(g[3],10),parseInt(f[3],10)))===t.priority){s.selectedCandidate.local.ipAddress=f[4],s.selectedCandidate.local.candidateType=f[7],s.selectedCandidate.local.portNumber=parseInt(f[5],10),s.selectedCandidate.local.transport=f[2],s.selectedCandidate.local.priority=parseInt(f[3],10),s.selectedCandidate.local.candidateType=u(f[7]),s.selectedCandidate.remote.ipAddress=g[4],s.selectedCandidate.remote.candidateType=g[7],s.selectedCandidate.remote.portNumber=parseInt(g[5],10),s.selectedCandidate.remote.transport=g[2],s.selectedCandidate.remote.priority=parseInt(g[3],10),s.selectedCandidate.remote.candidateType=u(g[7]);break}}s.selectedCandidate.writable=t.writable,s.selectedCandidate.readable=t.readable,s.selectedCandidate.priority=t.priority,s.selectedCandidate.nominated=t.nominated;var m=parseInt(t.rtt||"0",10);s.selectedCandidate.totalRtt=m,s.selectedCandidate.rtt=o._parseConnectionStats(r,t,"rtt");var _=parseInt(t.consentResponsesReceived||"0",10);s.selectedCandidate.consentResponses.totalReceived=_,s.selectedCandidate.consentResponses.received=o._parseConnectionStats(r,t,"consentResponsesReceived");var v=parseInt(t.consentResponsesSent||"0",10);s.selectedCandidate.consentResponses.totalSent=v,s.selectedCandidate.consentResponses.sent=o._parseConnectionStats(r,t,"consentResponsesSent");var y=parseInt(t.responsesReceived||"0",10);s.selectedCandidate.responses.totalReceived=y,s.selectedCandidate.responses.received=o._parseConnectionStats(r,t,"responsesReceived");var S=parseInt(t.responsesSent||"0",10);s.selectedCandidate.responses.totalSent=S,s.selectedCandidate.responses.sent=o._parseConnectionStats(r,t,"responsesSent")}else if("googCandidatePair"===t.type){var r=i?o._peerBandwidth[e][n]:o._peerStats[e][n];s.selectedCandidate.writable="true"===t.googWritable,s.selectedCandidate.readable="true"===t.googReadable;var m=parseInt(t.googRtt||"0",10);if(s.selectedCandidate.totalRtt=m,s.selectedCandidate.rtt=o._parseConnectionStats(r,t,"rtt"),t.consentResponsesReceived){var _=parseInt(t.consentResponsesReceived||"0",10);s.selectedCandidate.consentResponses.totalReceived=_,s.selectedCandidate.consentResponses.received=o._parseConnectionStats(r,t,"consentResponsesReceived")}if(t.consentResponsesSent){var v=parseInt(t.consentResponsesSent||"0",10);s.selectedCandidate.consentResponses.totalSent=v,s.selectedCandidate.consentResponses.sent=o._parseConnectionStats(r,t,"consentResponsesSent")}if(t.responsesReceived){var y=parseInt(t.responsesReceived||"0",10);s.selectedCandidate.responses.totalReceived=y,s.selectedCandidate.responses.received=o._parseConnectionStats(r,t,"responsesReceived")}if(t.responsesSent){var S=parseInt(t.responsesSent||"0",10);s.selectedCandidate.responses.totalSent=S,s.selectedCandidate.responses.sent=o._parseConnectionStats(r,t,"responsesSent")}var C=s.raw[t.localCandidateId||""]||{};s.selectedCandidate.local.ipAddress=C.ipAddress,s.selectedCandidate.local.portNumber=parseInt(C.portNumber,10),s.selectedCandidate.local.priority=parseInt(C.priority,10),s.selectedCandidate.local.networkType=C.networkType,s.selectedCandidate.local.transport=C.transport,s.selectedCandidate.local.candidateType=C.candidateType;var T=s.raw[t.remoteCandidateId||""]||{};s.selectedCandidate.remote.ipAddress=T.ipAddress,s.selectedCandidate.remote.portNumber=parseInt(T.portNumber,10),s.selectedCandidate.remote.priority=parseInt(T.priority,10),s.selectedCandidate.remote.transport=T.transport,s.selectedCandidate.remote.candidateType=T.candidateType}else if("candidatepair"===t.type&&"succeeded"===t.state&&t.nominated){s.selectedCandidate.writable=t.writable,s.selectedCandidate.readable=t.readable;var C=s.raw[t.localCandidateId||""];s.selectedCandidate.local.ipAddress=C.ipAddress,s.selectedCandidate.local.portNumber=C.portNumber,s.selectedCandidate.local.transport=C.transport,s.selectedCandidate.local.candidateType=C.candidateType,s.selectedCandidate.local.turnMediaTransport=C.mozLocalTransport;var T=s.raw[t.remoteCandidateId||""];s.selectedCandidate.remote.ipAddress=T.ipAddress,s.selectedCandidate.remote.portNumber=T.portNumber,s.selectedCandidate.remote.transport=T.transport,s.selectedCandidate.remote.candidateType=T.candidateType}},l=function(e,t){if(0===t.indexOf("ssrc_")){var n=t.indexOf("_send")>0?"sending":"receiving";e.codecImplementationName="unknown"===e.codecImplementationName?null:e.codecImplementationName,s[e.mediaType][n].codec.implementation=e.codecImplementationName||null,e.googCodecName="unknown"===e.googCodecName?null:e.googCodecName,s[e.mediaType][n].codec.name=e.googCodecName||s[e.mediaType][n].codec.name}},f=function(n,r){var c=i?o._peerBandwidth[e][r]:o._peerStats[e][r];if(0===r.indexOf("RTCInboundRTPAudioStream")){if(s.audio.receiving.fractionLost=n.fractionLost,s.audio.receiving.jitter=n.jitter,s.audio.receiving.totalBytes=n.bytesReceived,s.audio.receiving.bytes=o._parseConnectionStats(c,n,"bytesReceived"),s.audio.receiving.totalPackets=n.packetsReceived,s.audio.receiving.packets=o._parseConnectionStats(c,n,"packetsReceived"),s.audio.receiving.totalPacketsDiscarded=n.packetsDiscarded,s.audio.receiving.packetsDiscarded=o._parseConnectionStats(c,n,"packetsDiscarded"),s.audio.receiving.totalPacketsLost=n.packetsLost,s.audio.receiving.packetsLost=o._parseConnectionStats(c,n,"packetsLost"),s.audio.receiving.totalNacks=n.nackCount,s.audio.receiving.nacks=o._parseConnectionStats(c,n,"nackCount"),"function"!=typeof a.getReceivers)return}else if(0===r.indexOf("RTCMediaStreamTrack_remote_audio_"))s.audio.receiving.audioOutputLevel=n.audioLevel;else if(0===r.indexOf("RTCOutboundRTPAudioStream"))s.audio.sending.targetBitrate=n.targetBitrate||0,s.audio.sending.totalBytes=n.bytesSent,s.audio.sending.bytes=o._parseConnectionStats(c,n,"bytesSent"),s.audio.sending.totalPackets=n.packetsSent,s.audio.sending.packets=o._parseConnectionStats(c,n,"packetsSent"),s.audio.sending.totalNacks=n.nackCount,s.audio.sending.nacks=o._parseConnectionStats(c,n,"nackCount");else if("edge"===t.webrtcDetectedBrowser&&"inboundrtp"===n.type&&"audio"===n.mediaType&&n.isRemote)s.audio.receiving.fractionLost=n.fractionLost,s.audio.receiving.jitter=n.jitter,s.audio.receiving.totalBytes=n.bytesReceived,s.audio.receiving.bytes=o._parseConnectionStats(c,n,"bytesReceived"),s.audio.receiving.totalPackets=n.packetsReceived,s.audio.receiving.packets=o._parseConnectionStats(c,n,"packetsReceived"),s.audio.receiving.totalPacketsLost=n.packetsLost,s.audio.receiving.packetsLost=o._parseConnectionStats(c,n,"packetsLost"),s.audio.receiving.totalNacks=n.nackCount,s.audio.receiving.nacks=o._parseConnectionStats(c,n,"nackCount");else if("edge"!==t.webrtcDetectedBrowser||"outboundrtp"!==n.type||"audio"!==n.mediaType||n.isRemote){if(0===r.indexOf("ssrc_")&&"audio"===n.mediaType)if(r.indexOf("_recv")>0){s.audio.receiving.jitter=parseInt(n.googJitterReceived||"0",10),s.audio.receiving.jitterBufferMs=parseInt(n.googJitterBufferMs||"0",10),s.audio.receiving.currentDelayMs=parseInt(n.googCurrentDelayMs||"0",10);var d=parseInt(n.bytesReceived||"0",10);s.audio.receiving.totalBytes=d,s.audio.receiving.bytes=o._parseConnectionStats(c,n,"bytesReceived");var p=parseInt(n.packetsReceived||"0",10);s.audio.receiving.totalPackets=p,s.audio.receiving.packets=o._parseConnectionStats(c,n,"packetsReceived");var u=parseInt(n.packetsLost||"0",10);s.audio.receiving.totalPacketsLost=u,s.audio.receiving.packetsLost=o._parseConnectionStats(c,n,"packetsLost")}else{s.audio.sending.rtt=parseInt(n.googRtt||"0",10),s.audio.sending.audioInputLevel=parseInt(n.audioInputLevel||"0",10),s.audio.sending.echoReturnLoss=parseInt(n.googEchoCancellationReturnLoss||"0",10),s.audio.sending.echoReturnLossEnhancement=parseInt(n.googEchoCancellationReturnLossEnhancement||"0",10);var l=parseInt(n.bytesSent||"0",10);s.audio.sending.totalBytes=l,s.audio.sending.bytes=o._parseConnectionStats(c,n,"bytesSent");var f=parseInt(n.packetsSent||"0",10);s.audio.sending.totalPackets=f,s.audio.sending.packets=o._parseConnectionStats(c,n,"packetsSent")}else if(0===r.indexOf("inbound_rtp_audio"))s.audio.receiving.jitter=n.jitter||0,s.audio.receiving.totalBytes=n.bytesReceived,s.audio.receiving.bytes=o._parseConnectionStats(c,n,"bytesReceived"),s.audio.receiving.totalPackets=n.packetsReceived,s.audio.receiving.packets=o._parseConnectionStats(c,n,"packetsReceived"),s.audio.receiving.totalPacketsLost=n.packetsLost,s.audio.receiving.packetsLost=o._parseConnectionStats(c,n,"packetsLost"),s.audio.receiving.totalNacks=n.nackCount,s.audio.receiving.nacks=o._parseConnectionStats(c,n,"nackCount");else if(0===r.indexOf("outbound_rtp_audio")){s.audio.sending.totalBytes=n.bytesSent,s.audio.sending.bytes=o._parseConnectionStats(c,n,"bytesSent"),s.audio.sending.totalPackets=n.packetsSent,s.audio.sending.packets=o._parseConnectionStats(c,n,"packetsSent"),s.audio.sending.totalNacks=n.nackCount,s.audio.sending.nacks=o._parseConnectionStats(c,n,"nackCount");var h=s.raw[r.replace(/_rtp_/g,"_rtcp_")]||{};s.audio.sending.rtt=h.roundTripTime||0}}else{s.audio.sending.targetBitrate=n.targetBitrate,s.audio.sending.rtt=n.roundTripTime,s.audio.sending.totalBytes=n.bytesSent,s.audio.sending.bytes=o._parseConnectionStats(c,n,"bytesSent"),s.audio.sending.totalPackets=n.packetsSent,s.audio.sending.packets=o._parseConnectionStats(c,n,"packetsSent"),s.audio.sending.totalNacks=n.nackCount,s.audio.sending.nacks=o._parseConnectionStats(c,n,"nackCount");var g=s.raw[n.mediaTrackId||""]||{};s.audio.sending.audioInputLevel=g.audioLevel,s.audio.sending.echoReturnLoss=g.echoReturnLoss,s.audio.sending.echoReturnLossEnhancement=g.echoReturnLossEnhancement}},h=function(n,r){var a=i?o._peerBandwidth[e][r]:o._peerStats[e][r];if(0===r.indexOf("RTCInboundRTPVideoStream"))s.video.receiving.fractionLost=n.fractionLost,s.video.receiving.jitter=n.jitter,s.video.receiving.framesDecoded=n.framesDecoded,s.video.receiving.qpSum=n.qpSum,s.video.receiving.totalBytes=n.bytesReceived,s.video.receiving.bytes=o._parseConnectionStats(a,n,"bytesReceived"),s.video.receiving.totalPackets=n.packetsReceived,s.video.receiving.packets=o._parseConnectionStats(a,n,"packetsReceived"),s.video.receiving.totalPacketsDiscarded=n.packetsDiscarded,s.video.receiving.packetsDiscarded=o._parseConnectionStats(a,n,"packetsDiscarded"),s.video.receiving.totalPacketsLost=n.packetsLost,s.video.receiving.packetsLost=o._parseConnectionStats(a,n,"packetsLost"),s.video.receiving.totalNacks=n.nackCount,s.video.receiving.nacks=o._parseConnectionStats(a,n,"nackCount"),s.video.receiving.totalFirs=n.firCount,s.video.receiving.firs=o._parseConnectionStats(a,n,"firCount"),s.video.receiving.totalSlis=n.sliCount,s.video.receiving.slis=o._parseConnectionStats(a,n,"sliCount");else if(0===r.indexOf("RTCMediaStreamTrack_remote_video_"))s.video.receiving.frameHeight=n.frameHeight,s.video.receiving.frameWidth=n.frameWidth,s.video.receiving.framesCorrupted=n.framesCorrupted,s.video.receiving.framesPerSecond=n.framesPerSecond,s.video.receiving.framesDropped=n.framesDropped,s.video.receiving.totalFrames=n.framesReceived,s.video.receiving.frames=o._parseConnectionStats(a,n,"framesReceived");else if(0===r.indexOf("RTCOutboundRTPVideoStream"))s.video.sending.qpSum=n.qpSum,s.video.sending.targetBitrate=n.targetBitrate||0,s.video.sending.framesEncoded=n.framesEncoded||0,s.video.sending.totalBytes=n.bytesSent,s.video.sending.bytes=o._parseConnectionStats(a,n,"bytesSent"),s.video.sending.totalPackets=n.packetsSent,s.video.sending.packets=o._parseConnectionStats(a,n,"packetsSent"),s.video.sending.totalNacks=n.nackCount,s.video.sending.nacks=o._parseConnectionStats(a,n,"nackCount"),s.video.receiving.totalFirs=n.firCount,s.video.receiving.firs=o._parseConnectionStats(a,n,"firCount"),s.video.sending.totalSlis=n.sliCount,s.video.sending.slis=o._parseConnectionStats(a,n,"sliCount");else if("edge"===t.webrtcDetectedBrowser&&"inboundrtp"===n.type&&"video"===n.mediaType&&n.isRemote){s.video.receiving.fractionLost=n.fractionLost,s.video.receiving.jitter=n.jitter,s.video.receiving.totalBytes=n.bytesReceived,s.video.receiving.bytes=o._parseConnectionStats(a,n,"bytesReceived"),s.video.receiving.totalPackets=n.packetsReceived,s.video.receiving.packets=o._parseConnectionStats(a,n,"packetsReceived"),s.video.receiving.totalPacketsLost=n.packetsLost,s.video.receiving.packetsLost=o._parseConnectionStats(a,n,"packetsLost"),s.video.receiving.totalNacks=n.nackCount,s.video.receiving.nacks=o._parseConnectionStats(a,n,"nackCount"),s.video.receiving.totalPlis=n.pliCount,s.video.receiving.plis=o._parseConnectionStats(a,n,"pliCount"),s.video.receiving.totalFirs=n.firCount,s.video.receiving.firs=o._parseConnectionStats(a,n,"firCount"),s.video.receiving.totalSlis=n.sliCount,s.video.receiving.slis=o._parseConnectionStats(a,n,"sliCount");var c=s.raw[n.mediaTrackId||""]||{};s.video.receiving.framesCorrupted=c.framesCorrupted,s.video.receiving.framesDropped=c.framesDropped,s.video.receiving.framesDecoded=c.framesDecoded,s.video.receiving.totalFrames=c.framesReceived,s.video.receiving.frames=o._parseConnectionStats(a,c,"framesReceived")}else if("edge"!==t.webrtcDetectedBrowser||"outboundrtp"!==n.type||"video"!==n.mediaType||n.isRemote){if(0===r.indexOf("ssrc_")&&"video"===n.mediaType)if(r.indexOf("_recv")>0){s.video.receiving.jitter=parseInt(n.googJitterReceived||"0",10),s.video.receiving.jitterBufferMs=parseInt(n.googJitterBufferMs||"0",10),s.video.receiving.currentDelayMs=parseInt(n.googCurrentDelayMs||"0",10),s.video.receiving.renderDelayMs=parseInt(n.googRenderDelayMs||"0",10),s.video.receiving.frameWidth=parseInt(n.googFrameWidthReceived||"0",10),s.video.receiving.frameHeight=parseInt(n.googFrameHeightReceived||"0",10),s.video.receiving.framesDecoded=parseInt(n.framesDecoded||"0",10),s.video.receiving.frameRateOutput=parseInt(n.googFrameRateOutput||"0",10),s.video.receiving.frameRateDecoded=parseInt(n.googFrameRateDecoded||"0",10),s.video.receiving.frameRateReceived=parseInt(n.googFrameRateReceived||"0",10),s.video.receiving.qpSum=parseInt(n.qpSum||"0",10);var d=parseInt(n.bytesReceived||"0",10);s.video.receiving.totalBytes=d,s.video.receiving.bytes=o._parseConnectionStats(a,n,"bytesReceived");var p=parseInt(n.packetsReceived||"0",10);s.video.receiving.totalPackets=p,s.video.receiving.packets=o._parseConnectionStats(a,n,"packetsReceived");var u=parseInt(n.packetsLost||"0",10);s.video.receiving.totalPacketsLost=u,s.video.receiving.packetsLost=o._parseConnectionStats(a,n,"packetsLost");var l=parseInt(n.googNacksSent||"0",10);s.video.receiving.totalNacks=l,s.video.receiving.nacks=o._parseConnectionStats(a,n,"googNacksSent");var f=parseInt(n.googPlisSent||"0",10);s.video.receiving.totalPlis=f,s.video.receiving.plis=o._parseConnectionStats(a,n,"googPlisSent");var h=parseInt(n.googFirsSent||"0",10);s.video.receiving.totalFirs=h,s.video.receiving.firs=o._parseConnectionStats(a,n,"googFirsSent")}else{s.video.sending.rtt=parseInt(n.googRtt||"0",10),s.video.sending.frameWidth=parseInt(n.googFrameWidthSent||"0",10),s.video.sending.frameHeight=parseInt(n.googFrameHeightSent||"0",10),s.video.sending.framesEncoded=parseInt(n.framesEncoded||"0",10),s.video.sending.frameRateInput=parseInt(n.googFrameRateInput||"0",10),s.video.sending.frameRateEncoded=parseInt(n.googFrameRateEncoded||"0",10),s.video.sending.frameRateSent=parseInt(n.googFrameRateSent||"0",10),s.video.sending.cpuLimitedResolution="true"===n.googCpuLimitedResolution,s.video.sending.bandwidthLimitedResolution="true"===n.googBandwidthLimitedResolution;var g=parseInt(n.bytesSent||"0",10);s.video.sending.totalBytes=g,s.video.sending.bytes=o._parseConnectionStats(a,n,"bytesSent");var m=parseInt(n.packetsSent||"0",10);s.video.sending.totalPackets=m,s.video.sending.packets=o._parseConnectionStats(a,n,"packetsSent");var _=parseInt(n.googNacksReceived||"0",10);s.video.sending.totalNacks=_,s.video.sending.nacks=o._parseConnectionStats(a,n,"googNacksReceived");var v=parseInt(n.googPlisReceived||"0",10);s.video.sending.totalPlis=v,s.video.sending.plis=o._parseConnectionStats(a,n,"googPlisReceived");var y=parseInt(n.googFirsReceived||"0",10);s.video.sending.totalFirs=y,s.video.sending.firs=o._parseConnectionStats(a,n,"googFirsReceived")}else if(0===r.indexOf("inbound_rtp_video"))s.video.receiving.jitter=n.jitter||0,s.video.receiving.framesDecoded=n.framesDecoded||0,s.video.receiving.frameRateMean=n.framerateMean||0,s.video.receiving.frameRateStdDev=n.framerateStdDev||0,s.video.receiving.totalBytes=n.bytesReceived,s.video.receiving.bytes=o._parseConnectionStats(a,n,"bytesReceived"),s.video.receiving.totalPackets=n.packetsReceived,s.video.receiving.packets=o._parseConnectionStats(a,n,"packetsReceived"),s.video.receiving.totalPacketsLost=n.packetsLost,s.video.receiving.packetsLost=o._parseConnectionStats(a,n,"packetsLost"),s.video.receiving.totalNacks=n.nackCount,s.video.receiving.nacks=o._parseConnectionStats(a,n,"nackCount"),s.video.receiving.totalPlis=n.pliCount,s.video.receiving.plis=o._parseConnectionStats(a,n,"pliCount"),s.video.receiving.totalFirs=n.firCount,s.video.receiving.firs=o._parseConnectionStats(a,n,"firCount");else if(0===r.indexOf("outbound_rtp_video")){s.video.sending.framesEncoded=n.framesEncoded||0,s.video.sending.frameRateMean=n.framerateMean||0,s.video.sending.frameRateStdDev=n.framerateStdDev||0,s.video.sending.framesDropped=n.droppedFrames||0,s.video.sending.totalBytes=n.bytesSent,s.video.sending.bytes=o._parseConnectionStats(a,n,"bytesSent"),s.video.sending.totalPackets=n.packetsSent,s.video.sending.packets=o._parseConnectionStats(a,n,"packetsSent"),s.video.sending.totalNacks=n.nackCount,s.video.sending.nacks=o._parseConnectionStats(a,n,"nackCount"),s.video.sending.totalPlis=n.pliCount,s.video.sending.plis=o._parseConnectionStats(a,n,"pliCount"),s.video.sending.totalFirs=n.firCount,s.video.sending.firs=o._parseConnectionStats(a,n,"firCount");var S=s.raw[r.replace(/_rtp_/g,"_rtcp_")]||{};s.video.sending.rtt=S.roundTripTime||0}}else{s.video.sending.targetBitrate=n.targetBitrate||0,s.video.sending.roundTripTime=n.roundTripTime||0,s.video.sending.totalBytes=n.bytesSent,s.video.sending.bytes=o._parseConnectionStats(a,n,"bytesSent"),s.video.sending.totalPackets=n.packetsSent,s.video.sending.packets=o._parseConnectionStats(a,n,"packetsSent"),s.video.sending.totalNacks=n.nackCount,s.video.sending.nacks=o._parseConnectionStats(a,n,"nackCount"),s.video.sending.totalFirs=n.firCount,s.video.sending.firs=o._parseConnectionStats(a,n,"firCount"),s.video.sending.totalPlis=n.pliCount,s.video.sending.plis=o._parseConnectionStats(a,n,"pliCount"),s.video.sending.totalSlis=n.sliCount,s.video.sending.slis=o._parseConnectionStats(a,n,"sliCount");var c=s.raw[n.mediaTrackId||""]||{};s.video.sending.frameHeight=c.frameHeight,s.video.sending.frameWidth=c.frameWidth,s.video.sending.framesPerSecond=c.framesPerSecond,s.video.sending.totalFrames=c.framesSent,s.video.sending.frames=o._parseConnectionStats(a,c,"framesSent")}},g=function(n,i){if(0===i.indexOf("ssrc_")&&"video"===n.mediaType){var o=parseInt(n.googCaptureStartNtpTimeMs||"0",10),c=a.getRemoteStreams()[0];if(!(o>0&&i.indexOf("_recv")>0&&c&&document&&"function"==typeof document.getElementsByTagName))return;try{var d=document.getElementsByTagName("plugin"===t.webrtcDetectedType?"object":"video");"plugin"!==t.webrtcDetectedType&&0===d.length&&(d=document.getElementsByTagName("audio"));for(var p=0;p<d.length;p++){var u=null;if("plugin"===t.webrtcDetectedType){if(!(d[p].children&&"object"==typeof d[p].children&&"number"==typeof d[p].children.length&&d[p].children.length>0))break;for(var l=0;l<d[p].children.length;l++)if("streamId"===d[p].children[l].name){u=d[p].children[l].value||null;break}}else u=d[p].srcObject&&(d[p].srcObject.id||d[p].srcObject.label)||null;if(u&&u===(c.id||c.label)){s.video.receiving.e2eDelay=(new Date).getTime()+22089888e5-o-1e3*d[p].currentTime;break}}}catch(t){r||T.warn([e,"RTCStatsReport",null,"Failed retrieving e2e delay ->"],t)}}},m=function(r){"function"==typeof r.forEach?r.forEach(function(e,t){s.raw[t]=e}):s.raw=r;var c={remote:{},local:{}};"edge"===t.webrtcDetectedBrowser&&(a.remoteStream&&a.remoteStream.getTracks().forEach(function(e){c.remote[e.id]=e.kind}),a.localStream&&a.localStream.getTracks().forEach(function(e){c.local[e.id]=e.kind})),Object.keys(s.raw).forEach(function(n){if(0!==n.indexOf("ssrc_")||s.raw[n].mediaType){if("edge"===t.webrtcDetectedBrowser&&!s.raw[n].mediaType&&["inboundrtp","outboundrtp"].indexOf(s.raw[n].type)>-1){var r=s.raw[s.raw[n].mediaTrackId]||{};s.raw[n].mediaType=c[s.raw[n].isRemote?"remote":"local"][r.trackIdentifier]||""}}else s.raw[n].mediaType=s.raw[n].audioInputLevel||s.raw[n].audioOutputLevel?"audio":"video";p(s.raw[n],n),u(s.raw[n],n),l(s.raw[n],n),f(s.raw[n],n),h(s.raw[n],n),g(s.raw[n],n),i&&!o._peerBandwidth[e][n]?o._peerBandwidth[e][n]=s.raw[n]:i||o._peerStats[e][n]||(o._peerStats[e][n]=s.raw[n])}),s.audio.sending.bytes=s.audio.sending.bytes||0,s.audio.sending.packets=s.audio.sending.packets||0,s.audio.sending.totalBytes=s.audio.sending.totalBytes||0,s.audio.sending.totalPackets=s.audio.sending.totalPackets||0,s.video.sending.bytes=s.video.sending.bytes||0,s.video.sending.packets=s.video.sending.packets||0,s.video.sending.totalBytes=s.video.sending.totalBytes||0,s.video.sending.totalPackets=s.video.sending.totalPackets||0,s.audio.receiving.bytes=s.audio.receiving.bytes||0,s.audio.receiving.packets=s.audio.receiving.packets||0,s.audio.receiving.totalBytes=s.audio.receiving.totalBytes||0,s.audio.receiving.totalPackets=s.audio.receiving.totalPackets||0,s.video.receiving.bytes=s.video.receiving.bytes||0,s.video.receiving.packets=s.video.receiving.packets||0,s.video.receiving.totalBytes=s.video.receiving.totalBytes||0,s.video.receiving.totalPackets=s.video.receiving.totalPackets||0,n(null,s)},_=function(t){r||T.error([e,"RTCStatsReport",null,"Failed retrieving stats ->"],t),n(t,null)};if("function"!=typeof a.getStats)return _(new Error("getStats() API is not available."));"plugin"===t.webrtcDetectedType?a.getStats(null,m,_):a.getStats(null).then(m).catch(_)},a.prototype._addPeer=function(e,t,n,r,i){var o=this;return o._peerConnections[e]?void T.error([e,null,null,"Connection to peer has already been made"]):(o._peerConnStatus[e]={connected:!1,init:!1},T.log([e,null,null,"Starting the connection to peer. Options provided:"],{peerBrowser:n,receiveOnly:r,enableDataChannel:o._initOptions.enableDataChannel}),T.info("Adding peer",i),o._peerConnections[e]=o._createPeerConnection(e,!!i,t),o._peerConnections[e]?(o._peerConnStatus[e].init=!0,void(o._peerConnections[e].hasScreen=!!i)):void T.error([e,null,null,"Failed creating the connection to peer."]))},a.prototype._restartPeerConnection=function(e,n,r,i){var o=this;if(!o._peerConnections[e])return void T.error([e,null,null,"Peer does not have an existing connection. Unable to restart"]);var a=o._peerConnections[e],s=(o.getPeerInfo(e)||{}).agent||{};if(o._isLowerThanVersion(s.SMProtocolVersion||"","0.1.2")){var c=new Error("Failed restarting with other agents connecting from other SDKs as re-negotiation is not supported by other SDKs");return T.warn([e,"RTCPeerConnection",null,"Ignoring restart request as agent's SDK does not support it"],c),void("function"==typeof i&&(T.debug([e,"RTCPeerConnection",null,"Firing restart failure callback"]),i(c)))}if(a.signalingState===o.PEER_CONNECTION_STATE.STABLE&&o._peerConnections[e]){T.log([e,null,null,"Sending restart message to signaling server ->"],{iceRestart:n,options:r}),o._peerCustomConfigs[e]=o._peerCustomConfigs[e]||{},o._peerCustomConfigs[e].bandwidth=o._peerCustomConfigs[e].bandwidth||{},o._peerCustomConfigs[e].googleXBandwidth=o._peerCustomConfigs[e].googleXBandwidth||{},r.bandwidth&&"object"==typeof r.bandwidth&&("number"==typeof r.bandwidth.audio&&(o._peerCustomConfigs[e].bandwidth.audio=r.bandwidth.audio),"number"==typeof r.bandwidth.video&&(o._peerCustomConfigs[e].bandwidth.video=r.bandwidth.video),"number"==typeof r.bandwidth.data&&(o._peerCustomConfigs[e].bandwidth.data=r.bandwidth.data)),r.googleXBandwidth&&"object"==typeof r.googleXBandwidth&&("number"==typeof r.googleXBandwidth.min&&(o._peerCustomConfigs[e].googleXBandwidth.min=r.googleXBandwidth.min),"number"==typeof r.googleXBandwidth.max&&(o._peerCustomConfigs[e].googleXBandwidth.max=r.googleXBandwidth.max));var d={type:o._SIG_MESSAGE_TYPE.RESTART,mid:o._user.sid,rid:o._room.id,agent:t.webrtcDetectedBrowser,version:(t.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:o._getUserInfo(e),target:e,weight:o._peerPriorityWeight,receiveOnly:o.getPeerInfo().config.receiveOnly,enableIceTrickle:o._initOptions.enableIceTrickle,enableDataChannel:o._initOptions.enableDataChannel,enableIceRestart:o._enableIceRestart,doIceRestart:!0===n&&o._enableIceRestart&&o._peerInformations[e]&&o._peerInformations[e].config.enableIceRestart,isRestartResend:!1,temasysPluginVersion:t.WebRTCPlugin.plugin?t.WebRTCPlugin.plugin.VERSION:null,SMProtocolVersion:o.SM_PROTOCOL_VERSION,DTProtocolVersion:o.DT_PROTOCOL_VERSION};o._publishOnly&&(d.publishOnly={type:o._streams.screenshare&&o._streams.screenshare.stream?"screenshare":"video"}),o._parentId&&(d.parentId=o._parentId),o._peerEndOfCandidatesCounter[e]=o._peerEndOfCandidatesCounter[e]||{},o._peerEndOfCandidatesCounter[e].len=0,o._sendChannelMessage(d),o._handleNegotiationStats("restart",e,d,!1),o._trigger("peerRestart",e,o.getPeerInfo(e),!0,!0===n),"function"==typeof i&&(T.debug([e,"RTCPeerConnection",null,"Firing restart callback"]),i(null))}else if(a.signalingState===o.PEER_CONNECTION_STATE.HAVE_LOCAL_OFFER){var p=a.localDescription&&a.localDescription.sdp;if(p)o._sendChannelMessage({type:a.localDescription.type,sdp:a.localDescription.sdp,mid:o._user.sid,target:e,rid:o._room.id,restart:!0});else{var u="Failed re-sending localDescription as there is no localDescription set to connection. There could be a handshaking step error";T.error([e,"RTCPeerConnection",null,u],{localDescription:a.localDescription,remoteDescription:a.remoteDescription}),"function"==typeof i&&(T.debug([e,"RTCPeerConnection",null,"Firing restart failure callback"]),i(new Error(u)))}}else{var l="Failed restarting as peer connection state is "+a.signalingState;T.warn([e,"RTCPeerConnection",null,l]),"function"==typeof i&&(T.debug([e,"RTCPeerConnection",null,"Firing restart failure callback"]),i(new Error(l)))}},a.prototype._removePeer=function(e){if(!this._peerConnections[e]&&!this._peerInformations[e])return void T.debug([e,"RTCPeerConnection",null,"Dropping the hangup from Peer as not connected to Peer at all."]);var n=s(this.getPeerInfo(e))||{userData:"",settings:{audio:!1,video:!1,data:!1},mediaStatus:{audioMuted:!0,videoMuted:!0},agent:{name:"unknown",version:0,os:"",pluginVersion:null},config:{enableDataChannel:!0,enableIceRestart:!1,enableIceTrickle:!0,priorityWeight:0,publishOnly:!1,receiveOnly:!0},parentId:null,room:s(this._selectedRoom)};"MCU"!==e?this._trigger("peerLeft",e,n,!1):(this._hasMCU=!1,T.log([e,null,null,"MCU has stopped listening and left"]),this._trigger("serverPeerLeft",e,this.SERVER_PEER_TYPE.MCU)),this._peerConnections[e]&&(this._peerConnections[e].signalingState!==this.PEER_CONNECTION_STATE.CLOSED&&(this._peerConnections[e].close(),"AppleWebKit"===t.webrtcDetectedType&&(this._peerConnections[e].signalingStateClosed||(this._peerConnections[e].signalingStateClosed=!0,this._trigger("peerConnectionState",this.PEER_CONNECTION_STATE.CLOSED,e)),this._peerConnections[e].iceConnectionStateClosed||(this._peerConnections[e].iceConnectionStateClosed=!0,this._handleIceConnectionStats(this.ICE_CONNECTION_STATE.CLOSED,e),this._trigger("iceConnectionState",this.ICE_CONNECTION_STATE.CLOSED,e)))),"MCU"!==e&&this._handleEndedStreams(e),delete this._peerConnections[e]),this._peerInformations[e]&&delete this._peerInformations[e],this._peerMessagesStamps[e]&&delete this._peerMessagesStamps[e],this._streamsSession[e]&&delete this._streamsSession[e],this._peerEndOfCandidatesCounter[e]&&delete this._peerEndOfCandidatesCounter[e],this._peerCandidatesQueue[e]&&delete this._peerCandidatesQueue[e],this._sdpSessions[e]&&delete this._sdpSessions[e],this._peerStats[e]&&delete this._peerStats[e],this._peerBandwidth[e]&&delete this._peerBandwidth[e],this._gatheredCandidates[e]&&delete this._gatheredCandidates[e],this._peerCustomConfigs[e]&&delete this._peerCustomConfigs[e],this._peerConnStatus[e]&&delete this._peerConnStatus[e],this._dataChannels[e]&&this._closeDataChannel(e),T.log([e,"RTCPeerConnection",null,"Successfully removed peer"])},a.prototype._createPeerConnection=function(e,n,r){var i,o=this;if(o._inRoom&&o._room&&o._room.connection&&o._room.connection.peerConfig&&Array.isArray(o._room.connection.peerConfig.iceServers)){var a={iceServers:o._room.connection.peerConfig.iceServers,iceTransportPolicy:o._initOptions.filterCandidatesType.host&&o._initOptions.filterCandidatesType.srflx&&!o._initOptions.filterCandidatesType.relay?"relay":"all",bundlePolicy:o._peerConnectionConfig.bundlePolicy===o.BUNDLE_POLICY.NONE?o.BUNDLE_POLICY.BALANCED:o._peerConnectionConfig.bundlePolicy,rtcpMuxPolicy:o._peerConnectionConfig.rtcpMuxPolicy,iceCandidatePoolSize:o._peerConnectionConfig.iceCandidatePoolSize},c={optional:[{DtlsSrtpKeyAgreement:!0},{googIPv6:!0}]};r&&(a.certificates=[r]),o._peerConnStatus[e]&&(o._peerConnStatus[e].constraints=a,o._peerConnStatus[e].optional=c),"chrome"===t.webrtcDetectedBrowser&&(a.sdpSemantics="plan-b");try{T.debug([e,"RTCPeerConnection",null,"Creating peer connection ->"],{constraints:a,optional:c}),i=new(o._initOptions.useEdgeWebRTC&&window.msRTCPeerConnection?window.msRTCPeerConnection:RTCPeerConnection)(a,c)}catch(t){return T.error([e,null,null,"Failed creating peer connection:"],t),o._trigger("handshakeProgress",o.HANDSHAKE_PROGRESS.ERROR,e,t),null}i.setOffer="",i.setAnswer="",i.hasStream=!1,i.hasScreen=!!n,i.hasMainChannel=!1,i.firefoxStreamId="",i.processingLocalSDP=!1,i.processingRemoteSDP=!1,i.gathered=!1,i.gathering=!1,i.localStream=null,i.localStreamId=null,i.remoteStream=null,i.remoteStreamId=null,i.iceConnectionStateClosed=!1,i.signalingStateClosed=!1,o._gatheredCandidates[e]={sending:{host:[],srflx:[],relay:[]},receiving:{host:[],srflx:[],relay:[]}},o._streamsSession[e]=o._streamsSession[e]||{},o._peerEndOfCandidatesCounter[e]=o._peerEndOfCandidatesCounter[e]||{},o._sdpSessions[e]={local:{},remote:{}},o._peerBandwidth[e]={};var d=null;i.ondatachannel=function(t){var n=t.channel||t;if(T.debug([e,"RTCDataChannel",n.label,"Received datachannel ->"],n),o._initOptions.enableDataChannel&&o._peerInformations[e]&&o._peerInformations[e].config.enableDataChannel){o.DATA_CHANNEL_TYPE.DATA,n.label;i.hasMainChannel||(o.DATA_CHANNEL_TYPE.MESSAGING,"main",i.hasMainChannel=!0),o._createDataChannel(e,n)}else T.warn([e,"RTCDataChannel",n.label,"Not adding datachannel as enable datachannel is set to false"])},i.onaddstream=function(t){if(o._peerConnections[e]){var n=t.stream||t;if("MCU"===e)return void T.warn([e,"MediaStream",i.remoteStreamId,"Ignoring received remote stream from MCU ->"],n);if(!o._sdpSettings.direction.audio.receive&&!o._sdpSettings.direction.video.receive)return void T.warn([e,"MediaStream",i.remoteStreamId,"Ignoring received empty remote stream ->"],n);i.remoteStream=n,i.remoteStreamId=i.remoteStreamId||n.id||n.label;var r=s(o.getPeerInfo(e).settings);o._streamsSession[e][i.remoteStreamId]=r,0===n.getAudioTracks().length&&(o._streamsSession[e][i.remoteStreamId].audio=!1),0===n.getVideoTracks().length&&(o._streamsSession[e][i.remoteStreamId].video=!1),i.hasStream=!0,i.hasScreen=r.video&&"object"==typeof r.video&&r.video.screenshare,o._onRemoteStreamAdded(e,n,!!i.hasScreen)}},i.onicecandidate=function(t){o._onIceCandidate(e,t.candidate||t)};var p=null;return i.oniceconnectionstatechange=function(n){var r=i.iceConnectionState;if(T.debug([e,"RTCIceConnectionState",null,"Ice connection state changed ->"],r),"edge"===t.webrtcDetectedBrowser&&("connecting"===r?r=o.ICE_CONNECTION_STATE.CHECKING:"new"===r&&(r=o.ICE_CONNECTION_STATE.FAILED)),"AppleWebKit"===t.webrtcDetectedType&&r===o.ICE_CONNECTION_STATE.CLOSED)return void setTimeout(function(){i.iceConnectionStateClosed||(o._handleIceConnectionStats(o.ICE_CONNECTION_STATE.CLOSED,e),o._trigger("iceConnectionState",o.ICE_CONNECTION_STATE.CLOSED,e))},10);if(o._handleIceConnectionStats(i.iceConnectionState,e),o._trigger("iceConnectionState",r,e),r===o.ICE_CONNECTION_STATE.FAILED&&o._initOptions.enableIceTrickle&&o._trigger("iceConnectionState",o.ICE_CONNECTION_STATE.TRICKLE_FAILED,e),o._peerConnStatus[e]&&(o._peerConnStatus[e].connected=[o.ICE_CONNECTION_STATE.COMPLETED,o.ICE_CONNECTION_STATE.CONNECTED].indexOf(r)>-1),!p&&[o.ICE_CONNECTION_STATE.CONNECTED,o.ICE_CONNECTION_STATE.COMPLETED].indexOf(r)>-1&&(p=!0,o.getConnectionStatus(e,function(){p=setInterval(function(){if(!o._peerConnections[e]||o._peerConnections[e].signalingState===o.PEER_CONNECTION_STATE.CLOSED)return void clearInterval(p);o._handleBandwidthStats(e)},2e4)})),!o._hasMCU&&[o.ICE_CONNECTION_STATE.CONNECTED,o.ICE_CONNECTION_STATE.COMPLETED].indexOf(r)>-1&&o._bandwidthAdjuster&&!d&&"edge"!==t.webrtcDetectedBrowser&&"edge"!==(((o._peerInformations[e]||{}).agent||{}).name||"edge")){var a=0,s=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length};d={audio:{send:[],recv:[]},video:{send:[],recv:[]}};var c=setInterval(function(){if(!o._peerConnections[e]||o._peerConnections[e].signalingState===o.PEER_CONNECTION_STATE.CLOSED||!o._bandwidthAdjuster||!o._peerBandwidth[e])return void clearInterval(c);o._retrieveStats(e,function(t,n){if(!o._peerConnections[e]||o._peerConnections[e].signalingState===o.PEER_CONNECTION_STATE.CLOSED||!o._bandwidthAdjuster)return void clearInterval(c);if(t?(d.audio.send.push(0),d.audio.recv.push(0),d.video.send.push(0),d.video.recv.push(0)):(d.audio.send.push(8*n.audio.sending.bytes),d.audio.recv.push(8*n.audio.receiving.bytes),d.video.send.push(8*n.video.sending.bytes),d.video.recv.push(8*n.video.receiving.bytes)),++a===o._bandwidthAdjuster.interval){a=0;var r=s(d.audio.send),i=s(d.video.send);o._bandwidthAdjuster.useUploadBwOnly||(r+=s(d.audio.recv),i+=s(d.video.recv),r/=2,i/=2),r=parseInt(r*(o._bandwidthAdjuster.limitAtPercentage/100)/1e3,10),i=parseInt(i*(o._bandwidthAdjuster.limitAtPercentage/100)/1e3,10),d={audio:{send:[],recv:[]},video:{send:[],recv:[]}},o.refreshConnection(e,{bandwidth:{audio:r,video:i}})}},!0,!0)},1e3)}},i.onsignalingstatechange=function(){if(T.debug([e,"RTCSignalingState",null,"Peer connection state changed ->"],i.signalingState),"AppleWebKit"===t.webrtcDetectedType&&i.signalingState===o.PEER_CONNECTION_STATE.CLOSED)return void setTimeout(function(){i.signalingStateClosed||o._trigger("peerConnectionState",o.PEER_CONNECTION_STATE.CLOSED,e)},10);o._trigger("peerConnectionState",i.signalingState,e)},i.onicegatheringstatechange=function(){T.log([e,"RTCIceGatheringState",null,"Ice gathering state changed ->"],i.iceGatheringState),o._trigger("candidateGenerationState",i.iceGatheringState,e)},"firefox"===t.webrtcDetectedBrowser&&(i.removeStream=function(e){for(var t=i.getSenders(),n=0;n<t.length;n++)for(var r=e.getTracks(),o=0;o<r.length;o++)r[o]===t[n].track&&i.removeTrack(t[n])}),o._handleIceConnectionStats(i.iceConnectionState,e),o._handleIceGatheringStats("new",e,!1),i}},a.prototype._restartMCUConnection=function(e,n,r){var i=this,o=Object.keys(i._peerConnections),a={},c=function(e){var r={type:i._SIG_MESSAGE_TYPE.RESTART,mid:i._user.sid,rid:i._room.id,agent:t.webrtcDetectedBrowser,version:(t.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:i._getUserInfo(e),target:e,weight:i._peerPriorityWeight,receiveOnly:i.getPeerInfo().config.receiveOnly,enableIceTrickle:i._initOptions.enableIceTrickle,enableDataChannel:i._initOptions.enableDataChannel,enableIceRestart:i._enableIceRestart,doIceRestart:i._initOptions.mcuUseRenegoRestart&&!0===n&&i._enableIceRestart&&i._peerInformations[e]&&i._peerInformations[e].config.enableIceRestart,isRestartResend:!1,temasysPluginVersion:t.WebRTCPlugin.plugin?t.WebRTCPlugin.plugin.VERSION:null,SMProtocolVersion:i.SM_PROTOCOL_VERSION,DTProtocolVersion:i.DT_PROTOCOL_VERSION};i._publishOnly&&(r.publishOnly={type:i._streams.screenshare&&i._streams.screenshare.stream?"screenshare":"video"}),i._parentId&&(r.parentId=i._parentId),T.log([e,"RTCPeerConnection",null,"Sending restart message to signaling server ->"],r),i._sendChannelMessage(r),i._handleNegotiationStats("restart",e,r,!1)};r.bandwidth&&"object"==typeof r.bandwidth&&("number"==typeof r.bandwidth.audio&&(i._streamsBandwidthSettings.bAS.audio=r.bandwidth.audio),"number"==typeof r.bandwidth.video&&(i._streamsBandwidthSettings.bAS.video=r.bandwidth.video),"number"==typeof r.bandwidth.data&&(i._streamsBandwidthSettings.bAS.data=r.bandwidth.data)),r.googleXBandwidth&&"object"==typeof r.googleXBandwidth&&("number"==typeof r.googleXBandwidth.min&&(i._streamsBandwidthSettings.googleX.min=r.googleXBandwidth.min),"number"==typeof r.googleXBandwidth.max&&(i._streamsBandwidthSettings.googleX.max=r.googleXBandwidth.max));for(var d=0;d<o.length;d++)if(i._peerConnections[o[d]])"MCU"!==o[d]&&(i._trigger("peerRestart",o[d],i.getPeerInfo(o[d]),!0,!1),i._initOptions.mcuUseRenegoRestart||c(o[d]));else{var p="Peer connection with peer does not exists. Unable to restart";T.error([o[d],"PeerConnection",null,p]),a[o[d]]=new Error(p)}if(i._trigger("serverPeerRestart","MCU",i.SERVER_PEER_TYPE.MCU),i._initOptions.mcuUseRenegoRestart)i._peerEndOfCandidatesCounter.MCU=i._peerEndOfCandidatesCounter.MCU||{},i._peerEndOfCandidatesCounter.MCU.len=0,c("MCU");else{var u=function(t,n,r){T.log([null,"PeerConnection",null,"Invoked all peers to restart with MCU. Firing callback"]),"function"==typeof e&&(Object.keys(a).length>0?e({refreshErrors:a,listOfPeers:o},null):e(null,{listOfPeers:o}))};i.once("peerJoined",u,function(e,t,n){return n}),i.leaveRoom(!1,function(t,n){if(t){if("function"==typeof e){for(var c=0;c<o.length;c++)a[o[c]]=t;e({refreshErrors:a,listOfPeers:o},null)}}else i.joinRoom(i._selectedRoom,{bandwidth:r.bandwidth||{},googleXBandwidth:r.googleXBandwidth||{},sdpSettings:s(i._sdpSettings),voiceActivityDetection:i._voiceActivityDetection,publishOnly:!!i._publishOnly,parentId:i._parentId||null,autoBandwidthAdjustment:i._bandwidthAdjuster})})}},a.prototype._parseConnectionStats=function(e,t,n){var r=t.timestamp,i=e?e.timestamp||0:0,o=parseFloat(t[n]||"0",10),a=parseFloat(e?e[n]||"0":"0",10);return new Date(r).getTime()===new Date(i).getTime()?o:parseFloat(((o-a)/(r-i)*1e3).toFixed(3)||"0",10)},a.prototype._signalingEndOfCandidates=function(e){var n=this;if(n._peerEndOfCandidatesCounter[e]&&n._peerConnections[e]&&n._peerConnections[e].signalingState!==n.PEER_CONNECTION_STATE.CLOSED&&n._peerConnections[e].remoteDescription&&n._peerConnections[e].remoteDescription.sdp&&"number"==typeof n._peerEndOfCandidatesCounter[e].expectedLen&&n._peerEndOfCandidatesCounter[e].len>=n._peerEndOfCandidatesCounter[e].expectedLen&&(!n._peerCandidatesQueue[e]||0===n._peerCandidatesQueue[e].length)&&!n._peerEndOfCandidatesCounter[e].hasSet){T.debug([e,"RTCPeerConnection",null,"Signaling of end-of-candidates remote ICE gathering."]),n._peerEndOfCandidatesCounter[e].hasSet=!0;try{if("edge"===t.webrtcDetectedBrowser){for(var r=-1,i=[],o=n._peerConnections[e].remoteDescription.sdp.split("\r\n"),a=!1,s=0;s<o.length;s++)if(0===o[s].indexOf("m="))a="0"===o[s].split(" ")[1],r++;else if(0===o[s].indexOf("a=mid:")&&!a){var c=o[s].split("a=mid:")[1]||"";if(c&&-1===i.indexOf(c)&&(i.push(c),n._addIceCandidate(e,"endofcan-"+(new Date).getTime(),new RTCIceCandidate({sdpMid:c,sdpMLineIndex:r,candidate:"candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"})),n._peerConnectionConfig.bundlePolicy===n.BUNDLE_POLICY.MAX_BUNDLE))break}}else t&&!n._isLowerThanVersion(t.VERSION,"0.14.0")&&n._peerConnections[e].addIceCandidate(null);n._gatheredCandidates[e]&&n._trigger("candidatesGathered",e,{expected:n._peerEndOfCandidatesCounter[e].expectedLen||0,received:n._peerEndOfCandidatesCounter[e].len||0,processed:n._gatheredCandidates[e].receiving.srflx.length+n._gatheredCandidates[e].receiving.relay.length+n._gatheredCandidates[e].receiving.host.length})}catch(t){T.error([e,"RTCPeerConnection",null,"Failed signaling end-of-candidates ->"],t)}}},a.prototype.setUserData=function(e){var t=this,n="";void 0!==e&&null!==e&&(n=e),this._userData=n,t._inRoom?(T.log("Updated userData -> ",n),t._sendChannelMessage({type:t._SIG_MESSAGE_TYPE.UPDATE_USER,mid:t._user.sid,rid:t._room.id,userData:n,stamp:(new Date).getTime()}),t._trigger("peerUpdated",t._user.sid,t.getPeerInfo(),!0)):T.warn("User is not in the room. Broadcast of updated information will be dropped")},a.prototype.getUserData=function(e){if(e&&this._peerInformations[e]){var t=this._peerInformations[e].userData;return null!==t&&void 0!==t||(t=""),t}return this._userData},a.prototype.getPeerInfo=function(e){var n=null;return"string"==typeof e&&"object"==typeof this._peerInformations[e]?(n=s(this._peerInformations[e]),n.room=s(this._selectedRoom),n.settings.bandwidth=n.settings.bandwidth||{},n.settings.googleXBandwidth=n.settings.googleXBandwidth||{},"boolean"==typeof n.settings.video||n.settings.video&&"object"==typeof n.settings.video||(n.settings.video=!1,n.mediaStatus.audioMuted=!0),"boolean"==typeof n.settings.audio||n.settings.audio&&"object"==typeof n.settings.audio||(n.settings.audio=!1,n.mediaStatus.audioMuted=!0),"boolean"!=typeof n.mediaStatus.audioMuted&&(n.mediaStatus.audioMuted=!0),"boolean"!=typeof n.mediaStatus.videoMuted&&(n.mediaStatus.videoMuted=!0),n.settings.maxBandwidth&&(n.settings.bandwidth=s(n.settings.maxBandwidth),delete n.settings.maxBandwidth),n.settings.video&&"object"==typeof n.settings.video&&n.settings.video.customSettings&&"object"==typeof n.settings.video.customSettings&&(n.settings.video.customSettings.frameRate&&(n.settings.video.frameRate=s(n.settings.video.customSettings.frameRate)),n.settings.video.customSettings.facingMode&&(n.settings.video.facingMode=s(n.settings.video.customSettings.facingMode)),n.settings.video.customSettings.width&&(n.settings.video.resolution=n.settings.video.resolution||{},n.settings.video.resolution.width=s(n.settings.video.customSettings.width)),n.settings.video.customSettings.height&&(n.settings.video.resolution=n.settings.video.resolution||{},n.settings.video.resolution.height=s(n.settings.video.customSettings.height)),n.settings.video.customSettings.facingMode&&(n.settings.video.facingMode=s(n.settings.video.customSettings.facingMode))),n.settings.audio&&"object"==typeof n.settings.audio&&(n.settings.audio.stereo=!0===n.settings.audio.stereo),null!==n.userData&&void 0!==n.userData||(n.userData=""),n.parentId=n.parentId||null,"MCU"===e?(n.config.receiveOnly=!0,n.config.publishOnly=!1):this._hasMCU&&(n.config.receiveOnly=!1,n.config.publishOnly=!0),this._sdpSettings.direction.audio.receive||(n.settings.audio=!1,n.mediaStatus.audioMuted=!0),this._sdpSettings.direction.video.receive||(n.settings.video=!1,n.mediaStatus.videoMuted=!0),this._sdpSettings.connection.audio||(n.settings.audio=!1,n.mediaStatus.audioMuted=!0),this._sdpSettings.connection.video||(n.settings.video=!1,n.mediaStatus.videoMuted=!0),n.settings.data=!!(this._dataChannels[e]&&this._dataChannels[e].main&&this._dataChannels[e].main.channel&&this._dataChannels[e].main.channel.readyState===this.DATA_CHANNEL_STATE.OPEN),n.connected=this._peerConnStatus[e]&&!!this._peerConnStatus[e].connected,n.init=this._peerConnStatus[e]&&!!this._peerConnStatus[e].init,this._sdpSessions[e]&&this._sdpSessions[e].remote&&this._sdpSessions[e].remote.connection&&"object"==typeof this._sdpSessions[e].remote.connection&&(this._sdpSessions[e].remote.connection.audio&&this._sdpSessions[e].remote.connection.audio.indexOf("send")>-1||(n.settings.audio=!1,n.mediaStatus.audioMuted=!0),this._sdpSessions[e].remote.connection.video&&this._sdpSessions[e].remote.connection.video.indexOf("send")>-1||(n.settings.video=!1,n.mediaStatus.videoMuted=!0),this._sdpSessions[e].remote.connection.data&&this._sdpSessions[e].remote.connection.data.indexOf("send")>-1||(n.settings.data=!1))):(n={userData:s(this._userData),settings:{audio:!1,video:!1},mediaStatus:s(this._streamsMutedSettings),agent:{name:t.webrtcDetectedBrowser,version:t.webrtcDetectedVersion,os:window.navigator.platform,pluginVersion:t.WebRTCPlugin.plugin?t.WebRTCPlugin.plugin.VERSION:null,SMProtocolVersion:this.SMProtocolVersion,DTProtocolVersion:this.DTProtocolVersion},room:s(this._selectedRoom),config:{enableDataChannel:this._initOptions.enableDataChannel,enableIceTrickle:this._initOptions.enableIceTrickle,enableIceRestart:this._enableIceRestart,priorityWeight:this._peerPriorityWeight,receiveOnly:!1,publishOnly:!!this._publishOnly},connected:null,init:null},null!==n.userData&&void 0!==n.userData||(n.userData=""),this._streams.screenshare?n.settings=s(this._streams.screenshare.settings):this._streams.userMedia&&(n.settings=s(this._streams.userMedia.settings)),n.settings.bandwidth=s(this._streamsBandwidthSettings.bAS),n.settings.googleXBandwidth=s(this._streamsBandwidthSettings.googleX),n.parentId=this._parentId?this._parentId:null,n.config.receiveOnly=!n.settings.video&&!n.settings.audio,n.settings.data=this._initOptions.enableDataChannel&&this._sdpSettings.connection.data,n.settings.audio&&"object"==typeof n.settings.audio&&("boolean"==typeof this._initOptions.codecParams.audio.opus.stereo&&(n.settings.audio.stereo=this._initOptions.codecParams.audio.opus.stereo),"boolean"==typeof this._initOptions.codecParams.audio.opus.usedtx&&(n.settings.audio.usedtx=this._initOptions.codecParams.audio.opus.usedtx),"number"==typeof this._initOptions.codecParams.audio.opus.maxplaybackrate&&(n.settings.audio.maxplaybackrate=this._initOptions.codecParams.audio.opus.maxplaybackrate),"boolean"==typeof this._initOptions.codecParams.audio.opus.useinbandfec&&(n.settings.audio.useinbandfec=this._initOptions.codecParams.audio.opus.useinbandfec))),n.settings.audio||(n.mediaStatus.audioMuted=!0),n.settings.video||(n.mediaStatus.videoMuted=!0),n.settings.audio||n.settings.video||(n.config.receiveOnly=!0,n.config.publishOnly=!1),n},a.prototype.getPeersInRoom=function(){for(var e={},t=Object.keys(this._peerInformations),n=0;n<t.length;n++)e[t[n]]=s(this.getPeerInfo(t[n])),e[t[n]].isSelf=!1;return this._user&&this._user.sid&&(e[this._user.sid]=s(this.getPeerInfo()),e[this._user.sid].isSelf=!0),e},a.prototype.getPeersStream=function(){for(var e={},t=Object.keys(this._peerConnections),n=0;n<t.length;n++){var r=null,i=null;this._peerConnections[t[n]]&&this._peerConnections[t[n]].remoteDescription&&this._peerConnections[t[n]].remoteDescription.sdp&&(this._sdpSettings.direction.audio.receive||this._sdpSettings.direction.video.receive)&&(r=this._peerConnections[t[n]].remoteStream,i=r&&(this._peerConnections[t[n]].remoteStreamId||r.id||r.label)),e[t[n]]={streamId:i,stream:r,isSelf:!1}}if(this._user&&this._user.sid){var o=null;this._streams.screenshare&&this._streams.screenshare.stream?o=this._streams.screenshare.stream:this._streams.userMedia&&this._streams.userMedia.stream&&(o=this._streams.userMedia.stream),e[this._user.sid]={streamId:o?o.id||o.label||null:null,stream:o,isSelf:!0}}return e},a.prototype.getPeersDatachannels=function(){for(var e={},t=Object.keys(this._peerConnections),n=0;n<t.length;n++)if(e[t[n]]={},this._dataChannels[t[n]])for(var r in this._dataChannels[t[n]])if(this._dataChannels[t[n]].hasOwnProperty(r)&&this._dataChannels[t[n]][r]){var i=this._dataChannels[t[n]][r];e[t[n]][i.channelName]=this._getDataChannelBuffer(t[n],r),e[t[n]][i.channelName].channelName=i.channelName,e[t[n]][i.channelName].channelType=i.channelType,e[t[n]][i.channelName].channelProp=r,e[t[n]][i.channelName].currentTransferId=i.transferId,e[t[n]][i.channelName].currentStreamId=i.streamId,e[t[n]][i.channelName].readyState=i.channel?i.channel.readyState:self.DATA_CHANNEL_STATE.CREATE_ERROR}return e},a.prototype.getCurrentDataTransfers=function(){var e={};if(!this._user||!this._user.sid)return{};for(var t in this._dataTransfers)this._dataTransfers.hasOwnProperty(t)&&this._dataTransfers[t]&&(e[t]={transferInfo:this._getTransferInfo(t,this._user.sid,!0,!0,!0),isSelf:this._dataTransfers[t].senderPeerId===this._user.sid,peerId:this._dataTransfers[t].senderPeerId||this._user.sid});return e},a.prototype.getCurrentDataStreamsSession=function(){var e={};if(!this._user||!this._user.sid)return{};for(var t in this._dataStreams)this._dataStreams.hasOwnProperty(t)&&this._dataStreams[t]&&(e[t]={streamInfo:{chunkType:"string"===this._dataStreams[t].sessionChunkType?this.DATA_TRANSFER_DATA_TYPE.STRING:this.DATA_TRANSFER_DATA_TYPE.BLOB,isPrivate:this._dataStreams[t].isPrivate,isStringStream:"string"===this._dataStreams[t].sessionChunkType,senderPeerId:this._dataStreams[t].senderPeerId},isSelf:this._dataStreams[t].senderPeerId===this._user.sid,peerId:this._dataStreams[t].senderPeerId||this._user.sid});return e},a.prototype.getPeersCustomSettings=function(){var e=this,t={};for(var n in e._peerInformations)e._peerInformations.hasOwnProperty(n)&&e._peerInformations[n]&&(t[n]=e._getPeerCustomSettings(n));return t},a.prototype._getPeerCustomSettings=function(e){var t=this,n={settings:{audio:!1,video:!1,data:!1,bandwidth:s(t._streamsBandwidthSettings.bAS),googleXBandwidth:s(t._streamsBandwidthSettings.googleX)},mediaStatus:{audioMuted:!0,videoMuted:!0}},r=t._hasMCU?"MCU":e;if(!t._peerInformations[r])return n;if(t._peerConnections[r]&&t._peerConnections[r].signalingState!==t.PEER_CONNECTION_STATE.CLOSED){var i=t._peerConnections[e].localStream,o=t._peerConnections[e].localStreamId||i&&(i.id||i.label);if(n.settings.data=t._initOptions.enableDataChannel&&t._peerInformations[e].config.enableDataChannel,i&&(t._streams.screenshare&&t._streams.screenshare.stream&&o===(t._streams.screenshare.stream.id||t._streams.screenshare.stream.label)?(n.settings.audio=s(t._streams.screenshare.settings.audio),n.settings.video=s(t._streams.screenshare.settings.video),n.mediaStatus=s(t._streamsMutedSettings)):t._streams.userMedia&&t._streams.userMedia.stream&&o===(t._streams.userMedia.stream.id||t._streams.userMedia.stream.label)&&(n.settings.audio=s(t._streams.userMedia.settings.audio),n.settings.video=s(t._streams.userMedia.settings.video),n.mediaStatus=s(t._streamsMutedSettings)),!("function"!=typeof t._peerConnections[e].getSenders||t._initOptions.useEdgeWebRTC&&window.msRTCPeerConnection))){for(var a=t._peerConnections[e].getSenders(),c=!1,d=!1,p=0;p<a.length;p++)a[p]&&a[p].track&&a[p].track.kind&&("audio"===a[p].track.kind?c=!0:"video"===a[p].track.kind&&(d=!0));c||(n.settings.audio=!1,n.mediaStatus.audioMuted=!0),d||(n.settings.video=!1,n.mediaStatus.videoMuted=!0)}}return t._peerCustomConfigs[r]&&(t._peerCustomConfigs[r].bandwidth&&"object"==typeof t._peerCustomConfigs[r].bandwidth&&("number"==typeof t._peerCustomConfigs[r].bandwidth.audio&&(n.settings.bandwidth.audio=t._peerCustomConfigs[r].bandwidth.audio),"number"==typeof t._peerCustomConfigs[r].bandwidth.video&&(n.settings.bandwidth.video=t._peerCustomConfigs[r].bandwidth.video),"number"==typeof t._peerCustomConfigs[r].bandwidth.data&&(n.settings.bandwidth.data=t._peerCustomConfigs[r].bandwidth.data)),t._peerCustomConfigs[r].googleXBandwidth&&"object"==typeof t._peerCustomConfigs[r].googleXBandwidth&&("number"==typeof t._peerCustomConfigs[r].googleXBandwidth.min&&(n.settings.googleXBandwidth.min=t._peerCustomConfigs[r].googleXBandwidth.min),"number"==typeof t._peerCustomConfigs[r].googleXBandwidth.max&&(n.settings.googleXBandwidth.max=t._peerCustomConfigs[r].googleXBandwidth.max))),t._sdpSessions[r]&&t._sdpSessions[r].local&&t._sdpSessions[r].local.connection&&"object"==typeof t._sdpSessions[r].local.connection&&(t._sdpSessions[r].local.connection.audio&&t._sdpSessions[r].local.connection.audio.indexOf("send")>-1||(n.settings.audio=!1,n.mediaStatus.audioMuted=!0),t._sdpSessions[r].local.connection.video&&t._sdpSessions[r].local.connection.video.indexOf("send")>-1||(n.settings.video=!1,n.mediaStatus.videoMuted=!0),t._sdpSessions[r].local.connection.data&&t._sdpSessions[r].local.connection.data.indexOf("send")>-1||(n.settings.data=!1)),n},a.prototype._getUserInfo=function(e){var t=s(this.getPeerInfo()),n=e?this._getPeerCustomSettings(e):null;return n&&"object"==typeof n&&(t.settings=n.settings,t.mediaStatus=n.mediaStatus),t.settings.video&&"object"==typeof t.settings.video&&(t.settings.video.customSettings={},t.settings.video.frameRate&&"object"==typeof t.settings.video.frameRate&&(t.settings.video.customSettings.frameRate=s(t.settings.video.frameRate),t.settings.video.frameRate=-1),t.settings.video.facingMode&&"object"==typeof t.settings.video.facingMode&&(t.settings.video.customSettings.facingMode=s(t.settings.video.facingMode),t.settings.video.facingMode="-1"),t.settings.video.resolution&&"object"==typeof t.settings.video.resolution&&(t.settings.video.resolution.width&&"object"==typeof t.settings.video.resolution.width&&(t.settings.video.customSettings.width=s(t.settings.video.width),t.settings.video.resolution.width=-1),t.settings.video.resolution.height&&"object"==typeof t.settings.video.resolution.height&&(t.settings.video.customSettings.height=s(t.settings.video.height),t.settings.video.resolution.height=-1))),t.settings.bandwidth&&(t.settings.maxBandwidth=s(t.settings.bandwidth),delete t.settings.bandwidth),this._getSDPCommonSupports(e).video||(t.settings.video=!1,t.mediaStatus.videoMuted=!0),this._getSDPCommonSupports(e).audio||(t.settings.audio=!1,t.mediaStatus.audioMuted=!0),delete t.agent,delete t.room,delete t.config,delete t.parentId,delete t.settings.data,t},a.prototype._doOffer=function(e,n){var r=this,i=r._peerConnections[e];if(!i)return void T.warn([e,"RTCSessionDescription","offer","Dropping of creating of offer as connection does not exists"]);if(i.signalingState!==r.PEER_CONNECTION_STATE.STABLE)return void T.warn([e,"RTCSessionDescription","offer",'Dropping of creating of offer as signalingState is not "'+r.PEER_CONNECTION_STATE.STABLE+'" ->'],i.signalingState);var o={offerToReceiveAudio:!(!r._sdpSettings.connection.audio&&"MCU"!==e)&&r._getSDPCommonSupports(e).video,offerToReceiveVideo:!(!r._sdpSettings.connection.video&&"MCU"!==e)&&r._getSDPCommonSupports(e).audio,iceRestart:!!((r._peerInformations[e]||{}).config||{}).enableIceRestart&&n&&r._enableIceRestart,voiceActivityDetection:r._voiceActivityDetection};r._hasMCU&&"MCU"!==e||r._addLocalMediaStreams(e),r._initOptions.enableDataChannel&&r._peerInformations[e]&&r._peerInformations[e].config.enableDataChannel&&(r._dataChannels[e]&&r._dataChannels[e].main||(r._createDataChannel(e),r._peerConnections[e].hasMainChannel=!0)),T.debug([e,null,null,"Creating offer with config:"],o),i.endOfCandidates=!1,r._peerConnStatus[e]&&(r._peerConnStatus[e].sdpConstraints=o);var a=function(t){T.debug([e,null,null,"Created offer"],t),r._handleNegotiationStats("create_offer",e,t,!1),r._setLocalAndSendMessage(e,t)},s=function(t){T.error([e,null,null,"Failed creating an offer:"],t),r._handleNegotiationStats("error_create_offer",e,null,!1,t),r._trigger("handshakeProgress",r.HANDSHAKE_PROGRESS.ERROR,e,t)};i.createOffer(a,s,"plugin"===t.webrtcDetectedType?{mandatory:{OfferToReceiveAudio:o.offerToReceiveAudio,OfferToReceiveVideo:o.offerToReceiveVideo,iceRestart:o.iceRestart,voiceActivityDetection:o.voiceActivityDetection}}:o)},a.prototype._doAnswer=function(e){var n=this;T.log([e,null,null,"Creating answer with config:"],n._room.connection.sdpConstraints);var r=n._peerConnections[e];if(!r)return void T.warn([e,"RTCSessionDescription","answer","Dropping of creating of answer as connection does not exists"]);if(r.signalingState!==n.PEER_CONNECTION_STATE.HAVE_REMOTE_OFFER)return void T.warn([e,"RTCSessionDescription","answer",'Dropping of creating of answer as signalingState is not "'+n.PEER_CONNECTION_STATE.HAVE_REMOTE_OFFER+'" ->'],r.signalingState);var i="edge"===t.webrtcDetectedBrowser?{offerToReceiveVideo:!(!n._sdpSettings.connection.audio&&"MCU"!==e)&&n._getSDPCommonSupports(e,r.remoteDescription).video,offerToReceiveAudio:!(!n._sdpSettings.connection.video&&"MCU"!==e)&&n._getSDPCommonSupports(e,r.remoteDescription).audio,voiceActivityDetection:n._voiceActivityDetection}:void 0;n._hasMCU&&"MCU"!==e||n._addLocalMediaStreams(e),n._peerConnStatus[e]&&(n._peerConnStatus[e].sdpConstraints=i);var o=function(t){T.debug([e,null,null,"Created answer"],t),n._handleNegotiationStats("create_answer",e,t,!1),n._setLocalAndSendMessage(e,t)},a=function(t){T.error([e,null,null,"Failed creating an answer:"],t),n._handleNegotiationStats("error_create_answer",e,null,!1,t),n._trigger("handshakeProgress",n.HANDSHAKE_PROGRESS.ERROR,e,t)};r.createAnswer(o,a,i)},a.prototype._setLocalAndSendMessage=function(e,t){var n=this,r=n._peerConnections[e];if(!t||!t.sdp)return void T.warn([e,"RTCSessionDescription",null,"Local session description is undefined ->"],t);if(!r)return T.warn([e,"RTCSessionDescription",t.type,"Local session description will not be set as connection does not exists ->"],t),void n._handleNegotiationStats("dropped_"+i.type,e,i,!1,"Peer connection does not exists");if(t.type===n.HANDSHAKE_PROGRESS.OFFER&&r.signalingState!==n.PEER_CONNECTION_STATE.STABLE)return T.warn([e,"RTCSessionDescription",t.type,'Local session description will not be set as signaling state is "'+r.signalingState+'" ->'],t),void n._handleNegotiationStats("dropped_offer",e,i,!1,'Peer connection state is "'+r.signalingState+'"');if(t.type===n.HANDSHAKE_PROGRESS.ANSWER&&r.signalingState!==n.PEER_CONNECTION_STATE.HAVE_REMOTE_OFFER)return T.warn([e,"RTCSessionDescription",t.type,'Local session description will not be set as signaling state is "'+r.signalingState+'" ->'],t),void n._handleNegotiationStats("dropped_answer",e,i,!1,'Peer connection state is "'+r.signalingState+'"');if(r.processingLocalSDP)return T.warn([e,"RTCSessionDescription",t.type,"Local session description will not be set as another is being processed ->"],t),void n._handleNegotiationStats("dropped_"+i.type,e,i,!1,"Peer connection is currently processing an existing sdp");r.processingLocalSDP=!0;var i={type:t.type,sdp:t.sdp};i.sdp=n._removeSDPFirefoxH264Pref(e,i),i.sdp=n._setSDPCodecParams(e,i),i.sdp=n._removeSDPUnknownAptRtx(e,i),i.sdp=n._removeSDPCodecs(e,i),i.sdp=n._handleSDPConnectionSettings(e,i,"local"),i.sdp=n._removeSDPREMBPackets(e,i),i.sdp=n._setSCTPport(e,i),n._peerConnectionConfig.disableBundle&&(i.sdp=i.sdp.replace(/a=group:BUNDLE.*\r\n/gi,"")),T.log([e,"RTCSessionDescription",i.type,"Local session description updated ->"],i.sdp);var o=function(){if(T.debug([e,"RTCSessionDescription",i.type,"Local session description has been set ->"],i),r.processingLocalSDP=!1,n._handleNegotiationStats("set_"+i.type,e,i,!1),n._trigger("handshakeProgress",i.type,e),i.type===n.HANDSHAKE_PROGRESS.ANSWER?r.setAnswer="local":r.setOffer="local",!n._initOptions.enableIceTrickle&&!r.gathered)return void T.log([e,"RTCSessionDescription",i.type,"Local session description sending is halted to complete ICE gathering."]);n._sendChannelMessage({type:i.type,sdp:n._renderSDPOutput(e,i),mid:n._user.sid,target:e,rid:n._room.id,userInfo:n._getUserInfo(e)}),n._handleNegotiationStats(i.type,e,i,!1)},a=function(t){T.error([e,"RTCSessionDescription",i.type,"Local description failed setting ->"],t),r.processingLocalSDP=!1,n._handleNegotiationStats("error_set_"+i.type,e,i,!1,t),n._trigger("handshakeProgress",n.HANDSHAKE_PROGRESS.ERROR,e,t)};r.setLocalDescription(new RTCSessionDescription(i),o,a)},a.prototype.getPeers=function(e,t){var n=this;return n._isPrivileged?n._initOptions.appKey?("function"==typeof e&&(t=e,e=!1),n._sendChannelMessage({type:n._SIG_MESSAGE_TYPE.GET_PEERS,showAll:e||!1}),n._trigger("getPeersStateChange",n.GET_PEERS_STATE.ENQUIRED,n._user.sid,null),T.log("Enquired server for peers within the realm"),void("function"==typeof t&&n.once("getPeersStateChange",function(e,n,r){t(null,r)},function(e,t,r){return e===n.GET_PEERS_STATE.RECEIVED}))):void T.warn("App key is not defined. Please authenticate again."):void T.warn("Please upgrade your key to privileged to use this function")},a.prototype.introducePeer=function(e,t){var n=this;if(!n._isPrivileged)return T.warn("Please upgrade your key to privileged to use this function"),void n._trigger("introduceStateChange",n.INTRODUCE_STATE.ERROR,n._user.sid,e,t,"notPrivileged");var r={type:n._SIG_MESSAGE_TYPE.INTRODUCE,sendingPeerId:e,receivingPeerId:t};n._sendChannelMessage(r),n._handleSessionStats(r),n._trigger("introduceStateChange",n.INTRODUCE_STATE.INTRODUCING,n._user.sid,e,t,null),T.log("Introducing",e,"to",t)},a.prototype.joinRoom=function(e,n,r){var i=this,o=i._initOptions.defaultRoom,a=i._selectedRoom,s={},c=(new Date).getTime()+Math.floor(1e4*Math.random());i._joinRoomManager.timestamp=c,e&&"string"==typeof e?o=e:e&&"object"==typeof e?s=e:"function"==typeof e&&(r=e),n&&"object"==typeof n?s=n:"function"==typeof n&&(r=n);var d=function(e,t,n){T.error(e),"function"==typeof r&&r({room:t,errorCode:n||null,error:e instanceof Error?e:new Error(JSON.stringify(e))})},p=function(e,t){T.warn(e+" room: "+t)},u=function(){if(i._joinRoomManager.timestamp!==c)return void p("joinRoom() process did not complete",o);i._initSelectedRoom(o,function(e,n){return e?void d(e.error,i._selectedRoom,i._readyState):i._joinRoomManager.timestamp!==c?void p("joinRoom() process did not complete",o):void i._waitForOpenChannel(s||{},c,function(e,n){if(e)return void d(e,i._selectedRoom,i._readyState);if(i._joinRoomManager.timestamp!==c)return void p("joinRoom() process did not complete",o);if("AppleWebKit"===t.webrtcDetectedType){var a=i._streams.screenshare&&i._streams.screenshare.stream?i._streams.screenshare.stream:i._streams.userMedia&&i._streams.userMedia.stream?i._streams.userMedia.stream:null;a&&0!==a.getTracks().length?0===a.getAudioTracks().length?T.warn("Note that receiving audio streams may fail as safari 11 needs stream with audio and video tracks and not just with video tracks"):0===a.getVideoTracks().length&&T.warn("Note that receiving video streams may fail as safari 11 needs stream with audio and video tracks and not just with audio tracks"):T.warn("Note that receiving audio and video streams may fail as safari 11 needs stream with audio and video tracks")}if("function"==typeof r){var s=function(e,t,n){i.off("systemAction",u),i.off("channelClose",l),T.info([null,"Room",o,"Connected to Room ->"],t),r(null,{room:i._selectedRoom,peerId:e,peerInfo:t})},u=function(e,t){i.off("peerJoined",s),i.off("channelClose",l),T.error([null,"Room",o,"Failed connecting to Room ->"],t),d(new Error(t),i._selectedRoom,i._readyState)},l=function(){i.off("systemAction",u),i.off("peerJoined",s),T.error([null,"Room",o,"Failed connecting to Room due to abrupt disconnection."]),d(new Error("Channel closed abruptly before session was established"),i._selectedRoom,i._readyState)};i.once("peerJoined",s,function(e,t,n){return t.room===o&&n}),i.once("systemAction",u,function(e){return e===i.SYSTEM_ACTION.REJECT}),i.once("channelClose",l)}var f={type:i._SIG_MESSAGE_TYPE.JOIN_ROOM,uid:i._user.uid,cid:i._key,rid:i._room.id,userCred:i._user.token,timeStamp:i._user.timeStamp,apiOwner:i._appKeyOwner,roomCred:i._room.token,start:i._room.startDateTime,len:i._room.duration,isPrivileged:!0===i._isPrivileged,autoIntroduce:!1!==i._autoIntroduce,key:i._initOptions.appKey};i._sendChannelMessage(f),i._handleSessionStats(f)})})};if(null===e||["number","boolean"].indexOf(typeof e)>-1)return void d("Invalid room name is provided",e);if(null===n||["number","boolean"].indexOf(typeof n)>-1)return void d("Invalid mediaOptions is provided",o);i._joinRoomManager.socketsFn.forEach(function(e){e(c)}),i._joinRoomManager.socketsFn=[];var l=!1===s.audio&&!1===s.video;i._inRoom?i.leaveRoom({userMedia:l},function(e,t){T.debug([null,"Room",a,"Leave Room callback result ->"],[e,t]),u()}):(l&&i.stopStream(),u())},a.prototype.leaveRoom=function(e,t){var n=this,r=!0,i=!0,o=n._selectedRoom,a=n._user?n._user.sid:null,s=[],c=!n._inRoom;"boolean"==typeof e?!1===e&&(r=!1,i=!1):e&&"object"==typeof e?(r=!1!==e.userMedia,i=!1!==e.screenshare):"function"==typeof e&&(t=e);for(var d in n._peerInformations)n._peerInformations.hasOwnProperty(d)&&n._peerInformations[d]&&(s.push(d),n._removePeer(d));for(var p in n._peerConnections)n._peerConnections.hasOwnProperty(p)&&n._peerConnections[p]&&-1===s.indexOf(p)&&(s.push(p),n._removePeer(p));if(n._inRoom=!1,n._closeChannel(),c){var u="Unable to leave room as user is not in any room";return T.error([null,"Room",o,u]),void("function"==typeof t&&t(new Error(u),null))}n._stopStreams({userMedia:r,screenshare:i}),n._wait(function(){T.log([null,"Room",o,"User left the room"]),n._trigger("peerLeft",a,n.getPeerInfo(),!0),"function"==typeof t&&t(null,{peerId:a,previousRoom:o})},function(){return!n._channelOpen})},a.prototype.lockRoom=function(){this._user&&this._user.sid&&(T.log("Update to isRoomLocked status ->",!0),this._sendChannelMessage({type:this._SIG_MESSAGE_TYPE.ROOM_LOCK,mid:this._user.sid,rid:this._room.id,lock:!0}),this._roomLocked=!0,this._trigger("roomLock",!0,this._user.sid,this.getPeerInfo(),!0))},a.prototype.unlockRoom=function(){this._user&&this._user.sid&&(T.log("Update to isRoomLocked status ->",!1),this._sendChannelMessage({type:this._SIG_MESSAGE_TYPE.ROOM_LOCK,mid:this._user.sid,rid:this._room.id,lock:!1}),this._roomLocked=!1,this._trigger("roomLock",!1,this._user.sid,this.getPeerInfo(),!0))},a.prototype._waitForOpenChannel=function(e,t,n){var r=this;r._socketCurrentReconnectionAttempt=0,r._wait(function(){var i=function(){r.off("socketError",o),setTimeout(function(){if(e=e||{},r._userData=e.userData||r._userData||"",r._streamsBandwidthSettings={googleX:{},bAS:{}},r._publishOnly=!1,r._sdpSettings={connection:{audio:!0,video:!0,data:!0},direction:{audio:{send:!0,receive:!0},video:{send:!0,receive:!0}}},r._voiceActivityDetection="boolean"!=typeof e.voiceActivityDetection||e.voiceActivityDetection,r._peerConnectionConfig={bundlePolicy:r.BUNDLE_POLICY.BALANCED,rtcpMuxPolicy:r.RTCP_MUX_POLICY.REQUIRE,iceCandidatePoolSize:0,certificate:r.PEER_CERTIFICATE.AUTO,disableBundle:!1},r._bandwidthAdjuster=null,e.bandwidth&&("number"==typeof e.bandwidth.audio&&(r._streamsBandwidthSettings.bAS.audio=e.bandwidth.audio),"number"==typeof e.bandwidth.video&&(r._streamsBandwidthSettings.bAS.video=e.bandwidth.video),"number"==typeof e.bandwidth.data&&(r._streamsBandwidthSettings.bAS.data=e.bandwidth.data)),e.googleXBandwidth&&("number"==typeof e.googleXBandwidth.min&&(r._streamsBandwidthSettings.googleX.min=e.googleXBandwidth.min),"number"==typeof e.googleXBandwidth.max&&(r._streamsBandwidthSettings.googleX.max=e.googleXBandwidth.max)),e.sdpSettings&&(e.sdpSettings.direction&&(e.sdpSettings.direction.audio&&(r._sdpSettings.direction.audio.receive="boolean"!=typeof e.sdpSettings.direction.audio.receive||e.sdpSettings.direction.audio.receive,r._sdpSettings.direction.audio.send="boolean"!=typeof e.sdpSettings.direction.audio.send||e.sdpSettings.direction.audio.send),e.sdpSettings.direction.video&&(r._sdpSettings.direction.video.receive="boolean"!=typeof e.sdpSettings.direction.video.receive||e.sdpSettings.direction.video.receive,r._sdpSettings.direction.video.send="boolean"!=typeof e.sdpSettings.direction.video.send||e.sdpSettings.direction.video.send)),e.sdpSettings.connection&&(r._sdpSettings.connection.audio="boolean"!=typeof e.sdpSettings.connection.audio||e.sdpSettings.connection.audio,r._sdpSettings.connection.video="boolean"!=typeof e.sdpSettings.connection.video||e.sdpSettings.connection.video,r._sdpSettings.connection.data="boolean"!=typeof e.sdpSettings.connection.data||e.sdpSettings.connection.data)),e.publishOnly&&(r._sdpSettings.direction.audio.send=!0,r._sdpSettings.direction.audio.receive=!1,r._sdpSettings.direction.video.send=!0,r._sdpSettings.direction.video.receive=!1,r._publishOnly=!0,"object"==typeof e.publishOnly&&e.publishOnly.parentId&&"string"==typeof e.publishOnly.parentId&&(r._parentId=e.publishOnly.parentId)),e.parentId&&(r._parentId=e.parentId),e.peerConnection&&"object"==typeof e.peerConnection){if("string"==typeof e.peerConnection.bundlePolicy)for(var t in r.BUNDLE_POLICY)r.BUNDLE_POLICY.hasOwnProperty(t)&&r.BUNDLE_POLICY[t]===e.peerConnection.bundlePolicy&&(r._peerConnectionConfig.bundlePolicy=e.peerConnection.bundlePolicy);if("string"==typeof e.peerConnection.rtcpMuxPolicy)for(var i in r.RTCP_MUX_POLICY)r.RTCP_MUX_POLICY.hasOwnProperty(i)&&r.RTCP_MUX_POLICY[i]===e.peerConnection.rtcpMuxPolicy&&(r._peerConnectionConfig.rtcpMuxPolicy=e.peerConnection.rtcpMuxPolicy);if("number"==typeof e.peerConnection.iceCandidatePoolSize&&e.peerConnection.iceCandidatePoolSize>0&&(r._peerConnectionConfig.iceCandidatePoolSize=e.peerConnection.iceCandidatePoolSize),"string"==typeof e.peerConnection.certificate)for(var o in r.PEER_CERTIFICATE)r.PEER_CERTIFICATE.hasOwnProperty(o)&&r.PEER_CERTIFICATE[o]===e.peerConnection.certificate&&(r._peerConnectionConfig.certificate=e.peerConnection.certificate);r._peerConnectionConfig.disableBundle=!0===e.peerConnection.disableBundle}if(e.autoBandwidthAdjustment&&(r._bandwidthAdjuster={interval:10,limitAtPercentage:100,useUploadBwOnly:!1},"object"==typeof e.autoBandwidthAdjustment&&("number"==typeof e.autoBandwidthAdjustment.interval&&e.autoBandwidthAdjustment.interval>=10&&(r._bandwidthAdjuster.interval=e.autoBandwidthAdjustment.interval),"number"==typeof e.autoBandwidthAdjustment.limitAtPercentage&&e.autoBandwidthAdjustment.limitAtPercentage>=0&&e.autoBandwidthAdjustment.limitAtPercentage<=100&&(r._bandwidthAdjuster.limitAtPercentage=e.autoBandwidthAdjustment.limitAtPercentage),"boolean"==typeof e.autoBandwidthAdjustment.useUploadBwOnly&&(r._bandwidthAdjuster.useUploadBwOnly=e.autoBandwidthAdjustment.useUploadBwOnly))),!0===e.manualGetUserMedia){r._trigger("mediaAccessRequired");var a=0,s=!1;return void r._wait(function(){!0===s?r._onUserMediaError(new Error("Waiting for stream timeout"),!1,!1):n(null,r._streams.userMedia.stream)},function(){return a+=1,600===a?(s=!0,!0):!(!r._streams.userMedia||!r._streams.userMedia.stream)||void 0},50)}if(e.audio||e.video)return void r.getUserMedia({useExactConstraints:!!e.useExactConstraints,audio:e.audio,video:e.video},function(e,t){e?n(e,null):n(null,t)});n(null,null)},1)},o=function(e,t){r.off("channelOpen",i),n(t)};r._channelOpen?i():(r.once("channelOpen",i),r.once("socketError",o,function(e){return e===r.SOCKET_ERROR.RECONNECTION_ABORTED}),r._openChannel(t))},function(){return r._readyState===r.READY_STATE_CHANGE.COMPLETED})},a.prototype.generateUUID=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:n&&15).toString(16)})},a.prototype.init=function(e,t){var n=this,r={},i=function(){};if("function"==typeof e?i=e:e&&"object"==typeof e?(r=s(e),r.appKey&&"string"==typeof r.appKey||!r.apiKey||"string"!=typeof r.apiKey||(r.appKey=r.apiKey)):e&&"string"==typeof e&&(r.appKey=e),"function"==typeof t&&(i=t),r.defaultRoom=r.defaultRoom&&"string"==typeof r.defaultRoom?r.defaultRoom:r.appKey,r.roomServer=r.roomServer&&"string"==typeof r.roomServer?r.roomServer:"//api.temasys.io",r.statsServer=r.statsServer&&"string"==typeof r.statsServer?r.statsServer:"//api.temasys.io",r.enableIceTrickle=!1!==r.enableIceTrickle,r.enableDataChannel=!1!==r.enableDataChannel,r.enableSTUNServer=!1!==r.enableSTUNServer,r.enableTURNServer=!1!==r.enableTURNServer,r.audioFallback=!0===r.audioFallback,r.forceSSL=!1!==r.forceSSL,r.enableStatsGathering=!1!==r.enableStatsGathering,r.socketTimeout="number"==typeof r.socketTimeout&&r.socketTimeout>=5e3?r.socketTimeout:7e3,r.apiTimeout="number"==typeof r.apiTimeout?r.apiTimeout:4e3,r.forceTURNSSL=!0===r.forceTURNSSL,r.forceTURN=!0===r.forceTURN,r.usePublicSTUN=!0===r.usePublicSTUN,r.disableVideoFecCodecs=!0===r.disableVideoFecCodecs,r.disableComfortNoiseCodec=!0===r.disableComfortNoiseCodec,r.disableREMB=!0===r.disableREMB,r.throttleShouldThrowError=!0===r.throttleShouldThrowError,r.mcuUseRenegoRestart=!0===r.mcuUseRenegoRestart,r.useEdgeWebRTC=!0===r.useEdgeWebRTC,r.enableSimultaneousTransfers=!1!==r.enableSimultaneousTransfers,r.priorityWeightScheme=n._containsInList("PRIORITY_WEIGHT_SCHEME",r.priorityWeightScheme,"AUTO"),r.TURNServerTransport=n._containsInList("TURN_TRANSPORT",r.TURNServerTransport,"ANY"),r.credentials=r.credentials&&"object"==typeof r.credentials&&r.credentials.startDateTime&&"string"==typeof r.credentials.startDateTime&&r.credentials.credentials&&"string"==typeof r.credentials.credentials&&"number"==typeof r.credentials.duration?r.credentials:null,r.filterCandidatesType=r.filterCandidatesType&&"object"==typeof r.filterCandidatesType?r.filterCandidatesType:{},r.filterCandidatesType.host=!0===r.filterCandidatesType.host,r.filterCandidatesType.srflx=!0===r.filterCandidatesType.srflx,r.filterCandidatesType.relay=!0===r.filterCandidatesType.relay,r.throttleIntervals=r.throttleIntervals&&"object"==typeof r.throttleIntervals?r.throttleIntervals:{},r.throttleIntervals.shareScreen="number"==typeof r.throttleIntervals.shareScreen?r.throttleIntervals.shareScreen:1e4,r.throttleIntervals.refreshConnection="number"==typeof r.throttleIntervals.refreshConnection?r.throttleIntervals.refreshConnection:5e3,r.throttleIntervals.getUserMedia="number"==typeof r.throttleIntervals.getUserMedia?r.throttleIntervals.getUserMedia:0,r.iceServer&&"string"==typeof r.iceServer?r.iceServer={urls:[r.iceServer]}:Array.isArray(r.iceServer)&&r.iceServer.length>0?r.iceServer={urls:r.iceServer}:r.iceServer=null,r.socketServer&&"string"==typeof r.socketServer?r.socketServer=r.socketServer:r.socketServer&&"object"==typeof r.socketServer&&r.socketServer.url&&"string"==typeof r.socketServer.url?r.socketServer={url:r.socketServer.url,ports:Array.isArray(r.socketServer.ports)?r.socketServer.ports:[],protocol:r.socketServer.protocol?r.socketServer.protocol:null}:r.socketServer=null,r.audioCodec&&"object"==typeof r.audioCodec&&n._containsInList("AUDIO_CODEC",r.audioCodec.codec,"-")?r.audioCodec={codec:r.audioCodec.codec,samplingRate:"number"==typeof r.audioCodec.samplingRate?r.audioCodec.samplingRate:null,channels:"number"==typeof r.audioCodec.channels?r.audioCodec.channels:null}:r.audioCodec=n._containsInList("AUDIO_CODEC",r.audioCodec,"AUTO"),r.videoCodec&&"object"==typeof r.videoCodec&&n._containsInList("VIDEO_CODEC",r.videoCodec.codec,"-")?r.videoCodec={codec:r.videoCodec.codec,samplingRate:"number"==typeof r.videoCodec.samplingRate?r.videoCodec.samplingRate:null}:r.videoCodec=n._containsInList("VIDEO_CODEC",r.videoCodec,"AUTO"),r.codecParams=r.codecParams&&"object"==typeof r.codecParams?r.codecParams:{},r.codecParams.audio=r.codecParams.audio&&"object"==typeof r.codecParams.audio?r.codecParams.audio:{},r.codecParams.video=r.codecParams.video&&"object"==typeof r.codecParams.video?r.codecParams.video:{},r.codecParams.audio.opus=r.codecParams.audio.opus&&"object"==typeof r.codecParams.audio.opus?r.codecParams.audio.opus:{},r.codecParams.audio.opus.stereo="boolean"==typeof r.codecParams.audio.opus.stereo?r.codecParams.audio.opus.stereo:null,r.codecParams.audio.opus["sprop-stereo"]="boolean"==typeof r.codecParams.audio.opus["sprop-stereo"]?r.codecParams.audio.opus["sprop-stereo"]:null,r.codecParams.audio.opus.usedtx="boolean"==typeof r.codecParams.audio.opus.usedtx?r.codecParams.audio.opus.usedtx:null,r.codecParams.audio.opus.useinbandfec="boolean"==typeof r.codecParams.audio.opus.useinbandfec?r.codecParams.audio.opus.useinbandfec:null,r.codecParams.audio.opus.maxplaybackrate="number"==typeof r.codecParams.audio.opus.maxplaybackrate&&r.codecParams.audio.opus.maxplaybackrate>=8e3&&r.codecParams.audio.opus.maxplaybackrate<=48e3?r.codecParams.audio.opus.maxplaybackrate:null,r.codecParams.audio.opus.minptime="number"==typeof r.codecParams.audio.opus.minptime&&r.codecParams.audio.opus.minptime>=3?r.codecParams.audio.opus.minptime:null,r.codecParams.video.h264=r.codecParams.video.h264&&"object"==typeof r.codecParams.video.h264?r.codecParams.video.h264:{},r.codecParams.video.h264.profileLevelId=r.codecParams.video.h264.profileLevelId&&"string"==typeof r.codecParams.video.h264.profileLevelId?r.codecParams.video.h264.profileLevelId:null,r.codecParams.video.h264.levelAsymmetryAllowed="boolean"==typeof r.codecParams.video.h264.levelAsymmetryAllowed?r.codecParams.video.h264.levelAsymmetryAllowed:null,r.codecParams.video.h264.packetizationMode="boolean"==typeof r.codecParams.video.h264.packetizationMode?!0===r.codecParams.video.h264.packetizationMode?1:0:"number"==typeof r.codecParams.video.h264.packetizationMode?r.codecParams.video.h264.packetizationMode:null,r.codecParams.video.vp8=r.codecParams.video.vp8&&"object"==typeof r.codecParams.video.vp8?r.codecParams.video.vp8:{},r.codecParams.video.vp8.maxFs="number"==typeof r.codecParams.video.vp8.maxFs?r.codecParams.video.vp8.maxFs:null,r.codecParams.video.vp8.maxFr="number"==typeof r.codecParams.video.vp8.maxFr?r.codecParams.video.vp8.maxFr:null,r.codecParams.video.vp9=r.codecParams.video.vp9&&"object"==typeof r.codecParams.video.vp9?r.codecParams.video.vp9:{},r.codecParams.video.vp9.maxFs="number"==typeof r.codecParams.video.vp9.maxFs?r.codecParams.video.vp9.maxFs:null,r.codecParams.video.vp9.maxFr="number"==typeof r.codecParams.video.vp9.maxFr?r.codecParams.video.vp9.maxFr:null,r.forceTURN&&(r.enableTURNServer=!0,r.enableSTUNServer=!1,r.filterCandidatesType.host=!0,r.filterCandidatesType.srflx=!0,r.filterCandidatesType.relay=!1),n.once("readyStateChange",function(){},function(e,t){if(e===n.READY_STATE_CHANGE.ERROR)return T.error("Failed init() process ->",t),i({error:t.content,errorCode:t.errorCode,status:t.status},null),!0;if(e===n.READY_STATE_CHANGE.COMPLETED){T.info("Completed init() successfully ->",r);var o=s(n._initOptions);return o.serverUrl=n._path,o.readyState=n._readyState,o.selectedRoom=n._selectedRoom,o.TURNTransport=o.TURNServerTransport,i(null,o),!0}}),n._initOptions=r,n._readyState=n.READY_STATE_CHANGE.INIT,n._selectedRoom=n._initOptions.defaultRoom,n._trigger("readyStateChange",n.READY_STATE_CHANGE.INIT,null,n._selectedRoom),!r||!r.appKey||"string"!=typeof r.appKey)return n._readyState=n.READY_STATE_CHANGE.ERROR,void n._trigger("readyStateChange",n.READY_STATE_CHANGE.ERROR,{content:new Error("Please provide an app key"),errorCode:n.READY_STATE_CHANGE_ERROR.NO_PATH,status:-2},n._selectedRoom);n._setClientInfoForLogging(),n._path=n._initOptions.roomServer+"/api/"+n._initOptions.appKey+"/"+n._selectedRoom+(n._initOptions.credentials?"/"+n._initOptions.credentials.startDateTime+"/"+n._initOptions.credentials.duration+"?cred="+n._initOptions.credentials.credentials:"")+(n._initOptions.credentials?"&":"?")+"rand="+Date.now(),n._loadInfo()},a.prototype._containsInList=function(e,t,n){var r=this;for(var i in r[e])if(r[e].hasOwnProperty(i)&&r[e][i]===t)return t;return r[e][n]},a.prototype._requestServerInfo=function(e,t,n,r){var i=this,o=0;i._socketUseXDR="function"==typeof window.XDomainRequest||"object"==typeof window.XDomainRequest,t=i._initOptions.forceSSL?"https:"+t:t,function a(){var s=new XMLHttpRequest,c=!1;i._socketUseXDR&&(T.debug([null,"XMLHttpRequest",e,"Using XDomainRequest for CORS authentication."]),s=new XDomainRequest,s.setContentType=function(e){s.contentType=e}),s.onload=function(){if(!c){c=!0;var t=JSON.parse(s.responseText||s.response||"{}"),r=s.status||(t.success?200:400);if(i._handleAuthStats(t.success?"success":"error",t,r),t.success)return T.debug([null,"XMLHttpRequest",e,"Received sessions parameters ->"],t),void n(t);T.error([null,"XMLHttpRequest",e,"Failed retrieving sessions parameters ->"],t),i._readyState=i.READY_STATE_CHANGE.ERROR,i._trigger("readyStateChange",i.READY_STATE_CHANGE.ERROR,{status:r,content:new Error(t.info||"XMLHttpRequest status not OK\nStatus was: "+r),errorCode:t.error||r},i._selectedRoom)}},s.onerror=function(t){c||(c=!0,T.error([null,"XMLHttpRequest",e,"Failed retrieving information with status ->"],s.status),i._handleAuthStats("error",null,-1,"Failed connecting to server"),i._readyState=i.READY_STATE_CHANGE.ERROR,i._trigger("readyStateChange",i.READY_STATE_CHANGE.ERROR,{status:s.status||-1,content:new Error("Network error occurred. (Status: "+s.status+")"),errorCode:i.READY_STATE_CHANGE_ERROR.XML_HTTP_REQUEST_ERROR},i._selectedRoom))},s.onprogress=function(){T.debug([null,"XMLHttpRequest",e,"Retrieving information and config from webserver ->"],{url:t,params:r})};try{s.open(e,t,!0),i._socketUseXDR||(s.setRequestHeader("Skylink_SDK_version",i.VERSION),s.setRequestHeader("Skylink_SDK_type","WEB_SDK")),r?(s.setContentType("application/json;charset=UTF-8"),s.send(JSON.stringify(r))):s.send()}catch(e){return c=!0,i._handleAuthStats("error",null,-1,e),i._readyState=i.READY_STATE_CHANGE.ERROR,void i._trigger("readyStateChange",i.READY_STATE_CHANGE.ERROR,{status:s.status||-1,content:new Error("Failed starting XHR process."),errorCode:i.READY_STATE_CHANGE_ERROR.XML_HTTP_REQUEST_ERROR},i._selectedRoom)}setTimeout(function(){if(!c)if(c=!0,s.onload=null,s.onerror=null,s.onprogress=null,o<2)o++,a();else{var e=new Error("Response timed out from API server");i._handleAuthStats("error",null,-1,e),i._readyState=i.READY_STATE_CHANGE.ERROR,i._trigger("readyStateChange",i.READY_STATE_CHANGE.ERROR,{status:s.status||-1,content:e,errorCode:i.READY_STATE_CHANGE_ERROR.XML_HTTP_NO_REPONSE_ERROR},i._selectedRoom)}},i._initOptions.apiTimeout)}()},a.prototype._parseInfo=function(e){if(T.log("Parsing parameter from server",e),!e.pc_constraints&&!e.offer_constraints)return void this._trigger("readyStateChange",this.READY_STATE_CHANGE.ERROR,{status:200,content:e.info,errorCode:e.error},self._selectedRoom);T.debug("Peer connection constraints:",e.pc_constraints),T.debug("Offer constraints:",e.offer_constraints),this._key=e.cid,this._appKeyOwner=e.apiOwner,this._signalingServer=e.ipSigserver,this._isPrivileged=e.isPrivileged,this._autoIntroduce=e.autoIntroduce,e.enable_stats_config||(this._initOptions.enableStatsGathering=!1),this._user={uid:e.username,token:e.userCred,timeStamp:e.timeStamp,streams:[],info:{}},this._room={id:e.room_key,token:e.roomCred,startDateTime:e.start,duration:e.len,connection:{peerConstraints:JSON.parse(e.pc_constraints),peerConfig:null,offerConstraints:JSON.parse(e.offer_constraints),sdpConstraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},mediaConstraints:JSON.parse(e.media_constraints)}},this._socketPorts={"http:":Array.isArray(e.httpPortList)&&e.httpPortList.length>0?e.httpPortList:[80,3e3],"https:":Array.isArray(e.httpsPortList)&&e.httpsPortList.length>0?e.httpsPortList:[443,3443]},this._readyState=this.READY_STATE_CHANGE.COMPLETED,this._trigger("readyStateChange",this.READY_STATE_CHANGE.COMPLETED,null,this._selectedRoom),T.info("Parsed parameters from webserver. Ready for web-realtime communication")},a.prototype._loadInfo=function(){var e=this;if("function"!=typeof(o.AdapterJS||n||{}).webRTCReady){return void e._trigger("readyStateChange",e.READY_STATE_CHANGE.ERROR,{status:-2,content:new Error("AdapterJS dependency is not loaded or incorrect AdapterJS dependency is used"),errorCode:e.READY_STATE_CHANGE_ERROR.ADAPTER_NO_LOADED},e._selectedRoom)}return o.io||r?window.XMLHttpRequest?e._path?void t.webRTCReady(function(){if(e._enableIceRestart="firefox"!==t.webrtcDetectedBrowser||t.webrtcDetectedVersion>=48,e._binaryChunkType="firefox"===t.webrtcDetectedBrowser?e.DATA_TRANSFER_DATA_TYPE.BLOB:e.DATA_TRANSFER_DATA_TYPE.ARRAY_BUFFER,!function(){try{var e=new window.RTCPeerConnection(null);return["object","function"].indexOf(typeof e.createOffer)>-1&&null!==e.createOffer}catch(e){return!1}}())return window.RTCPeerConnection&&"plugin"===t.webrtcDetectedType?T.error("Plugin is not available. Please check plugin status."):T.error("WebRTC not supported. Please upgrade your browser"),e._readyState=e.READY_STATE_CHANGE.ERROR,void e._trigger("readyStateChange",e.READY_STATE_CHANGE.ERROR,{status:-2,content:new Error("plugin"===t.webrtcDetectedType&&window.RTCPeerConnection?"Plugin is not available":"WebRTC not available"),errorCode:e.READY_STATE_CHANGE_ERROR.NO_WEBRTC_SUPPORT},e._selectedRoom);e._getCodecsSupport(function(t){return t?(T.error(t),e._readyState=e.READY_STATE_CHANGE.ERROR,void e._trigger("readyStateChange",e.READY_STATE_CHANGE.ERROR,{status:-2,content:new Error(t.message||t.toString()),errorCode:e.READY_STATE_CHANGE_ERROR.PARSE_CODECS},e._selectedRoom)):0===Object.keys(e._currentCodecSupport.audio).length&&0===Object.keys(e._currentCodecSupport.video).length?(T.error("No audio/video codecs available to start connection."),e._readyState=e.READY_STATE_CHANGE.ERROR,void e._trigger("readyStateChange",e.READY_STATE_CHANGE.ERROR,{status:-2,content:new Error("No audio/video codecs available to start connection"),errorCode:e.READY_STATE_CHANGE_ERROR.PARSE_CODECS},e._selectedRoom)):(e._readyState=e.READY_STATE_CHANGE.LOADING,e._trigger("readyStateChange",e.READY_STATE_CHANGE.LOADING,null,e._selectedRoom),e._handleClientStats(),void e._requestServerInfo("GET",e._path,function(t){e._parseInfo(t)}))})}):(T.error("Skylink is not initialised. Please call init() first"),e._readyState=e.READY_STATE_CHANGE.ERROR,void e._trigger("readyStateChange",e.READY_STATE_CHANGE.ERROR,{status:-2,content:new Error("No API Path is found"),errorCode:e.READY_STATE_CHANGE_ERROR.NO_PATH},e._selectedRoom)):(T.error("XMLHttpRequest not supported. Please upgrade your browser"),e._readyState=e.READY_STATE_CHANGE.ERROR,void e._trigger("readyStateChange",e.READY_STATE_CHANGE.ERROR,{status:-2,content:new Error("XMLHttpRequest not available"),errorCode:e.READY_STATE_CHANGE_ERROR.NO_XMLHTTPREQUEST_SUPPORT},e._selectedRoom)):(T.error("Socket.io not loaded. Please load socket.io"),e._readyState=e.READY_STATE_CHANGE.ERROR,void e._trigger("readyStateChange",e.READY_STATE_CHANGE.ERROR,{status:-2,content:new Error("Socket.io not found"),errorCode:e.READY_STATE_CHANGE_ERROR.NO_SOCKET_IO},e._selectedRoom))},a.prototype._initSelectedRoom=function(e,t){var n=this;if("function"==typeof e||void 0===e)return T.error("Invalid room provided. Room:",e),void t(new Error("Invalid room provided"),null);var r=n._initOptions.defaultRoom,i=s(n._initOptions);i.iceServer=i.iceServer?i.iceServer.urls:null,i.defaultRoom!==e&&(i.defaultRoom=e),n.init(i,function(e,i){n._initOptions.defaultRoom=r,e?t(e,null):t(null,i)})};var c=["error","warn","info","log","debug"],d=0,p=!1,u=!1,l=!1,f=!1,h=[],g={app_key:null,statsServer:null},m=function(e){if(void 0===e)return h;for(var t=[],n=0;n<h.length;n++)h[n][1]===c[e]&&t.push(h[n]);return t},_=function(){h=[]},v=function(){for(var e=0;e<h.length;e++){var t=h[e][0],n="undefined"!==console[h[e][1]]?h[e][1]:"log",r=h[e][2],i=h[e][3];void 0!==i?console[n](r,i,t):console[n](r,t)}},y={getLogs:m,clearAllLogs:_,printAllLogs:v},S=function(e,t){if(g.statsServer){var n=g.statsServer,r={data:{message:e,object:t}};r.app_key=g.app_key,r.timestamp=(new Date).toISOString();try{var i=new XMLHttpRequest;i.onerror=function(){},i.open("POST",n+"/rest/stats/sessionerror",!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(r))}catch(e){}}},C=function(e,t,n){var r="",i=new Date;if("object"==typeof t){if(r+=t[0]?" ["+t[0]+"] -":" -",r+=t[1]?" <<"+t[1]+">>":"",t[2])if(r+=" ","object"==typeof t[2])for(var o=0;o<t[2].length;o++)r+="("+t[2][o]+")";else r+="("+t[2]+")";r+=" "+t[3]}else r+=" - "+t;if(p&&u){var a=[i,c[e],r];void 0!==n&&a.push(n),h.push(a)}if(r="SkylinkJS"+(f?" :: "+i.toISOString():"")+r,d>=e)if(e=void 0===console[c[e]]?3:e,p&&l){void 0===console.trace&&e[3];void 0!==n?(console[c[e]](r,n),void 0!==console.trace&&console.trace("")):(console[c[e]](r),void 0!==console.trace&&console.trace(""))}else void 0!==n?console[c[e]](r,n):console[c[e]](r)},T={debug:function(e,t){C(4,e,t)},log:function(e,t){C(3,e,t)},info:function(e,t){C(2,e,t)},warn:function(e,t){C(1,e,t)},error:function(e,t){S(e,t),C(0,e,t)}};a.prototype.setLogLevel=function(e){for(var t in this.LOG_LEVEL)if(this.LOG_LEVEL[t]===e)return d=e,void T.log([null,"Log",t,"Log level exists. Level is set"]);T.error([null,"Log",t,"Log level does not exist. Level is not set"])},a.prototype.setDebugMode=function(e){e&&"object"==typeof e?(p=!0,l=!0===e.trace,u=!0===e.storeLogs,f=!0===e.printTimestamp):!0===e?(p=!0,l=!0,u=!0,f=!1):(p=!1,l=!1,u=!1,f=!1)},a.prototype._setClientInfoForLogging=function(){var e=this._initOptions;g.app_key=e.appKey,g.statsServer=e.statsServer};a.prototype.on=function(e,t){"function"==typeof t?(this._EVENTS[e]=this._EVENTS[e]||[],this._EVENTS[e].push(t),T.log([null,"Event",e,"Event is subscribed"])):T.error([null,"Event",e,"Provided parameter is not a function"])},a.prototype.once=function(e,t,n,r){"boolean"==typeof n&&(r=n,n=null),r=void 0!==r&&r,n="function"!=typeof n?function(){return!0}:n,"function"==typeof t?(this._onceEvents[e]=this._onceEvents[e]||[],this._onceEvents[e].push([t,n,r]),T.log([null,"Event",e,"Event is subscribed on condition"])):T.error([null,"Event",e,"Provided callback is not a function"])},a.prototype.off=function(e,t){if(e&&"string"==typeof e){if(void 0===t)return this._EVENTS[e]=[],this._onceEvents[e]=[],void T.log([null,"Event",e,"All events are unsubscribed"]);for(var n=this._EVENTS[e]||[],r=this._onceEvents[e]||[],i=0;i<n.length;i++)if(n[i]===t){T.log([null,"Event",e,"Event is unsubscribed"]),n.splice(i,1);break}if(void 0!==r)for(var o=0;o<r.length;o++)if(r[o][0]===t){T.log([null,"Event",e,"One-time Event is unsubscribed"]),r.splice(o,1);break}}else this._EVENTS={},this._onceEvents={}},a.prototype._trigger=function(e){var t=Array.prototype.slice.call(arguments),n=this._EVENTS[e],r=this._onceEvents[e]||null;if(t.shift(),n)for(var i=0;i<n.length;i++)try{if(T.log([null,"Event",e,"Event is fired"]),!1===n[i].apply(this,t))break}catch(t){throw T.error([null,"Event",e,"Exception occurred in event:"],t),t}if(r)for(var o=0;o<r.length;o++)if(!0===r[o][1].apply(this,t)){if(T.log([null,"Event",e,"Condition is met. Firing event"]),!1===r[o][0].apply(this,t))break;r[o]&&!r[o][2]&&(T.log([null,"Event",e,"Removing event after firing once"]),r.splice(o,1),o--)}else T.log([null,"Event",e,"Condition is still not met. Holding event from being fired"]);T.log([null,"Event",e,"Event is triggered"])},a.prototype._condition=function(e,t,n,r,i){if("boolean"==typeof r&&(i=r,r=null),"function"==typeof t&&"function"==typeof n){if(n())return T.log([null,"Event",e,"First condition is met. Firing callback"]),void t();T.log([null,"Event",e,"First condition is not met. Subscribing to event"]),this.once(e,t,r,i)}else T.error([null,"Event",e,"Provided callback or checkFirst is not a function"])},a.prototype._wait=function(e,t,n,r){if(r=void 0!==r&&r,"function"==typeof e&&"function"==typeof t){if(t())return T.log([null,"Event",null,"Condition is met. Firing callback"]),void e();T.log([null,"Event",null,"Condition is not met. Doing a check."]),n="number"==typeof n?n:50;var i=setInterval(function(){t()&&(T.log([null,"Event",null,"Condition is met after waiting. Firing callback"]),r||clearInterval(i),e())},n)}else"function"!=typeof e&&T.error([null,"Event",null,"Provided callback is not a function"]),"function"!=typeof t&&T.error([null,"Event",null,"Provided condition is not a function"])},a.prototype._throttle=function(e,t,n){var r=this,i=(new Date).getTime();r._timestamp[t]&&i-r._timestamp[t]<n?e(!1):(e(!0),r._timestamp[t]=i)},a.prototype._postStats=function(e,t){var n=this,r={};if(n._initOptions.enableStatsGathering){Array.isArray(t)?r.data=t:r=t,r.client_id=(n._user&&n._user.uid||"dummy")+"_"+n._statIdRandom,r.app_key=n._initOptions.appKey,r.timestamp=(new Date).toISOString();try{var i=new XMLHttpRequest;i.onerror=function(){},i.open("POST",n._initOptions.statsServer+e,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(r))}catch(e){T.error([null,"XMLHttpRequest","POST","Error in posting stats data ->"],e)}}},a.prototype._handleClientStats=function(){var e=this,n={username:e._user&&e._user.uid||null,sdk_name:"web",sdk_version:e.VERSION,agent_name:t.webrtcDetectedBrowser,agent_version:t.webrtcDetectedVersion,agent_platform:navigator.platform,agent_plugin_version:t.WebRTCPlugin.plugin&&t.WebRTCPlugin.plugin.VERSION||null};e._postStats("/rest/stats/client",n)},a.prototype._handleSessionStats=function(e){var t=this,n={room_id:t._room&&t._room.id,user_id:t._user&&t._user.sid||null,state:e.type,contents:e};t._postStats("/rest/stats/session",n)},a.prototype._handleAuthStats=function(e,t,n,r){var i=this,o={room_id:t&&t.room_key||null,state:e,http_status:n,http_error:("string"==typeof r?r:r&&r.message)||null,api_url:i._path,api_result:t};i._postStats("/rest/stats/auth",o)},a.prototype._handleSignalingStats=function(e,t,n){var r=this,i=s(r._socketSession),o={room_id:r._room&&r._room.id,user_id:r._user&&r._user.sid||null,state:e,signaling_url:i.socketServer,signaling_transport:i.transportType.toLowerCase(),attempts:t,error:("string"==typeof n?n:n&&n.message)||null};r._postStats("/rest/stats/client/signaling",o)},a.prototype._handleIceConnectionStats=function(e,t){var n=this,r={room_id:n._room&&n._room.id,user_id:n._user&&n._user.sid,peer_id:t,state:e,local_candidate:{},remote_candidate:{}};n._retrieveStats(t,function(e,t){t&&["local","remote"].forEach(function(e){var n=t.selectedCandidate[e];n&&(r[e+"_candidate"].ip_address=n.ipAddress||null,r[e+"_candidate"].port_number=n.portNumber||null,r[e+"_candidate"].candidate_type=n.candidateType||null,r[e+"_candidate"].protocol=n.transport||null,r[e+"_candidate"].priority=n.priority||null,"local"===e&&(r.local_candidate.network_type=n.networkType||null))}),n._postStats("/rest/stats/client/iceconnection",r)},!0)},a.prototype._handleIceCandidateStats=function(e,t,n,r,i){var o=this,a={room_id:o._room&&o._room.id,user_id:o._user&&o._user.sid,peer_id:t,state:e,is_remote:!!n,candidate_id:n||null,candidate_sdp_mid:r.sdpMid,candidate_sdp_mindex:r.sdpMLineIndex,candidate_candidate:r.candidate,error:("string"==typeof i?i:i&&i.message)||null};o._manageStatsBuffer("iceCandidate",a,"/rest/stats/client/icecandidate")},a.prototype._handleIceGatheringStats=function(e,t,n){var r=this,i={room_id:r._room&&r._room.id,user_id:r._user&&r._user.sid,peer_id:t,state:e,is_remote:n};r._manageStatsBuffer("iceGathering",i,"/rest/stats/client/icegathering")},a.prototype._handleNegotiationStats=function(e,t,n,r,i){var o=this,a={room_id:o._room&&o._room.id,user_id:o._user&&o._user.sid,peer_id:t,state:e,is_remote:r,weight:n.weight,sdp_type:null,sdp_sdp:null,error:("string"==typeof i?i:i&&i.message)||null};-1===["enter","welcome","restart"].indexOf(e)&&(a.weight=o.getPeerInfo(r?t:void 0).config.priorityWeight,a.sdp_type=n&&n.type||null,a.sdp_sdp=n&&n.sdp||null),o._manageStatsBuffer("negotiation",a,"/rest/stats/client/negotiation")},a.prototype._handleBandwidthStats=function(e){var t=this,n={room_id:t._room&&t._room.id,user_id:t._user&&t._user.sid,peer_id:e,audio_send:{tracks:[]},audio_recv:{},video_send:{tracks:[]},video_recv:{}},r=t._streams.screenshare||t._streams.userMedia||null,i=t.getPeerInfo().mediaStatus;r&&(r.tracks.audio&&(n.audio_send.tracks=[{stream_id:r.id,id:r.tracks.audio.id,label:r.tracks.audio.label,muted:i.audioMuted}]),r.tracks.video&&(n.video_send.tracks=[{stream_id:r.id,id:r.tracks.video.id,label:r.tracks.video.label,height:r.tracks.video.height,width:r.tracks.video.width,muted:i.videoMuted}])),t._retrieveStats(e,function(e,r){e&&(n.error=e&&e.message,r={audio:{sending:{},receiving:{}},video:{sending:{},receiving:{}}});var i=function(e,t,n){var i=r[e]["send"===t?"sending":"receiving"][n];return["number","string","boolean"].indexOf(typeof i)>-1?i:null};n.audio_send.bytes=i("audio","send","bytes"),n.audio_send.packets=i("audio","send","packets"),n.audio_send.round_trip_time=i("audio","send","rtt"),n.audio_send.nack_count=i("audio","send","nacks"),n.audio_send.echo_return_loss=i("audio","send","echoReturnLoss"),n.audio_send.echo_return_loss_enhancement=i("audio","send","echoReturnLossEnhancement"),n.audio_recv.bytes=i("audio","recv","bytes"),n.audio_recv.packets=i("audio","recv","packets"),n.audio_recv.packets_lost=i("audio","recv","packetsLost"),n.video_recv.packets_discarded=i("audio","recv","packetsDiscarded"),n.audio_recv.jitter=i("audio","recv","jitter"),n.audio_recv.nack_count=i("audio","recv","nacks"),n.video_send.bytes=i("video","send","bytes"),n.video_send.packets=i("video","send","packets"),n.video_send.round_trip_time=i("video","send","rtt"),n.video_send.nack_count=i("video","send","nacks"),n.video_send.firs_count=i("video","send","firs"),n.video_send.plis_count=i("video","send","plis"),n.video_send.frames=i("video","send","frames"),n.video_send.frames_encoded=i("video","send","framesEncoded"),n.video_send.frames_dropped=i("video","send","framesDropped"),n.video_send.frame_width=i("video","send","frameWidth"),n.video_send.frame_height=i("video","send","frameHeight"),n.video_send.framerate=i("video","send","frameRate"),n.video_send.framerate_input=i("video","send","frameRateInput"),n.video_send.framerate_encoded=i("video","send","frameRateEncoded"),n.video_send.framerate_mean=i("video","send","frameRateMean"),n.video_send.framerate_std_dev=i("video","send","frameRateStdDev"),n.video_send.cpu_limited_resolution=i("video","send","cpuLimitedResolution"),n.video_send.bandwidth_limited_resolution=i("video","send","bandwidthLimitedResolution"),n.video_recv.bytes=i("video","recv","bytes"),n.video_recv.packets=i("video","recv","packets"),n.video_recv.packets_lost=i("video","recv","packetsLost"),n.video_recv.packets_discarded=i("video","recv","packetsDiscarded"),n.video_recv.jitter=i("video","recv","jitter"),n.video_recv.nack_count=i("video","recv","nacks"),n.video_recv.firs_count=i("video","recv","firs"),n.video_recv.plis_count=i("video","recv","plis"),n.video_recv.frames=i("video","recv","frames"),n.video_recv.frames_decoded=i("video","recv","framesDecoded"),n.video_recv.frame_width=i("video","recv","frameWidth"),n.video_recv.frame_height=i("video","recv","frameHeight"),n.video_recv.framerate=i("video","recv","frameRate"),n.video_recv.framerate_output=i("video","recv","frameRateOutput"),n.video_recv.framerate_decoded=i("video","recv","frameRateDecoded"),n.video_recv.framerate_mean=i("video","recv","frameRateMean"),n.video_recv.framerate_std_dev=i("video","recv","frameRateStdDev"),n.video_recv.qp_sum=i("video","recv","qpSum"),t._postStats("/rest/stats/client/bandwidth",n)},!0)},a.prototype._handleRecordingStats=function(e,t,n,r){var i=this,o={room_id:i._room&&i._room.id,user_id:i._user&&i._user.sid,state:e,recording_id:t||null,recordings:n,error:("string"==typeof r?r:r&&r.message)||null};i._postStats("/rest/stats/client/recording",o)},a.prototype._handleDatachannelStats=function(e,n,r,i,o){var a=this,s={room_id:a._room&&a._room.id,user_id:a._user&&a._user.sid,peer_id:n,state:e,channel_id:r&&r.id,channel_label:r&&r.label,channel_type:"main"===i?"persistent":"temporal",channel_binary_type:r&&r.binaryType,error:("string"==typeof o?o:o&&o.message)||null};r&&"plugin"===t.webrtcDetectedType&&(s.channel_binary_type="int8Array","IE"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion<11&&(s.channel_binary_type="none")),a._postStats("/rest/stats/client/datachannel",s)},a.prototype._stats_buffer={},a.prototype._manageStatsBuffer=function(e,t,n){var r=this;void 0===r._stats_buffer[e]&&(r._stats_buffer[e]={},r._stats_buffer[e].url=n,r._stats_buffer[e].data=[]),r._stats_buffer[e].data.push(t),setInterval(function(){for(var e in r._stats_buffer)r._stats_buffer[e].data.length>0&&(r._postStats(r._stats_buffer[e].url,r._stats_buffer[e].data),r._stats_buffer[e].data=[])},5e3)},a.prototype._sendChannelMessage=function(e){var t=this;if(!t._channelOpen||!t._user||!t._socket)return void T.warn([e.target||"Server","Socket",e.type,"Dropping of message as Socket connection is not opened or is at incorrect step ->"],e);t._user.sid&&!t._peerMessagesStamps[t._user.sid]&&(t._peerMessagesStamps[t._user.sid]={userData:0,audioMuted:0,videoMuted:0});var n=function(e){return e.type===t._SIG_MESSAGE_TYPE.UPDATE_USER?!!t._user.sid&&e.stamp>t._peerMessagesStamps[t._user.sid].userData:e.type===t._SIG_MESSAGE_TYPE.MUTE_VIDEO?!!t._user.sid&&e.stamp>t._peerMessagesStamps[t._user.sid].videoMuted:e.type!==t._SIG_MESSAGE_TYPE.MUTE_AUDIO||!!t._user.sid&&e.stamp>t._peerMessagesStamps[t._user.sid].audioMuted},r=function(e){e.type===t._SIG_MESSAGE_TYPE.UPDATE_USER?t._peerMessagesStamps[t._user.sid].userData=e.stamp:e.type===t._SIG_MESSAGE_TYPE.MUTE_VIDEO?t._peerMessagesStamps[t._user.sid].videoMuted=e.stamp:e.type===t._SIG_MESSAGE_TYPE.MUTE_AUDIO&&(t._peerMessagesStamps[t._user.sid].audioMuted=e.stamp)},i=function(){T.debug([null,"Socket",null,"Starting queue timeout"]),t._socketMessageTimeout=setTimeout(function(){if((new Date).getTime()-t._timestamp.socketMessage<=1e3)return T.debug([null,"Socket",null,"Restarting queue timeout"]),void i();c()},1e3-((new Date).getTime()-t._timestamp.socketMessage))},o=function(e){e.type===t._SIG_MESSAGE_TYPE.PUBLIC_MESSAGE&&t._trigger("incomingMessage",{content:e.data,isPrivate:!1,targetPeerId:null,listOfPeers:Object.keys(t._peerInformations),isDataChannel:!1,senderPeerId:t._user.sid},t._user.sid,t.getPeerInfo(),!0)},a=function(i){if(t._socketMessageTimeout=null,!(t._channelOpen&&t._user&&t._user.sid&&t._socket))return void T.warn([e.target||"Server","Socket",null,"Dropping of group messages as Socket connection is not opened or is at incorrect step ->"],i);for(var a=[],c={userData:0,audioMuted:0,videoMuted:0},d=0;d<i.length;d++)n(i[d])&&(i[d].type===t._SIG_MESSAGE_TYPE.UPDATE_USER&&i[d].stamp>t._peerMessagesStamps[t._user.sid].userData&&i[d].stamp>c.userData?c.userData=i[d].stamp:i[d].type===t._SIG_MESSAGE_TYPE.MUTE_AUDIO&&i[d].stamp>t._peerMessagesStamps[t._user.sid].audioMuted&&i[d].stamp>c.audioMuted?c.audioMuted=i[d].stamp:i[d].type===t._SIG_MESSAGE_TYPE.MUTE_VIDEO&&i[d].stamp>t._peerMessagesStamps[t._user.sid].videoMuted&&i[d].stamp>c.videoMuted&&(c.videoMuted=i[d].stamp));for(var p=0;p<i.length;p++)i[p].type===t._SIG_MESSAGE_TYPE.UPDATE_USER&&i[p].stamp<c.userData||i[p].type===t._SIG_MESSAGE_TYPE.MUTE_AUDIO&&i[p].stamp<c.audioMuted||i[p].type===t._SIG_MESSAGE_TYPE.MUTE_VIDEO&&i[p].stamp<c.videoMuted?(T.warn([e.target||"Server","Socket",i[p],"Dropping of outdated status message ->"],s(i[p])),i.splice(p,1),p--):a.push(JSON.stringify(i[p]));if(a.length>0){var u={type:t._SIG_MESSAGE_TYPE.GROUP,lists:a,mid:t._user.sid,rid:t._room.id};T.log([e.target||"Server","Socket",u.type,"Sending queued grouped message (max: 16 per group) ->"],s(u)),t._socket.send(JSON.stringify(u)),t._timestamp.socketMessage=(new Date).getTime();for(var l=0;l<i.length;l++)r(i[l]),o(i[l])}},c=function(){t._socketMessageQueue.length>0&&(t._socketMessageQueue.length<16?a(t._socketMessageQueue.splice(0,t._socketMessageQueue.length)):(a(t._socketMessageQueue.splice(0,16)),i()))};if(t._GROUP_MESSAGE_LIST.indexOf(e.type)>-1)if(t._timestamp.socketMessage&&(new Date).getTime()-t._timestamp.socketMessage<=1e3)T.debug([e.target||"Server","Socket",e.type,"Queueing socket message to prevent message drop ->"],s(e)),t._socketMessageQueue.push(e),t._socketMessageTimeout||i();else{if(!n(e))return void T.warn([e.target||"Server","Socket",e.type,"Dropping of outdated status message ->"],s(e));t._socketMessageTimeout&&clearTimeout(t._socketMessageTimeout),T.log([e.target||"Server","Socket",e.type,"Sending message ->"],s(e)),t._socket.send(JSON.stringify(e)),r(e),o(e),t._timestamp.socketMessage=(new Date).getTime()}else T.log([e.target||"Server","Socket",e.type,"Sending message ->"],s(e)),t._socket.send(JSON.stringify(e)),e.type===t._SIG_MESSAGE_TYPE.BYE&&t._inRoom&&t._user&&t._user.sid&&e.mid===t._user.sid&&(t.leaveRoom(!1),t._trigger("sessionDisconnect",t._user.sid,t.getPeerInfo()))},a.prototype._createSocket=function(e,t){var n=this,r={forceNew:!0,reconnection:!0,timeout:n._initOptions.socketTimeout,reconnectionAttempts:2,reconnectionDelayMax:5e3,reconnectionDelay:1e3,transports:["websocket"],query:{Skylink_SDK_type:"WEB_SDK",Skylink_SDK_version:n.VERSION}},o=n._initOptions.socketServer&&"object"==typeof n._initOptions.socketServer&&Array.isArray(n._initOptions.socketServer.ports)&&n._initOptions.socketServer.ports.length>0?n._initOptions.socketServer.ports:n._socketPorts[n._signalingServerProtocol],a=null;null===n._signalingServerPort?(n._signalingServerPort=o[0],a=n.SOCKET_FALLBACK.NON_FALLBACK):o.indexOf(n._signalingServerPort)===o.length-1||"string"==typeof n._initOptions.socketServer?"WebSocket"===e?(e="Polling",n._signalingServerPort=o[0]):n._socketSession.finalAttempts++:n._signalingServerPort=o[o.indexOf(n._signalingServerPort)+1],"Polling"===e&&(r.reconnectionDelayMax=1e3,r.reconnectionAttempts=4,r.transports=["xhr-polling","jsonp-polling","polling"]);var c=n._signalingServerProtocol+"//"+n._signalingServer+":"+n._signalingServerPort+"?rand="+Date.now(),d=0;n._initOptions.socketServer&&(c="string"==typeof n._initOptions.socketServer?n._initOptions.socketServer:(n._initOptions.socketServer.protocol?n._initOptions.socketServer.protocol:n._signalingServerProtocol)+"//"+n._initOptions.socketServer.url+":"+n._signalingServerPort),n._socketSession.transportType=e,n._socketSession.socketOptions=r,n._socketSession.socketServer=c,null===a&&(a="http:"===n._signalingServerProtocol?"Polling"===e?n.SOCKET_FALLBACK.LONG_POLLING:n.SOCKET_FALLBACK.FALLBACK_PORT:"Polling"===e?n.SOCKET_FALLBACK.LONG_POLLING_SSL:n.SOCKET_FALLBACK.FALLBACK_SSL_PORT,n._socketSession.attempts++,n._trigger("socketError",n.SOCKET_ERROR.RECONNECTION_ATTEMPT,null,a,s(n._socketSession)),n._trigger("channelRetry",a,n._socketSession.attempts,s(n._socketSession))),n._socket&&n._closeChannel(),n._channelOpen=!1,T.log("Opening channel with signaling server url:",s(n._socketSession));var p=null;try{p=i.connect(c,r)}catch(e){return T.error("Failed creating socket connection object ->",e),a===n.SOCKET_FALLBACK.NON_FALLBACK?n._trigger("socketError",n.SOCKET_ERROR.CONNECTION_FAILED,e,a,s(n._socketSession)):n._trigger("socketError",n.SOCKET_ERROR.RECONNECTION_FAILED,e,a,s(n._socketSession)),void n._trigger("socketError",n.SOCKET_ERROR.RECONNECTION_ABORTED,new Error("Reconnection aborted as there no more available ports, transports and final attempts left."),a,s(n._socketSession))}p.on("reconnect_attempt",function(e){d++,n._socketSession.attempts++,n._handleSignalingStats("reconnect_attempt",d),n._trigger("channelRetry",a,n._socketSession.attempts,s(n._socketSession))}),p.on("reconnect_failed",function(){var r='Failed reconnection with transport "'+e+'" and port '+n._signalingServerPort+".";n._handleSignalingStats("reconnect_failed",d,r),a===n.SOCKET_FALLBACK.NON_FALLBACK?(r=r.replace(/ reconnection /g," connection "),n._trigger("socketError",n.SOCKET_ERROR.CONNECTION_FAILED,new Error(r),a,s(n._socketSession))):n._trigger("socketError",n.SOCKET_ERROR.RECONNECTION_FAILED,new Error(r),a,s(n._socketSession)),n._socketSession.finalAttempts<2?n._createSocket(e,t):n._trigger("socketError",n.SOCKET_ERROR.RECONNECTION_ABORTED,new Error("Reconnection aborted as there no more available ports, transports and final attempts left."),a,s(n._socketSession))}),p.on("reconnect_error",function(e){n._handleSignalingStats("reconnect_error",d,e)}),p.on("connect",function(){n._handleSignalingStats("connect",d),n._channelOpen||(T.log([null,"Socket",null,"Channel opened"]),n._channelOpen=!0,n._trigger("channelOpen",s(n._socketSession)))}),p.on("reconnect",function(){n._handleSignalingStats("reconnect",d),n._channelOpen||(T.log([null,"Socket",null,"Channel opened"]),n._channelOpen=!0,n._trigger("channelOpen",s(n._socketSession)))}),p.on("error",function(e){if(n._handleSignalingStats("error",d,e),e&&e.message.indexOf("xhr poll error")>-1)return T.error([null,"Socket",null,"XHR poll connection unstable. Disconnecting.. ->"],e),void n._closeChannel();T.error([null,"Socket",null,"Exception occurred ->"],e),n._trigger("channelError",e,s(n._socketSession))}),p.on("disconnect",function(){n._handleSignalingStats("disconnect",d),n._channelOpen&&(n._channelOpen=!1,n._trigger("channelClose",s(n._socketSession)),T.log([null,"Socket",null,"Channel closed"]),n._inRoom&&n._user&&n._user.sid&&(n.leaveRoom(!1),n._trigger("sessionDisconnect",n._user.sid,n.getPeerInfo())))}),p.on("message",function(e){var t=JSON.parse(e);if(T.log([null,"Socket",null,"Received message ->"],t),t.type===n._SIG_MESSAGE_TYPE.GROUP){T.debug("Bundle of "+t.lists.length+" messages");for(var r=0;r<t.lists.length;r++){var i=JSON.parse(t.lists[r]);n._processSigMessage(i),n._trigger("channelMessage",i,s(n._socketSession))}}else n._processSigMessage(t),n._trigger("channelMessage",t,s(n._socketSession))}),n._joinRoomManager.socketsFn.push(function(e){e!==t&&p.disconnect()}),n._socket=p},a.prototype._openChannel=function(e){var t=this;if(t._channelOpen)return void T.error([null,"Socket",null,"Unable to instantiate a new channel connection as there is already an ongoing channel connection"]);if(t._readyState!==t.READY_STATE_CHANGE.COMPLETED)return void T.error([null,"Socket",null,"Unable to instantiate a new channel connection as readyState is not ready"]);t._initOptions.forceSSL?t._signalingServerProtocol="https:":t._signalingServerProtocol=window.location.protocol;var n="WebSocket";window.WebSocket||(n="Polling"),t._socketSession.finalAttempts=0,t._socketSession.attempts=0,t._signalingServerPort=null,t._createSocket(n,e)},a.prototype._closeChannel=function(){this._socket&&(this._socket.removeAllListeners("connect_error"),this._socket.removeAllListeners("reconnect_attempt"),this._socket.removeAllListeners("reconnect_error"),this._socket.removeAllListeners("reconnect_failed"),this._socket.removeAllListeners("connect"),this._socket.removeAllListeners("reconnect"),this._socket.removeAllListeners("error"),this._socket.removeAllListeners("disconnect"),this._socket.removeAllListeners("message")),this._channelOpen&&(this._socket&&this._socket.disconnect(),T.log([null,"Socket",null,"Channel closed"]),this._channelOpen=!1,this._trigger("channelClose",s(this._socketSession)),this._inRoom&&this._user&&this._user.sid&&(this.leaveRoom(!1),this._trigger("sessionDisconnect",this._user.sid,this.getPeerInfo()))),this._socket=null},a.prototype.sendMessage=function(e,t){var n=Object.keys(this._peerInformations),r=!1;if(Array.isArray(t)?(n=t,r=!0):t&&"string"==typeof t&&(n=[t],r=!0),!this._inRoom||!this._socket||!this._user)return void T.error("Unable to send message as User is not in Room. ->",e);for(var i=0;i<n.length;i++){var o=n[i];this._peerInformations[o]?"MCU"===o?(n.splice(i,1),i--):r&&(T.debug([o,"Socket",null,"Sending private message to Peer"]),this._sendChannelMessage({cid:this._key,data:e,mid:this._user.sid,rid:this._room.id,target:o,type:this._SIG_MESSAGE_TYPE.PRIVATE_MESSAGE})):(T.error([o,"Socket",null,"Dropping of sending message to Peer as Peer session does not exists"]),n.splice(i,1),i--)}0===n.length&&T.warn("Currently there are no Peers to send message to (unless the message is queued and there are Peer connected by then)."),r?this._trigger("incomingMessage",{content:e,isPrivate:r,targetPeerId:t||null,listOfPeers:n,isDataChannel:!1,senderPeerId:this._user.sid},this._user.sid,this.getPeerInfo(),!0):(T.debug([null,"Socket",null,"Broadcasting message to Peers"]),this._sendChannelMessage({cid:this._key,data:e,mid:this._user.sid,rid:this._room.id,type:this._SIG_MESSAGE_TYPE.PUBLIC_MESSAGE}))},a.prototype.startRecording=function(e){var t=this;if(!t._hasMCU){var n="Unable to start recording as MCU is not connected";return T.error(n),t._handleRecordingStats("error-no-mcu-start",null,null,n),void("function"==typeof e&&e(new Error(n),null))}if(t._currentRecordingId){var r="Unable to start recording as there is an existing recording in-progress";return T.error(r),t._handleRecordingStats("error-start-when-active",t._currentRecordingId,null,r),void("function"==typeof e&&e(new Error(r),null))}"function"==typeof e&&t.once("recordingState",function(t,n){e(null,n)},function(e){return e===t.RECORDING_STATE.START}),t._sendChannelMessage({type:t._SIG_MESSAGE_TYPE.START_RECORDING,rid:t._room.id,target:"MCU"}),t._handleRecordingStats("request-start"),T.debug(["MCU","Recording",null,"Starting recording"])},a.prototype.stopRecording=function(e,t){var n=this;if(!n._hasMCU){var r="Unable to stop recording as MCU is not connected";return T.error(r),n._handleRecordingStats("error-no-mcu-stop",null,null,r),void("function"==typeof e&&e(new Error(r),null))}if(!n._currentRecordingId){var i="Unable to stop recording as there is no recording in-progress";return T.error(i),n._handleRecordingStats("error-stop-when-inactive",null,null,i),void("function"==typeof e&&e(new Error(i),null))}if(n._recordingStartInterval){var o="Unable to stop recording as 4 seconds has not been recorded yet";return T.error(o),n._handleRecordingStats("error-min-stop",n._currentRecordingId,null,o),void("function"==typeof e&&e(new Error(o),null))}if("function"==typeof e){var a=n._currentRecordingId;n.once("recordingState",function(n,r,i,o){if(t)return o?void e(o,null):void e(null,{link:i,recordingId:r});e(null,r)},function(e,r){if(a===r)return t?[n.RECORDING_STATE.LINK,n.RECORDING_STATE.ERROR].indexOf(e)>-1:e===n.RECORDING_STATE.STOP})}n._sendChannelMessage({type:n._SIG_MESSAGE_TYPE.STOP_RECORDING,rid:n._room.id,target:"MCU"}),n._handleRecordingStats("request-stop",n._currentRecordingId),T.debug(["MCU","Recording",null,"Stopping recording"])},a.prototype.getRecordings=function(){return s(this._recordings)},a.prototype._processSigMessage=function(e,t){var n=e.mid;if(n&&n!==this._user.sid||(n="Server"),T.debug([n,"Socket",e.type,"Received from peer ->"],s(e)),e.mid===this._user.sid&&e.type!==this._SIG_MESSAGE_TYPE.REDIRECT&&e.type!==this._SIG_MESSAGE_TYPE.IN_ROOM)return void T.debug([n,"Socket",e.type,"Ignoring message ->"],s(e));switch(e.type){case this._SIG_MESSAGE_TYPE.PUBLIC_MESSAGE:this._publicMessageHandler(e);break;case this._SIG_MESSAGE_TYPE.PRIVATE_MESSAGE:this._privateMessageHandler(e);break;case this._SIG_MESSAGE_TYPE.IN_ROOM:this._inRoomHandler(e);break;case this._SIG_MESSAGE_TYPE.ENTER:this._enterHandler(e);break;case this._SIG_MESSAGE_TYPE.WELCOME:this._welcomeHandler(e);break;case this._SIG_MESSAGE_TYPE.RESTART:this._restartHandler(e);break;case this._SIG_MESSAGE_TYPE.OFFER:this._offerHandler(e);break;case this._SIG_MESSAGE_TYPE.ANSWER:this._answerHandler(e);break;case this._SIG_MESSAGE_TYPE.CANDIDATE:this._candidateHandler(e);break;case this._SIG_MESSAGE_TYPE.BYE:this._byeHandler(e);break;case this._SIG_MESSAGE_TYPE.REDIRECT:this._redirectHandler(e);break;case this._SIG_MESSAGE_TYPE.UPDATE_USER:this._updateUserEventHandler(e);break;case this._SIG_MESSAGE_TYPE.MUTE_VIDEO:this._muteVideoEventHandler(e);break;case this._SIG_MESSAGE_TYPE.MUTE_AUDIO:this._muteAudioEventHandler(e);break;case this._SIG_MESSAGE_TYPE.STREAM:this._streamEventHandler(e);break;case this._SIG_MESSAGE_TYPE.ROOM_LOCK:this._roomLockEventHandler(e);break;case this._SIG_MESSAGE_TYPE.PEER_LIST:this._peerListEventHandler(e);break;case this._SIG_MESSAGE_TYPE.INTRODUCE_ERROR:this._introduceErrorEventHandler(e);break;case this._SIG_MESSAGE_TYPE.APPROACH:this._approachEventHandler(e);break;case this._SIG_MESSAGE_TYPE.RECORDING:this._recordingEventHandler(e);break;case this._SIG_MESSAGE_TYPE.END_OF_CANDIDATES:this._endOfCandidatesHandler(e);break;default:T.error([e.mid,"Socket",e.type,"Unsupported message ->"],s(e))}},a.prototype._peerListEventHandler=function(e){var t=this;t._peerList=e.result,T.log(["Server",null,e.type,"Received list of peers"],t._peerList),t._trigger("getPeersStateChange",t.GET_PEERS_STATE.RECEIVED,t._user.sid,t._peerList)},a.prototype._endOfCandidatesHandler=function(e){var t=this,n=e.mid;t._peerConnections[n]&&t._peerConnections[n].signalingState!==t.PEER_CONNECTION_STATE.CLOSED&&(t._peerEndOfCandidatesCounter[n].expectedLen=e.noOfExpectedCandidates||0,t._handleIceGatheringStats("complete",n,!0),t._signalingEndOfCandidates(n))},a.prototype._introduceErrorEventHandler=function(e){var t=this;T.log(["Server",null,e.type,"Introduce failed. Reason: "+e.reason]),t._handleSessionStats(e),t._trigger("introduceStateChange",t.INTRODUCE_STATE.ERROR,t._user.sid,e.sendingPeerId,e.receivingPeerId,e.reason)},a.prototype._approachEventHandler=function(e){var n=this;T.log(["Server",null,e.type,"Approaching peer"],e.target),n._handleSessionStats(e),n._trigger("handshakeProgress",n.HANDSHAKE_PROGRESS.ENTER,n._user.sid);var r={type:n._SIG_MESSAGE_TYPE.ENTER,mid:n._user.sid,rid:n._room.id,agent:t.webrtcDetectedBrowser,version:(t.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:n._getUserInfo(),receiveOnly:n.getPeerInfo().config.receiveOnly,target:e.target,weight:n._peerPriorityWeight,temasysPluginVersion:t.WebRTCPlugin.plugin?t.WebRTCPlugin.plugin.VERSION:null,enableIceTrickle:n._initOptions.enableIceTrickle,enableDataChannel:n._initOptions.enableDataChannel,enableIceRestart:n._enableIceRestart,SMProtocolVersion:n.SM_PROTOCOL_VERSION,DTProtocolVersion:n.DT_PROTOCOL_VERSION};n._publishOnly&&(r.publishOnly={type:n._streams.screenshare&&n._streams.screenshare.stream?"screenshare":"video"}),n._parentId&&(r.parentId=n._parentId),n._sendChannelMessage(r),n._handleSessionStats(r)},a.prototype._redirectHandler=function(e){if(T.log(["Server",null,e.type,"System action warning:"],{message:e.info,reason:e.reason,action:e.action}),this._handleSessionStats(e),e.action===this.SYSTEM_ACTION.REJECT)for(var t in this._peerConnections)this._peerConnections.hasOwnProperty(t)&&this._removePeer(t);"toClose"===e.reason&&(e.reason="toclose"),this._trigger("systemAction",e.action,e.info,e.reason)},a.prototype._updateUserEventHandler=function(e){var t=e.mid;if(T.log([t,null,e.type,"Peer updated userData:"],e.userData),this._peerInformations[t]){if(this._peerMessagesStamps[t]&&"number"==typeof e.stamp){if(e.stamp<this._peerMessagesStamps[t].userData)return void T.warn([t,null,e.type,"Dropping outdated status ->"],e);this._peerMessagesStamps[t].userData=e.stamp}this._peerInformations[t].userData=e.userData||{},this._trigger("peerUpdated",t,this.getPeerInfo(t),!1)}else T.log([t,null,e.type,"Peer does not have any user information"])},a.prototype._roomLockEventHandler=function(e){var t=e.mid;T.log([t,e.type,"Room lock status:"],e.lock),this._trigger("roomLock",e.lock,t,this.getPeerInfo(t),!1)},a.prototype._muteAudioEventHandler=function(e){var t=e.mid;if(T.log([t,null,e.type,"Peer's audio muted:"],e.muted),this._peerInformations[t]){if(this._peerMessagesStamps[t]&&"number"==typeof e.stamp){if(e.stamp<this._peerMessagesStamps[t].audioMuted)return void T.warn([t,null,e.type,"Dropping outdated status ->"],e);this._peerMessagesStamps[t].audioMuted=e.stamp}this._peerInformations[t].mediaStatus.audioMuted=e.muted,this._trigger("streamMuted",t,this.getPeerInfo(t),!1,this._peerInformations[t].settings.video&&this._peerInformations[t].settings.video.screenshare),this._trigger("peerUpdated",t,this.getPeerInfo(t),!1)}else T.log([t,e.type,"Peer does not have any user information"])},a.prototype._muteVideoEventHandler=function(e){var t=e.mid;if(T.log([t,null,e.type,"Peer's video muted:"],e.muted),this._peerInformations[t]){if(this._peerMessagesStamps[t]&&"number"==typeof e.stamp){if(e.stamp<this._peerMessagesStamps[t].videoMuted)return void T.warn([t,null,e.type,"Dropping outdated status ->"],e);this._peerMessagesStamps[t].videoMuted=e.stamp}this._peerInformations[t].mediaStatus.videoMuted=e.muted,this._trigger("streamMuted",t,this.getPeerInfo(t),!1,this._peerInformations[t].settings.video&&this._peerInformations[t].settings.video.screenshare),this._trigger("peerUpdated",t,this.getPeerInfo(t),!1)}else T.log([t,null,e.type,"Peer does not have any user information"])},a.prototype._streamEventHandler=function(e){var t=e.mid;T.log([t,null,e.type,"Peer's stream status:"],e.status),this._peerInformations[t]&&e.streamId?(this._streamsSession[t]=this._streamsSession[t]||{},"ended"===e.status&&(e.settings&&"object"==typeof e.settings&&void 0===this._streamsSession[t][e.streamId]&&(this._streamsSession[t][e.streamId]={audio:e.settings.audio,video:e.settings.video}),this._handleEndedStreams(t,e.streamId))):T.log([t,null,e.type,"Peer does not have any user information"])},a.prototype._byeHandler=function(e){var t=e.mid;(this._user||{}).sid!==t?(T.log([t,null,e.type,"Peer has left the room"]),this._removePeer(t)):T.log([t,null,e.type,"Self has left the room"])},a.prototype._privateMessageHandler=function(e){var t=e.mid;T.log([t,null,e.type,"Received private message from peer:"],e.data),this._trigger("incomingMessage",{content:e.data,isPrivate:!0,targetPeerId:e.target,isDataChannel:!1,senderPeerId:t},t,this.getPeerInfo(t),!1)},a.prototype._publicMessageHandler=function(e){var t=e.mid;T.log([t,null,e.type,"Received public message from peer:"],e.data),this._trigger("incomingMessage",{content:e.data,isPrivate:!1,targetPeerId:null,isDataChannel:!1,senderPeerId:t},t,this.getPeerInfo(t),!1)},a.prototype._recordingEventHandler=function(e){var t=this;if(T.debug(["MCU","Recording",null,"Received recording message ->"],e),"on"===e.action)t._handleRecordingStats("start",e.recordingId),t._recordings[e.recordingId]||(T.debug(["MCU","Recording",e.recordingId,"Started recording"]),t._currentRecordingId=e.recordingId,t._recordings[e.recordingId]={active:!0,state:t.RECORDING_STATE.START,startedDateTime:(new Date).toISOString(),endedDateTime:null,mixingDateTime:null,links:null,error:null},t._recordingStartInterval=setTimeout(function(){T.log(["MCU","Recording",e.recordingId,"4 seconds has been recorded. Recording can be stopped now"]),t._recordingStartInterval=null},4e3),t._trigger("recordingState",t.RECORDING_STATE.START,e.recordingId,null,null));else if("off"===e.action){if(t._handleRecordingStats("stop",e.recordingId),!t._recordings[e.recordingId])return void T.error(["MCU","Recording",e.recordingId,'Received request of "off" but the session is empty']);t._currentRecordingId=null,t._recordingStartInterval&&(clearTimeout(t._recordingStartInterval),T.warn(["MCU","Recording",e.recordingId,"Recording stopped abruptly before 4 seconds"]),t._recordingStartInterval=null),T.debug(["MCU","Recording",e.recordingId,"Stopped recording"]),t._recordings[e.recordingId].active=!1,t._recordings[e.recordingId].state=t.RECORDING_STATE.STOP,t._recordings[e.recordingId].endedDateTime=(new Date).toISOString(),t._trigger("recordingState",t.RECORDING_STATE.STOP,e.recordingId,null,null)}else if("url"===e.action){var n={};if(Array.isArray(e.urls))for(var r=0;r<e.urls.length;r++)n[messages.urls[r].id||""]=messages.urls[r].url||"";else"string"==typeof e.url&&(n.mixin=e.url);if(t._handleRecordingStats("mixin",e.recordingId,n),!t._recordings[e.recordingId])return void T.error(["MCU","Recording",e.recordingId,"Received URL but the session is empty"]);t._recordings[e.recordingId].links=n,t._recordings[e.recordingId].state=t.RECORDING_STATE.LINK,t._recordings[e.recordingId].mixingDateTime=(new Date).toISOString(),t._trigger("recordingState",t.RECORDING_STATE.LINK,e.recordingId,n,null)}else{var i=new Error(e.error||"Unknown error");if(t._handleRecordingStats("error",e.recordingId,null,i.message),!t._recordings[e.recordingId])return void T.error(["MCU","Recording",e.recordingId,"Received error but the session is empty ->"],i);T.error(["MCU","Recording",e.recordingId,"Recording failure ->"],i),t._recordings[e.recordingId].state=t.RECORDING_STATE.ERROR,t._recordings[e.recordingId].error=i,t._recordings[e.recordingId].active&&(T.debug(["MCU","Recording",e.recordingId,"Stopped recording abruptly"]),t._recordings[e.recordingId].active=!1),t._trigger("recordingState",t.RECORDING_STATE.ERROR,e.recordingId,null,i)}},a.prototype._inRoomHandler=function(e){var n=this;T.log(["Server",null,e.type,"User is now in the room and functionalities are now available. Config received:"],e.pc_config),n._room.connection.peerConfig=n._setIceServers((e.pc_config||{}).iceServers||[]),n._inRoom=!0,n._user.sid=e.sid,n._peerPriorityWeight=e.tieBreaker+(n._initOptions.priorityWeightScheme===n.PRIORITY_WEIGHT_SCHEME.AUTO?0:n._initOptions.priorityWeightScheme===n.PRIORITY_WEIGHT_SCHEME.ENFORCE_OFFERER?2e15:-2e15),n._handleSessionStats(e),n._trigger("peerJoined",n._user.sid,n.getPeerInfo(),!0),n._trigger("handshakeProgress",n.HANDSHAKE_PROGRESS.ENTER,n._user.sid);var r=null;n._streams.screenshare&&n._streams.screenshare.stream?(r=n._streams.screenshare.stream.id||n._streams.screenshare.stream.label,n._trigger("incomingStream",n._user.sid,n._streams.screenshare.stream,!0,n.getPeerInfo(),!0,r)):n._streams.userMedia&&n._streams.userMedia.stream&&(r=n._streams.userMedia.stream.id||n._streams.userMedia.stream.label,n._trigger("incomingStream",n._user.sid,n._streams.userMedia.stream,!0,n.getPeerInfo(),!1,r));var i={type:n._SIG_MESSAGE_TYPE.ENTER,mid:n._user.sid,rid:n._room.id,agent:t.webrtcDetectedBrowser,version:(t.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:n._getUserInfo(),receiveOnly:n.getPeerInfo().config.receiveOnly,weight:n._peerPriorityWeight,temasysPluginVersion:t.WebRTCPlugin.plugin?t.WebRTCPlugin.plugin.VERSION:null,enableIceTrickle:n._initOptions.enableIceTrickle,enableDataChannel:n._initOptions.enableDataChannel,enableIceRestart:n._enableIceRestart,SMProtocolVersion:n.SM_PROTOCOL_VERSION,DTProtocolVersion:n.DT_PROTOCOL_VERSION};n._publishOnly&&(i.publishOnly={type:n._streams.screenshare&&n._streams.screenshare.stream?"screenshare":"video"}),n._parentId&&(i.parentId=n._parentId),n._sendChannelMessage(i),n._handleSessionStats(i)},a.prototype._enterHandler=function(e){var n=this,r=e.mid,i=!1,o=e.userInfo||{};if(o.settings=o.settings||{},o.mediaStatus=o.mediaStatus||{},o.config={enableIceTrickle:"boolean"!=typeof e.enableIceTrickle||e.enableIceTrickle,enableIceRestart:"boolean"==typeof e.enableIceRestart&&e.enableIceRestart,enableDataChannel:"boolean"!=typeof e.enableDataChannel||e.enableDataChannel,priorityWeight:"number"==typeof e.weight?e.weight:0,receiveOnly:!0===e.receiveOnly,publishOnly:!!e.publishOnly},o.parentId=e.parentId||null,o.agent={name:"string"==typeof e.agent&&e.agent?e.agent:"other",version:function(){if(!e.version||"string"!=typeof e.version)return 0;if(e.version.indexOf(".")>-1){var t=e.version.split(".");if(t.length>2){var n=t[0]||"0";return t.splice(0,1),parseFloat(n+"."+t.join("0"),10)}return parseFloat(e.version||"0",10)}return parseInt(e.version||"0",10)}(),os:"string"==typeof e.os&&e.os?e.os:"",pluginVersion:"string"==typeof e.temasysPluginVersion&&e.temasysPluginVersion?e.temasysPluginVersion:null,SMProtocolVersion:e.SMProtocolVersion&&"string"==typeof e.SMProtocolVersion?e.SMProtocolVersion:"0.1.1",DTProtocolVersion:e.DTProtocolVersion&&"string"==typeof e.DTProtocolVersion?e.DTProtocolVersion:n._hasMCU||"MCU"===r?"0.1.2":"0.1.0"},T.log([r,"RTCPeerConnection",null,'Peer "enter" received ->'],e),n._handleNegotiationStats("enter",r,e,!0),"MCU"!==r&&(n._parentId&&n._parentId===r||n._hasMCU&&n._publishOnly||e.parentId&&n._user&&n._user.sid&&e.parentId===n._user.sid))return void T.warn([r,"RTCPeerConnection",null,'Discarding "enter" for parentId or publishOnly case ->'],e);var a=function(a){if(!n._peerInformations[r]){i=!0,n._peerInformations[r]=o;var s=o.settings.video&&"object"==typeof o.settings.video&&!!o.settings.video.screenshare;n._addPeer(r,a||null,{agent:o.agent.name,version:o.agent.version,os:o.agent.os},e.receiveOnly,s),"MCU"===r?(T.info([r,"RTCPeerConnection",null,"MCU feature has been enabled"]),n._hasMCU=!0,n._trigger("serverPeerJoined",r,n.SERVER_PEER_TYPE.MCU)):n._trigger("peerJoined",r,n.getPeerInfo(r),!1),n._trigger("handshakeProgress",n.HANDSHAKE_PROGRESS.ENTER,r)}n._peerMessagesStamps[r]=n._peerMessagesStamps[r]||{userData:0,audioMuted:0,videoMuted:0};var c={type:n._SIG_MESSAGE_TYPE.WELCOME,mid:n._user.sid,rid:n._room.id,enableIceTrickle:n._initOptions.enableIceTrickle,enableDataChannel:n._initOptions.enableDataChannel,enableIceRestart:n._enableIceRestart,agent:t.webrtcDetectedBrowser,version:(t.webrtcDetectedVersion||0).toString(),receiveOnly:n.getPeerInfo().config.receiveOnly,os:window.navigator.platform,userInfo:n._getUserInfo(r),target:r,weight:n._peerPriorityWeight,temasysPluginVersion:t.WebRTCPlugin.plugin?t.WebRTCPlugin.plugin.VERSION:null,SMProtocolVersion:n.SM_PROTOCOL_VERSION,DTProtocolVersion:n.DT_PROTOCOL_VERSION};n._publishOnly&&(c.publishOnly={type:n._streams.screenshare&&n._streams.screenshare.stream?"screenshare":"video"}),n._parentId&&(c.parentId=n._parentId),n._sendChannelMessage(c),n._handleNegotiationStats("welcome",r,c,!1),i&&n._trigger("handshakeProgress",n.HANDSHAKE_PROGRESS.WELCOME,r)};if(n._peerConnectionConfig.certificate!==n.PEER_CERTIFICATE.AUTO&&"function"==typeof RTCPeerConnection.generateCertificate){var s={};s=n._peerConnectionConfig.certificate===n.PEER_CERTIFICATE.ECDSA?{name:"ECDSA",namedCurve:"P-256"}:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},RTCPeerConnection.generateCertificate(s).then(function(e){a(e)},function(){a()})}else a()},a.prototype._restartHandler=function(e){var n=this,r=e.mid,i=e.userInfo||{};if(i.settings=i.settings||{},i.mediaStatus=i.mediaStatus||{},i.config={enableIceTrickle:"boolean"!=typeof e.enableIceTrickle||e.enableIceTrickle,enableIceRestart:"boolean"==typeof e.enableIceRestart&&e.enableIceRestart,enableDataChannel:"boolean"!=typeof e.enableDataChannel||e.enableDataChannel,priorityWeight:"number"==typeof e.weight?e.weight:0,receiveOnly:!0===e.receiveOnly,publishOnly:!!e.publishOnly},i.parentId=e.parentId||null,i.agent={name:"string"==typeof e.agent&&e.agent?e.agent:"other",version:function(){if(!e.version||"string"!=typeof e.version)return 0;if(e.version.indexOf(".")>-1){var t=e.version.split(".");if(t.length>2){var n=t[0]||"0";return t.splice(0,1),parseFloat(n+"."+t.join("0"),10)}return parseFloat(e.version||"0",10)}return parseInt(e.version||"0",10)}(),os:"string"==typeof e.os&&e.os?e.os:"",pluginVersion:"string"==typeof e.temasysPluginVersion&&e.temasysPluginVersion?e.temasysPluginVersion:null,SMProtocolVersion:e.SMProtocolVersion&&"string"==typeof e.SMProtocolVersion?e.SMProtocolVersion:"0.1.1",DTProtocolVersion:e.DTProtocolVersion&&"string"==typeof e.DTProtocolVersion?e.DTProtocolVersion:n._hasMCU||"MCU"===r?"0.1.2":"0.1.0"},T.log([r,"RTCPeerConnection",null,'Peer "restart" received ->'],e),n._handleNegotiationStats("restart",r,e,!0),!n._peerInformations[r])return void T.error([r,"RTCPeerConnection",null,"Peer does not have an existing session. Ignoring restart process."]);if("MCU"!==r&&(n._parentId&&n._parentId===r||n._hasMCU&&n._publishOnly||e.parentId&&n._user&&n._user.sid&&e.parentId===n._user.sid))return void T.warn([r,"RTCPeerConnection",null,'Discarding "restart" for parentId or publishOnly case ->'],e);if(n._hasMCU&&!n._initOptions.mcuUseRenegoRestart)return T.warn([r,"RTCPeerConnection",null,"Dropping restart request as MCU does not support re-negotiation. Restart workaround is to re-join Room for Peer."]),void n._trigger("peerRestart",r,n.getPeerInfo(r),!1,!1);if(n._peerInformations[r]=i,n._peerMessagesStamps[r]=n._peerMessagesStamps[r]||{userData:0,audioMuted:0,videoMuted:0},n._peerEndOfCandidatesCounter[r]=n._peerEndOfCandidatesCounter[r]||{},n._peerEndOfCandidatesCounter[r].len=0,n._peerPriorityWeight>e.weight){if(T.debug([r,"RTCPeerConnection",null,"Re-negotiating new offer/answer."]),n._peerMessagesStamps[r].hasRestart)return void T.warn([r,"RTCPeerConnection",null,'Discarding extra "restart" received.']);n._peerMessagesStamps[r].hasRestart=!0,n._doOffer(r,!0===e.doIceRestart,{agent:i.agent.name,version:i.agent.version,os:i.agent.os},!0)}else{T.debug([r,"RTCPeerConnection",null,"Waiting for peer to start re-negotiation."]);var o={type:n._SIG_MESSAGE_TYPE.RESTART,mid:n._user.sid,rid:n._room.id,agent:t.webrtcDetectedBrowser,version:(t.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:n._getUserInfo(r),target:r,weight:n._peerPriorityWeight,enableIceTrickle:n._initOptions.enableIceTrickle,enableDataChannel:n._initOptions.enableDataChannel,enableIceRestart:n._enableIceRestart,doIceRestart:!0===e.doIceRestart,receiveOnly:n.getPeerInfo().config.receiveOnly,isRestartResend:!0,temasysPluginVersion:t.WebRTCPlugin.plugin?t.WebRTCPlugin.plugin.VERSION:null,SMProtocolVersion:n.SM_PROTOCOL_VERSION,DTProtocolVersion:n.DT_PROTOCOL_VERSION};n._publishOnly&&(o.publishOnly={type:n._streams.screenshare&&n._streams.screenshare.stream?"screenshare":"video"}),n._parentId&&(o.parentId=n._parentId),n._sendChannelMessage(o),n._handleNegotiationStats("restart",r,o,!1)}n._trigger("peerRestart",r,n.getPeerInfo(r),!1,!0===e.doIceRestart)},a.prototype._welcomeHandler=function(e){var n=this,r=e.mid,i=!1,o=e.userInfo||{};if(o.settings=o.settings||{},o.mediaStatus=o.mediaStatus||{},o.config={enableIceTrickle:"boolean"!=typeof e.enableIceTrickle||e.enableIceTrickle,enableIceRestart:"boolean"==typeof e.enableIceRestart&&e.enableIceRestart,enableDataChannel:"boolean"!=typeof e.enableDataChannel||e.enableDataChannel,priorityWeight:"number"==typeof e.weight?e.weight:0,receiveOnly:!0===e.receiveOnly,publishOnly:!!e.publishOnly},o.parentId=e.parentId||null,o.agent={name:"string"==typeof e.agent&&e.agent?e.agent:"other",version:function(){if(!e.version||"string"!=typeof e.version)return 0;if(e.version.indexOf(".")>-1){var t=e.version.split(".");if(t.length>2){var n=t[0]||"0";return t.splice(0,1),parseFloat(n+"."+t.join("0"),10)}return parseFloat(e.version||"0",10)}return parseInt(e.version||"0",10)}(),os:"string"==typeof e.os&&e.os?e.os:"",pluginVersion:"string"==typeof e.temasysPluginVersion&&e.temasysPluginVersion?e.temasysPluginVersion:null,SMProtocolVersion:e.SMProtocolVersion&&"string"==typeof e.SMProtocolVersion?e.SMProtocolVersion:"0.1.1",DTProtocolVersion:e.DTProtocolVersion&&"string"==typeof e.DTProtocolVersion?e.DTProtocolVersion:n._hasMCU||"MCU"===r?"0.1.2":"0.1.0"},T.log([r,"RTCPeerConnection",null,'Peer "welcome" received ->'],e),n._handleNegotiationStats("welcome",r,e,!0),"MCU"!==r&&(n._parentId&&n._parentId===r||n._hasMCU&&n._publishOnly||e.parentId&&n._user&&n._user.sid&&e.parentId===n._user.sid))return void T.warn([r,"RTCPeerConnection",null,'Discarding "welcome" for parentId or publishOnly case ->'],e);var a=function(a){if(!n._peerInformations[r]){i=!0,n._peerInformations[r]=o;var s=o.settings.video&&"object"==typeof o.settings.video&&!!o.settings.video.screenshare;n._addPeer(r,a||null,{agent:o.agent.name,version:o.agent.version,os:o.agent.os},e.receiveOnly,s),"MCU"===r?(T.info([r,"RTCPeerConnection",null,"MCU feature has been enabled"]),n._hasMCU=!0,n._trigger("serverPeerJoined",r,n.SERVER_PEER_TYPE.MCU)):n._trigger("peerJoined",r,n.getPeerInfo(r),!1),n._trigger("handshakeProgress",n.HANDSHAKE_PROGRESS.ENTER,r),n._trigger("handshakeProgress",n.HANDSHAKE_PROGRESS.WELCOME,r)}if(n._peerMessagesStamps[r]=n._peerMessagesStamps[r]||{userData:0,audioMuted:0,videoMuted:0,hasWelcome:!1},n._hasMCU||n._peerPriorityWeight>e.weight){if(n._peerMessagesStamps[r].hasWelcome)return void T.warn([r,"RTCPeerConnection",null,'Discarding extra "welcome" received.']);T.debug([r,"RTCPeerConnection",null,"Starting negotiation"]),n._peerMessagesStamps[r].hasWelcome=!0,n._doOffer(r,!1,{agent:o.agent.name,version:o.agent.version,os:o.agent.os},!0)}else{T.debug([r,"RTCPeerConnection",null,"Waiting for peer to start negotiation."]);var c={type:n._SIG_MESSAGE_TYPE.WELCOME,mid:n._user.sid,rid:n._room.id,enableIceTrickle:n._initOptions.enableIceTrickle,enableDataChannel:n._initOptions.enableDataChannel,enableIceRestart:n._enableIceRestart,receiveOnly:n.getPeerInfo().config.receiveOnly,agent:t.webrtcDetectedBrowser,version:(t.webrtcDetectedVersion||0).toString(),os:window.navigator.platform,userInfo:n._getUserInfo(r),target:r,weight:n._peerPriorityWeight,temasysPluginVersion:t.WebRTCPlugin.plugin?t.WebRTCPlugin.plugin.VERSION:null,SMProtocolVersion:n.SM_PROTOCOL_VERSION,DTProtocolVersion:n.DT_PROTOCOL_VERSION};n._publishOnly&&(c.publishOnly={type:n._streams.screenshare&&n._streams.screenshare.stream?"screenshare":"video"}),n._parentId&&(c.parentId=n._parentId),n._sendChannelMessage(c),n._handleNegotiationStats("welcome",r,c,!1)}};if(n._peerConnectionConfig.certificate!==n.PEER_CERTIFICATE.AUTO&&"function"==typeof RTCPeerConnection.generateCertificate){var s={};s=n._peerConnectionConfig.certificate===n.PEER_CERTIFICATE.ECDSA?{name:"ECDSA",namedCurve:"P-256"}:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},RTCPeerConnection.generateCertificate(s).then(function(e){a(e)},function(){a()})}else a()},a.prototype._offerHandler=function(e){var t=this,n=e.mid,r=t._peerConnections[n];T.log([n,null,e.type,"Received offer from peer. Session description:"],s(e));var i={type:"offer",sdp:t._hasMCU?e.sdp.replace(/\r\n/g,"\n").split("\n").join("\r\n"):e.sdp};if(t._handleNegotiationStats("offer",n,i,!0),!r)return T.error([n,null,e.type,"Peer connection object not found. Unable to setRemoteDescription for offer"]),void t._handleNegotiationStats("dropped_offer",n,i,!0,"Peer connection does not exists");if(e.userInfo&&"object"==typeof e.userInfo){var o=e.userInfo||{};t._peerInformations[n].settings=o.settings||{},t._peerInformations[n].mediaStatus=o.mediaStatus||{},t._peerInformations[n].userData=o.userData}if(T.log([n,"RTCSessionDescription",e.type,"Session description object created"],i),i.sdp=t._removeSDPFilteredCandidates(n,i),i.sdp=t._setSDPCodec(n,i),i.sdp=t._setSDPBitrate(n,i),i.sdp=t._setSDPCodecParams(n,i),i.sdp=t._removeSDPCodecs(n,i),i.sdp=t._removeSDPREMBPackets(n,i),i.sdp=t._handleSDPConnectionSettings(n,i,"remote"),i.sdp=t._removeSDPUnknownAptRtx(n,i),T.log([n,"RTCSessionDescription",e.type,"Updated remote offer ->"],i.sdp),r.signalingState!==t.PEER_CONNECTION_STATE.STABLE)return T.warn([n,null,e.type,'Peer connection state is not in "stable" state for re-negotiation. Dropping message.'],{signalingState:r.signalingState,isRestart:!!e.resend}),void t._handleNegotiationStats("dropped_offer",n,i,!0,'Peer connection state is "'+r.signalingState+'"');if(r.processingRemoteSDP)return T.warn([n,"RTCSessionDescription","offer","Dropping of setting local offer as there is another sessionDescription being processed ->"],i),void t._handleNegotiationStats("dropped_offer",n,i,!0,"Peer connection is currently processing an existing sdp");r.processingRemoteSDP=!0,e.userInfo&&t._trigger("peerUpdated",n,t.getPeerInfo(n),!1),t._parseSDPMediaStreamIDs(n,i);var a=function(){T.debug([n,"RTCSessionDescription",e.type,"Remote description set"]),r.setOffer="remote",r.processingRemoteSDP=!1,t._handleNegotiationStats("set_offer",n,i,!0),t._trigger("handshakeProgress",t.HANDSHAKE_PROGRESS.OFFER,n),t._addIceCandidateFromQueue(n),t._doAnswer(n)},c=function(o){r.processingRemoteSDP=!1,t._handleNegotiationStats("error_set_offer",n,i,!0,o),t._trigger("handshakeProgress",t.HANDSHAKE_PROGRESS.ERROR,n,o),T.error([n,null,e.type,"Failed setting remote description:"],{error:o,state:r.signalingState,offer:i})};r.setRemoteDescription(new RTCSessionDescription(i),a,c)},a.prototype._candidateHandler=function(e){var t=e.mid;if(!e.candidate&&!e.id)return void T.warn([t,"RTCIceCandidate",null,"Received invalid ICE candidate message ->"],e);var n="can-"+(new Date).getTime(),r=e.candidate.split(" ")[7]||"",i=new RTCIceCandidate({sdpMLineIndex:e.label,candidate:e.candidate,sdpMid:e.id});if(T.debug([t,"RTCIceCandidate",n+":"+r,"Received ICE candidate ->"],i),this._handleIceCandidateStats("received",t,n,i),this._peerEndOfCandidatesCounter[t]=this._peerEndOfCandidatesCounter[t]||{},this._peerEndOfCandidatesCounter[t].len=this._peerEndOfCandidatesCounter[t].len||0,this._peerEndOfCandidatesCounter[t].hasSet=!1,this._peerEndOfCandidatesCounter[t].len++,this._trigger("candidateProcessingState",this.CANDIDATE_PROCESSING_STATE.RECEIVED,t,n,r,{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex},null),!this._peerConnections[t]||this._peerConnections[t].signalingState===this.PEER_CONNECTION_STATE.CLOSED)return T.warn([t,"RTCIceCandidate",n+":"+r,"Dropping ICE candidate as Peer connection does not exists or is closed"]),this._handleIceCandidateStats("process_failed",t,n,i,"Peer connection does not exist"),this._trigger("candidateProcessingState",this.CANDIDATE_PROCESSING_STATE.DROPPED,t,n,r,{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex},new Error("Failed processing ICE candidate as Peer connection does not exists or is closed.")),void this._signalingEndOfCandidates(t);if(this._initOptions.filterCandidatesType[r]){if(!this._hasMCU||!this._initOptions.forceTURN)return T.warn([t,"RTCIceCandidate",n+":"+r,"Dropping received ICE candidate as it matches ICE candidate filtering flag ->"],i),this._handleIceCandidateStats("dropped",t,n,i),this._trigger("candidateProcessingState",this.CANDIDATE_PROCESSING_STATE.DROPPED,t,n,r,{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex},new Error("Dropping of processing ICE candidate as it matches ICE candidate filtering flag.")),void this._signalingEndOfCandidates(t);T.warn([t,"RTCIceCandidate",n+":"+r,"Not dropping received ICE candidate as TURN connections are enforced as MCU is present (and act as a TURN itself) so filtering of ICE candidate flags are not honoured ->"],i)}this._peerConnections[t].remoteDescription&&this._peerConnections[t].remoteDescription.sdp&&this._peerConnections[t].localDescription&&this._peerConnections[t].localDescription.sdp?this._addIceCandidate(t,n,i):this._addIceCandidateToQueue(t,n,i),this._signalingEndOfCandidates(t),this._gatheredCandidates[t]||(this._gatheredCandidates[t]={sending:{host:[],srflx:[],relay:[]},receiving:{host:[],srflx:[],relay:[]}}),this._gatheredCandidates[t].receiving[r].push({sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,candidate:i.candidate})},a.prototype._answerHandler=function(e){var t=this,n=e.mid,r=t._peerConnections[n];T.log([n,null,e.type,"Received answer from peer. Session description:"],s(e));var i={type:"answer",sdp:t._hasMCU?e.sdp.replace(/\r\n/g,"\n").split("\n").join("\r\n"):e.sdp};if(t._handleNegotiationStats("answer",n,i,!0),!r)return T.error([n,null,e.type,"Peer connection object not found. Unable to setRemoteDescription for answer"]),void t._handleNegotiationStats("dropped_answer",n,i,!0,"Peer connection does not exist");if(e.userInfo&&"object"==typeof e.userInfo){var o=e.userInfo||{};t._peerInformations[n].settings=o.settings||{},t._peerInformations[n].mediaStatus=o.mediaStatus||{},t._peerInformations[n].userData=o.userData}if(T.log([n,"RTCSessionDescription",e.type,"Session description object created"],i),i.sdp=t._removeSDPFilteredCandidates(n,i),i.sdp=t._setSDPCodec(n,i),i.sdp=t._setSDPBitrate(n,i),i.sdp=t._setSDPCodecParams(n,i),i.sdp=t._removeSDPCodecs(n,i),i.sdp=t._removeSDPREMBPackets(n,i),i.sdp=t._handleSDPConnectionSettings(n,i,"remote"),i.sdp=t._removeSDPUnknownAptRtx(n,i),i.sdp=t._setSCTPport(n,i),T.log([n,"RTCSessionDescription",e.type,"Updated remote answer ->"],i.sdp),r.signalingState!==t.PEER_CONNECTION_STATE.HAVE_LOCAL_OFFER)return T.warn([n,null,e.type,'Peer connection state is not in "have-local-offer" state for re-negotiation. Dropping message.'],{signalingState:r.signalingState,isRestart:!!e.restart}),void t._handleNegotiationStats("dropped_answer",n,i,!0,'Peer connection state is "'+r.signalingState+'"');if(r.processingRemoteSDP)return T.warn([n,"RTCSessionDescription","answer","Dropping of setting local answer as there is another sessionDescription being processed ->"],i),void t._handleNegotiationStats("dropped_answer",n,i,!0,"Peer connection is currently processing an existing sdp");r.processingRemoteSDP=!0,e.userInfo&&t._trigger("peerUpdated",n,t.getPeerInfo(n),!1),t._parseSDPMediaStreamIDs(n,i);var a=function(){T.debug([n,null,e.type,"Remote description set"]),r.setAnswer="remote",r.processingRemoteSDP=!1,t._handleNegotiationStats("set_answer",n,i,!0),t._trigger("handshakeProgress",t.HANDSHAKE_PROGRESS.ANSWER,n),t._addIceCandidateFromQueue(n),t._peerMessagesStamps[n]&&(t._peerMessagesStamps[n].hasRestart=!1),t._dataChannels[n]&&(-1===r.remoteDescription.sdp.indexOf("m=application")||r.remoteDescription.sdp.indexOf("m=application 0")>0)&&(T.warn([n,"RTCPeerConnection",null,"Closing all datachannels as they were rejected."]),t._closeDataChannel(n))},c=function(o){t._handleNegotiationStats("error_set_answer",n,i,!0,o),t._trigger("handshakeProgress",t.HANDSHAKE_PROGRESS.ERROR,n,o),r.processingRemoteSDP=!1,T.error([n,null,e.type,"Failed setting remote description:"],{error:o,state:r.signalingState,answer:i})};r.setRemoteDescription(new RTCSessionDescription(i),a,c)},a.prototype._isLowerThanVersion=function(e,t){for(var n=(e||"").split("."),r=(t||"").split("."),i=0;i<r.length;i++)if((n[i]||"0")<(r[i]||"0"))return!0;return!1},a.prototype.getUserMedia=function(e,n){var r=this;if("function"==typeof e)n=e,e={audio:!0,video:!0};else if("object"!=typeof e||null===e){if(void 0!==e){return T.error("Please provide a valid options",e),void("function"==typeof n&&n(new Error("Please provide a valid options"),null))}e={audio:!0,video:!0}}else if(!e.audio&&!e.video){return T.error("Please select audio or video",e),void("function"==typeof n&&n(new Error("Please select audio or video"),null))}r._throttle(function(i){if(i){if("function"==typeof n){var o=function(e){r.off("mediaAccessError",a),n(null,e)},a=function(e){r.off("mediaAccessSuccess",o),n(e,null)};r.once("mediaAccessSuccess",o,function(e,t){return!t}),r.once("mediaAccessError",a,function(e,t){return!t})}var s=r._parseStreamSettings(e),c=function(e){s.mutedSettings.shouldAudioMuted&&(r._streamsMutedSettings.audioMuted=!0),s.mutedSettings.shouldVideoMuted&&(r._streamsMutedSettings.videoMuted=!0),r._onStreamAccessSuccess(e,s,!1,!1)},d=function(e){r._onStreamAccessError(e,s,!1,!1)};try{if("function"!=typeof(t||{}).webRTCReady)return d(new Error("Failed to call getUserMedia() as AdapterJS is not yet loaded!"));t.webRTCReady(function(){navigator.getUserMedia(s.getUserMediaSettings,c,d)})}catch(e){d(e)}}else if(r._initOptions.throttlingShouldThrowError){var p="Unable to run as throttle interval has not reached ("+r._initOptions.throttleIntervals.getUserMedia+"ms).";T.error(p),"function"==typeof n&&n(new Error(p),null)}},"getUserMedia",r._initOptions.throttleIntervals.getUserMedia)},a.prototype.sendStream=function(e,n){var r=this,i=function(e){r._inRoom?(r._streams.screenshare||(r._trigger("incomingStream",r._user.sid,e,!0,r.getPeerInfo(),!1,e.id||e.label),r._trigger("peerUpdated",r._user.sid,r.getPeerInfo(),!0)),Object.keys(r._peerConnections).length>0||r._hasMCU?r._refreshPeerConnection(Object.keys(r._peerConnections),!1,{},function(t,r){if(t)return T.error("Failed refreshing connections for sendStream() ->",t),void("function"==typeof n&&n(new Error("Failed refreshing connections."),null));"function"==typeof n&&n(null,e)}):"function"==typeof n&&n(null,e)):"function"==typeof n&&n(null,e)};if(!("object"==typeof e&&null!==e||t&&t.WebRTCPlugin&&t.WebRTCPlugin.plugin&&["function","object"].indexOf(typeof e)>-1)){return T.error("Provided stream settings is invalid",e),void("function"==typeof n&&n(new Error("Provided stream settings is invalid"),null))}if(r._inRoom||T.warn("There are no peers to send stream to as not in room!"),"edge"===t.webrtcDetectedBrowser){return T.error("Edge browser currently does not support renegotiation.",e),void("function"==typeof n&&n(new Error("Edge browser currently does not support renegotiation."),null))}if("function"==typeof e.getAudioTracks||"function"==typeof e.getVideoTracks){var o=function(e){for(var t=0;t<e.length;t++)if(!(e[t].ended||"string"==typeof e[t].readyState&&"live"!==e[t].readyState))return!0;return!1};if(!o(e.getAudioTracks())&&!o(e.getVideoTracks())){var a="Provided stream object does not have audio or video tracks.";return T.error(a,e),void("function"==typeof n&&n(new Error(a),null))}r._onStreamAccessSuccess(e,{settings:{audio:!0,video:!0},getUserMediaSettings:{audio:!0,video:!0}},!1,!1),i(e)}else r.getUserMedia(e,function(e,t){if(e)return void("function"==typeof n&&n(e,null));i(t)})},a.prototype.stopStream=function(){this._streams.userMedia&&this._stopStreams({userMedia:!0})},a.prototype.muteStream=function(e){var t=this;if("object"!=typeof e)return void T.error("Provided settings is not an object");if(!(t._streams.userMedia&&t._streams.userMedia.stream||t._streams.screenshare&&t._streams.screenshare.stream))return void T.warn("No streams are available to mute / unmute!");var n="boolean"!=typeof e.audioMuted||e.audioMuted,r="boolean"!=typeof e.videoMuted||e.videoMuted,i=!1,o=!1;if(t._streamsMutedSettings.audioMuted!==n&&(t._streamsMutedSettings.audioMuted=n,i=!0),t._streamsMutedSettings.videoMuted!==r&&(t._streamsMutedSettings.videoMuted=r,o=!0),o||i){var a=t._muteStreams();o&&t._inRoom&&t._sendChannelMessage({type:t._SIG_MESSAGE_TYPE.MUTE_VIDEO,mid:t._user.sid,rid:t._room.id,muted:t._streamsMutedSettings.videoMuted,stamp:(new Date).getTime()}),i&&t._inRoom&&setTimeout(function(){t._sendChannelMessage({type:t._SIG_MESSAGE_TYPE.MUTE_AUDIO,mid:t._user.sid,rid:t._room.id,muted:t._streamsMutedSettings.audioMuted,stamp:(new Date).getTime()})},o?1050:0),(a.hasVideo&&o||a.hasAudio&&i)&&(t._trigger("localMediaMuted",{audioMuted:!a.hasAudio||t._streamsMutedSettings.audioMuted,videoMuted:!a.hasVideo||t._streamsMutedSettings.videoMuted}),t._inRoom&&(t._trigger("streamMuted",t._user.sid,t.getPeerInfo(),!0,t._streams.screenshare&&t._streams.screenshare.stream),t._trigger("peerUpdated",t._user.sid,t.getPeerInfo(),!0)))}},a.prototype.enableAudio=function(){this.muteStream({audioMuted:!1,videoMuted:this._streamsMutedSettings.videoMuted})},a.prototype.disableAudio=function(){this.muteStream({audioMuted:!0,videoMuted:this._streamsMutedSettings.videoMuted})},a.prototype.enableVideo=function(){this.muteStream({videoMuted:!1,audioMuted:this._streamsMutedSettings.audioMuted})},a.prototype.disableVideo=function(){this.muteStream({videoMuted:!0,audioMuted:this._streamsMutedSettings.audioMuted})},a.prototype.shareScreen=function(e,n,r){var i=this,o=!1,a=[i.MEDIA_SOURCE.SCREEN],s=null,c=function(e){for(var t in i.MEDIA_SOURCE)if(i.MEDIA_SOURCE.hasOwnProperty(t)&&i.MEDIA_SOURCE[t]===e)return!0;return!1};if(e&&"string"==typeof e||e&&"object"==typeof e&&e.sourceId&&e.mediaSource)c("object"==typeof e?e.mediaSource:e)&&(a=["object"==typeof e?e.mediaSource:e]),s="object"==typeof e?e.sourceId:null;else if(Array.isArray(e)){for(var d=[],p=0;p<e.length;p++)c(e[p])&&d.push(e[p]);d.length>0&&(a=d)}else e&&"object"==typeof e?e.sourceId&&e.mediaSource||(o={usedtx:"boolean"==typeof e.usedtx?e.usedtx:null,useinbandfec:"boolean"==typeof e.useinbandfec?e.useinbandfec:null,stereo:!0===e.stereo,echoCancellation:!1!==e.echoCancellation,deviceId:e.deviceId}):!0===e?o=!0===e&&{usedtx:null,useinbandfec:null,stereo:!1,echoCancellation:!0,deviceId:null}:"function"==typeof e&&(r=e,e=!1);if(n&&"string"==typeof n||n&&"object"==typeof n&&n.sourceId&&n.mediaSource)c("object"==typeof n?n.mediaSource:n)&&(a=["object"==typeof n?n.mediaSource:n]),s="object"==typeof n?n.sourceId:null;else if(Array.isArray(n)){for(var u=[],p=0;p<n.length;p++)c(n[p])&&u.push(n[p]);u.length>0&&(a=u)}else"function"==typeof n&&(r=n);a.indexOf("audio")>-1&&-1===a.indexOf("tab")&&(a.splice(a.indexOf("audio"),1),0===a.length&&(a=[i.MEDIA_SOURCE.SCREEN])),i._throttle(function(e){if(e){var n={settings:{audio:o,video:{screenshare:!0,exactConstraints:!1}},getUserMediaSettings:{audio:!1,video:{mediaSource:a}}};"plugin"===t.webrtcDetectedType&&s&&(n.getUserMediaSettings.video.optional=[{screenId:s}]);var c=function(e){i.off("mediaAccessError",d),i._inRoom?(i._trigger("incomingStream",i._user.sid,e,!0,i.getPeerInfo(),!0,e.id||e.label),i._trigger("peerUpdated",i._user.sid,i.getPeerInfo(),!0),Object.keys(i._peerConnections).length>0||i._hasMCU?i._refreshPeerConnection(Object.keys(i._peerConnections),!1,{},function(t,n){if(t)return T.error("Failed refreshing connections for shareScreen() ->",t),void("function"==typeof r&&r(new Error("Failed refreshing connections."),null));"function"==typeof r&&r(null,e)}):"function"==typeof r&&r(null,e)):"function"==typeof r&&r(null,e)},d=function(e){i.off("mediaAccessSuccess",c),"function"==typeof r&&r(e,null)};i.once("mediaAccessSuccess",c,function(e,t){return t}),i.once("mediaAccessError",d,function(e,t){return t});var p=!!o&&{echoCancellation:o.echoCancellation};try{var u=!1;o&&("firefox"===t.webrtcDetectedBrowser?(u=!0,n.getUserMediaSettings.audio=p):a.indexOf("audio")>-1&&a.indexOf("tab")>-1&&(u=!0,n.getUserMediaSettings.audio={}));var l=function(e){if(u||!o)return void i._onStreamAccessSuccess(e,n,!0,!1);n.getUserMediaSettings.audio=p;var t=function(t){try{t.addTrack(e.getVideoTracks()[0]),i.once("mediaAccessSuccess",function(){i._streams.screenshare.streamClone=e},function(e,t){return t}),i._onStreamAccessSuccess(t,n,!0,!1)}catch(t){T.error("Failed retrieving audio stream for screensharing stream",t),i._onStreamAccessSuccess(e,n,!0,!1)}},r=function(t){T.error("Failed retrieving audio stream for screensharing stream",t),i._onStreamAccessSuccess(e,n,!0,!1)};navigator.getUserMedia({audio:p},t,r)},f=function(e){i._onStreamAccessError(e,n,!0,!1)};if("function"!=typeof(t||{}).webRTCReady)return f(new Error("Failed to call getUserMedia() as AdapterJS is not yet loaded!"));t.webRTCReady(function(){navigator.getUserMedia(n.getUserMediaSettings,l,f)})}catch(e){i._onStreamAccessError(e,n,!0,!1)}}else if(i._initOptions.throttlingShouldThrowError){var h="Unable to run as throttle interval has not reached ("+i._initOptions.throttleIntervals.shareScreen+"ms).";T.error(h),"function"==typeof r&&r(new Error(h),null)}},"shareScreen",i._initOptions.throttleIntervals.shareScreen)},a.prototype.stopScreen=function(){this._streams.screenshare&&(this._stopStreams({screenshare:!0}),this._inRoom&&(this._streams.userMedia&&this._streams.userMedia.stream&&(this._trigger("incomingStream",this._user.sid,this._streams.userMedia.stream,!0,this.getPeerInfo(),!1,this._streams.userMedia.stream.id||this._streams.userMedia.stream.label),this._trigger("peerUpdated",this._user.sid,this.getPeerInfo(),!0)),this._refreshPeerConnection(Object.keys(this._peerConnections),{},!1)))},a.prototype.getStreamSources=function(e){var t={audio:{input:[],output:[]},video:{input:[]}};if("function"!=typeof e)return T.error("Please provide the callback.");var n=function(n){n.forEach(function(e){var n={deviceId:e.deviceId||e.sourceId||"default",label:e.label,groupId:e.groupId||null};n.label=n.label||"Source for "+n.deviceId,["audio","audioinput"].indexOf(e.kind)>-1?t.audio.input.push(n):["video","videoinput"].indexOf(e.kind)>-1?t.video.input.push(n):"audiooutput"===e.kind&&t.audio.output.push(n)}),e(t)};navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(n):window.MediaStreamTrack&&"function"==typeof MediaStreamTrack.getSources?MediaStreamTrack.getSources(n):n("function"==typeof navigator.getUserMedia?[{deviceId:"default",kind:"audioinput",label:"Default Audio Track"},{deviceId:"default",kind:"videoinput",label:"Default Video Track"}]:[])},a.prototype.getScreenSources=function(e){var n={mediaSource:[],mediaSourceInput:[]};return"function"!=typeof e?T.error("Please provide the callback."):navigator.userAgent.toLowerCase().indexOf("android")>-1?("chrome"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion>=59&&(n.mediaSource=["screen"]),void e(n)):"plugin"===t.webrtcDetectedType?void t.webRTCReady(function(){if(t.WebRTCPlugin.plugin&&t.WebRTCPlugin.plugin.isScreensharingAvailable&&t.WebRTCPlugin.plugin.HasScreensharingFeature&&(n.mediaSource=["window","screen"],"function"==typeof t.WebRTCPlugin.plugin.getScreensharingSources))return void t.WebRTCPlugin.plugin.getScreensharingSources(function(t){t.forEach(t,function(e){var t={sourceId:e.id||e.sourceId||"default",label:e.label,mediaSource:e.kind||"screen"};t.label=t.label||"Source for "+t.sourceId,n.mediaSourceInput.push(t)}),e(n)});e(n)}):(("chrome"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion>=34||"firefox"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion>=38||"opera"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion>=21)&&("opera"!==t.webrtcDetectedBrowser||t.extensionInfo&&t.extensionInfo.opera&&t.extensionInfo.opera.extensionId||T.warn("Please ensure that your application allows Opera screensharing!"),n.mediaSource=["window","screen"],"chrome"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion>=52||"opera"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion>=39?n.mediaSource.push("tab","audio"):"firefox"===t.webrtcDetectedBrowser&&n.mediaSource.push("browser","camera","application")),void e(n))},a.prototype._muteStreams=function(){var e=this,n=!1,r=!1,i=function(t){for(var i=t.getAudioTracks(),o=t.getVideoTracks(),a=0;a<i.length;a++)i[a].enabled=!e._streamsMutedSettings.audioMuted,r=!0;for(var s=0;s<o.length;s++)o[s].enabled=!e._streamsMutedSettings.videoMuted,n=!0};if(e._streams.userMedia&&e._streams.userMedia.stream&&i(e._streams.userMedia.stream),e._streams.screenshare&&e._streams.screenshare.stream&&i(e._streams.screenshare.stream),e._streams.screenshare&&e._streams.screenshare.streamClone&&i(e._streams.screenshare.streamClone),"edge"===t.webrtcDetectedBrowser)for(var o in e._peerConnections)if(e._peerConnections.hasOwnProperty(o)&&e._peerConnections[o])for(var a=e._peerConnections[o].getLocalStreams(),s=0;s<a.length;s++)i(a[s]);return T.debug("Updated Streams muted status ->",e._streamsMutedSettings),{hasVideo:n,hasAudio:r}},a.prototype._stopStreams=function(e){var t=this,n=function(e){var n=e.id||e.label;T.debug([null,"MediaStream",n,"Stopping Stream ->"],e);try{for(var r=e.getAudioTracks(),i=e.getVideoTracks(),o=0;o<r.length;o++)r[o].stop();for(var a=0;a<i.length;a++)i[a].stop()}catch(t){e.stop()}t._streamsStoppedCbs[n]&&(t._streamsStoppedCbs[n](),delete t._streamsStoppedCbs[n])},r=!1,i=!1,o=!1;"object"==typeof e&&(r=!0===e.userMedia,i=!0===e.screenshare),r&&t._streams.userMedia&&(t._streams.userMedia.stream&&n(t._streams.userMedia.stream),t._streams.userMedia=null,o=!0),i&&t._streams.screenshare&&(t._streams.screenshare.streamClone&&n(t._streams.screenshare.streamClone),t._streams.screenshare.stream&&n(t._streams.screenshare.stream),t._streams.screenshare=null,o=!0),t._inRoom&&o&&t._trigger("peerUpdated",t._user.sid,t.getPeerInfo(),!0),T.log("Stopping Streams with settings ->",e)},a.prototype._parseStreamSettings=function(e){var n={settings:{audio:!1,video:!1},mutedSettings:{shouldAudioMuted:!1,shouldVideoMuted:!1},getUserMediaSettings:{audio:!1,video:!1}};return e.audio&&(n.settings.audio={stereo:!1,exactConstraints:!!e.useExactConstraints,echoCancellation:!0},n.getUserMediaSettings.audio={echoCancellation:!0},"object"==typeof e.audio&&("boolean"==typeof e.audio.stereo&&(n.settings.audio.stereo=e.audio.stereo),"boolean"==typeof e.audio.useinbandfec&&(n.settings.audio.useinbandfec=e.audio.useinbandfec),"boolean"==typeof e.audio.usedtx&&(n.settings.audio.usedtx=e.audio.usedtx),"number"==typeof e.audio.maxplaybackrate&&e.audio.maxplaybackrate>=8e3&&e.audio.maxplaybackrate<=48e3&&(n.settings.audio.maxplaybackrate=e.audio.maxplaybackrate),"boolean"==typeof e.audio.mute&&(n.mutedSettings.shouldAudioMuted=e.audio.mute),"edge"!==t.webrtcDetectedBrowser&&("boolean"==typeof e.audio.echoCancellation&&(n.settings.audio.echoCancellation=e.audio.echoCancellation,n.getUserMediaSettings.audio.echoCancellation=e.audio.echoCancellation),Array.isArray(e.audio.optional)&&(n.settings.audio.optional=s(e.audio.optional),n.getUserMediaSettings.audio.optional=s(e.audio.optional)),e.audio.deviceId&&"string"==typeof e.audio.deviceId&&"firefox"!==t.webrtcDetectedBrowser&&(n.settings.audio.deviceId=e.audio.deviceId,n.getUserMediaSettings.audio.deviceId=e.useExactConstraints?{exact:e.audio.deviceId}:{ideal:e.audio.deviceId}))),"edge"===t.webrtcDetectedBrowser&&(n.getUserMediaSettings.audio=!0)),e.video&&(n.settings.video={resolution:s(this.VIDEO_RESOLUTION.VGA),screenshare:!1,exactConstraints:!!e.useExactConstraints},n.getUserMediaSettings.video={},"object"==typeof e.video?("boolean"==typeof e.video.mute&&(n.mutedSettings.shouldVideoMuted=e.video.mute),Array.isArray(e.video.optional)&&(n.settings.video.optional=s(e.video.optional),n.getUserMediaSettings.video.optional=s(e.video.optional)),e.video.deviceId&&"string"==typeof e.video.deviceId&&(n.settings.video.deviceId=e.video.deviceId,n.getUserMediaSettings.video.deviceId=e.useExactConstraints?{exact:e.video.deviceId}:{ideal:e.video.deviceId}),e.video.resolution&&"object"==typeof e.video.resolution&&((e.video.resolution.width&&"object"==typeof e.video.resolution.width||"number"==typeof e.video.resolution.width)&&(n.settings.video.resolution.width=e.video.resolution.width),(e.video.resolution.height&&"object"==typeof e.video.resolution.height||"number"==typeof e.video.resolution.height)&&(n.settings.video.resolution.height=e.video.resolution.height)),n.getUserMediaSettings.video.width="object"==typeof n.settings.video.resolution.width?n.settings.video.resolution.width:e.useExactConstraints?{exact:n.settings.video.resolution.width}:{max:n.settings.video.resolution.width},n.getUserMediaSettings.video.height="object"==typeof n.settings.video.resolution.height?n.settings.video.resolution.height:e.useExactConstraints?{exact:n.settings.video.resolution.height}:{max:n.settings.video.resolution.height},(e.video.frameRate&&"object"==typeof e.video.frameRate||"number"==typeof e.video.frameRate&&"plugin"!==t.webrtcDetectedType)&&(n.settings.video.frameRate=e.video.frameRate,n.getUserMediaSettings.video.frameRate="object"==typeof n.settings.video.frameRate?n.settings.video.frameRate:e.useExactConstraints?{exact:n.settings.video.frameRate}:{max:n.settings.video.frameRate}),e.video.facingMode&&["string","object"].indexOf(typeof e.video.facingMode)>-1&&"plugin"===t.webrtcDetectedType&&(n.settings.video.facingMode=e.video.facingMode,n.getUserMediaSettings.video.facingMode="object"==typeof n.settings.video.facingMode?n.settings.video.facingMode:e.useExactConstraints?{exact:n.settings.video.facingMode}:{max:n.settings.video.facingMode})):n.getUserMediaSettings.video={width:e.useExactConstraints?{exact:n.settings.video.resolution.width}:{max:n.settings.video.resolution.width},height:e.useExactConstraints?{exact:n.settings.video.resolution.height}:{max:n.settings.video.resolution.height}},"edge"===t.webrtcDetectedBrowser&&(n.settings.video={screenshare:!1,exactConstraints:!!e.useExactConstraints},n.getUserMediaSettings.video=!0)),n},a.prototype._parseStreamTracksInfo=function(e,n){var r=this,i=r._streams[e].stream;if(!i)return T.warn("Unable to parse stream tracks information as the stream is not defined"),n();r._streams[e].tracks={audio:null,video:null};var o=i.getAudioTracks(),a=i.getVideoTracks();if(o.length>0&&(r._streams[e].tracks.audio={id:o[0].id||"",label:o[0].label||"audio_track_0"}),0===a.length)return n();r._streams[e].tracks.video={id:a[0].id||"",label:a[0].label||"video_track_0",width:null,height:null};var s=document.createElement("video");s.autoplay=!0,s.muted=!0,s.volume=0;var c=function(){r._streams[e]&&(r._streams[e].tracks.video.width=s.videoWidth,r._streams[e].tracks.video.height=s.videoHeight,s.src="",s.srcObject=null,n())};"plugin"===t.webrtcDetectedType?setTimeout(c,1500):s.addEventListener("loadeddata",c),t.attachMediaStream(s,i)},a.prototype._onStreamAccessSuccess=function(e,n,r,i){var o=this,a=e.id||e.label,s=!1;if(T.log([null,"MediaStream",a,"Has access to stream ->"],e),!r&&o._streams.userMedia?o._stopStreams({userMedia:!0,screenshare:!1}):r&&o._streams.screenshare&&o._stopStreams({userMedia:!1,screenshare:!0}),o._streamsStoppedCbs[a]=function(){T.log([null,"MediaStream",a,"Stream has ended"]),s=!0,o._trigger("mediaAccessStopped",!!r,!!i,a),o._inRoom&&(T.debug([null,"MediaStream",a,"Sending Stream ended status to Peers"]),o._sendChannelMessage({type:o._SIG_MESSAGE_TYPE.STREAM,mid:o._user.sid,rid:o._room.id,cid:o._key,streamId:a,settings:n.settings,status:"ended"}),o._trigger("streamEnded",o._user.sid,o.getPeerInfo(),!0,!!r,a),r&&o._streams.screenshare&&o._streams.screenshare.stream&&(o._streams.screenshare.stream.id||o._streams.screenshare.stream.label)===a?o._streams.screenshare=null:!r&&o._streams.userMedia&&o._streams.userMedia.stream&&(o._streams.userMedia.stream.id||o._streams.userMedia.stream.label)===a&&(o._streams.userMedia=null))},["chrome","opera"].indexOf(t.webrtcDetectedBrowser)>-1?(e.oninactive=function(){o._streamsStoppedCbs[a]&&(o._streamsStoppedCbs[a](),delete o._streamsStoppedCbs[a])},r&&e.getVideoTracks().length>0&&(e.getVideoTracks()[0].onended=function(){setTimeout(function(){!s&&o._inRoom&&o.stopScreen()},350)})):"firefox"===t.webrtcDetectedBrowser?e.endedInterval=setInterval(function(){void 0===e.recordedTime&&(e.recordedTime=0),e.recordedTime===e.currentTime?(clearInterval(e.endedInterval),o._streamsStoppedCbs[a]&&(o._streamsStoppedCbs[a](),delete o._streamsStoppedCbs[a])):e.recordedTime=e.currentTime},1e3):e.onended=function(){o._streamsStoppedCbs[a]&&(o._streamsStoppedCbs[a](),delete o._streamsStoppedCbs[a])},n.settings.audio&&0===e.getAudioTracks().length||n.settings.video&&0===e.getVideoTracks().length){var c="Expected audio tracks length with "+(n.settings.audio?"1":"0")+" and video tracks length with "+(n.settings.video?"1":"0")+" but received audio tracks length with "+e.getAudioTracks().length+" and video tracks length with "+e.getVideoTracks().length;T.warn([null,"MediaStream",a,c]);var d=!!n.settings.audio,p=!!n.settings.video;n.settings.audio&&0===e.getAudioTracks().length&&(n.settings.audio=!1),n.settings.video&&0===e.getVideoTracks().length&&(n.settings.video=!1),o._trigger("mediaAccessFallback",{error:new Error(c),diff:{video:{expected:p?1:0,received:e.getVideoTracks().length},audio:{expected:d?1:0,received:e.getAudioTracks().length}}},o.MEDIA_ACCESS_FALLBACK_STATE.FALLBACKED,!!r,!!i,a)}o._streams[r?"screenshare":"userMedia"]={id:a,stream:e,settings:n.settings,constraints:n.getUserMediaSettings},o._muteStreams(),o._parseStreamTracksInfo(r?"screenshare":"userMedia",function(){o._trigger("mediaAccessSuccess",e,!!r,!!i,a)})},a.prototype._onStreamAccessError=function(e,t,n){var r=this;if(!n&&t.settings.audio&&t.settings.video&&r._initOptions.audioFallback){T.debug("Fallbacking to retrieve audio only Stream"),r._trigger("mediaAccessFallback",{error:e,diff:null},r.MEDIA_ACCESS_FALLBACK_STATE.FALLBACKING,!1,!0);var i=function(e){r._onStreamAccessSuccess(e,t,!1,!0)},o=function(e){T.error("Failed fallbacking to retrieve audio only Stream ->",e),r._trigger("mediaAccessError",e,!1,!0),r._trigger("mediaAccessFallback",{error:e,diff:null},r.MEDIA_ACCESS_FALLBACK_STATE.ERROR,!1,!0)};return void navigator.getUserMedia({audio:!0},i,o)}T.error("Failed retrieving "+(n?"screensharing":"camera")+" Stream ->",e),r._trigger("mediaAccessError",e,!!n,!1)},a.prototype._onRemoteStreamAdded=function(e,t,n){var r=this,i=r._peerConnections[e]&&r._peerConnections[e].remoteStreamId||t.id||t.label;if(!r._peerInformations[e])return void T.warn([e,"MediaStream",i,"Received remote stream when peer is not connected. Ignoring stream ->"],t);T.log([e,"MediaStream",i,"Received remote stream ->"],t),n&&T.log([e,"MediaStream",i,"Peer is having a screensharing session with user"]),r._trigger("incomingStream",e,t,!1,r.getPeerInfo(e),n,i),r._trigger("peerUpdated",e,r.getPeerInfo(e),!1)},a.prototype._addLocalMediaStreams=function(e){var n=this;try{T.log([e,null,null,"Adding local stream"]);var r=n._peerConnections[e];if(r){var i=!(!n._sdpSettings.connection.audio&&"MCU"!==e)&&n._getSDPCommonSupports(e,r.remoteDescription).video,o=!(!n._sdpSettings.connection.video&&"MCU"!==e)&&n._getSDPCommonSupports(e,r.remoteDescription).audio;if(r.signalingState!==n.PEER_CONNECTION_STATE.CLOSED){var a=function(e){if(!e||(!r.localStreamId||e.id!==r.localStreamId)){if("edge"!==t.webrtcDetectedBrowser||n._initOptions.useEdgeWebRTC&&window.msRTCPeerConnection?r.getLocalStreams().forEach(function(e){r.removeStream(e)}):r.getSenders().forEach(function(e){r.removeTrack(e)}),!i&&!o)return;e&&("edge"!==t.webrtcDetectedBrowser||n._initOptions.useEdgeWebRTC&&window.msRTCPeerConnection?r.addStream(e):e.getTracks().forEach(function(t){"audio"===t.kind&&!i||"video"===t.kind&&!o||r.addTrack(t,e)}),r.localStreamId=e.id||e.label,r.localStream=e)}};n._streams.screenshare&&n._streams.screenshare.stream?(T.debug([e,"MediaStream",null,"Sending screen"],n._streams.screenshare.stream),a(n._streams.screenshare.stream)):n._streams.userMedia&&n._streams.userMedia.stream?(T.debug([e,"MediaStream",null,"Sending stream"],n._streams.userMedia.stream),a(n._streams.userMedia.stream)):(T.warn([e,"MediaStream",null,"No media to send. Will be only receiving"]),a(null))}else T.warn([e,"MediaStream",null,"Not adding any stream as signalingState is closed"])}else T.warn([e,"MediaStream",n._mediaStream,"Not adding stream as peerconnection object does not exists"])}catch(t){(t.message||"").indexOf("already added")>-1?T.warn([e,null,null,"Not re-adding stream as LocalMediaStream is already added"],t):T.error([e,null,null,"Failed adding local stream"],t)}},a.prototype._handleEndedStreams=function(e,t){var n=this;n._streamsSession[e]=n._streamsSession[e]||{};var r=function(t){if(n._streamsSession[e][t]){var r=s(n.getPeerInfo(e));r.settings.audio=s(n._streamsSession[e][t].audio),r.settings.video=s(n._streamsSession[e][t].video);var i=r.settings.video&&"object"==typeof r.settings.video&&!!r.settings.video.screenshare;n._streamsSession[e][t]=!1,n._trigger("streamEnded",e,r,!1,i,t)}};if(t)r(t);else if(n._peerConnections[e])for(var i in n._streamsSession[e])n._streamsSession[e].hasOwnProperty(i)&&n._streamsSession[e][i]&&r(i)},a.prototype._setSDPCodecParams=function(e,t){var n=this,r=function(e,n,r,i){var o=t.sdp.match(new RegExp("m="+e+" .*\r\n","gi"));if(Array.isArray(o)&&o.length>0){var a=t.sdp.match(new RegExp("a=rtpmap:.* "+n+"/"+(r?r+("audio"===e?"[/]*.*":".*"):".*")+"\r\n","gi"));if(Array.isArray(a)&&a.length>0)for(var s=0;s<a.length;s++){var c=(a[s].split("a=rtpmap:")[1]||"").split(" ")[0];if(c){var d=t.sdp.match(new RegExp("a=fmtp:"+c+" .*\r\n","gi")),p="a=fmtp:"+c+" ",u=[];if(Array.isArray(d)&&d.length>0){for(var l=(d[0].split("a=fmtp:"+c+" ")[1]||"").replace(/ /g,"").replace(/\r\n/g,"").split(";"),f=0;f<l.length;f++)if(l[f]){var h=l[f].split("=");i.hasOwnProperty(h[0])?p+="boolean"==typeof i[h[0]]?i[h[0]]?h[0]+"=1;":"":h[0]+"="+i[h[0]]+";":p+=l[f]+";",u.push(h[0])}t.sdp=t.sdp.replace(d[0],"")}for(var g in i)i.hasOwnProperty(g)&&-1===u.indexOf(g)&&(p+="boolean"==typeof i[g]?i[g]?g+"=1;":"":g+"="+i[g]+";",u.push(g));p!=="a=fmtp:"+c+" "&&(t.sdp=t.sdp.replace(a[s],a[s]+p+"\r\n"))}}}};return r("audio",n.AUDIO_CODEC.OPUS,48e3,function(){var e={},t=n._streams.screenshare?n._streams.screenshare.settings.audio:n._streams.userMedia?n._streams.userMedia.settings.audio:{};return t=t&&"object"==typeof t?t:{},"boolean"==typeof n._initOptions.codecParams.audio.opus.stereo?e.stereo=n._initOptions.codecParams.audio.opus.stereo:"boolean"==typeof t.stereo&&(e.stereo=t.stereo),"boolean"==typeof n._initOptions.codecParams.audio.opus["sprop-stereo"]?e["sprop-stereo"]=n._initOptions.codecParams.audio.opus["sprop-stereo"]:"boolean"==typeof t.stereo&&(e["sprop-stereo"]=t.stereo),"boolean"==typeof n._initOptions.codecParams.audio.opus.usedtx?e.usedtx=n._initOptions.codecParams.audio.opus.usedtx:"boolean"==typeof t.usedtx&&(e.usedtx=t.usedtx),"boolean"==typeof n._initOptions.codecParams.audio.opus.useinbandfec?e.useinbandfec=n._initOptions.codecParams.audio.opus.useinbandfec:"boolean"==typeof t.useinbandfec&&(e.useinbandfec=t.useinbandfec),"number"==typeof n._initOptions.codecParams.audio.opus.maxplaybackrate?e.maxplaybackrate=n._initOptions.codecParams.audio.opus.maxplaybackrate:"number"==typeof t.maxplaybackrate&&(e.maxplaybackrate=t.maxplaybackrate),"number"==typeof n._initOptions.codecParams.audio.opus.minptime?e.minptime=n._initOptions.codecParams.audio.opus.minptime:"number"==typeof t.minptime&&(e.minptime=t.minptime),e}()),r("video",n.VIDEO_CODEC.VP8,null,function(){var e={};return"number"==typeof n._initOptions.codecParams.video.vp8.maxFr&&(e["max-fr"]=n._initOptions.codecParams.video.vp8.maxFr),"number"==typeof n._initOptions.codecParams.video.vp8.maxFs&&(e["max-fs"]=n._initOptions.codecParams.video.vp8.maxFs),e}()),r("video",n.VIDEO_CODEC.VP9,null,function(){var e={};return"number"==typeof n._initOptions.codecParams.video.vp9.maxFr&&(e["max-fr"]=n._initOptions.codecParams.video.vp9.maxFr),"number"==typeof n._initOptions.codecParams.video.vp9.maxFs&&(e["max-fs"]=n._initOptions.codecParams.video.vp9.maxFs),e}()),r("video",n.VIDEO_CODEC.H264,null,function(){var e={};return"string"==typeof n._initOptions.codecParams.video.h264.levelAsymmetryAllowed&&(e["profile-level-id"]=n._initOptions.codecParams.video.h264.profileLevelId),"boolean"==typeof n._initOptions.codecParams.video.h264.levelAsymmetryAllowed&&(e["level-asymmetry-allowed"]=n._initOptions.codecParams.video.h264.levelAsymmetryAllowed),"boolean"==typeof n._initOptions.codecParams.video.h264.packetizationMode&&(e["packetization-mode"]=n._initOptions.codecParams.video.h264.packetizationMode),e}()),t.sdp},a.prototype._setSDPBitrate=function(e,t){var n=t.sdp.split("\r\n"),r=function(r,i){var o=r,a=-1,s=-1;"data"===r&&(o="application");for(var c=0;c<n.length;c++)if(0===n[c].indexOf("m="+o))a=c;else if(a>0){if(0===n[c].indexOf("m="))break;0===n[c].indexOf("c=")?s=c:0!==n[c].indexOf("b=AS:")&&0!==n[c].indexOf("b:TIAS:")||(n.splice(c,1),c--)}return"number"==typeof i&&i>0?-1===s?void T.error([e,"RTCSessionDesription",t.type,'Failed setting "'+r+'" bandwidth as c-line is missing.']):(T.info([e,"RTCSessionDesription",t.type,'Limiting maximum sending "'+r+'" bandwidth ->'],i),void n.splice(s+1,0,"firefox"===window.webrtcDetectedBrowser?"b=TIAS:"+(1e3*i*(window.webrtcDetectedVersion>52&&window.webrtcDetectedVersion<55?1e3:1)).toFixed(0):"b=AS:"+i)):void T.warn([e,"RTCSessionDesription",t.type,'Not limiting "'+r+'" bandwidth'])},i=this._streamsBandwidthSettings.bAS.audio,o=this._streamsBandwidthSettings.bAS.video,a=this._streamsBandwidthSettings.bAS.data,s=this._streamsBandwidthSettings.googleX.min,c=this._streamsBandwidthSettings.googleX.max;if(this._peerCustomConfigs[e]&&(this._peerCustomConfigs[e].bandwidth&&"object"==typeof this._peerCustomConfigs[e].bandwidth&&("number"==typeof this._peerCustomConfigs[e].bandwidth.audio&&(i=this._peerCustomConfigs[e].bandwidth.audio),"number"==typeof this._peerCustomConfigs[e].bandwidth.video&&(o=this._peerCustomConfigs[e].bandwidth.video),"number"==typeof this._peerCustomConfigs[e].bandwidth.data&&(a=this._peerCustomConfigs[e].bandwidth.data)),this._peerCustomConfigs[e].googleXBandwidth&&"object"==typeof this._peerCustomConfigs[e].googleXBandwidth&&("number"==typeof this._peerCustomConfigs[e].googleXBandwidth.min&&(s=this._peerCustomConfigs[e].googleXBandwidth.min),"number"==typeof this._peerCustomConfigs[e].googleXBandwidth.max&&(c=this._peerCustomConfigs[e].googleXBandwidth.max))),r("audio",i),r("video",o),r("data",a),"number"==typeof s||"number"==typeof c){for(var d=null,p=-1,u=-1,l=0;l<n.length;l++)if(0===n[l].indexOf("m=video"))d=n[l].split(" ")[3];else if(d){if(0===n[l].indexOf("m="))break;if(0===n[l].indexOf("a=rtpmap:"+d+" "))p=l;else if(0===n[l].indexOf("a=fmtp:"+d+" ")){n[l]=n[l].replace(/x-google-(min|max)-bitrate=[0-9]*[;]*/gi,""),u=l;break}}if(p>-1){var f="";"number"==typeof s&&(f+="x-google-min-bitrate="+s+";"),"number"==typeof c&&(f+="x-google-max-bitrate="+c+";"),T.info([e,"RTCSessionDesription",t.type,"Limiting x-google-bitrate ->"],f),u>-1?n[u]+=(n[u].split(" ")[1]?";":"")+f:n.splice(p+1,0,"a=fmtp:"+d+" "+f)}}return n.join("\r\n")},a.prototype._setSDPCodec=function(e,t,n){var r=this,i=function(n,i){var o="object"==typeof i?i.codec:i,a="object"==typeof i?i.samplingRate:null,s="object"==typeof i?i.channels:null;if(o===r["audio"===n?"AUDIO_CODEC":"VIDEO_CODEC"].AUTO)return void T.warn([e,"RTCSessionDesription",t.type,'Not preferring any codec for "'+n+'" streaming. Using browser selection.']);var c=t.sdp.match(new RegExp("m="+n+" .*\r\n","gi"));if(!(Array.isArray(c)&&c.length>0))return void T.error([e,"RTCSessionDesription",t.type,'Not preferring any codec for "'+n+'" streaming as m= line is not found.']);var d=function(r,i,d){if(Array.isArray(r)&&r.length>0){i||(a=null),d||(s=null),T.info([e,"RTCSessionDesription",t.type,'Preferring "'+o+'" (samplingRate: '+(a||"n/a")+", channels: "+(s||"n/a")+') for "'+n+'" streaming.']);var p=c[0],u=p.replace("\r\n","").split(" ");p=u[0]+" "+u[1]+" "+u[2]+" ",u.splice(0,3);for(var l=0;l<r.length;l++){var f=(r[l].split("a=rtpmap:")[1]||"").split(" ");f.length<2||(p+=f[0]+" ")}for(var h=0;h<u.length;h++)p.indexOf(" "+u[h])>0?(u.splice(h,1),h--):t.sdp.match(new RegExp("a=rtpmap:"+u[h]+" "+o+"/.*\r\n","gi"))&&(p+=u[h]+" ",u.splice(h,1),h--);return p+=u.join(" ")+"\r\n",t.sdp=t.sdp.replace(c[0],p),!0}};if(a){if("audio"===n&&s&&d(t.sdp.match(new RegExp("a=rtpmap:.* "+o+"/"+a+(1===s?"[/1]*":"/"+s)+"\r\n","gi")),!0,!0))return;if(d(t.sdp.match(new RegExp("a=rtpmap:.* "+o+"/"+a+"[/]*.*\r\n","gi")),!0))return}"audio"===n&&s&&d(t.sdp.match(new RegExp("a=rtpmap:.* "+o+"/.*/"+s+"\r\n","gi")),!1,!0)||d(t.sdp.match(new RegExp("a=rtpmap:.* "+o+"/.*\r\n","gi")))};return i("audio",n?n.audio:r._initOptions.audioCodec),i("video",n?n.video:r._initOptions.videoCodec),t.sdp},a.prototype._removeSDPFirefoxH264Pref=function(e,t){return T.info([e,"RTCSessionDesription",t.type,"Removing Firefox experimental H264 flag to ensure interopability reliability"]),t.sdp.replace(/a=fmtp:0 profile-level-id=0x42e00c;packetization-mode=1\r\n/g,"")},a.prototype._removeSDPUnknownAptRtx=function(e,t){for(var n=(t.sdp.split("\r\n"),t.sdp.split("m=")),r=0;r<n.length;r++)n[r]=function(e){return(e.match(/a=rtpmap:.*\ rtx\/.*\r\n/gi)||[]).forEach(function(t){var n=(t.split("a=rtpmap:")[1]||"").split(" ")[0]||"",r=(e.match(new RegExp("a=fmtp:"+n+" .*\r\n","gi"))||[])[0];if(!r)return void(e=e.replace(new RegExp(t,"g"),""));var i=(r.split(" apt=")[1]||"").replace(/\r\n/gi,"");e.match(new RegExp("a=rtpmap:"+i+" .*\r\n","gi"))||(e=e.replace(new RegExp(t,"g"),""),e=e.replace(new RegExp(r,"g"),""))}),e}(n[r]),n[r]=function(e){return(e.match(/a=(fmtp|rtcp-fb):.*\ rtx\/.*\r\n/gi)||[]).forEach(function(t){var n=(t.split("a="+(t.indexOf("rtcp")>0?"rtcp-fb":"fmtp"))[1]||"").split(" ")[0]||"";e.match(new RegExp("a=rtpmap:"+n+" .*\r\n","gi"))||(e=e.replace(new RegExp(t,"g"),""))}),e}(n[r]);return n.join("m=")},a.prototype._removeSDPCodecs=function(e,t){var n=this.getPeerInfo().settings.audio,r=function(n,r){var i=t.sdp.match(new RegExp("a=rtpmap:(\\d*)\\ "+r+".*","gi"));if(!(Array.isArray(i)&&i.length>0))return void T.warn([e,"RTCSessionDesription",t.type,'Not removing "'+r+'" as it does not exists.']);for(var o=0;o<i.length;o++){var a=i[o].split(" ")[0].split(":")[1];T.info([e,"RTCSessionDesription",t.type,'Removing "'+r+'" payload ->'],a),t.sdp=t.sdp.replace(new RegExp("a=rtpmap:"+a+"\\ .*\\r\\n","g"),""),t.sdp=t.sdp.replace(new RegExp("a=fmtp:"+a+"\\ .*\\r\\n","g"),""),t.sdp=t.sdp.replace(new RegExp("a=rtpmap:\\d+ rtx\\/\\d+\\r\\na=fmtp:\\d+ apt="+a+"\\r\\n","g"),"");for(var s=t.sdp.split("\r\n"),c=0;c<s.length;c++)if(0===s[c].indexOf("m="+n)){var d=s[c].split(" ");d.indexOf(a)>=3&&d.splice(d.indexOf(a),1),s[c]=d.join(" ");break}t.sdp=s.join("\r\n")}};return this._initOptions.disableVideoFecCodecs&&(this._hasMCU?T.warn([e,"RTCSessionDesription",t.type,'Not removing "ulpfec" or "red" codecs as connected to MCU to prevent connectivity issues.']):(r("video","red"),r("video","ulpfec"))),this._initOptions.disableComfortNoiseCodec&&n&&"object"==typeof n&&n.stereo&&r("audio","CN"),"edge"===window.webrtcDetectedBrowser&&"edge"!==(((this._peerInformations[e]||{}).agent||{}).name||"unknown").name&&(t.sdp=t.sdp.replace(/a=rtcp-fb:.*\ x-message\ .*\r\n/gi,"")),t.sdp},a.prototype._removeSDPREMBPackets=function(e,t){return this._initOptions.disableREMB?(T.info([e,"RTCSessionDesription",t.type,"Removing REMB packets."]),t.sdp.replace(/a=rtcp-fb:\d+ goog-remb\r\n/g,"")):t.sdp},a.prototype._getSDPSelectedCodec=function(e,t,n,r){var i={name:null,implementation:null,clockRate:null,channels:null,payloadType:null,params:null};return t&&t.sdp?(t.sdp.split("m=").forEach(function(e,t){if(0!==t&&0===e.indexOf(n+" ")){var r=(e.split("\r\n")[0]||"").split(" ");r.splice(0,3);for(var o=0;o<r.length;o++){var a=e.match(new RegExp("a=rtpmap:"+r[o]+".*\r\n","gi"));if(a){var s=((a[0]||"").replace(/\r\n/g,"").split(" ")[1]||"").split("/");if(!(["red","ulpfec","telephone-event","cn","rtx"].indexOf(s[0].toLowerCase())>-1)){i.name=s[0],i.clockRate=parseInt(s[1],10)||0,i.channels=parseInt(s[2]||"1",10)||1,i.payloadType=parseInt(r[o],10),i.params="";(e.match(new RegExp("a=fmtp:"+r[o]+".*\r\n","gi"))||[]).forEach(function(e){i.params+=e.replace(new RegExp("a=fmtp:"+r[o],"gi"),"").replace(/\ /g,"").replace(/\r\n/g,"")});break}}}}}),r||T.debug([e,"RTCSessionDesription",t.type,'Parsing session description "'+n+'" codecs ->'],i),i):i},a.prototype._removeSDPFilteredCandidates=function(e,t){return"MCU"===e&&t.type===this.HANDSHAKE_PROGRESS.ANSWER&&"firefox"===window.webrtcDetectedBrowser&&(t.sdp=t.sdp.replace(/ generation 0/g,""),t.sdp=t.sdp.replace(/ udp /g," UDP ")),this._initOptions.forceTURN&&this._hasMCU?(T.warn([e,"RTCSessionDesription",t.type,"Not filtering ICE candidates as TURN connections are enforced as MCU is present (and act as a TURN itself) so filtering of ICE candidate flags are not honoured"]),t.sdp):(this._initOptions.filterCandidatesType.host&&(T.info([e,"RTCSessionDesription",t.type,'Removing "host" ICE candidates.']),t.sdp=t.sdp.replace(/a=candidate:.*host.*\r\n/g,"")),this._initOptions.filterCandidatesType.srflx&&(T.info([e,"RTCSessionDesription",t.type,'Removing "srflx" ICE candidates.']),t.sdp=t.sdp.replace(/a=candidate:.*srflx.*\r\n/g,"")),this._initOptions.filterCandidatesType.relay&&(T.info([e,"RTCSessionDesription",t.type,'Removing "relay" ICE candidates.']),t.sdp=t.sdp.replace(/a=candidate:.*relay.*\r\n/g,"")),t.sdp)},a.prototype._getCodecsSupport=function(e){var n=this;if(n._currentCodecSupport)return void e(null);if(n._currentCodecSupport={audio:{},video:{}},"AppleWebKit"===t.webrtcDetectedType)return n._currentCodecSupport.audio={opus:["48000/2"]},n._currentCodecSupport.video={h264:["48000"]},e(null);try{if("edge"===window.webrtcDetectedBrowser){for(var r=RTCRtpSender.getCapabilities().codecs,i=0;i<r.length;i++)if(["audio","video"].indexOf(r[i].kind)>-1&&r[i].name){var o=r[i].name.toLowerCase();n._currentCodecSupport[r[i].kind][o]=r[i].clockRate+(r[i].numChannels>1?"/"+r[i].numChannels:"")}e(null)}else{var a=new RTCPeerConnection(null),s="plugin"!==t.webrtcDetectedType?{offerToReceiveAudio:!0,offerToReceiveVideo:!0}:{mandatory:{OfferToReceiveVideo:!0,OfferToReceiveAudio:!0}};try{var c=a.createDataChannel("test");n._binaryChunkType=c.binaryType||n._binaryChunkType,n._binaryChunkType=n._binaryChunkType.toLowerCase().indexOf("array")>-1?n.DATA_TRANSFER_DATA_TYPE.ARRAY_BUFFER:n._binaryChunkType;for(var d in n.DATA_TRANSFER_DATA_TYPE)if(n.DATA_TRANSFER_DATA_TYPE.hasOwnProperty(d)&&n._binaryChunkType.toLowerCase()===n.DATA_TRANSFER_DATA_TYPE[d].toLowerCase()){n._binaryChunkType=n.DATA_TRANSFER_DATA_TYPE[d];break}}catch(e){}a.createOffer(function(t){n._currentCodecSupport=n._getSDPCodecsSupport(null,t),e(null)},function(t){e(t)},s)}}catch(t){e(t)}},a.prototype._handleSDPConnectionSettings=function(e,t,n){var r=this;if(!r._sdpSessions[e])return t.sdp;var i=t.sdp;"remote"!==n||r.getPeerInfo(e).config.enableIceTrickle||(i=i.replace(/a=end-of-candidates\r\n/g,""));var o=i.split("\r\n"),a=((r._peerInformations[e]||{}).agent||{}).name||"",c=(r._peerInformations[e],""),d=-1,p=[],u=-1,l=s(r._sdpSettings);if("MCU"===e&&(l.connection.audio=!0,l.connection.video=!0,l.connection.data=!0),r._hasMCU){var f=s(r.getPeerInfo(e)).settings||{};l.direction.audio.receive="MCU"!==e&&!!f.audio,l.direction.audio.send="MCU"===e,l.direction.video.receive="MCU"!==e&&!!f.video,l.direction.video.send="MCU"===e}if("remote"===n){var h=r._getSDPCommonSupports(e,t);h.audio||(l.connection.audio=!1),h.video||(l.connection.video=!1)}r._sdpSessions[e][n].mLines=[],r._sdpSessions[e][n].bundleLine="",r._sdpSessions[e][n].connection={audio:null,video:null,data:null};for(var g=0;g<o.length;g++){if(0===o[g].indexOf("a=group:BUNDLE"))r._sdpSessions[e][n].bundleLine=o[g],d=g;else if(0===o[g].indexOf("m=")&&(c=(o[g].split("m=")[1]||"").split(" ")[0]||"",c="application"===c?"data":c,u++,r._sdpSessions[e][n].mLines[u]=o[g],!l.connection[c])){if(T.log([e,"RTCSessionDesription",t.type,"Removing rejected m="+c+" line ->"],o[g]),r._peerConnectionConfig.bundlePolicy===r.BUNDLE_POLICY.MAX_BUNDLE&&d>-1&&0===u&&("remote"===n?t.type===this.HANDSHAKE_PROGRESS.OFFER:t.type===this.HANDSHAKE_PROGRESS.ANSWER)){T.warn([e,"RTCSessionDesription",t.type,"Not removing rejected m="+c+" line ->"],o[g]),l.connection[c]=!0,["audio","video"].indexOf(c)>-1&&(l.direction[c].send=!1,l.direction[c].receive=!1);continue}if("edge"===window.webrtcDetectedBrowser){o.splice(g,1),g--;continue}if("remote"===n||t.type===this.HANDSHAKE_PROGRESS.ANSWER){var m=o[g].split(" ");m[1]=0,o[g]=m.join(" ");continue}}if("remote"!==n||0!==o[g].indexOf("a=candidate:")||r.getPeerInfo(e).config.enableIceTrickle||o[g+1]&&(0===o[g+1].indexOf("a=candidate:")||0===o[g+1].indexOf("a=end-of-candidates"))||(T.info([e,"RTCSessionDesription",t.type,"Appending end-of-candidates signal for non-trickle ICE connection."]),o.splice(g+1,0,"a=end-of-candidates"),g++),c)if(l.connection[c]){if(0===o[g].indexOf("a=mid:"))p.push(o[g].split("a=mid:")[1]||"");else if(c&&["a=sendrecv","a=sendonly","a=recvonly"].indexOf(o[g])>-1){if(-1===["audio","video"].indexOf(c)){r._sdpSessions[e][n].connection.data=o[g];continue}if("local"===n)l.direction[c].send&&!l.direction[c].receive?o[g]=o[g].indexOf("send")>-1?"a=sendonly":"a=inactive":!l.direction[c].send&&l.direction[c].receive?o[g]=o[g].indexOf("recv")>-1?"a=recvonly":"a=inactive":l.direction[c].send||l.direction[c].receive||(o[g]="a=inactive"),r._hasMCU||"firefox"===window.webrtcDetectedBrowser||"firefox"!==a||t.type!==r.HANDSHAKE_PROGRESS.OFFER||"a=recvonly"!==o[g]||(T.warn([e,"RTCSessionDesription",t.type,"Overriding any original settings to receive only to send and receive to resolve chrome BUNDLE errors."]),o[g]="a=sendrecv",l.direction[c].send=!0,l.direction[c].receive=!0);else if(t.type===r.HANDSHAKE_PROGRESS.ANSWER){var _=r._sdpSessions[e].local.connection[c];"a=sendonly"===_?o[g]=-1===["a=inactive","a=recvonly"].indexOf(o[g])?"a=sendonly"===o[g]?"a=inactive":"a=recvonly":o[g]:"a=recvonly"===_?o[g]=-1===["a=inactive","a=sendonly"].indexOf(o[g])?"a=recvonly"===o[g]?"a=inactive":"a=sendonly":o[g]:"a=inactive"===_&&(o[g]="a=inactive")}r._sdpSessions[e][n].connection[c]=o[g]}}else o.splice(g,1),g--;(o[g]||"").replace(/\n|\r|\s|\ /gi,"")||(o.splice(g,1),g--)}return d>-1&&(r._peerConnectionConfig.bundlePolicy===r.BUNDLE_POLICY.MAX_BUNDLE?o[d]="a=group:BUNDLE "+p.join(" "):r._peerConnectionConfig.bundlePolicy===r.BUNDLE_POLICY.NONE&&o.splice(d,1)),"edge"!==window.webrtcDetectedBrowser&&(o[o.length-1].replace(/\n|\r|\s/gi,"")?o.push(""):o[o.length-1]=""),T.info([e,"RTCSessionDesription",t.type,"Handling connection lines and direction ->"],l),o.join("\r\n")},a.prototype._getSDPFingerprint=function(e,t,n){var r={fingerprint:null,fingerprintAlgorithm:null,derBase64:null};if(!t||!t.sdp)return r;for(var i=t.sdp.split("\r\n"),o=0;o<i.length;o++)if(0===i[o].indexOf("a=fingerprint")){var a=i[o].replace("a=fingerprint:","").split(" ");r.fingerprint=a[1],r.fingerprintAlgorithm=a[0];break}return n||T.debug([e,"RTCSessionDesription",t.type,"Parsing session description fingerprint ->"],r),r},a.prototype._renderSDPOutput=function(e,t){var n=this,r=null,i=null;if(t&&t.sdp){if(!n._peerConnections[e])return t.sdp;n._peerConnections[e].localStream&&(r=n._peerConnections[e].localStream,i=n._peerConnections[e].localStreamId||n._peerConnections[e].localStream.id);var o=(n._initOptions.enableIceTrickle?t.sdp:t.sdp.replace(/a=end-of-candidates\r\n/g,"")).split("\r\n");n._peerInformations[e];if(r)for(var a="",s=0;s<o.length;s++)if(0===o[s].indexOf("m="))a=(o[s].split("m=")[1]||"").split(" ")[0]||"",a=-1===["audio","video"].indexOf(a)?"":a;else if(a)if(0===o[s].indexOf("a=msid:")){var c=o[s].split(" ");c[0]="a=msid:"+i,o[s]=c.join(" ")}else if(0===o[s].indexOf("a=ssrc:")){var d=null;if(o[s].indexOf(" msid:")>0?d=o[s].split(" msid:"):o[s].indexOf(" mslabel:")>0&&(d=o[s].split(" mslabel:")),d){var p=(d[1]||"").split(" ");p[0]=i,d[1]=p.join(" "),o[s].indexOf(" msid:")>0?o[s]=d.join(" msid:"):o[s].indexOf(" mslabel:")>0&&(o[s]=d.join(" mslabel:"))}}if(!n._initOptions.enableIceTrickle){T.info([e,"RTCSessionDesription",t.type,"Appending end-of-candidates signal for non-trickle ICE connection."]);for(var u=0;u<o.length;u++)0===o[u].indexOf("a=candidate:")&&(o[u+1]&&(0===o[u+1].indexOf("a=candidate:")||0===o[u+1].indexOf("a=end-of-candidates"))||(o.splice(u+1,0,"a=end-of-candidates"),u++))}if(t.type===this.HANDSHAKE_PROGRESS.ANSWER&&this._sdpSessions[e]){for(var l=-1,f=0;f<o.length;f++)if(0===o[f].indexOf("a=group:BUNDLE")&&this._sdpSessions[e].remote.bundleLine&&this._peerConnectionConfig.bundlePolicy===this.BUNDLE_POLICY.MAX_BUNDLE)o[f]=this._sdpSessions[e].remote.bundleLine;else if(0===o[f].indexOf("m=")){l++;var h=o[f].split(" "),g=(this._sdpSessions[e].remote.mLines[l]||"").split(" ");h[0]&&g[0]&&h[0]!==g[0]&&(g[1]=0,T.info([e,"RTCSessionDesription",t.type,"Appending middle rejected m= line ->"],g.join(" ")),o.splice(f,0,g.join(" ")),f++,l++)}for(;this._sdpSessions[e].remote.mLines[l+1];){l++;var m=o.length;o[m-1].replace(/\s/gi,"")||(m-=1);var _=(this._sdpSessions[e].remote.mLines[l]||"").split(" ");_[1]=0,T.info([e,"RTCSessionDesription",t.type,"Appending later rejected m= line ->"],_.join(" ")),o.splice(m,0,_.join(" "))}}return"edge"!==window.webrtcDetectedBrowser||t.type!==this.HANDSHAKE_PROGRESS.OFFER||o[o.length-1].replace(/\s/gi,"")||(T.info([e,"RTCSessionDesription",t.type,"Removing last empty space for Edge browsers"]),o.splice(o.length-1,1)),T.info([e,"RTCSessionDescription",t.type,"Formatted output ->"],o.join("\r\n")),o.join("\r\n")}},a.prototype._parseSDPMediaStreamIDs=function(e,t){if(this._peerConnections[e]){if(!t||!t.sdp)return void(this._peerConnections[e].remoteStreamId=null);for(var n=t.sdp.split("\r\n"),r=null,i=0;i<n.length;i++){if(0===n[i].indexOf("a=msid:")){r=(n[i].split("a=msid:")[1]||"").split(" ")[0];break}if(0===n[i].indexOf("a=ssrc:")&&n[i].indexOf(" msid:")>0){r=(n[i].split(" msid:")[1]||"").split(" ")[0];break}}r?r!==this._peerConnections[e].remoteStreamId?(T.info([e,"RTCSessionDesription",t.type,"New remote stream is sent ->"],r),this._peerConnections[e].remoteStreamId=r):T.info([e,"RTCSessionDesription",t.type,"Same remote stream is sent ->"],r):(T.info([e,"RTCSessionDesription",t.type,"No remote stream is sent."]),this._peerConnections[e].remoteStreamId=null)}},a.prototype._getSDPICECandidates=function(e,t,n){var r={host:[],srflx:[],relay:[]};return t&&t.sdp?(t.sdp.split("m=").forEach(function(e,t){if(0!==t){var n=((e.match(/a=mid:.*\r\n/gi)||[])[0]||"").replace(/a=mid:/gi,"").replace(/\r\n/,""),i=t-1;(e.match(/a=candidate:.*\r\n/gi)||[]).forEach(function(e){var t=(e.split(" ")[7]||"host").replace(/\r\n/g,"");r[t]=r[t]||[],r[t].push(new RTCIceCandidate({sdpMid:n,sdpMLineIndex:i,candidate:(e.split("a=")[1]||"").replace(/\r\n/g,"")}))})}}),n||T.debug([e,"RTCSessionDesription",t.type,"Parsing session description ICE candidates ->"],r),r):r},a.prototype._getSDPMediaSSRC=function(e,t,n){var r={audio:0,video:0};return t&&t.sdp?(t.sdp.split("m=").forEach(function(e,t){if(0!==t){var n=e.split(" ")[0]||"",i=(e.match(/a=ssrc:.*\r\n/)||[])[0];"number"==typeof r[n]&&i&&(r[n]=parseInt((i.split("a=ssrc:")[1]||"").split(" ")[0],10)||0)}}),n||T.debug([e,"RTCSessionDesription",t.type,"Parsing session description media SSRCs ->"],r),r):r},a.prototype._getSDPCodecsSupport=function(e,t){var n={audio:{},video:{}};if(!t||!t.sdp)return n;for(var r=t.sdp.split("\r\n"),i="",o=0;o<r.length;o++)if(0!==r[o].indexOf("m=")){if(0===r[o].indexOf("a=rtpmap:")){var a=(r[o].split(" ")[1]||"").split("/"),s=(a[0]||"").toLowerCase(),c=a[1]+(a[2]?"/"+a[2]:"");if(["ulpfec","red","telephone-event","cn","rtx"].indexOf(s)>-1)continue;n[i][s]=n[i][s]||[],-1===n[i][s].indexOf(c)&&n[i][s].push(c)}}else i=(r[o].split("m=")[1]||"").split(" ")[0];return T.info([e||null,"RTCSessionDescription",t.type,"Parsed codecs support ->"],n),n},a.prototype._getSDPCommonSupports=function(e,n){var r=this,i={audio:!1,video:!1};if(!e||!n||!n.sdp){if(i.video=!(!r._currentCodecSupport.video.h264&&!r._currentCodecSupport.video.vp8),i.audio=!!r._currentCodecSupport.audio.opus,e){var o=((r._peerInformations[e]||{}).agent||{}).name||"";t.webrtcDetectedBrowser===o&&(i.video=Object.keys(r._currentCodecSupport.video).length>0,i.audio=Object.keys(r._currentCodecSupport.audio).length>0)}return i}var a=r._getSDPCodecsSupport(e,n),s=r._currentCodecSupport;for(var c in s.audio)if(s.audio.hasOwnProperty(c)&&s.audio[c]&&a.audio[c]){i.audio=!0;break}for(var d in s.video)if(s.video.hasOwnProperty(d)&&s.video[d]&&a.video[d]){i.video=!0;break}return i},a.prototype._setSCTPport=function(e,n){var r=this;if("firefox"===t.webrtcDetectedBrowser&&t.webrtcDetectedVersion>=63&&!0===r._hasMCU){for(var i=n.sdp.split("\r\n"),o=-1,a=n.type,s=0;s<i.length;s++)if(0===i[s].indexOf("m=application"))o=s;else if(o>0){if(0===i[s].indexOf("m="))break;if("offer"===a){r._mline=i[o];break}if("answer"===a){i[o]=r._mline,i.splice(o+1,0,"a=sctp-port:5000");break}}return i.join("\r\n")}return n.sdp},e.exports={Skylink:a,SkylinkLogs:y}}(this)}).call(t,n(610),n(610),n(1197),n(1197))},1197:function(e,t,n){function r(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r=i(e),o=r.source,d=r.id,p=r.path,u=c[d]&&p in c[d].nsps,l=t.forceNew||t["force new connection"]||!1===t.multiplex||u;return l?(s("ignoring socket cache for %s",o),n=a(o,t)):(c[d]||(s("new io instance for %s",o),c[d]=a(o,t)),n=c[d]),n.socket(r.path)}var i=n(1942),o=n(750),a=n(1200),s=n(9)("socket.io-client");e.exports=t=r;var c=t.managers={};t.protocol=o.protocol,t.connect=r,t.Manager=n(1200),t.Socket=n(1204)},1198:function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var a=n.exec(e||""),s={},c=14;c--;)s[r[c]]=a[c]||"";return-1!=i&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},1199:function(e,t,n){(function(t){function n(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}e.exports=n}).call(t,n(65))},1200:function(e,t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);e&&"object"==typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new s.Encoder,this.decoder=new s.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var i=n(1947),o=n(1204),a=n(1205),s=n(750),c=n(1207),d=n(614),p=n(9)("socket.io-client:manager"),u=n(613),l=n(1208),f=Object.prototype.hasOwnProperty;e.exports=r,r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},r.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.engine.id)},a(r.prototype),r.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},r.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},r.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(e){if(p("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;p("opening %s",this.uri),this.engine=i(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var r=c(t,"open",function(){n.onopen(),e&&e()}),o=c(t,"error",function(t){if(p("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;p("connect attempt will timeout after %d",a);var s=setTimeout(function(){p("connect attempt timed out after %d",a),r.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(r),this.subs.push(o),this},r.prototype.onopen=function(){p("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(e){this.decoder.add(e)},r.prototype.ondecoded=function(e){this.emit("packet",e)},r.prototype.onerror=function(e){p("error",e),this.emitAll("error",e)},r.prototype.socket=function(e){function t(){~u(r.connecting,n)||r.connecting.push(n)}var n=this.nsps[e];if(!n){n=new o(this,e),this.nsps[e]=n;var r=this;n.on("connecting",t),n.on("connect",function(){n.id=r.engine.id}),this.autoConnect&&t()}return n},r.prototype.destroy=function(e){var t=u(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},r.prototype.packet=function(e){p("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},r.prototype.cleanup=function(){p("cleanup");for(var e;e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){p("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(e){p("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)p("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();p("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(p("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(p("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(p("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},1201:function(e,t,n){(function(e){function r(t){var n=!1,r=!1,s=!1!==t.jsonp;if(e.location){var c="https:"==location.protocol,d=location.port;d||(d=c?443:80),n=t.hostname!=location.hostname||d!=t.port,r=t.secure!=c}if(t.xdomain=n,t.xscheme=r,"open"in new i(t)&&!t.forceJSONP)return new o(t);if(!s)throw new Error("JSONP disabled");return new a(t)}var i=n(751),o=n(1950),a=n(1958),s=n(1959);t.polling=r,t.websocket=s}).call(t,n(65))},1202:function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},1203:function(e,t,n){function r(e){var t=e&&e.forceBase64;p&&!t||(this.supportsBinary=!1),i.call(this,e)}var i=n(752),o=n(754),a=n(327),s=n(229),c=n(612),d=n(9)("engine.io-client:polling");e.exports=r;var p=function(){return null!=new(n(751))({xdomain:!1}).responseType}();s(r,i),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(e){function t(){d("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(d("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){d("pre-pause polling complete"),--r||t()})),this.writable||(d("we are currently writing - waiting to pause"),r++,this.once("drain",function(){d("pre-pause writing complete"),--r||t()}))}else t()},r.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(e){var t=this;d("polling got data %s",e);var n=function(e,n,r){if("opening"==t.readyState&&t.onOpen(),"close"==e.type)return t.onClose(),!1;t.onPacket(e)};a.decodePayload(e,this.socket.binaryType,n),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function e(){d("writing close packet"),t.write([{type:"close"}])}var t=this;"open"==this.readyState?(d("transport open - closing"),e()):(d("transport not open - deferring close"),this.once("open",e))},r.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")},t=this;a.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},1204:function(e,t,n){function r(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var i=n(750),o=n(1205),a=n(1206),s=n(1207),c=n(614),d=n(9)("socket.io-client:socket"),p=n(1961);e.exports=r;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=o.prototype.emit;o(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",c(this,"onopen")),s(e,"packet",c(this,"onpacket")),s(e,"close",c(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},r.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},r.prototype.emit=function(e){if(u.hasOwnProperty(e))return l.apply(this,arguments),this;var t=a(arguments),n=i.EVENT;p(t)&&(n=i.BINARY_EVENT);var r={type:n,data:t};return r.options={},r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),delete this.flags,this},r.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},r.prototype.onopen=function(){d("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:i.CONNECT})},r.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},r.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data)}},r.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?l.apply(this,t):this.receiveBuffer.push(t)},r.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=a(arguments);d("sending ack %j",r);var o=p(r)?i.BINARY_ACK:i.ACK;t.packet({type:o,id:e,data:r})}}},r.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)l.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},1205:function(e,t){function n(e){if(e)return r(e)}function r(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},1206:function(e,t){function n(e,t){var n=[];t=t||0;for(var r=t||0;r<e.length;r++)n[r-t]=e[r];return n}e.exports=n},1207:function(e,t){function n(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}e.exports=n},1208:function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},1652:function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var a=n.exec(e||""),s={},c=14;c--;)s[r[c]]=a[c]||"";return-1!=i&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},1653:function(e,t,n){(function(t){function r(e){if(!e||"object"!=typeof e)return!1;if(i(e)){for(var n=0,o=e.length;n<o;n++)if(r(e[n]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||a&&e instanceof Blob||s&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return r(e.toJSON(),!0);for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)&&r(e[c]))return!0;return!1}var i=n(2649),o=Object.prototype.toString,a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===o.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===o.call(File);e.exports=r}).call(t,n(2645).Buffer)},1654:function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},1655:function(e,t,n){(function(t){function n(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&(e instanceof ArrayBuffer||ArrayBuffer.isView(e))}e.exports=n}).call(t,n(65))},1656:function(e,t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);e&&"object"==typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||s;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var i=n(2651),o=n(1659),a=n(407),s=n(1112),c=n(1660),d=n(614),p=n(9)("socket.io-client:manager"),u=n(613),l=n(1208),f=Object.prototype.hasOwnProperty;e.exports=r,r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},r.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},r.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},a(r.prototype),r.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},r.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},r.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(e,t){if(p("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;p("opening %s",this.uri),this.engine=i(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var o=c(n,"open",function(){r.onopen(),e&&e()}),a=c(n,"error",function(t){if(p("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;p("connect attempt will timeout after %d",s);var d=setTimeout(function(){p("connect attempt timed out after %d",s),o.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(d)}})}return this.subs.push(o),this.subs.push(a),this},r.prototype.onopen=function(){p("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},r.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},r.prototype.ondata=function(e){this.decoder.add(e)},r.prototype.ondecoded=function(e){this.emit("packet",e)},r.prototype.onerror=function(e){p("error",e),this.emitAll("error",e)},r.prototype.socket=function(e,t){function n(){~u(i.connecting,r)||i.connecting.push(r)}var r=this.nsps[e];if(!r){r=new o(this,e,t),this.nsps[e]=r;var i=this;r.on("connecting",n),r.on("connect",function(){r.id=i.generateId(e)}),this.autoConnect&&n()}return r},r.prototype.destroy=function(e){var t=u(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},r.prototype.packet=function(e){p("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},r.prototype.cleanup=function(){p("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){p("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(e){p("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)p("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();p("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(p("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(p("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(p("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},1657:function(e,t,n){(function(e){function r(t){var n=!1,r=!1,s=!1!==t.jsonp;if(e.location){var c="https:"===location.protocol,d=location.port;d||(d=c?443:80),n=t.hostname!==location.hostname||d!==t.port,r=t.secure!==c}if(t.xdomain=n,t.xscheme=r,"open"in new i(t)&&!t.forceJSONP)return new o(t);if(!s)throw new Error("JSONP disabled");return new a(t)}var i=n(1113),o=n(2653),a=n(2660),s=n(2661);t.polling=r,t.websocket=s}).call(t,n(65))},1658:function(e,t,n){function r(e){var t=e&&e.forceBase64;p&&!t||(this.supportsBinary=!1),i.call(this,e)}var i=n(1114),o=n(702),a=n(408),s=n(229),c=n(612),d=n(9)("engine.io-client:polling");e.exports=r;var p=function(){return null!=new(n(1113))({xdomain:!1}).responseType}();s(r,i),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(e){function t(){d("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(d("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){d("pre-pause polling complete"),--r||t()})),this.writable||(d("we are currently writing - waiting to pause"),r++,this.once("drain",function(){d("pre-pause writing complete"),--r||t()}))}else t()},r.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(e){var t=this;d("polling got data %s",e);var n=function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)};a.decodePayload(e,this.socket.binaryType,n),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function e(){d("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(d("transport open - closing"),e()):(d("transport not open - deferring close"),this.once("open",e))},r.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};a.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=o.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},1659:function(e,t,n){function r(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var i=n(1112),o=n(407),a=n(1206),s=n(1660),c=n(614),d=n(9)("socket.io-client:socket"),p=n(702);e.exports=r;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=o.prototype.emit;o(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",c(this,"onopen")),s(e,"packet",c(this,"onpacket")),s(e,"close",c(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},r.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},r.prototype.emit=function(e){if(u.hasOwnProperty(e))return l.apply(this,arguments),this;var t=a(arguments),n={type:i.EVENT,data:t};return n.options={},n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),delete this.flags,this},r.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},r.prototype.onopen=function(){if(d("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?p.encode(this.query):this.query;d("sending connect packet with query %s",e),this.packet({type:i.CONNECT,query:e})}else this.packet({type:i.CONNECT})},r.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},r.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data)}},r.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?l.apply(this,t):this.receiveBuffer.push(t)},r.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=a(arguments);d("sending ack %j",r),t.packet({type:i.ACK,id:e,data:r})}}},r.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)l.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},r.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},1660:function(e,t){function n(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}e.exports=n},1663:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(i))return e;var o;return o=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")"})}},1763:function(e,t,n){function r(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}function i(e){function n(){if(n.enabled){var e=n,r=+new Date,i=r-(d||r);e.diff=i,e.prev=d,e.curr=r,d=r;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var s=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;s++;var i=t.formatters[r];if("function"==typeof i){var a=o[s];n=i.call(e,a),o.splice(s,1),s--}return n}),t.formatArgs.call(e,o);(n.log||t.log||console.log.bind(console)).apply(e,o)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=r(e),"function"==typeof t.init&&t.init(n),n}function o(e){t.save(e),t.names=[],t.skips=[];for(var n=(e||"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&(e=n[i].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))}function a(){t.enable("")}function s(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=i.debug=i.default=i,t.coerce=c,t.disable=a,t.enable=o,t.enabled=s,t.humanize=n(1764),t.names=[],t.skips=[],t.formatters={};var d},1764:function(e,t){function n(e){if(e=String(e),!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*p;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*s;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function r(e){return e>=d?Math.round(e/d)+"d":e>=c?Math.round(e/c)+"h":e>=s?Math.round(e/s)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function i(e){return o(e,d,"day")||o(e,c,"hour")||o(e,s,"minute")||o(e,a,"second")||e+" ms"}function o(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var a=1e3,s=60*a,c=60*s,d=24*c,p=365.25*d;e.exports=function(e,t){t=t||{};var o=typeof e;if("string"===o&&e.length>0)return n(e);if("number"===o&&!1===isNaN(e))return t.long?i(e):r(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},1942:function(e,t,n){(function(t){function r(e,n){var r=e,n=n||t.location;null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),o("parse %s",e),r=i(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var a=-1!==r.host.indexOf(":"),s=a?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port,r.href=r.protocol+"://"+s+(n&&n.port==r.port?"":":"+r.port),r}var i=n(1198),o=n(9)("socket.io-client:url");e.exports=r}).call(t,n(65))},1943:function(e,t,n){(function(e,r){var i;(function(){function o(e,t){function n(e){if(n[e]!==m)return n[e];var o;if("bug-string-char-index"==e)o="a"!="a"[0];else if("json"==e)o=n("json-stringify")&&n("json-parse");else{var a,s='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var d=t.stringify,p="function"==typeof d&&y;if(p){(a=function(){return 1}).toJSON=a;try{p="0"===d(0)&&"0"===d(new r)&&'""'==d(new i)&&d(v)===m&&d(m)===m&&d()===m&&"1"===d(a)&&"[1]"==d([a])&&"[null]"==d([m])&&"null"==d(null)&&"[null,null,null]"==d([m,v,null])&&d({a:[a,!0,!1,null,"\0\b\n\f\r\t"]})==s&&"1"===d(null,a)&&"[\n 1,\n 2\n]"==d([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==d(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==d(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==d(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==d(new c(-1))}catch(e){p=!1}}o=p}if("json-parse"==e){var u=t.parse;if("function"==typeof u)try{if(0===u("0")&&!u(!1)){a=u(s);var l=5==a.a.length&&1===a.a[0];if(l){try{l=!u('"\t"')}catch(e){}if(l)try{l=1!==u("01")}catch(e){}if(l)try{l=1!==u("1.")}catch(e){}}}}catch(e){l=!1}o=l}}return n[e]=!!o}e||(e=d.Object()),t||(t=d.Object());var r=e.Number||d.Number,i=e.String||d.String,a=e.Object||d.Object,c=e.Date||d.Date,p=e.SyntaxError||d.SyntaxError,u=e.TypeError||d.TypeError,l=e.Math||d.Math,f=e.JSON||d.JSON;"object"==typeof f&&f&&(t.stringify=f.stringify,t.parse=f.parse);var h,g,m,_=a.prototype,v=_.toString,y=new c(-0xc782b5b800cec);try{y=-109252==y.getUTCFullYear()&&0===y.getUTCMonth()&&1===y.getUTCDate()&&10==y.getUTCHours()&&37==y.getUTCMinutes()&&6==y.getUTCSeconds()&&708==y.getUTCMilliseconds()}catch(e){}if(!n("json")){var S=n("bug-string-char-index");if(!y)var C=l.floor,T=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(e,t){return T[t]+365*(e-1970)+C((e-1969+(t=+(t>1)))/4)-C((e-1901+t)/100)+C((e-1601+t)/400)};if((h=_.hasOwnProperty)||(h=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=v?h=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,h=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,h.call(this,e)}),g=function(e,t){var n,r,i,o=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(i in r)h.call(r,i)&&o++;return n=r=null,o?g=2==o?function(e,t){var n,r={},i="[object Function]"==v.call(e);for(n in e)i&&"prototype"==n||h.call(r,n)||!(r[n]=1)||!h.call(e,n)||t(n)}:function(e,t){var n,r,i="[object Function]"==v.call(e);for(n in e)i&&"prototype"==n||!h.call(e,n)||(r="constructor"===n)||t(n);(r||h.call(e,n="constructor"))&&t(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],g=function(e,t){var n,i,o="[object Function]"==v.call(e),a=!o&&"function"!=typeof e.constructor&&s[typeof e.hasOwnProperty]&&e.hasOwnProperty||h;for(n in e)o&&"prototype"==n||!a.call(e,n)||t(n);for(i=r.length;n=r[--i];a.call(e,n)&&t(n));}),g(e,t)},!n("json-stringify")){var R={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},b=function(e,t){return("000000"+(t||0)).slice(-e)},w=function(e){for(var t='"',n=0,r=e.length,i=!S||r>10,o=i&&(S?e.split(""):e);n<r;n++){var a=e.charCodeAt(n);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=R[a];break;default:if(a<32){t+="\\u00"+b(2,a.toString(16));break}t+=i?o[n]:e.charAt(n)}}return t+'"'},A=function(e,t,n,r,i,o,a){var s,c,d,p,l,f,_,y,S,T,R,P,D,O,I,k;try{s=t[e]}catch(e){}if("object"==typeof s&&s)if("[object Date]"!=(c=v.call(s))||h.call(s,"toJSON"))"function"==typeof s.toJSON&&("[object Number]"!=c&&"[object String]"!=c&&"[object Array]"!=c||h.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&s<1/0){if(E){for(l=C(s/864e5),d=C(l/365.2425)+1970-1;E(d+1,0)<=l;d++);for(p=C((l-E(d,0))/30.42);E(d,p+1)<=l;p++);l=1+l-E(d,p),f=(s%864e5+864e5)%864e5,_=C(f/36e5)%24,y=C(f/6e4)%60,S=C(f/1e3)%60,T=f%1e3}else d=s.getUTCFullYear(),p=s.getUTCMonth(),l=s.getUTCDate(),_=s.getUTCHours(),y=s.getUTCMinutes(),S=s.getUTCSeconds(),T=s.getUTCMilliseconds();s=(d<=0||d>=1e4?(d<0?"-":"+")+b(6,d<0?-d:d):b(4,d))+"-"+b(2,p+1)+"-"+b(2,l)+"T"+b(2,_)+":"+b(2,y)+":"+b(2,S)+"."+b(3,T)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if("[object Boolean]"==(c=v.call(s)))return""+s;if("[object Number]"==c)return s>-1/0&&s<1/0?""+s:"null";if("[object String]"==c)return w(""+s);if("object"==typeof s){for(O=a.length;O--;)if(a[O]===s)throw u();if(a.push(s),R=[],I=o,o+=i,"[object Array]"==c){for(D=0,O=s.length;D<O;D++)P=A(D,s,n,r,i,o,a),R.push(P===m?"null":P);k=R.length?i?"[\n"+o+R.join(",\n"+o)+"\n"+I+"]":"["+R.join(",")+"]":"[]"}else g(r||s,function(e){var t=A(e,s,n,r,i,o,a);t!==m&&R.push(w(e)+":"+(i?" ":"")+t)}),k=R.length?i?"{\n"+o+R.join(",\n"+o)+"\n"+I+"}":"{"+R.join(",")+"}":"{}";return a.pop(),k}};t.stringify=function(e,t,n){var r,i,o,a;if(s[typeof t]&&t)if("[object Function]"==(a=v.call(t)))i=t;else if("[object Array]"==a){o={};for(var c,d=0,p=t.length;d<p;c=t[d++],("[object String]"==(a=v.call(c))||"[object Number]"==a)&&(o[c]=1));}if(n)if("[object Number]"==(a=v.call(n))){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==a&&(r=n.length<=10?n:n.slice(0,10));return A("",(c={},c[""]=e,c),i,o,r,"",[])}}if(!n("json-parse")){var P,D,O=i.fromCharCode,I={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},k=function(){throw P=D=null,p()},N=function(){for(var e,t,n,r,i,o=D,a=o.length;P<a;)switch(i=o.charCodeAt(P)){case 9:case 10:case 13:case 32:P++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=S?o.charAt(P):o[P],P++,e;case 34:for(e="@",P++;P<a;)if((i=o.charCodeAt(P))<32)k();else if(92==i)switch(i=o.charCodeAt(++P)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=I[i],P++;break;case 117:for(t=++P,n=P+4;P<n;P++)(i=o.charCodeAt(P))>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||k();e+=O("0x"+o.slice(t,P));break;default:k()}else{if(34==i)break;for(i=o.charCodeAt(P),t=P;i>=32&&92!=i&&34!=i;)i=o.charCodeAt(++P);e+=o.slice(t,P)}if(34==o.charCodeAt(P))return P++,e;k();default:if(t=P,45==i&&(r=!0,i=o.charCodeAt(++P)),i>=48&&i<=57){for(48==i&&(i=o.charCodeAt(P+1))>=48&&i<=57&&k(),r=!1;P<a&&(i=o.charCodeAt(P))>=48&&i<=57;P++);if(46==o.charCodeAt(P)){for(n=++P;n<a&&(i=o.charCodeAt(n))>=48&&i<=57;n++);n==P&&k(),P=n}if(101==(i=o.charCodeAt(P))||69==i){for(i=o.charCodeAt(++P),43!=i&&45!=i||P++,n=P;n<a&&(i=o.charCodeAt(n))>=48&&i<=57;n++);n==P&&k(),P=n}return+o.slice(t,P)}if(r&&k(),"true"==o.slice(P,P+4))return P+=4,!0;if("false"==o.slice(P,P+5))return P+=5,!1;if("null"==o.slice(P,P+4))return P+=4,null;k()}return"$"},M=function(e){var t,n;if("$"==e&&k(),"string"==typeof e){if("@"==(S?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=N());n||(n=!0))n&&(","==e?"]"==(e=N())&&k():k()),","==e&&k(),t.push(M(e));return t}if("{"==e){for(t={};"}"!=(e=N());n||(n=!0))n&&(","==e?"}"==(e=N())&&k():k()),","!=e&&"string"==typeof e&&"@"==(S?e.charAt(0):e[0])&&":"==N()||k(),t[e.slice(1)]=M(N());return t}k()}return e},x=function(e,t,n){var r=L(e,t,n);r===m?delete e[t]:e[t]=r},L=function(e,t,n){var r,i=e[t];if("object"==typeof i&&i)if("[object Array]"==v.call(i))for(r=i.length;r--;)x(i,r,n);else g(i,function(e){x(i,e,n)});return n.call(e,t,i)};t.parse=function(e,t){var n,r;return P=0,D=""+e,n=M(N()),"$"!=N()&&k(),P=D=null,t&&"[object Function]"==v.call(t)?L((r={},r[""]=n,r),"",t):n}}}return t.runInContext=o,t}var a=n(1944),s={function:!0,object:!0},c=s[typeof t]&&t&&!t.nodeType&&t,d=s[typeof window]&&window||this,p=c&&s[typeof e]&&e&&!e.nodeType&&"object"==typeof r&&r;if(!p||p.global!==p&&p.window!==p&&p.self!==p||(d=p),c&&!a)o(d,c);else{var u=d.JSON,l=d.JSON3,f=!1,h=o(d,d.JSON3={noConflict:function(){return f||(f=!0,d.JSON=u,d.JSON3=l,u=l=null),h}});d.JSON={parse:h.parse,stringify:h.stringify}}a&&void 0!==(i=function(){return h}.call(t,n,t,e))&&(e.exports=i)}).call(this)}).call(t,n(257)(e),n(65))},1944:function(e,t){(function(t){e.exports=t}).call(t,{})},1945:function(e,t){function n(e){if(e)return r(e)}function r(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){function n(){r.off(e,n),t.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},1946:function(e,t,n){(function(e){var r=n(611),i=n(1199);t.deconstructPacket=function(e){function t(e){if(!e)return e;if(i(e)){var o={_placeholder:!0,num:n.length};return n.push(e),o}if(r(e)){for(var a=new Array(e.length),s=0;s<e.length;s++)a[s]=t(e[s]);return a}if("object"==typeof e&&!(e instanceof Date)){var a={};for(var c in e)a[c]=t(e[c]);return a}return e}var n=[],o=e.data,a=e;return a.data=t(o),a.attachments=n.length,{packet:a,buffers:n}},t.reconstructPacket=function(e,t){function n(e){if(e&&e._placeholder){return t[e.num]}if(r(e)){for(var i=0;i<e.length;i++)e[i]=n(e[i]);return e}if(e&&"object"==typeof e){for(var o in e)e[o]=n(e[o]);return e}return e}return e.data=n(e.data),e.attachments=void 0,e},t.removeBlobs=function(t,n){function o(t,c,d){if(!t)return t;if(e.Blob&&t instanceof Blob||e.File&&t instanceof File){a++;var p=new FileReader;p.onload=function(){d?d[c]=this.result:s=this.result,--a||n(s)},p.readAsArrayBuffer(t)}else if(r(t))for(var u=0;u<t.length;u++)o(t[u],u,t);else if(t&&"object"==typeof t&&!i(t))for(var l in t)o(t[l],l,t)}var a=0,s=t;o(s),a||n(s)}}).call(t,n(65))},1947:function(e,t,n){e.exports=n(1948)},1948:function(e,t,n){e.exports=n(1949),e.exports.parser=n(327)},1949:function(e,t,n){(function(t){function r(e,n){if(!(this instanceof r))return new r(e,n);n=n||{},e&&"object"==typeof e&&(n=e,e=null),e?(e=p(e),n.hostname=e.host,n.secure="https"==e.protocol||"wss"==e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=p(n.host).host),this.secure=null!=n.secure?n.secure:t.location&&"https:"==location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(t.location?location.hostname:"localhost"),this.port=n.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized;var i="object"==typeof t&&t;i.global===i&&n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),this.open()}function i(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var o=n(1201),a=n(753),s=n(9)("engine.io-client:socket"),c=n(613),d=n(327),p=n(1198),u=n(1960),l=n(754);e.exports=r,r.priorWebsocketSuccess=!1,a(r.prototype),r.protocol=d.protocol,r.Socket=r,r.Transport=n(752),r.transports=n(1201),r.parser=n(327),r.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=i(this.query);return t.EIO=d.protocol,t.transport=e,this.id&&(t.sid=this.id),new o[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders})},r.prototype.open=function(){var e;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},r.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},r.prototype.probe=function(e){function t(){if(l.onlyBinaryUpgrades){var t=!this.supportsBinary&&l.transport.supportsBinary;u=u||t}u||(s('probe transport "%s" opened',e),p.send([{type:"ping",data:"probe"}]),p.once("packet",function(t){if(!u)if("pong"==t.type&&"probe"==t.data){if(s('probe transport "%s" pong',e),l.upgrading=!0,l.emit("upgrading",p),!p)return;r.priorWebsocketSuccess="websocket"==p.name,s('pausing current transport "%s"',l.transport.name),l.transport.pause(function(){u||"closed"!=l.readyState&&(s("changing transport and sending upgrade packet"),d(),l.setTransport(p),p.send([{type:"upgrade"}]),l.emit("upgrade",p),p=null,l.upgrading=!1,l.flush())})}else{s('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=p.name,l.emit("upgradeError",n)}}))}function n(){u||(u=!0,d(),p.close(),p=null)}function i(t){var r=new Error("probe error: "+t);r.transport=p.name,n(),s('probe transport "%s" failed because of error: %s',e,t),l.emit("upgradeError",r)}function o(){i("transport closed")}function a(){i("socket closed")}function c(e){p&&e.name!=p.name&&(s('"%s" works - aborting "%s"',e.name,p.name),n())}function d(){p.removeListener("open",t),p.removeListener("error",i),p.removeListener("close",o),l.removeListener("close",a),l.removeListener("upgrading",c)}s('probing transport "%s"',e);var p=this.createTransport(e,{probe:1}),u=!1,l=this;r.priorWebsocketSuccess=!1,p.once("open",t),p.once("error",i),p.once("close",o),this.once("close",a),this.once("upgrading",c),p.open()},r.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},r.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},r.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},r.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},r.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!=this.readyState&&"closed"!=this.readyState){n=n||{},n.compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function e(){r.onClose("forced close"),s("socket closing - telling transport to close"),r.transport.close()}function t(){r.removeListener("upgrade",t),r.removeListener("upgradeError",t),e()}function n(){r.once("upgrade",t),r.once("upgradeError",t)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},r.prototype.onError=function(e){s("socket error %j",e),r.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},r.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){s('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),n.writeBuffer=[],n.prevBufferLen=0}},r.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~c(this.transports,e[n])&&t.push(e[n]);return t}}).call(t,n(65))},1950:function(e,t,n){(function(t){function r(){}function i(e){if(c.call(this,e),t.location){var n="https:"==location.protocol,r=location.port;r||(r=n?443:80),this.xd=e.hostname!=t.location.hostname||r!=e.port,this.xs=e.secure!=n}else this.extraHeaders=e.extraHeaders}function o(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function a(){for(var e in o.requests)o.requests.hasOwnProperty(e)&&o.requests[e].abort()}var s=n(751),c=n(1203),d=n(753),p=n(229),u=n(9)("engine.io-client:polling-xhr");e.exports=i,e.exports.Request=o,p(i,c),i.prototype.supportsBinary=!0,i.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.extraHeaders=this.extraHeaders,new o(e)},i.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},i.prototype.doPoll=function(){u("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},d(o.prototype),o.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new s(e),r=this;try{u("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders){n.setDisableHeaderCheck(!0);for(var i in this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this.extraHeaders[i])}}catch(e){}if(this.supportsBinary&&(n.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0),this.hasXDR()?(n.onload=function(){r.onLoad()},n.onerror=function(){r.onError(n.responseText)}):n.onreadystatechange=function(){4==n.readyState&&(200==n.status||1223==n.status?r.onLoad():setTimeout(function(){r.onError(n.status)},0))},u("xhr data %s",this.data),n.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}t.document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},o.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},o.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,e)try{this.xhr.abort()}catch(e){}t.document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===t)e=this.xhr.response;else if(this.supportsBinary)try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(t){for(var n=new Uint8Array(this.xhr.response),r=[],i=0,o=n.length;i<o;i++)r.push(n[i]);e=String.fromCharCode.apply(null,r)}else e=this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},o.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},t.document&&(o.requestsCount=0,o.requests={},t.attachEvent?t.attachEvent("onunload",a):t.addEventListener&&t.addEventListener("beforeunload",a,!1))}).call(t,n(65))},1951:function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},1952:function(e,t,n){(function(t){function r(e){function n(e){if(!e)return!1;if(t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer||t.Blob&&e instanceof Blob||t.File&&e instanceof File)return!0;if(i(e)){for(var r=0;r<e.length;r++)if(n(e[r]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&n(e[o]))return!0}return!1}return n(e)}var i=n(611);e.exports=r}).call(t,n(65))},1953:function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)o[s]=i[a];return o.buffer}},1954:function(e,t){!function(e){"use strict";t.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(t){var n,r,i,o,a,s=.75*t.length,c=t.length,d=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var p=new ArrayBuffer(s),u=new Uint8Array(p);for(n=0;n<c;n+=4)r=e.indexOf(t[n]),i=e.indexOf(t[n+1]),o=e.indexOf(t[n+2]),a=e.indexOf(t[n+3]),u[d++]=r<<2|i>>4,u[d++]=(15&i)<<4|o>>2,u[d++]=(3&o)<<6|63&a;return p}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},1955:function(e,t){function n(e,t,n){function i(e,r){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=n):0!==i.count||o||t(null,r)}var o=!1;return n=n||r,i.count=e,0===e?t():i}function r(){}e.exports=n},1956:function(e,t,n){(function(e,r){var i;!function(o){function a(e){for(var t,n,r=[],i=0,o=e.length;i<o;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<o?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function s(e){for(var t,n=e.length,r=-1,i="";++r<n;)t=e[r],t>65535&&(t-=65536,i+=S(t>>>10&1023|55296),t=56320|1023&t),i+=S(t);return i}function c(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function d(e,t){return S(e>>t&63|128)}function p(e){if(0==(4294967168&e))return S(e);var t="";return 0==(4294965248&e)?t=S(e>>6&31|192):0==(4294901760&e)?(c(e),t=S(e>>12&15|224),t+=d(e,6)):0==(4292870144&e)&&(t=S(e>>18&7|240),t+=d(e,12),t+=d(e,6)),t+=S(63&e|128)}function u(e){for(var t,n=a(e),r=n.length,i=-1,o="";++i<r;)t=n[i],o+=p(t);return o}function l(){if(y>=v)throw Error("Invalid byte index");var e=255&_[y];if(y++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function f(){var e,t,n,r,i;if(y>v)throw Error("Invalid byte index");if(y==v)return!1;if(e=255&_[y],y++,0==(128&e))return e;if(192==(224&e)){var t=l();if((i=(31&e)<<6|t)>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=l(),n=l(),(i=(15&e)<<12|t<<6|n)>=2048)return c(i),i;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=l(),n=l(),r=l(),(i=(15&e)<<18|t<<12|n<<6|r)>=65536&&i<=1114111))return i;throw Error("Invalid UTF-8 detected")}function h(e){_=a(e),v=_.length,y=0;for(var t,n=[];!1!==(t=f());)n.push(t);return s(n)}var g="object"==typeof t&&t,m=("object"==typeof e&&e&&e.exports,"object"==typeof r&&r);var _,v,y,S=String.fromCharCode,C={version:"2.0.0",encode:u,decode:h};void 0!==(i=function(){return C}.call(t,n,t,e))&&(e.exports=i)}()}).call(t,n(257)(e),n(65))},1957:function(e,t,n){(function(t){function n(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}function r(e,t){t=t||{};var r=new o;n(e);for(var i=0;i<e.length;i++)r.append(e[i]);return t.type?r.getBlob(t.type):r.getBlob()}function i(e,t){return n(e),new Blob(e,t||{})}var o=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,a=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),s=a&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;e.exports=function(){return a?s?t.Blob:i:c?r:void 0}()}).call(t,n(65))},1958:function(e,t,n){(function(t){function r(){}function i(e){o.call(this,e),this.query=this.query||{},s||(t.___eio||(t.___eio=[]),s=t.___eio),this.index=s.length;var n=this;s.push(function(e){n.onData(e)}),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=r)},!1)}var o=n(1203),a=n(229);e.exports=i;var s,c=/\n/g,d=/\\n/g;a(i,o),i.prototype.supportsBinary=!1,i.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},i.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype.doWrite=function(e,t){function n(){r(),t()}function r(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(e){i.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(e)}catch(e){o=document.createElement("iframe"),o.name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,a=document.createElement("form"),s=document.createElement("textarea"),p=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=p,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),r(),e=e.replace(d,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n}}).call(t,n(65))},1959:function(e,t,n){(function(t){function r(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,i.call(this,e)}var i=n(752),o=n(327),a=n(754),s=n(229),c=n(612),d=n(9)("engine.io-client:websocket"),p=t.WebSocket||t.MozWebSocket,u=p;if(!u&&"undefined"==typeof window)try{u=n(604)}catch(e){}e.exports=r,s(r,i),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t={agent:this.agent,perMessageDeflate:this.perMessageDeflate};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.ws=p?new u(e):new u(e,void 0,t),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(r.prototype.onData=function(e){var t=this;setTimeout(function(){i.prototype.onData.call(t,e)},0)}),r.prototype.write=function(e){function n(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}var r=this;this.writable=!1;for(var i=e.length,a=0,s=i;a<s;a++)!function(e){o.encodePacket(e,r.supportsBinary,function(o){if(!p){var a={};if(e.options&&(a.compress=e.options.compress),r.perMessageDeflate){("string"==typeof o?t.Buffer.byteLength(o):o.length)<r.perMessageDeflate.threshold&&(a.compress=!1)}}try{p?r.ws.send(o):r.ws.send(o,a)}catch(e){d("websocket closed before onclose event")}--i||n()})}(e[a])},r.prototype.onClose=function(){i.prototype.onClose.call(this)},r.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),e=a.encode(e),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},r.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===r.prototype.name)}}).call(t,n(65))},1960:function(e,t,n){(function(t){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,o=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,s=/\s+$/;e.exports=function(e){return"string"==typeof e&&e?(e=e.replace(a,"").replace(s,""),t.JSON&&JSON.parse?JSON.parse(e):n.test(e.replace(r,"@").replace(i,"]").replace(o,""))?new Function("return "+e)():void 0):null}}).call(t,n(65))},1961:function(e,t,n){(function(t){function r(e){function n(e){if(!e)return!1;if(t.Buffer&&t.Buffer.isBuffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer||t.Blob&&e instanceof Blob||t.File&&e instanceof File)return!0;if(i(e)){for(var r=0;r<e.length;r++)if(n(e[r]))return!0}else if(e&&"object"==typeof e){e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON());for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&n(e[o]))return!0}return!1}return n(e)}var i=n(611);e.exports=r}).call(t,n(65))},229:function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},2642:function(e,t,n){n(2643),n(610),e.exports=n(1196)},2643:function(e,t,n){function r(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r=i(e),o=r.source,d=r.id,p=r.path,u=c[d]&&p in c[d].nsps,l=t.forceNew||t["force new connection"]||!1===t.multiplex||u;return l?(s("ignoring socket cache for %s",o),n=a(o,t)):(c[d]||(s("new io instance for %s",o),c[d]=a(o,t)),n=c[d]),r.query&&!t.query&&(t.query=r.query),n.socket(r.path,t)}var i=n(2644),o=n(1112),a=n(1656),s=n(9)("socket.io-client");e.exports=t=r;var c=t.managers={};t.protocol=o.protocol,t.connect=r,t.Manager=n(1656),t.Socket=n(1659)},2644:function(e,t,n){(function(t){function r(e,n){var r=e;n=n||t.location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),o("parse %s",e),r=i(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var a=-1!==r.host.indexOf(":"),s=a?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port,r.href=r.protocol+"://"+s+(n&&n.port===r.port?"":":"+r.port),r}var i=n(1652),o=n(9)("socket.io-client:url");e.exports=r}).call(t,n(65))},2645:function(e,t,n){"use strict";(function(e){function r(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,n){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return a(this,e,t,n)}function a(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?l(e,t,n,r):"string"==typeof t?p(e,t,n):f(e,t)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t,n,r){return s(t),t<=0?i(e,t):void 0!==n?"string"==typeof r?i(e,t).fill(n,r):i(e,t).fill(n):i(e,t)}function d(e,t){if(s(t),e=i(e,t<0?0:0|h(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!o.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|m(t,n);e=i(e,r);var a=e.write(t,n);return a!==r&&(e=e.slice(0,a)),e}function u(e,t){var n=t.length<0?0:0|h(t.length);e=i(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function l(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=u(e,t),e}function f(e,t){if(o.isBuffer(t)){var n=0|h(t.length);return e=i(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||X(t.length)?i(e,0):u(e,t);if("Buffer"===t.type&&Z(t.data))return u(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function h(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function g(e){return+e!=e&&(e=0),o.alloc(+e)}function m(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(r)return V(e).length;t=(""+t).toLowerCase(),r=!0}}function _(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return P(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return A(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:S(e,t,n,r,i);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):S(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function S(e,t,n,r,i){function o(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}var d;if(i){var p=-1;for(d=n;d<s;d++)if(o(e,d)===o(t,-1===p?0:d-p)){if(-1===p&&(p=d),d-p+1===c)return p*a}else-1!==p&&(d-=d-p),p=-1}else for(n+c>s&&(n=s-c),d=n;d>=0;d--){for(var u=!0,l=0;l<c;l++)if(o(e,d+l)!==o(t,l)){u=!1;break}if(u)return d}return-1}function C(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function T(e,t,n,r){return K(V(t,e.length-n),e,n,r)}function E(e,t,n,r){return K(Y(t),e,n,r)}function R(e,t,n,r){return E(e,t,n,r)}function b(e,t,n,r){return K(q(t),e,n,r)}function w(e,t,n,r){return K(z(t,e.length-n),e,n,r)}function A(e,t,n){return 0===t&&n===e.length?J.fromByteArray(e):J.fromByteArray(e.slice(t,n))}function P(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o=e[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=n){var c,d,p,u;switch(s){case 1:o<128&&(a=o);break;case 2:c=e[i+1],128==(192&c)&&(u=(31&o)<<6|63&c)>127&&(a=u);break;case 3:c=e[i+1],d=e[i+2],128==(192&c)&&128==(192&d)&&(u=(15&o)<<12|(63&c)<<6|63&d)>2047&&(u<55296||u>57343)&&(a=u);break;case 4:c=e[i+1],d=e[i+2],p=e[i+3],128==(192&c)&&128==(192&d)&&128==(192&p)&&(u=(15&o)<<18|(63&c)<<12|(63&d)<<6|63&p)>65535&&u<1114112&&(a=u)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=s}return D(r)}function D(e){var t=e.length;if(t<=$)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=$));return n}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function k(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=W(e[o]);return i}function N(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,n,r,i,a){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function U(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function B(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,r,i){return i||B(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Q.write(e,t,n,r,23,4),n+4}function G(e,t,n,r,i){return i||B(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Q.write(e,t,n,r,52,8),n+8}function F(e){if(e=H(e).replace(ee,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function H(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function W(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Y(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function z(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function q(e){return J.toByteArray(F(e))}function K(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function X(e){return e!==e}var J=n(2646),Q=n(2647),Z=n(2648);t.Buffer=o,t.SlowBuffer=g,t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,n){return a(null,e,t,n)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,n){return c(null,e,t,n)},o.allocUnsafe=function(e){return d(null,e)},o.allocUnsafeSlow=function(e){return d(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},o.byteLength=m,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?P(this,0,e):_.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,n,r,i){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var a=i-r,s=n-t,c=Math.min(a,s),d=this.slice(r,i),p=e.slice(t,n),u=0;u<c;++u)if(d[u]!==p[u]){a=d[u],s=p[u];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return C(this,e,t,n);case"utf8":case"utf-8":return T(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return R(this,e,t,n);case"base64":return b(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r;if(o.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=o.prototype;else{var i=t-e;r=new o(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},o.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},o.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return t||M(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||M(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||M(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||M(e,4,this.length),Q.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||M(e,4,this.length),Q.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||M(e,8,this.length),Q.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||M(e,8,this.length),Q.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){x(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){x(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return G(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return G(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!o.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var a;if("number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var s=o.isBuffer(e)?e:V(new o(e,r).toString()),c=s.length;for(a=0;a<n-t;++a)this[a+t]=s[a%c]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(t,n(65))},2646:function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function i(e){var t=r(e),n=t[0],i=t[1];return 3*(n+i)/4-i}function o(e,t,n){return 3*(t+n)/4-n}function a(e){for(var t,n=r(e),i=n[0],a=n[1],s=new l(o(e,i,a)),c=0,d=a>0?i-4:i,p=0;p<d;p+=4)t=u[e.charCodeAt(p)]<<18|u[e.charCodeAt(p+1)]<<12|u[e.charCodeAt(p+2)]<<6|u[e.charCodeAt(p+3)],s[c++]=t>>16&255,s[c++]=t>>8&255,s[c++]=255&t;return 2===a&&(t=u[e.charCodeAt(p)]<<2|u[e.charCodeAt(p+1)]>>4,s[c++]=255&t),1===a&&(t=u[e.charCodeAt(p)]<<10|u[e.charCodeAt(p+1)]<<4|u[e.charCodeAt(p+2)]>>2,s[c++]=t>>8&255,s[c++]=255&t),s}function s(e){return p[e>>18&63]+p[e>>12&63]+p[e>>6&63]+p[63&e]}function c(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(s(r));return i.join("")}function d(e){for(var t,n=e.length,r=n%3,i=[],o=0,a=n-r;o<a;o+=16383)i.push(c(e,o,o+16383>a?a:o+16383));return 1===r?(t=e[n-1],i.push(p[t>>2]+p[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(p[t>>10]+p[t>>4&63]+p[t<<2&63]+"=")),i.join("")}t.byteLength=i,t.toByteArray=a,t.fromByteArray=d;for(var p=[],u=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,g=f.length;h<g;++h)p[h]=f[h],u[f.charCodeAt(h)]=h;u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},2647:function(e,t){t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,c=(1<<s)-1,d=c>>1,p=-7,u=n?i-1:0,l=n?-1:1,f=e[t+u];for(u+=l,o=f&(1<<-p)-1,f>>=-p,p+=s;p>0;o=256*o+e[t+u],u+=l,p-=8);for(a=o&(1<<-p)-1,o>>=-p,p+=r;p>0;a=256*a+e[t+u],u+=l,p-=8);if(0===o)o=1-d;else{if(o===c)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=d}return(f?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,c,d=8*o-i-1,p=(1<<d)-1,u=p>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,h=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=p):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),t+=a+u>=1?l/c:l*Math.pow(2,1-u),t*c>=2&&(a++,c/=2),a+u>=p?(s=0,a=p):a+u>=1?(s=(t*c-1)*Math.pow(2,i),a+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&s,f+=h,s/=256,i-=8);for(a=a<<i|s,d+=i;d>0;e[n+f]=255&a,f+=h,a/=256,d-=8);e[n+f-h]|=128*g}},2648:function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},2649:function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},2650:function(e,t,n){(function(e){function r(e,t){if(!e)return e;if(a(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(o(e)){for(var i=new Array(e.length),s=0;s<e.length;s++)i[s]=r(e[s],t);return i}if("object"==typeof e&&!(e instanceof Date)){var i={};for(var c in e)i[c]=r(e[c],t);return i}return e}function i(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(o(e))for(var n=0;n<e.length;n++)e[n]=i(e[n],t);else if("object"==typeof e)for(var r in e)e[r]=i(e[r],t);return e}var o=n(1654),a=n(1655),s=Object.prototype.toString,c="function"==typeof e.Blob||"[object BlobConstructor]"===s.call(e.Blob),d="function"==typeof e.File||"[object FileConstructor]"===s.call(e.File);t.deconstructPacket=function(e){var t=[],n=e.data,i=e;return i.data=r(n,t),i.attachments=t.length,{packet:i,buffers:t}},t.reconstructPacket=function(e,t){return e.data=i(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){function n(e,s,p){if(!e)return e;if(c&&e instanceof Blob||d&&e instanceof File){r++;var u=new FileReader;u.onload=function(){p?p[s]=this.result:i=this.result,--r||t(i)},u.readAsArrayBuffer(e)}else if(o(e))for(var l=0;l<e.length;l++)n(e[l],l,e);else if("object"==typeof e&&!a(e))for(var f in e)n(e[f],f,e)}var r=0,i=e;n(i),r||t(i)}}).call(t,n(65))},2651:function(e,t,n){e.exports=n(2652),e.exports.parser=n(408)},2652:function(e,t,n){(function(t){function r(e,n){if(!(this instanceof r))return new r(e,n);n=n||{},e&&"object"==typeof e&&(n=e,e=null),e?(e=p(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=p(n.host).host),this.secure=null!=n.secure?n.secure:t.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(t.location?location.hostname:"localhost"),this.port=n.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.transportOptions=n.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized,this.forceNode=!!n.forceNode;var i="object"==typeof t&&t;i.global===i&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function i(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var o=n(1657),a=n(407),s=n(9)("engine.io-client:socket"),c=n(613),d=n(408),p=n(1652),u=n(702);e.exports=r,r.priorWebsocketSuccess=!1,a(r.prototype),r.protocol=d.protocol,r.Socket=r,r.Transport=n(1114),r.transports=n(1657),r.parser=n(408),r.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=i(this.query);t.EIO=d.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new o[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},r.prototype.open=function(){var e;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},r.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},r.prototype.probe=function(e){function t(){if(l.onlyBinaryUpgrades){var t=!this.supportsBinary&&l.transport.supportsBinary;u=u||t}u||(s('probe transport "%s" opened',e),p.send([{type:"ping",data:"probe"}]),p.once("packet",function(t){if(!u)if("pong"===t.type&&"probe"===t.data){if(s('probe transport "%s" pong',e),l.upgrading=!0,l.emit("upgrading",p),!p)return;r.priorWebsocketSuccess="websocket"===p.name,s('pausing current transport "%s"',l.transport.name),l.transport.pause(function(){u||"closed"!==l.readyState&&(s("changing transport and sending upgrade packet"),d(),l.setTransport(p),p.send([{type:"upgrade"}]),l.emit("upgrade",p),p=null,l.upgrading=!1,l.flush())})}else{s('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=p.name,l.emit("upgradeError",n)}}))}function n(){u||(u=!0,d(),p.close(),p=null)}function i(t){var r=new Error("probe error: "+t);r.transport=p.name,n(),s('probe transport "%s" failed because of error: %s',e,t),l.emit("upgradeError",r)}function o(){i("transport closed")}function a(){i("socket closed")}function c(e){p&&e.name!==p.name&&(s('"%s" works - aborting "%s"',e.name,p.name),n())}function d(){p.removeListener("open",t),p.removeListener("error",i),p.removeListener("close",o),l.removeListener("close",a),l.removeListener("upgrading",c)}s('probing transport "%s"',e);var p=this.createTransport(e,{probe:1}),u=!1,l=this;r.priorWebsocketSuccess=!1,p.once("open",t),p.once("error",i),p.once("close",o),this.once("close",a),this.once("upgrading",c),p.open()},r.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},r.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},r.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},r.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},r.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){n=n||{},n.compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},r.prototype.close=function(){function e(){r.onClose("forced close"),s("socket closing - telling transport to close"),r.transport.close()}function t(){r.removeListener("upgrade",t),r.removeListener("upgradeError",t),e()}function n(){r.once("upgrade",t),r.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},r.prototype.onError=function(e){s("socket error %j",e),r.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},r.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),n.writeBuffer=[],n.prevBufferLen=0}},r.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~c(this.transports,e[n])&&t.push(e[n]);return t}}).call(t,n(65))},2653:function(e,t,n){(function(t){function r(){}function i(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,t.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),this.xd=e.hostname!==t.location.hostname||r!==e.port,this.xs=e.secure!==n}}function o(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function a(){for(var e in o.requests)o.requests.hasOwnProperty(e)&&o.requests[e].abort()}var s=n(1113),c=n(1658),d=n(407),p=n(229),u=n(9)("engine.io-client:polling-xhr");e.exports=i,e.exports.Request=o,p(i,c),i.prototype.supportsBinary=!0,i.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new o(e)},i.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},i.prototype.doPoll=function(){u("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},d(o.prototype),o.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new s(e),r=this;try{u("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(var i in this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this.extraHeaders[i])}}catch(e){}if("POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){r.onLoad()},n.onerror=function(){r.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState)try{var e=n.getResponseHeader("Content-Type");r.supportsBinary&&"application/octet-stream"===e&&(n.responseType="arraybuffer")}catch(e){}4===n.readyState&&(200===n.status||1223===n.status?r.onLoad():setTimeout(function(){r.onError(n.status)},0))},u("xhr data %s",this.data),n.send(this.data)}catch(e){return void setTimeout(function(){r.onError(e)},0)}t.document&&(this.index=o.requestsCount++,o.requests[this.index]=this)},o.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},o.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},o.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},o.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,e)try{this.xhr.abort()}catch(e){}t.document&&delete o.requests[this.index],this.xhr=null}},o.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},o.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},o.prototype.abort=function(){this.cleanup()},o.requestsCount=0,o.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",a):t.addEventListener&&t.addEventListener("beforeunload",a,!1))}).call(t,n(65))},2654:function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},2655:function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)o[s]=i[a];return o.buffer}},2656:function(e,t){function n(e,t,n){function i(e,r){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(o=!0,t(e),t=n):0!==i.count||o||t(null,r)}var o=!1;return n=n||r,i.count=e,0===e?t():i}function r(){}e.exports=n},2657:function(e,t){function n(e){for(var t,n,r=[],i=0,o=e.length;i<o;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<o?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function r(e){for(var t,n=e.length,r=-1,i="";++r<n;)t=e[r],t>65535&&(t-=65536,i+=h(t>>>10&1023|55296),t=56320|1023&t),i+=h(t);return i}function i(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function o(e,t){return h(e>>t&63|128)}function a(e,t){if(0==(4294967168&e))return h(e);var n="";return 0==(4294965248&e)?n=h(e>>6&31|192):0==(4294901760&e)?(i(e,t)||(e=65533),n=h(e>>12&15|224),n+=o(e,6)):0==(4292870144&e)&&(n=h(e>>18&7|240),n+=o(e,12),n+=o(e,6)),n+=h(63&e|128)}function s(e,t){t=t||{};for(var r,i=!1!==t.strict,o=n(e),s=o.length,c=-1,d="";++c<s;)r=o[c],d+=a(r,i);return d}function c(){if(f>=l)throw Error("Invalid byte index");var e=255&u[f];if(f++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(e){var t,n,r,o,a;if(f>l)throw Error("Invalid byte index");if(f==l)return!1;if(t=255&u[f],f++,0==(128&t))return t;if(192==(224&t)){if(n=c(),(a=(31&t)<<6|n)>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&t)){if(n=c(),r=c(),(a=(15&t)<<12|n<<6|r)>=2048)return i(a,e)?a:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=c(),r=c(),o=c(),(a=(7&t)<<18|n<<12|r<<6|o)>=65536&&a<=1114111))return a;throw Error("Invalid UTF-8 detected")}function p(e,t){t=t||{};var i=!1!==t.strict;u=n(e),l=u.length,f=0;for(var o,a=[];!1!==(o=d(i));)a.push(o);return r(a)}var u,l,f,h=String.fromCharCode;e.exports={version:"2.1.2",encode:s,decode:p}},2658:function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,r,i,o,a,s=.75*e.length,c=e.length,d=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var p=new ArrayBuffer(s),u=new Uint8Array(p);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],i=n[e.charCodeAt(t+1)],o=n[e.charCodeAt(t+2)],a=n[e.charCodeAt(t+3)],u[d++]=r<<2|i>>4,u[d++]=(15&i)<<4|o>>2,u[d++]=(3&o)<<6|63&a;return p}}()},2659:function(e,t){function n(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e})}function r(e,t){t=t||{};var r=new o;return n(e).forEach(function(e){r.append(e)}),t.type?r.getBlob(t.type):r.getBlob()}function i(e,t){return new Blob(n(e),t||{})}var o=void 0!==o?o:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,a=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),s=a&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=o&&o.prototype.append&&o.prototype.getBlob;"undefined"!=typeof Blob&&(r.prototype=Blob.prototype,i.prototype=Blob.prototype),e.exports=function(){return a?s?Blob:i:c?r:void 0}()},2660:function(e,t,n){(function(t){function r(){}function i(e){o.call(this,e),this.query=this.query||{},s||(t.___eio||(t.___eio=[]),s=t.___eio),this.index=s.length;var n=this;s.push(function(e){n.onData(e)}),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=r)},!1)}var o=n(1658),a=n(229);e.exports=i;var s,c=/\n/g,d=/\\n/g;a(i,o),i.prototype.supportsBinary=!1,i.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},i.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype.doWrite=function(e,t){function n(){r(),t()}function r(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(e){i.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+i.iframeId+'">';o=document.createElement(e)}catch(e){o=document.createElement("iframe"),o.name=i.iframeId,o.src="javascript:0"}o.id=i.iframeId,i.form.appendChild(o),i.iframe=o}var i=this;if(!this.form){var o,a=document.createElement("form"),s=document.createElement("textarea"),p=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=p,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),r(),e=e.replace(d,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&n()}:this.iframe.onload=n}}).call(t,n(65))},2661:function(e,t,n){(function(t){function r(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=u&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(l=i),o.call(this,e)}var i,o=n(1114),a=n(408),s=n(702),c=n(229),d=n(612),p=n(9)("engine.io-client:websocket"),u=t.WebSocket||t.MozWebSocket;if("undefined"==typeof window)try{i=n(604)}catch(e){}var l=u;l||"undefined"!=typeof window||(l=i),e.exports=r,c(r,o),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new l(e,t):new l(e):new l(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},r.prototype.write=function(e){function n(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}var r=this;this.writable=!1;for(var i=e.length,o=0,s=i;o<s;o++)!function(e){a.encodePacket(e,r.supportsBinary,function(o){if(!r.usingBrowserWebSocket){var a={};if(e.options&&(a.compress=e.options.compress),r.perMessageDeflate){("string"==typeof o?t.Buffer.byteLength(o):o.length)<r.perMessageDeflate.threshold&&(a.compress=!1)}}try{r.usingBrowserWebSocket?r.ws.send(o):r.ws.send(o,a)}catch(e){p("websocket closed before onclose event")}--i||n()})}(e[o])},r.prototype.onClose=function(){o.prototype.onClose.call(this)},r.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=d()),this.supportsBinary||(e.b64=1),e=s.encode(e),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},r.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===r.prototype.name)}}).call(t,n(65))},2663:function(e,t){function n(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=r(i);return[n].concat(i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"})).concat([o]).join("\n")}return[n].join("\n")}function r(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=n(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},2664:function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=h[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(p(r.parts[o],t))}else{for(var a=[],o=0;o<r.parts.length;o++)a.push(p(r.parts[o],t));h[r.id]={id:r.id,refs:1,parts:a}}}}function i(e,t){for(var n=[],r={},i=0;i<e.length;i++){var o=e[i],a=t.base?o[0]+t.base:o[0],s=o[1],c=o[2],d=o[3],p={css:s,media:c,sourceMap:d};r[a]?r[a].parts.push(p):n.push(r[a]={id:a,parts:[p]})}return n}function o(e,t){var n=m(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=y[y.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),y.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function a(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=y.indexOf(e);t>=0&&y.splice(t,1)}function s(e){var t=document.createElement("style");return e.attrs.type="text/css",d(t,e.attrs),o(e,t),t}function c(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",d(t,e.attrs),o(e,t),t}function d(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function p(e,t){var n,r,i,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var d=v++;n=_||(_=s(t)),r=u.bind(null,n,d,!1),i=u.bind(null,n,d,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=c(t),r=f.bind(null,n,t),i=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=s(t),r=l.bind(null,n),i=function(){a(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}function u(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=C(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function l(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function f(e,t,n){var r=n.css,i=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||o)&&(r=S(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}var h={},g=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),m=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e.call(this,n)),t[n]}}(function(e){return document.querySelector(e)}),_=null,v=0,y=[],S=n(1663);e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},t.attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||(t.singleton=g()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=i(e,t);return r(n,t),function(e){for(var o=[],a=0;a<n.length;a++){var s=n[a],c=h[s.id];c.refs--,o.push(c)}if(e){r(i(e,t),t)}for(var a=0;a<o.length;a++){var c=o[a];if(0===c.refs){for(var d=0;d<c.parts.length;d++)c.parts[d]();delete h[c.id]}}}};var C=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},327:function(e,t,n){(function(e){function r(e,n){return n("b"+t.packets[e.type]+e.data.data)}function i(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=_[e.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return r(a.buffer)}function o(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,t.encodePacket(e,n,!0,r)},i.readAsArrayBuffer(e.data)}function a(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(m)return o(e,n,r);var i=new Uint8Array(1);return i[0]=_[e.type],r(new S([i.buffer,e.data]))}function s(e,t,n){for(var r=new Array(e.length),i=l(e.length,n),o=0;o<e.length;o++)!function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})}(o,e[o],i)}var c=n(1951),d=n(1952),p=n(1953),u=n(1954),l=n(1955),f=n(1956),h=navigator.userAgent.match(/Android/i),g=/PhantomJS/i.test(navigator.userAgent),m=h||g;t.protocol=3;var _=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},v=c(_),y={type:"error",data:"parser error"},S=n(1957);t.encodePacket=function(t,n,o,s){"function"==typeof n&&(s=n,n=!1),"function"==typeof o&&(s=o,o=null);var c=void 0===t.data?void 0:t.data.buffer||t.data;if(e.ArrayBuffer&&c instanceof ArrayBuffer)return i(t,n,s);if(S&&c instanceof e.Blob)return a(t,n,s);if(c&&c.base64)return r(t,s);var d=_[t.type];return void 0!==t.data&&(d+=o?f.encode(String(t.data)):String(t.data)),s(""+d)},t.encodeBase64Packet=function(n,r){var i="b"+t.packets[n.type];if(S&&n.data instanceof e.Blob){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];r(i+e)},o.readAsDataURL(n.data)}var a;try{a=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(e){for(var s=new Uint8Array(n.data),c=new Array(s.length),d=0;d<s.length;d++)c[d]=s[d];a=String.fromCharCode.apply(null,c)}return i+=e.btoa(a),r(i)},t.decodePacket=function(e,n,r){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r)try{e=f.decode(e)}catch(e){return y}var i=e.charAt(0);return Number(i)==i&&v[i]?e.length>1?{type:v[i],data:e.substring(1)}:{type:v[i]}:y}var o=new Uint8Array(e),i=o[0],a=p(e,1);return S&&"blob"===n&&(a=new S([a])),{type:v[i],data:a}},t.decodeBase64Packet=function(t,n){var r=v[t.charAt(0)];if(!e.ArrayBuffer)return{type:r,data:{base64:!0,data:t.substr(1)}};var i=u.decode(t.substr(1));return"blob"===n&&S&&(i=new S([i])),{type:r,data:i}},t.encodePayload=function(e,n,r){function i(e){return e.length+":"+e}function o(e,r){t.encodePacket(e,!!a&&n,!0,function(e){r(null,i(e))})}"function"==typeof n&&(r=n,n=null);var a=d(e);return n&&a?S&&!m?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r):e.length?void s(e,o,function(e,t){return r(t.join(""))}):r("0:")},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);"function"==typeof n&&(r=n,n=null);var i;if(""==e)return r(y,0,1);for(var o,a,s="",c=0,d=e.length;c<d;c++){var p=e.charAt(c);if(":"!=p)s+=p;else{if(""==s||s!=(o=Number(s)))return r(y,0,1);if(a=e.substr(c+1,o),s!=a.length)return r(y,0,1);if(a.length){if(i=t.decodePacket(a,n,!0),y.type==i.type&&y.data==i.data)return r(y,0,1);if(!1===r(i,c+o,d))return}c+=o,s=""}}return""!=s?r(y,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){function r(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})}if(!e.length)return n(new ArrayBuffer(0));s(e,r,function(e,t){var r=t.reduce(function(e,t){var n;return n="string"==typeof t?t.length:t.byteLength,e+n.toString().length+n+2},0),i=new Uint8Array(r),o=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);n=r.buffer}i[o++]=t?0:1;for(var s=n.byteLength.toString(),a=0;a<s.length;a++)i[o++]=parseInt(s[a]);i[o++]=255;for(var r=new Uint8Array(n),a=0;a<r.length;a++)i[o++]=r[a]}),n(i.buffer)})},t.encodePayloadAsBlob=function(e,n){function r(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,t[0]=0}for(var o=e instanceof ArrayBuffer?e.byteLength:e.size,a=o.toString(),s=new Uint8Array(a.length+1),i=0;i<a.length;i++)s[i]=parseInt(a[i]);if(s[a.length]=255,S){var c=new S([t.buffer,s.buffer,e]);n(null,c)}})}s(e,r,function(e,t){return n(new S(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[],a=!1;i.byteLength>0;){for(var s=new Uint8Array(i),c=0===s[0],d="",u=1;255!=s[u];u++){if(d.length>310){a=!0;break}d+=s[u]}if(a)return r(y,0,1);i=p(i,2+d.length),d=parseInt(d);var l=p(i,0,d);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(e){var f=new Uint8Array(l);l="";for(var u=0;u<f.length;u++)l+=String.fromCharCode(f[u])}o.push(l),i=p(i,d)}var h=o.length;o.forEach(function(e,i){r(t.decodePacket(e,n,!0),i,h)})}}).call(t,n(65))},407:function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},408:function(e,t,n){function r(e,n){return n("b"+t.packets[e.type]+e.data.data)}function i(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=v[e.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return r(a.buffer)}function o(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){t.encodePacket({type:e.type,data:i.result},n,!0,r)},i.readAsArrayBuffer(e.data)}function a(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(_)return o(e,n,r);var i=new Uint8Array(1);return i[0]=v[e.type],r(new C([i.buffer,e.data]))}function s(e){try{e=h.decode(e,{strict:!1})}catch(e){return!1}return e}function c(e,t,n){for(var r=new Array(e.length),i=f(e.length,n),o=0;o<e.length;o++)!function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})}(o,e[o],i)}var d,p=n(2654),u=n(1653),l=n(2655),f=n(2656),h=n(2657);"undefined"!=typeof ArrayBuffer&&(d=n(2658));var g="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),m="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),_=g||m;t.protocol=3;var v=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},y=p(v),S={type:"error",data:"parser error"},C=n(2659);t.encodePacket=function(e,t,n,o){"function"==typeof t&&(o=t,t=!1),"function"==typeof n&&(o=n,n=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return i(e,t,o);if(void 0!==C&&s instanceof C)return a(e,t,o);if(s&&s.base64)return r(e,o);var c=v[e.type];return void 0!==e.data&&(c+=n?h.encode(String(e.data),{strict:!1}):String(e.data)),o(""+c)},t.encodeBase64Packet=function(e,n){var r="b"+t.packets[e.type];if(void 0!==C&&e.data instanceof C){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(r+e)},i.readAsDataURL(e.data)}var o;try{o=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var a=new Uint8Array(e.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];o=String.fromCharCode.apply(null,s)}return r+=btoa(o),n(r)},t.decodePacket=function(e,n,r){if(void 0===e)return S;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=s(e)))return S;var i=e.charAt(0);return Number(i)==i&&y[i]?e.length>1?{type:y[i],data:e.substring(1)}:{type:y[i]}:S}var o=new Uint8Array(e),i=o[0],a=l(e,1);return C&&"blob"===n&&(a=new C([a])),{type:y[i],data:a}},t.decodeBase64Packet=function(e,t){var n=y[e.charAt(0)];if(!d)return{type:n,data:{base64:!0,data:e.substr(1)}};var r=d.decode(e.substr(1));return"blob"===t&&C&&(r=new C([r])),{type:n,data:r}},t.encodePayload=function(e,n,r){function i(e){return e.length+":"+e}function o(e,r){t.encodePacket(e,!!a&&n,!1,function(e){r(null,i(e))})}"function"==typeof n&&(r=n,n=null);var a=u(e);return n&&a?C&&!_?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r):e.length?void c(e,o,function(e,t){return r(t.join(""))}):r("0:")},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);"function"==typeof n&&(r=n,n=null);var i;if(""===e)return r(S,0,1);for(var o,a,s="",c=0,d=e.length;c<d;c++){var p=e.charAt(c);if(":"===p){if(""===s||s!=(o=Number(s)))return r(S,0,1);if(a=e.substr(c+1,o),s!=a.length)return r(S,0,1);if(a.length){if(i=t.decodePacket(a,n,!1),S.type===i.type&&S.data===i.data)return r(S,0,1);if(!1===r(i,c+o,d))return}c+=o,s=""}else s+=p}return""!==s?r(S,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){function r(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})}if(!e.length)return n(new ArrayBuffer(0));c(e,r,function(e,t){var r=t.reduce(function(e,t){var n;return n="string"==typeof t?t.length:t.byteLength,e+n.toString().length+n+2},0),i=new Uint8Array(r),o=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);n=r.buffer}i[o++]=t?0:1;for(var s=n.byteLength.toString(),a=0;a<s.length;a++)i[o++]=parseInt(s[a]);i[o++]=255;for(var r=new Uint8Array(n),a=0;a<r.length;a++)i[o++]=r[a]}),n(i.buffer)})},t.encodePayloadAsBlob=function(e,n){function r(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,t[0]=0}for(var o=e instanceof ArrayBuffer?e.byteLength:e.size,a=o.toString(),s=new Uint8Array(a.length+1),i=0;i<a.length;i++)s[i]=parseInt(a[i]);if(s[a.length]=255,C){var c=new C([t.buffer,s.buffer,e]);n(null,c)}})}c(e,r,function(e,t){return n(new C(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),s=0===a[0],c="",d=1;255!==a[d];d++){if(c.length>310)return r(S,0,1);c+=a[d]}i=l(i,2+c.length),c=parseInt(c);var p=l(i,0,c);if(s)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var u=new Uint8Array(p);p="";for(var d=0;d<u.length;d++)p+=String.fromCharCode(u[d])}o.push(p),i=l(i,c)}var f=o.length;o.forEach(function(e,i){r(t.decodePacket(e,n,!0),i,f)})}},604:function(e,t){e.exports=WebSocket},610:function(e,t,n){(function(t,n){var r,r,i={options:{hidePluginInstallPrompt:!0}},i=i||t||{};if(i.options=i.options||{},i.options.getAllCams=!!i.options.getAllCams,i.options.hidePluginInstallPrompt=!!i.options.hidePluginInstallPrompt,i.options.forceSafariPlugin=!!i.options.forceSafariPlugin,i.VERSION="0.15.4",i.onwebrtcready=i.onwebrtcready||function(e){},i._onwebrtcreadies=[],i.webRTCReady=function(e){if("function"!=typeof e)throw new Error("Callback provided is not a function");var t=function(){"function"==typeof window.require&&"function"==typeof i._defineMediaSourcePolyfill&&i._defineMediaSourcePolyfill(),e(null!==i.WebRTCPlugin.plugin)};!0===i.onwebrtcreadyDone?t():i._onwebrtcreadies.push(t)},i.WebRTCPlugin=i.WebRTCPlugin||{},i.WebRTCPlugin.pluginInfo=i.WebRTCPlugin.pluginInfo||{prefix:"Tem",plugName:"TemWebRTCPlugin",pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__TemWebRTCReady0",portalLink:"https://skylink.io/plugin/",downloadLink:null,companyName:"Temasys",downloadLinks:{mac:"https://bit.ly/webrtcpluginpkg",win:"https://bit.ly/webrtcpluginmsi"}},void 0!==i.WebRTCPlugin.pluginInfo.downloadLinks&&null!==i.WebRTCPlugin.pluginInfo.downloadLinks&&(navigator.platform.match(/^Mac/i)?i.WebRTCPlugin.pluginInfo.downloadLink=i.WebRTCPlugin.pluginInfo.downloadLinks.mac:navigator.platform.match(/^Win/i)&&(i.WebRTCPlugin.pluginInfo.downloadLink=i.WebRTCPlugin.pluginInfo.downloadLinks.win)),i.WebRTCPlugin.TAGS={NONE:"none",AUDIO:"audio",VIDEO:"video"},i.WebRTCPlugin.pageId=Math.random().toString(36).slice(2),i.WebRTCPlugin.plugin=null,i.WebRTCPlugin.setLogLevel=null,i.WebRTCPlugin.defineWebRTCInterface=null,i.WebRTCPlugin.isPluginInstalled=null,i.WebRTCPlugin.pluginInjectionInterval=null,i.WebRTCPlugin.injectPlugin=null,i.WebRTCPlugin.PLUGIN_STATES={NONE:0,INITIALIZING:1,INJECTING:2,INJECTED:3,READY:4},i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.NONE,i.onwebrtcreadyDone=!1,i.WebRTCPlugin.PLUGIN_LOG_LEVELS={NONE:"NONE",ERROR:"ERROR",WARNING:"WARNING",INFO:"INFO",VERBOSE:"VERBOSE",SENSITIVE:"SENSITIVE"},i.WebRTCPlugin.WaitForPluginReady=null,i.WebRTCPlugin.callWhenPluginReady=null,i.documentReady=function(){return"interactive"===document.readyState&&!!document.body||"complete"===document.readyState},window.__TemWebRTCReady0=function(){i.documentReady()?(i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.READY,i.maybeThroughWebRTCReady()):setTimeout(__TemWebRTCReady0,100)},i.maybeThroughWebRTCReady=function(){i.onwebrtcreadyDone||(i.onwebrtcreadyDone=!0,i._onwebrtcreadies.length?i._onwebrtcreadies.forEach(function(e){"function"==typeof e&&e(null!==i.WebRTCPlugin.plugin)}):"function"==typeof i.onwebrtcready&&i.onwebrtcready(null!==i.WebRTCPlugin.plugin))},i.TEXT={PLUGIN:{REQUIRE_INSTALLATION:"This website requires you to install a WebRTC-enabling plugin to work on this browser.",REQUIRE_RESTART:"Your plugin is being downloaded. Please run the installer, and restart your browser to begin using it.",NOT_SUPPORTED:"Your browser does not support WebRTC.",BUTTON:"Install Now"},REFRESH:{REQUIRE_REFRESH:"Please refresh page",BUTTON:"Refresh Page"}},i._iceConnectionStates={starting:"starting",checking:"checking",connected:"connected",completed:"connected",done:"completed",disconnected:"disconnected",failed:"failed",closed:"closed"},i._iceConnectionFiredStates=[],i.isDefined=null,window.webrtcDetectedType=null,window.MediaStream="function"==typeof MediaStream?MediaStream:null,window.RTCPeerConnection="function"==typeof RTCPeerConnection?RTCPeerConnection:null,window.RTCSessionDescription="function"==typeof RTCSessionDescription?RTCSessionDescription:null,window.RTCIceCandidate="function"==typeof RTCIceCandidate?RTCIceCandidate:null,window.getUserMedia="function"==typeof getUserMedia?getUserMedia:null,window.attachMediaStream=null,window.reattachMediaStream=null,window.webrtcDetectedBrowser=null,window.webrtcDetectedVersion=null,window.webrtcMinimumVersion=null,window.webrtcDetectedDCSupport=null,i.parseWebrtcDetectedBrowser=function(){var e=null;if(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)e=navigator.userAgent.match(/OPR\/(\d+)/i)||[],window.webrtcDetectedBrowser="opera",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=26,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport="SCTP";else if(navigator.userAgent.match(/Bowser\/[0-9.]*/g)){e=navigator.userAgent.match(/Bowser\/[0-9.]*/g)||[];var t=parseInt((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[])[2]||"0",10);window.webrtcDetectedBrowser="bowser",window.webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),window.webrtcMinimumVersion=0,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport=t>30?"SCTP":"RTP"}else if(navigator.userAgent.indexOf("OPiOS")>0)e=navigator.userAgent.match(/OPiOS\/([0-9]+)\./),window.webrtcDetectedBrowser="opera",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("CriOS")>0)e=navigator.userAgent.match(/CriOS\/([0-9]+)\./)||[],window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedBrowser="chrome",window.webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("FxiOS")>0)e=navigator.userAgent.match(/FxiOS\/([0-9]+)\./)||[],window.webrtcDetectedBrowser="firefox",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=0,window.webrtcDetectedType=null,window.webrtcDetectedDCSupport=null;else if(document.documentMode)e=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],window.webrtcDetectedBrowser="IE",window.webrtcDetectedVersion=parseInt(e[1],10),window.webrtcMinimumVersion=9,window.webrtcDetectedType="plugin",window.webrtcDetectedDCSupport="SCTP",webrtcDetectedVersion||(e=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],window.webrtcDetectedVersion=parseInt(e[1]||"0",10));else if(window.StyleMedia||navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e=navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)||[],window.webrtcDetectedBrowser="edge",window.webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),window.webrtcMinimumVersion=13.10547,window.webrtcDetectedType="ms",window.webrtcDetectedDCSupport=null;else if("undefined"!=typeof InstallTrigger||navigator.userAgent.indexOf("irefox")>0)e=navigator.userAgent.match(/Firefox\/([0-9]+)\./)||[],window.webrtcDetectedBrowser="firefox",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=33,window.webrtcDetectedType="moz",window.webrtcDetectedDCSupport="SCTP";else if(window.chrome&&window.chrome.webstore||navigator.userAgent.indexOf("Chrom")>0)e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[],window.webrtcDetectedBrowser="chrome",window.webrtcDetectedVersion=parseInt(e[2]||"0",10),window.webrtcMinimumVersion=38,window.webrtcDetectedType="webkit",window.webrtcDetectedDCSupport=window.webrtcDetectedVersion>30?"SCTP":"RTP";else if(/constructor/i.test(window.HTMLElement)||function(e){return"[object SafariRemoteNotification]"===e.toString()}(!window.safari||safari.pushNotification)||navigator.userAgent.match(/AppleWebKit\/(\d+)\./)||navigator.userAgent.match(/Version\/(\d+).(\d+)/)){e=navigator.userAgent.match(/version\/(\d+)\.(\d+)/i)||[];var n=navigator.userAgent.match(/AppleWebKit\/(\d+)/i)||[],r=navigator.userAgent.match(/(iPhone|iPad)/gi),o=n.length>=1&&n[1]>=604;if(window.webrtcDetectedBrowser="safari",window.webrtcDetectedVersion=parseInt(e[1]||"0",10),window.webrtcMinimumVersion=7,r)window.webrtcDetectedType=o?"AppleWebKit":null;else{var a=window.webrtcDetectedVersion,s=parseInt(e[2]||"0",10),c=11==a&&s<2;window.webrtcDetectedType=!o||i.options.forceSafariPlugin&&c?"plugin":"AppleWebKit"}window.webrtcDetectedDCSupport="SCTP"}i.webrtcDetectedBrowser=window.webrtcDetectedBrowser,i.webrtcDetectedVersion=window.webrtcDetectedVersion,i.webrtcMinimumVersion=window.webrtcMinimumVersion,i.webrtcDetectedType=window.webrtcDetectedType,i.webrtcDetectedDCSupport=window.webrtcDetectedDCSupport},i.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e[t]=n},i.renderNotificationBar=function(e,t,n){if(i.documentReady()){var r=window,o=document.createElement("iframe");o.name="adapterjs-alert",o.style.position="fixed",o.style.top="-41px",o.style.left=0,o.style.right=0,o.style.width="100%",o.style.height="40px",o.style.backgroundColor="#ffffe1",o.style.border="none",o.style.borderBottom="1px solid #888888",o.style.zIndex="9999999","string"==typeof o.style.webkitTransition?o.style.webkitTransition="all .5s ease-out":"string"==typeof o.style.transition&&(o.style.transition="all .5s ease-out"),document.body.appendChild(o);var a=o.contentWindow?o.contentWindow:o.contentDocument.document?o.contentDocument.document:o.contentDocument;a.document.open(),a.document.write('<span style="display: inline-block; font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 4px; vertical-align: middle; cursor: default;">'+e+"</span>"),t&&"function"==typeof n?(a.document.write('<button id="okay">'+t+'</button><button id="cancel">Cancel</button>'),a.document.close(),i.addEvent(a.document.getElementById("okay"),"click",function(e){e.preventDefault();try{e.cancelBubble=!0}catch(e){}n(e)}),i.addEvent(a.document.getElementById("cancel"),"click",function(e){r.document.body.removeChild(o)})):a.document.close(),setTimeout(function(){"string"==typeof o.style.webkitTransform?o.style.webkitTransform="translateY(40px)":"string"==typeof o.style.transform?o.style.transform="translateY(40px)":o.style.top="0px"},300)}},window.requestUserMedia="function"==typeof requestUserMedia?requestUserMedia:null,i.parseWebrtcDetectedBrowser(),["webkit","moz","ms","AppleWebKit"].indexOf(i.webrtcDetectedType)>-1){navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)&&window.RTCPeerConnection&&(window.msRTCPeerConnection=window.RTCPeerConnection),function(t){e.exports=t()}(function(){return function e(t,n,i){function o(s,c){if(!n[s]){if(!t[s]){var d="function"==typeof r&&r;if(!c&&d)return r(s,!0);if(a)return a(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){"use strict";function r(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function i(e,t,n,r,i){var o=p.writeRtpDescription(e.kind,t);if(o+=p.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=p.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(r?r.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+p.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+p.localCName+"\r\n"),o}function o(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function s(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function c(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function d(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var p=e("sdp");t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function l(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var f=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw d("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=o(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=p.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(f.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(f.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),f.prototype.onicecandidate=null,f.prototype.onaddstream=null,f.prototype.ontrack=null,f.prototype.onremovestream=null,f.prototype.onsignalingstatechange=null,f.prototype.oniceconnectionstatechange=null,f.prototype.onconnectionstatechange=null,f.prototype.onicegatheringstatechange=null,f.prototype.onnegotiationneeded=null,f.prototype.ondatachannel=null,f.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},f.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},f.prototype.getConfiguration=function(){return this._config},f.prototype.getLocalStreams=function(){return this.localStreams},f.prototype.getRemoteStreams=function(){return this.remoteStreams},f.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},f.prototype.addTrack=function(t,n){if(this._isClosed)throw d("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(e){return e.track===t}))throw d("InvalidAccessError","Track already exists.");for(var r,i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},f.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},f.prototype.removeTrack=function(t){if(this._isClosed)throw d("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw d("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},f.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},f.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},f.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},f.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},f.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment;var c=p.writeCandidate(a);o.candidate=Object.assign(o.candidate,p.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=p.getMediaSections(r._localDescription.sdp);d[o.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r._localDescription.sdp=p.getDescription(r._localDescription.sdp)+d.join("");var u=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),s||r._dispatchEvent("icecandidate",o),u&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},f.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},f.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},f.prototype._transceive=function(e,n,r){var i=a(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:p.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},f.prototype.setLocalDescription=function(e){var t=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(d("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(d("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));var n,r;if("offer"===e.type)n=p.splitSections(e.sdp),r=n.shift(),n.forEach(function(e,n){var r=p.parseRtpParameters(e);t.transceivers[n].localCapabilities=r}),t.transceivers.forEach(function(e,n){t._gather(e.mid,n)});else if("answer"===e.type){n=p.splitSections(t._remoteDescription.sdp),r=n.shift();var i=p.matchPrefix(r,"a=ice-lite").length>0;n.forEach(function(e,n){var o=t.transceivers[n],s=o.iceGatherer,c=o.iceTransport,d=o.dtlsTransport,u=o.localCapabilities,l=o.remoteCapabilities;if(!(p.isRejected(e)&&0===p.matchPrefix(e,"a=bundle-only").length||o.rejected)){var f=p.getIceParameters(e,r),h=p.getDtlsParameters(e,r);i&&(h.role="server"),t.usingBundle&&0!==n||(t._gather(o.mid,n),"new"===c.state&&c.start(s,f,i?"controlling":"controlled"),"new"===d.state&&d.start(h));var g=a(u,l);t._transceive(o,g.codecs.length>0,!1)}})}return t._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve()},f.prototype.setRemoteDescription=function(r){var i=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(d("TypeError",'Unsupported type "'+r.type+'"'));if(!s("setRemoteDescription",r.type,i.signalingState)||i._isClosed)return Promise.reject(d("InvalidStateError","Can not set remote "+r.type+" in state "+i.signalingState));var o={};i.remoteStreams.forEach(function(e){o[e.id]=e});var a=[],f=p.splitSections(r.sdp),h=f.shift(),g=p.matchPrefix(h,"a=ice-lite").length>0,m=p.matchPrefix(h,"a=group:BUNDLE ").length>0;i.usingBundle=m;var _=p.matchPrefix(h,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!_&&_.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(s,d){var l=p.splitLines(s),f=p.getKind(s),_=p.isRejected(s)&&0===p.matchPrefix(s,"a=bundle-only").length,v=l[0].substr(2).split(" ")[2],y=p.getDirection(s,h),S=p.parseMsid(s),C=p.getMid(s)||p.generateIdentifier();if(_||"application"===f&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v))return void(i.transceivers[d]={mid:C,kind:f,protocol:v,rejected:!0});!_&&i.transceivers[d]&&i.transceivers[d].rejected&&(i.transceivers[d]=i._createTransceiver(f,!0));var T,E,R,b,w,A,P,D,O,I,k,N=p.parseRtpParameters(s);_||(I=p.getIceParameters(s,h),k=p.getDtlsParameters(s,h),k.role="client"),P=p.parseRtpEncodingParameters(s);var M=p.parseRtcpParameters(s),x=p.matchPrefix(s,"a=end-of-candidates",h).length>0,L=p.matchPrefix(s,"a=candidate:").map(function(e){return p.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===r.type||"answer"===r.type)&&!_&&m&&d>0&&i.transceivers[d]&&(i._disposeIceAndDtlsTransports(d),i.transceivers[d].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[d].iceTransport=i.transceivers[0].iceTransport,i.transceivers[d].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[d].rtpSender&&i.transceivers[d].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[d].rtpReceiver&&i.transceivers[d].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==r.type||_)"answer"!==r.type||_||(T=i.transceivers[d],E=T.iceGatherer,R=T.iceTransport,b=T.dtlsTransport,w=T.rtpReceiver,A=T.sendEncodingParameters,D=T.localCapabilities,i.transceivers[d].recvEncodingParameters=P,i.transceivers[d].remoteCapabilities=N,i.transceivers[d].rtcpParameters=M,L.length&&"new"===R.state&&(!g&&!x||m&&0!==d?L.forEach(function(e){c(T.iceTransport,e)}):R.setRemoteCandidates(L)),m&&0!==d||("new"===R.state&&R.start(E,I,"controlling"),"new"===b.state&&b.start(k)),i._transceive(T,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!w||"sendrecv"!==y&&"sendonly"!==y?delete T.rtpReceiver:(O=w.track,S?(o[S.stream]||(o[S.stream]=new e.MediaStream),n(O,o[S.stream]),a.push([O,w,o[S.stream]])):(o.default||(o.default=new e.MediaStream),n(O,o.default),a.push([O,w,o.default]))));else{T=i.transceivers[d]||i._createTransceiver(f),T.mid=C,T.iceGatherer||(T.iceGatherer=i._createIceGatherer(d,m)),L.length&&"new"===T.iceTransport.state&&(!x||m&&0!==d?L.forEach(function(e){c(T.iceTransport,e)}):T.iceTransport.setRemoteCandidates(L)),D=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(D.codecs=D.codecs.filter(function(e){return"rtx"!==e.name})),A=T.sendEncodingParameters||[{ssrc:1001*(2*d+2)}];var U=!1;if("sendrecv"===y||"sendonly"===y){if(U=!T.rtpReceiver,w=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,f),U){var B;O=w.track,S&&"-"===S.stream||(S?(o[S.stream]||(o[S.stream]=new e.MediaStream,Object.defineProperty(o[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(O,"id",{get:function(){return S.track}}),B=o[S.stream]):(o.default||(o.default=new e.MediaStream),B=o.default)),B&&(n(O,B),T.associatedRemoteMediaStreams.push(B)),a.push([O,w,B])}}else T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===T.rtpReceiver.track.id});t&&u(t,e)}),T.associatedRemoteMediaStreams=[]);T.localCapabilities=D,T.remoteCapabilities=N,T.rtpReceiver=w,T.rtcpParameters=M,T.sendEncodingParameters=A,T.recvEncodingParameters=P,i._transceive(i.transceivers[d],!1,U)}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===r.type?"active":"passive"),i._remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(o).forEach(function(t){var n=o[t];if(n.getTracks().length){if(-1===i.remoteStreams.indexOf(n)){i.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){i._dispatchEvent("addstream",r)})}a.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&l(i,t,r,[n])})}}),a.forEach(function(e){e[2]||l(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},f.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},f.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},f.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},f.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},f.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},f.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(d("InvalidStateError","Can not call createOffer after close"));var r=n.transceivers.filter(function(e){return"audio"===e.kind}).length,o=n.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(r=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--r<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)});r>0||o>0;)r>0&&(n._createTransceiver("audio"),r--),o>0&&(n._createTransceiver("video"),o--);var s=p.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(r,i){var o=r.track,a=r.kind,s=r.mid||p.generateIdentifier();r.mid=s,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(i,n.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=r.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=c,r.sendEncodingParameters=d}),"max-compat"!==n._config.bundlePolicy&&(s+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){s+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+p.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))});var c=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(c)},f.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(d("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(d("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var r=p.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var o=p.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,s){if(!(s+1>o)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?r+="m=application 0 DTLS/SCTP 5000\r\n":r+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var d=a(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=i(e,d,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(s)},f.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,i){if(!n._remoteDescription)return i(d("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){o=a;break}var s=n.transceivers[o];if(!s)return i(d("OperationError","Can not add ICE candidate"));if(s.rejected)return r();var u=Object.keys(e.candidate).length>0?p.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return r();if(u.component&&1!==u.component)return r();if((0===o||o>0&&s.iceTransport!==n.transceivers[0].iceTransport)&&!c(s.iceTransport,u))return i(d("OperationError","Can not add ICE candidate"));var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),t=p.getMediaSections(n._remoteDescription.sdp),t[o]+="a="+(u.type?l:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=p.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].rejected||(n.transceivers[f].iceTransport.addRemoteCandidate({}),t=p.getMediaSections(n._remoteDescription.sdp),t[f]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=p.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);r()})},f.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw d("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){e[n].type=r(e[n]),t.set(n,e[n])}),t})}}});var h=["createOffer","createAnswer"];return h.forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),h=["setLocalDescription","setRemoteDescription","addIceCandidate"],h.forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=f.prototype[e];f.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),f}},{sdp:2}],2:[function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return n=n.concat(r.splitLines(t)),{usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=r.parseRtpMap(s),d=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=d.length?r.parseFmtp(d[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var p=r.matchPrefix(e,"b=");return p.length&&(p=0===p[0].indexOf("b=TIAS:")?parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")?1e3*parseInt(p[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=p})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e),n=t[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0],n=t.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=r)},{}],3:[function(e,t,r){(function(n){"use strict";var r=e("./adapter_factory.js");t.exports=r({window:n.window})}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(e,t,n){"use strict";var r=e("./utils");t.exports=function(t,n){var i=t&&t.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in n)hasOwnProperty.call(n,a)&&(o[a]=n[a]);var s=r.log,c=r.detectBrowser(i),d=e("./chrome/chrome_shim")||null,p=e("./edge/edge_shim")||null,u=e("./firefox/firefox_shim")||null,l=e("./safari/safari_shim")||null,f=e("./common_shim")||null,h={browserDetails:c,commonShim:f,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),h;s("adapter.js shimming chrome."),h.browserShim=d,f.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),d.shimSenderReceiverGetStats(i),d.fixNegotiationNeeded(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"firefox":if(!u||!u.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),h;s("adapter.js shimming firefox."),h.browserShim=u,f.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimRemoveStream(i),u.shimSenderGetStats(i),u.shimReceiverGetStats(i),u.shimRTCDataChannel(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"edge":if(!p||!p.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),h;s("adapter.js shimming edge."),h.browserShim=p,f.shimCreateObjectURL(i),p.shimGetUserMedia(i),p.shimPeerConnection(i),p.shimReplaceTrack(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;case"safari":if(!l||!o.shimSafari)return s("Safari shim is not included in this adapter release."),h;s("adapter.js shimming safari."),h.browserShim=l,f.shimCreateObjectURL(i),l.shimRTCIceServerUrls(i),l.shimCreateOfferLegacy(i),l.shimCallbacksAPI(i),l.shimLocalStreamsAPI(i),l.shimRemoteStreamsAPI(i),l.shimTrackEventTransceiver(i),l.shimGetUserMedia(i),f.shimRTCIceCandidate(i),f.shimMaxMessageSize(i),f.shimSendThrowTypeError(i);break;default:s("Unsupported browser!")}return h}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(e,t,n){"use strict";function r(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(function(i){i.endsWith("Id")?r(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(function(t){r(e,e.get(t),n)})}))}function i(e,t,n){var i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var a=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(function(t){e.forEach(function(n){n.type===i&&n.trackId===t.id&&r(e,n,o)})}),o}var o=e("../utils.js"),a=o.log;t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)"RTCRtpTransceiver"in e||o.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=this,o=n.apply(i,arguments);return o||(o=t(i,e),i._senders.push(o)),o};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;r.apply(t,arguments);var n=t._senders.indexOf(e);-1!==n&&t._senders.splice(n,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],i.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return i(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return i(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var t=this;if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var n,r,i,o=arguments[0];return t.getSenders().forEach(function(e){e.track===o&&(n?i=!0:n=e)}),t.getReceivers().forEach(function(e){return e.track===o&&(r?i=!0:r=e),e.track===o}),i||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(t,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return void(this.src="");this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var r=t.getSenders();n.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===r.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){function t(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}var r=o.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}a.apply(n,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},s.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r._reverseStreams[a.id]=n,r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var i=t(e,r);n[0].apply(null,[i])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(n){return t(e,n)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=n(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,n=d.get.apply(this);return""===n.type?n:t(e,n)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(r){t._streams[r].getTracks().find(function(t){return e.track===t})&&(n=t._streams[r])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=o.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection)e.RTCPeerConnection=function(t,n){return a("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});else{var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,r.push(a)):r.push(e.iceServers[i])}e.iceServers=r}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return r.apply(this,[c,arguments[0]])}return new Promise(function(e,t){r.apply(i,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(e){o.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){if(!("getDisplayMedia"in e.navigator))return"function"!=typeof t?void console.error("shimGetDisplayMedia: getSourceId argument is not a function"):void(navigator.getDisplayMedia=function(e){return t(e).then(function(t){return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:e.video.frameRate||3}},navigator.mediaDevices.getUserMedia(e)})})}}},{"../utils.js":14,"./getusermedia":6}],6:[function(e,t,n){"use strict";var r=e("../utils.js"),i=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var d;if("environment"===s.exact||"environment"===s.ideal?d=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return d.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==d.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),r(e)})}e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(s(e))})})};n.getUserMedia=c;var d=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var p=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return p(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return d(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(e,t,n){"use strict";var r=e("sdp"),i=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=r.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){var t=r.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=r.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!==n?-1:n},a=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},s=function(e,n){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=r.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;if(e._sctp=null,n(arguments[0])){var t,r=o(arguments[0]),i=a(r),d=s(arguments[0],r);t=0===i&&0===d?Number.POSITIVE_INFINITY:0===i||0===d?Math.max(i,d):Math.min(i,d);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return t}}),e._sctp=p}return c.apply(e,arguments)}}},shimSendThrowTypeError:function(e){function t(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=this,r=n.apply(e,arguments);return t(r,e),r},i.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})}}}},{"./utils":14,sdp:2}],8:[function(e,t,n){"use strict";var r=e("../utils"),i=e("./filtericeservers"),o=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var a=o(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=i(e.iceServers)),new a(e)},e.RTCPeerConnection.prototype=a.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(e,t,n){"use strict";var r=e("../utils");t.exports=function(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof i;return o&&(i=[i]),i=i.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=o?i[0]:i,!!i.length}})}},{"../utils":14}],10:[function(e,t,n){"use strict";t.exports=function(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},{}],11:[function(e,t,n){"use strict";var r=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=i(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(n,r)}}},shimSenderGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n}),r.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&-1!==e.getTracks().indexOf(n.track)&&t.removeTrack(n)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||(navigator.getDisplayMedia=function(e){if(!e||!e.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===e.video?e.video={mediaSource:t}:e.video.mediaSource=t,navigator.mediaDevices.getUserMedia(e)})}}},{"../utils":14,"./getusermedia":12}],12:[function(e,t,n){"use strict";var r=e("../utils"),i=r.log;t.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){o(a(e))})},c=function(e){return new Promise(function(t,n){s(e,t,n)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var d=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var p=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return p(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var u=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),u(e.audio,"autoGainControl","mozAutoGainControl"),u(e.audio,"noiseSuppression","mozNoiseSuppression")),l(e)},o&&o.prototype.getSettings){var f=o.prototype.getSettings;o.prototype.getSettings=function(){var e=f.apply(this,arguments);return u(e,"mozAutoGainControl","autoGainControl"),u(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),u(e,"autoGainControl","mozAutoGainControl"),u(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(t.version<44)return s(e,i,o);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,o)}}},{"../utils":14}],13:[function(e,t,n){"use strict";var r=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}}},{"../utils":14}],14:[function(e,t,n){"use strict";function r(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function i(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}var o=!0,a=!0;t.exports={extractVersion:r,wrapPeerConnectionEvent:i,disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){a&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,n={};if(n.browser=null,n.version=null,void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=r(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)n.browser="chrome",n.version=r(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=r(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=r(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}}},{}]},{},[3])(3)}),navigator.mozGetUserMedia?(MediaStreamTrack.getSources=function(e){setTimeout(function(){e([{kind:"audio",id:"default",label:"",facing:""},{kind:"video",id:"default",label:"",facing:""}])},0)},attachMediaStream=function(e,t){return e.srcObject=t,e},reattachMediaStream=function(e,t){return e.srcObject=t.srcObject,e}):navigator.webkitGetUserMedia?(attachMediaStream=function(e,t){return i.webrtcDetectedVersion>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):console.error("Error attaching stream to element."),e},reattachMediaStream=function(e,t){return i.webrtcDetectedVersion>=43?e.srcObject=t.srcObject:e.src=t.src,e}):"AppleWebKit"===i.webrtcDetectedType?(attachMediaStream=function(e,t){return e.srcObject=t,e},reattachMediaStream=function(e,t){return e.srcObject=t.srcObject,e},navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=getUserMedia=function(e,t,n){navigator.mediaDevices.getUserMedia(e).then(t).catch(n)})):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)&&(attachMediaStream=function(e,t){return e.srcObject=t,e},reattachMediaStream=function(e,t){return e.srcObject=t.srcObject,e});var o=attachMediaStream;"opera"===i.webrtcDetectedBrowser&&(o=function(e,t){i.webrtcDetectedVersion>38?e.srcObject=t:void 0!==e.src&&(e.src=URL.createObjectURL(t))}),attachMediaStream=function(e,t){return"chrome"!==i.webrtcDetectedBrowser&&"opera"!==i.webrtcDetectedBrowser||t?o(e,t):e.src="",e};var a=reattachMediaStream;reattachMediaStream=function(e,t){return a(e,t),e},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=function(e,t,n){navigator.getUserMedia(e,t,n)},i.attachMediaStream=attachMediaStream,i.reattachMediaStream=reattachMediaStream,i.getUserMedia=getUserMedia,"undefined"==typeof Promise&&(requestUserMedia=null),i.maybeThroughWebRTCReady()}else"object"==typeof console&&"function"==typeof console.log||(console={}||console,console.log=function(e){},console.info=function(e){},console.error=function(e){},console.dir=function(e){},console.exception=function(e){},console.trace=function(e){},console.warn=function(e){},console.count=function(e){},console.debug=function(e){},console.count=function(e){},console.time=function(e){},console.timeEnd=function(e){},console.group=function(e){},console.groupCollapsed=function(e){},console.groupEnd=function(e){}),i.WebRTCPlugin.WaitForPluginReady=function(){for(;i.WebRTCPlugin.pluginState!==i.WebRTCPlugin.PLUGIN_STATES.READY;);},i.WebRTCPlugin.callWhenPluginReady=function(e){if(i.WebRTCPlugin.pluginState===i.WebRTCPlugin.PLUGIN_STATES.READY)e();else var t=setInterval(function(){i.WebRTCPlugin.pluginState===i.WebRTCPlugin.PLUGIN_STATES.READY&&(clearInterval(t),e())},100)},i.WebRTCPlugin.setLogLevel=function(e){i.WebRTCPlugin.callWhenPluginReady(function(){i.WebRTCPlugin.plugin.setLogLevel(e)})},i.WebRTCPlugin.injectPlugin=function(){if(i.documentReady()&&i.WebRTCPlugin.pluginState===i.WebRTCPlugin.PLUGIN_STATES.INITIALIZING){i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.INJECTING;var e=document.getElementById(i.WebRTCPlugin.pluginInfo.pluginId);if(e)if(i.WebRTCPlugin.plugin=e,i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.INJECTED,i.WebRTCPlugin.plugin.valid)window[i.WebRTCPlugin.pluginInfo.onload]();else var t=setInterval(function(){i.WebRTCPlugin.plugin.valid&&(clearInterval(t),window[i.WebRTCPlugin.pluginInfo.onload]())},100);else{if("IE"===i.webrtcDetectedBrowser&&i.webrtcDetectedVersion<=10){var n=document.createDocumentFragment();for(i.WebRTCPlugin.plugin=document.createElement("div"),i.WebRTCPlugin.plugin.innerHTML='<object id="'+i.WebRTCPlugin.pluginInfo.pluginId+'" type="'+i.WebRTCPlugin.pluginInfo.type+'" width="1" height="1"><param name="pluginId" value="'+i.WebRTCPlugin.pluginInfo.pluginId+'" /> <param name="windowless" value="false" /> <param name="pageId" value="'+i.WebRTCPlugin.pageId+'" /> <param name="onload" value="'+i.WebRTCPlugin.pluginInfo.onload+'" /><param name="tag" value="'+i.WebRTCPlugin.TAGS.NONE+'" />'+(i.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+"</object>";i.WebRTCPlugin.plugin.firstChild;)n.appendChild(i.WebRTCPlugin.plugin.firstChild);document.body.appendChild(n),i.WebRTCPlugin.plugin=document.getElementById(i.WebRTCPlugin.pluginInfo.pluginId)}else i.WebRTCPlugin.plugin=document.createElement("object"),i.WebRTCPlugin.plugin.id=i.WebRTCPlugin.pluginInfo.pluginId,"IE"===i.webrtcDetectedBrowser?(i.WebRTCPlugin.plugin.width="1px",i.WebRTCPlugin.plugin.height="1px"):(i.WebRTCPlugin.plugin.width="0px",i.WebRTCPlugin.plugin.height="0px"),i.WebRTCPlugin.plugin.type=i.WebRTCPlugin.pluginInfo.type,i.WebRTCPlugin.plugin.innerHTML='<param name="onload" value="'+i.WebRTCPlugin.pluginInfo.onload+'"><param name="pluginId" value="'+i.WebRTCPlugin.pluginInfo.pluginId+'"><param name="windowless" value="false" /> '+(i.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+'<param name="pageId" value="'+i.WebRTCPlugin.pageId+'"><param name="tag" value="'+i.WebRTCPlugin.TAGS.NONE+'" />',document.body.appendChild(i.WebRTCPlugin.plugin);i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.INJECTED}}},i.WebRTCPlugin.isPluginInstalled=function(e,t,n,r,o){if("IE"!==i.webrtcDetectedBrowser){var a=navigator.mimeTypes;if(void 0!==a){for(var s=0;s<a.length;s++)if(a[s].type.indexOf(n)>=0)return void r();o()}else i.renderNotificationBar(i.TEXT.PLUGIN.NOT_SUPPORTED)}else{try{new ActiveXObject(e+"."+t)}catch(e){return void o()}r()}},i.WebRTCPlugin.defineWebRTCInterface=function(){if(i.WebRTCPlugin.pluginState===i.WebRTCPlugin.PLUGIN_STATES.READY)return void console.error("AdapterJS - WebRTC interface has already been defined");i.WebRTCPlugin.pluginState=i.WebRTCPlugin.PLUGIN_STATES.INITIALIZING,i.isDefined=function(e){return null!==e&&void 0!==e},RTCSessionDescription=function(e){return i.WebRTCPlugin.WaitForPluginReady(),i.WebRTCPlugin.plugin.ConstructSessionDescription(e.type,e.sdp)},MediaStream=function(e){return i.WebRTCPlugin.WaitForPluginReady(),i.WebRTCPlugin.plugin.MediaStream(e)},RTCPeerConnection=function(e,t){if(void 0!==e&&null!==e&&!Array.isArray(e.iceServers))throw new Error("Failed to construct 'RTCPeerConnection': Malformed RTCConfiguration");if(void 0!==t&&null!==t){var n=!1;if(n|="object"!=typeof t,n|=t.hasOwnProperty("mandatory")&&void 0!==t.mandatory&&null!==t.mandatory&&t.mandatory.constructor!==Object,n|=t.hasOwnProperty("optional")&&void 0!==t.optional&&null!==t.optional&&!Array.isArray(t.optional))throw new Error("Failed to construct 'RTCPeerConnection': Malformed constraints object")}i.WebRTCPlugin.WaitForPluginReady();var r=null;if(e&&Array.isArray(e.iceServers)){r=e.iceServers;for(var o=0;o<r.length;o++)r[o].urls&&!r[o].url&&(r[o].url=r[o].urls),r[o].hasCredentials=i.isDefined(r[o].username)&&i.isDefined(r[o].credential)}if(i.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION&&i.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION>1)return r&&(e.iceServers=r),i.WebRTCPlugin.plugin.PeerConnection(e);var a=t&&t.mandatory?t.mandatory:null,s=t&&t.optional?t.optional:null;return i.WebRTCPlugin.plugin.PeerConnection(i.WebRTCPlugin.pageId,r,a,s)};var e=function(){};e.getSources=function(e){i.WebRTCPlugin.callWhenPluginReady(function(){i.WebRTCPlugin.plugin.GetSources(e)})};var t=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n){if("string"==typeof e[n])return void(t[n]=e[n]);var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if("sourceId"===i("",n)&&void 0!==r.exact&&(r.ideal=r.exact,r.exact=void 0),void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};getUserMedia=function(e,n,r){var o={};o.audio=!!e.audio&&t(e.audio),o.video=!!e.video&&t(e.video),i.WebRTCPlugin.callWhenPluginReady(function(){i.WebRTCPlugin.plugin.getUserMedia(o,n,r)})},window.navigator.getUserMedia=getUserMedia,"undefined"!=typeof Promise&&(requestUserMedia=function(e){return new Promise(function(t,n){try{getUserMedia(e,t,n)}catch(e){n(e)}})},void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia=requestUserMedia,navigator.mediaDevices.enumerateDevices=function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],id:e.id,deviceId:e.id,groupId:""}}))})})}),attachMediaStream=function(e,t){if(e&&e.parentNode){var n;null===t?n="":(void 0!==t.enableSoundTracks&&t.enableSoundTracks(!0),n=t.id);var r=0===e.id.length?Math.random().toString(36).slice(2):e.id,o=e.nodeName.toLowerCase();if("object"!==o){var a;switch(o){case"audio":a=i.WebRTCPlugin.TAGS.AUDIO;break;case"video":a=i.WebRTCPlugin.TAGS.VIDEO;break;default:a=i.WebRTCPlugin.TAGS.NONE}var s=document.createDocumentFragment(),c=document.createElement("div"),d="";for(e.className?d='class="'+e.className+'" ':e.attributes&&e.attributes.class&&(d='class="'+e.attributes.class.value+'" '),c.innerHTML='<object id="'+r+'" '+d+'type="'+i.WebRTCPlugin.pluginInfo.type+'"><param name="pluginId" value="'+r+'" /> <param name="pageId" value="'+i.WebRTCPlugin.pageId+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+n+'" /> <param name="tag" value="'+a+'" /> </object>';c.firstChild;)s.appendChild(c.firstChild);var p="",u="";e.clientWidth||e.clientHeight?(u=e.clientWidth,p=e.clientHeight):(e.width||e.height)&&(u=e.width,p=e.height),e.parentNode.insertBefore(s,e),s=document.getElementById(r),s.width=u,s.height=p,e.parentNode.removeChild(e)}else{for(var l=e.children,f=0;f!==l.length;++f)if("streamId"===l[f].name){l[f].value=n;break}e.setStreamId(n)}var h=document.getElementById(r);return i.forwardEventHandlers(h,e,Object.getPrototypeOf(e)),h}},reattachMediaStream=function(e,t){for(var n=null,r=t.children,o=0;o!==r.length;++o)if("streamId"===r[o].name){i.WebRTCPlugin.WaitForPluginReady(),n=i.WebRTCPlugin.plugin.getStreamWithId(i.WebRTCPlugin.pageId,r[o].value);break}if(null!==n)return attachMediaStream(e,n);console.log("Could not find the stream associated with this element")},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=getUserMedia,i.attachMediaStream=attachMediaStream,i.reattachMediaStream=reattachMediaStream,i.getUserMedia=getUserMedia,i.forwardEventHandlers=function(e,t,n){var r=Object.getOwnPropertyNames(n);for(var o in r)if(o){var a=r[o];"function"==typeof a.slice&&"on"===a.slice(0,2)&&"function"==typeof t[a]&&i.addEvent(e,a.slice(2),t[a])}var s=Object.getPrototypeOf(n);s&&i.forwardEventHandlers(e,t,s)},RTCIceCandidate=function(e){return e.sdpMid||(e.sdpMid=""),i.WebRTCPlugin.WaitForPluginReady(),i.WebRTCPlugin.plugin.ConstructIceCandidate(e.sdpMid,e.sdpMLineIndex,e.candidate)},i.addEvent(document,"readystatechange",i.WebRTCPlugin.injectPlugin),i.WebRTCPlugin.injectPlugin()},i.WebRTCPlugin.pluginNeededButNotInstalledCb=i.WebRTCPlugin.pluginNeededButNotInstalledCb||function(){i.addEvent(document,"readystatechange",i.WebRTCPlugin.pluginNeededButNotInstalledCbPriv),i.WebRTCPlugin.pluginNeededButNotInstalledCbPriv()},i.WebRTCPlugin.pluginNeededButNotInstalledCbPriv=function(){if(i.documentReady()&&(document.removeEventListener("readystatechange",i.WebRTCPlugin.pluginNeededButNotInstalledCbPriv),!i.options.hidePluginInstallPrompt)){var e=i.WebRTCPlugin.pluginInfo.downloadLink;if(e){var t;i.WebRTCPlugin.pluginInfo.companyName?(t="This website requires you to install the ",i.WebRTCPlugin.pluginInfo.portalLink?t+=' <a href="'+i.WebRTCPlugin.pluginInfo.portalLink+'" target="_blank">'+i.WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin</a>":t+=i.WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin",t+=" to work on this browser."):t=i.TEXT.PLUGIN.REQUIRE_INSTALLATION,i.renderNotificationBar(t,i.TEXT.PLUGIN.BUTTON,function(){if(window.open(e,"_top"),"safari"===webrtcDetectedBrowser&&11==webrtcDetectedVersion)i.renderNotificationBar(i.TEXT.PLUGIN.REQUIRE_RESTART);else var t=setInterval(function(){"IE"!==i.webrtcDetectedBrowser&&navigator.plugins.refresh(!1),i.WebRTCPlugin.isPluginInstalled(i.WebRTCPlugin.pluginInfo.prefix,i.WebRTCPlugin.pluginInfo.plugName,i.WebRTCPlugin.pluginInfo.type,function(){clearInterval(t),i.WebRTCPlugin.defineWebRTCInterface()},function(){})},500)})}else i.renderNotificationBar(i.TEXT.PLUGIN.NOT_SUPPORTED)}},i.WebRTCPlugin.isPluginInstalled(i.WebRTCPlugin.pluginInfo.prefix,i.WebRTCPlugin.pluginInfo.plugName,i.WebRTCPlugin.pluginInfo.type,i.WebRTCPlugin.defineWebRTCInterface,i.WebRTCPlugin.pluginNeededButNotInstalledCb);e.exports=i,i.TEXT.EXTENSION={REQUIRE_INSTALLATION_FF:"To enable screensharing you need to install the Skylink WebRTC tools Firefox Add-on.",REQUIRE_INSTALLATION_CHROME:"To enable screensharing you need to install the Skylink WebRTC tools Chrome Extension.",REQUIRE_REFRESH:"Please refresh this page after the Skylink WebRTC tools extension has been installed.",BUTTON_FF:"Install Now",BUTTON_CHROME:"Go to Chrome Web Store"},i.extensionInfo=i.extensionInfo||{chrome:{extensionId:"ljckddiekopnnjoeaiofddfhgnbdoafc",extensionLink:"https://chrome.google.com/webstore/detail/skylink-webrtc-tools/ljckddiekopnnjoeaiofddfhgnbdoafc",iframeLink:"https://cdn.temasys.com.sg/skylink/extensions/detectRTC.html"},firefox:{extensionLink:"https://addons.mozilla.org/en-US/firefox/addon/skylink-webrtc-tools/"},opera:{extensionId:null,extensionLink:null}},i._mediaSourcePolyfillIsDefined=!1,i._defineMediaSourcePolyfill=function(){if(!i._mediaSourcePolyfillIsDefined){i._mediaSourcePolyfillIsDefined=!0;var e=null,t=function(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},n=function(e,t,n){if(!e||"object"!=typeof e)throw new Error("GetUserMedia: (constraints, .., ..) argument required");if("function"!=typeof t)throw new Error("GetUserMedia: (.., successCb, ..) argument required");if("function"!=typeof n)throw new Error("GetUserMedia: (.., .., failureCb) argument required")};if("moz"===i.webrtcDetectedType)e=window.navigator.getUserMedia,navigator.getUserMedia=function(r,o,a){if(n(r,o,a),r.video&&"object"==typeof r.video&&r.video.hasOwnProperty("mediaSource")){var s=t(r),c=["screen","window","application","browser","camera"],d=["NotAllowedError","PermissionDeniedError","SecurityError"];if(Array.isArray(s.video.mediaSource)){for(var p=0;p<s.video.mediaSource.length;){if(c.indexOf(s.video.mediaSource[p])>-1){s.video.mediaSource=s.video.mediaSource[p];break}p++}s.video.mediaSource="string"==typeof s.video.mediaSource?s.video.mediaSource:null}if(-1===c.indexOf(s.video.mediaSource))return void a(new Error('GetUserMedia: Only "screen" and "window" are supported as mediaSource constraints'));var u=setInterval(function(){"complete"===document.readyState&&(clearInterval(u),s.video.mozMediaSource=s.video.mediaSource,e(s,o,function(e){d.indexOf(e.name)>-1&&i.webrtcDetectedVersion<52&&"https:"===window.parent.location.protocol?i.renderNotificationBar(i.TEXT.EXTENSION.REQUIRE_INSTALLATION_FF,i.TEXT.EXTENSION.BUTTON_FF,function(e){window.open(i.extensionInfo.firefox.extensionLink,"_blank"),e.target&&e.target.parentElement&&e.target.nextElementSibling&&e.target.nextElementSibling.click&&e.target.nextElementSibling.click(),i.renderNotificationBar(i.TEXT.EXTENSION?i.TEXT.EXTENSION.REQUIRE_REFRESH:i.TEXT.REFRESH.REQUIRE_REFRESH,i.TEXT.REFRESH.BUTTON,function(){window.open("javascript:location.reload()","_top")})}):a(e)}))},1)}else e(r,o,a)},i.getUserMedia=window.getUserMedia=navigator.getUserMedia;else if("webkit"===i.webrtcDetectedType){e=window.navigator.getUserMedia;var r=document.createElement("iframe");if(navigator.getUserMedia=function(o,a,s){if(n(o,a,s),o.video&&"object"==typeof o.video&&o.video.hasOwnProperty("mediaSource")){var c=t(o),d=["window","screen","tab","audio"];if(navigator.userAgent.toLowerCase().indexOf("android")>-1)return void((Array.isArray(c.video.mediaSource)?c.video.mediaSource.indexOf("screen")>-1:"screen"===c.video.mediaSource)?(c.video.mandatory=c.video.mandatory||{},c.video.mandatory.chromeMediaSource="screen",c.video.mandatory.maxHeight=window.screen.height,c.video.mandatory.maxWidth=window.screen.width,delete c.video.mediaSource,e(c,a,s)):s(new Error('GetUserMedia: Only "screen" are supported as mediaSource constraints for Android')));if(!("opera"===i.webrtcDetectedBrowser?!!i.extensionInfo.opera.extensionId:"chrome"===i.webrtcDetectedBrowser))return void s(new Error("Current browser does not support screensharing"));if("string"==typeof c.video.mediaSource&&d.indexOf(c.video.mediaSource)>-1&&"audio"!==c.video.mediaSource)c.video.mediaSource=[c.video.mediaSource];else if(Array.isArray(c.video.mediaSource)){for(var p=0,u=[];p<d.length;){for(var l=0;l<c.video.mediaSource.length;)d[p]===c.video.mediaSource[l]&&u.push(c.video.mediaSource[l]),l++;p++}c.video.mediaSource=u}else c.video.mediaSource=[];if(c.video.mediaSource.indexOf("audio")>-1&&-1===c.video.mediaSource.indexOf("tab"))return void s(new Error('GetUserMedia: "audio" mediaSource must be provided with ["audio", "tab"]'));if(0===c.video.mediaSource.length)return void s(new Error('GetUserMedia: Only "screen", "window", "tab" are supported as mediaSource constraints'));c.video.mediaSource.indexOf("tab")>-1&&c.video.mediaSource.indexOf("audio")>-1&&!c.audio&&console.warn('Audio must be requested if "tab" and "audio" mediaSource constraints is requested');var f=function(t){t.success?(c.video.mandatory=c.video.mandatory||{},c.video.mandatory.chromeMediaSource="desktop",c.video.mandatory.maxWidth=window.screen.width>1920?window.screen.width:1920,c.video.mandatory.maxHeight=window.screen.height>1080?window.screen.height:1080,c.video.mandatory.chromeMediaSourceId=t.sourceId,Array.isArray(c.video.mediaSource)&&c.video.mediaSource.indexOf("tab")>-1&&c.video.mediaSource.indexOf("audio")>-1&&c.audio&&(c.audio="object"==typeof c.audio?c.audio:{},c.audio.mandatory=c.audio.mandatory||{},c.audio.mandatory.chromeMediaSource="desktop",c.audio.mandatory.chromeMediaSourceId=t.sourceId),delete c.video.mediaSource,e(c,a,s)):(t.extensionLink&&i.renderNotificationBar(i.TEXT.EXTENSION.REQUIRE_INSTALLATION_CHROME,i.TEXT.EXTENSION.BUTTON_CHROME,function(e){window.open(t.extensionLink,"_blank"),e.target&&e.target.parentElement&&e.target.nextElementSibling&&e.target.nextElementSibling.click&&e.target.nextElementSibling.click(),i.renderNotificationBar(i.TEXT.EXTENSION?i.TEXT.EXTENSION.REQUIRE_REFRESH:i.TEXT.REFRESH.REQUIRE_REFRESH,i.TEXT.REFRESH.BUTTON,function(){window.open("javascript:location.reload()","_top")})}),s(t.error))};if(i.extensionInfo.chrome.iframeLink&&"opera"!==i.webrtcDetectedBrowser)r.getSourceId(c.video.mediaSource,f);else{var h=i.extensionInfo["opera"===i.webrtcDetectedBrowser?"opera":"chrome"].extensionId,g=i.extensionInfo["opera"===i.webrtcDetectedBrowser?"opera":"chrome"].extensionLink,m=document.createElement("img");m.src="chrome-extension://"+h+"/icon.png",m.onload=function(){chrome.runtime.sendMessage(h,{type:"get-version"},function(e){if(!e||"object"!=typeof e||"send-version"!==e.type)return void f({success:!1,error:new Error("Extension is disabled")});chrome.runtime.sendMessage(h,{type:"get-source",sources:c.video.mediaSource},function(e){f(e&&"object"==typeof e?"send-source-error"===e.type?{success:!1,error:new Error("Permission denied for screen retrieval")}:{success:!0,sourceId:e.sourceId}:{success:!1,error:new Error("Retrieval failed")})})})},m.onerror=function(){f({success:!1,error:new Error("Extension not installed"),extensionLink:g})}}}else e(o,a,s)},i.getUserMedia=window.getUserMedia=navigator.getUserMedia,navigator.mediaDevices.getUserMedia=function(e){return new Promise(function(t,n){try{window.getUserMedia(e,t,n)}catch(e){n(e)}})},"chrome"===i.webrtcDetectedBrowser){var o={loaded:!1,error:!1};if(r)try{(document.body||document.documentElement).removeChild(r)}catch(e){}if(!i.extensionInfo.chrome.iframeLink)return;r.onload=function(){o.loaded=!0},r.onerror=function(){o.error=!0},r.src=i.extensionInfo.chrome.iframeLink,r.style.display="none";var a=function(e,t){window.addEventListener("message",function e(n){n.data&&"object"==typeof n.data&&("not-installed"===n.data.chromeExtensionStatus?(window.removeEventListener("message",e),t({success:!1,error:new Error("Extension is not installed"),extensionLink:n.data.data||i.extensionInfo.chrome.extensionLink})):"installed-disabled"===n.data.chromeExtensionStatus?(window.removeEventListener("message",e),t({success:!1,error:new Error("Extension is disabled")})):"PermissionDeniedError"===n.data.chromeMediaSourceId?(window.removeEventListener("message",e),t({success:!1,error:new Error("Permission denied for screen retrieval")})):n.data.chromeMediaSourceId&&"string"==typeof n.data.chromeMediaSourceId&&(window.removeEventListener("message",e),t({success:!0,sourceId:n.data.chromeMediaSourceId})))}),r.contentWindow.postMessage({captureSourceId:!0,sources:e,legacy:!0,extensionId:i.extensionInfo.chrome.extensionId,extensionLink:i.extensionInfo.chrome.extensionLink},"*")};r.getSourceId=function(e,t){if(o.error)return void t({success:!1,error:new Error("iframe is not loaded")});if(o.loaded)a(e,t);else var n=0,r=setInterval(function(){o.loaded?(clearInterval(r),a(e,t)):50===n?(clearInterval(r),t({success:!1,error:new Error("iframe failed to load")})):n++},100)},(document.body||document.documentElement).appendChild(r)}}else"edge"===i.webrtcDetectedBrowser?console.warn("Edge does not support screensharing feature in getUserMedia"):"AppleWebKit"===i.webrtcDetectedType?console.warn("Safari does not support screensharing feature in getUserMedia"):"plugin"===i.webrtcDetectedType&&(i.WebRTCPlugin.parseVersion=function(e){var t=e.split(".");return{major:parseInt(t[0]),minor:parseInt(t[1]),revision:parseInt(t[2])}},i.WebRTCPlugin.isVersionGreater=function(e,t){var n=i.WebRTCPlugin.parseVersion(e),r=i.WebRTCPlugin.parseVersion(t);return n.major>r.major||n.major==r.major&&n.minor>r.minor||n.major==r.major&&n.minor==r.minor&&n.revision>r.revision},e=window.navigator.getUserMedia,navigator.getUserMedia=function(r,o,a){if(n(r,o,a),r.video&&"object"==typeof r.video&&r.video.hasOwnProperty("mediaSource")){var s=t(r);i.WebRTCPlugin.callWhenPluginReady(function(){if(!i.WebRTCPlugin.plugin.HasScreensharingFeature||!i.WebRTCPlugin.plugin.isScreensharingAvailable)return void a(new Error("Your version of the WebRTC plugin does not support screensharing"));if(i.WebRTCPlugin.plugin.screensharingKeys)if(Array.isArray(s.video.mediaSource)&&s.video.mediaSource.indexOf("screen")>-1&&s.video.mediaSource.indexOf("window")>-1||s.video.mediaSource===i.WebRTCPlugin.plugin.screensharingKey||s.video.mediaSource===i.WebRTCPlugin.plugin.screensharingKeys.screenOrWindow)s.video.mediaSource=i.WebRTCPlugin.plugin.screensharingKeys.screenOrWindow;else if(Array.isArray(s.video.mediaSource)&&s.video.mediaSource.indexOf("screen")>-1||"screen"===s.video.mediaSource)s.video.mediaSource=i.WebRTCPlugin.plugin.screensharingKeys.screen;else{if(!(Array.isArray(s.video.mediaSource)&&s.video.mediaSource.indexOf("window")>-1||"window"===s.video.mediaSource))return void a(new Error('GetUserMedia: Only "screen", "window", ["screen", "window"] are supported as mediaSource constraints'));s.video.mediaSource=i.WebRTCPlugin.plugin.screensharingKeys.window}i.WebRTCPlugin.isVersionGreater(i.WebRTCPlugin.plugin.VERSION,"0.8.874")||(s.video.optional=s.video.optional||[],s.video.optional.push({sourceId:s.video.mediaSource})),e(s,o,a)})}else e(r,o,a)},i.getUserMedia=getUserMedia=window.getUserMedia=navigator.getUserMedia,navigator.mediaDevices&&"undefined"!=typeof Promise&&(navigator.mediaDevices.getUserMedia=requestUserMedia))}},"function"!=typeof window.require&&i._defineMediaSourcePolyfill()}).call(t,n(610),n(65))},611:function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},612:function(e,t,n){"use strict";function r(e){var t="";do{t=s[e%c]+t,e=Math.floor(e/c)}while(e>0);return t}function i(e){var t=0;for(u=0;u<e.length;u++)t=t*c+d[e.charAt(u)];return t}function o(){var e=r(+new Date);return e!==a?(p=0,a=e):e+"."+r(p++)}for(var a,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),c=64,d={},p=0,u=0;u<c;u++)d[s[u]]=u;o.encode=r,o.decode=i,e.exports=o},613:function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},614:function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},702:function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},703:function(e,t,n){e.exports=n.p+"images/logo-dark.svg"},750:function(e,t,n){function r(){}function i(e){var n="",r=!1;return n+=e.type,t.BINARY_EVENT!=e.type&&t.BINARY_ACK!=e.type||(n+=e.attachments,n+="-"),e.nsp&&"/"!=e.nsp&&(r=!0,n+=e.nsp),null!=e.id&&(r&&(n+=",",r=!1),n+=e.id),null!=e.data&&(r&&(n+=","),n+=u.stringify(e.data)),p("encoded %j as %s",e,n),n}function o(e,t){function n(e){var n=f.deconstructPacket(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)}f.removeBlobs(e,n)}function a(){this.reconstructor=null}function s(e){var n={},r=0;if(n.type=Number(e.charAt(0)),null==t.types[n.type])return d();if(t.BINARY_EVENT==n.type||t.BINARY_ACK==n.type){for(var i="";"-"!=e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!=e.charAt(r))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"==e.charAt(r+1))for(n.nsp="";++r;){var o=e.charAt(r);if(","==o)break;if(n.nsp+=o,r==e.length)break}else n.nsp="/";var a=e.charAt(r+1);if(""!==a&&Number(a)==a){for(n.id="";++r;){var o=e.charAt(r);if(null==o||Number(o)!=o){--r;break}if(n.id+=e.charAt(r),r==e.length)break}n.id=Number(n.id)}if(e.charAt(++r))try{n.data=u.parse(e.substr(r))}catch(e){return d()}return p("decoded %s as %j",e,n),n}function c(e){this.reconPack=e,this.buffers=[]}function d(e){return{type:t.ERROR,data:"parser error"}}var p=n(9)("socket.io-parser"),u=n(1943),l=(n(611),n(1945)),f=n(1946),h=n(1199);t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=a,r.prototype.encode=function(e,n){if(p("encoding packet %j",e),t.BINARY_EVENT==e.type||t.BINARY_ACK==e.type)o(e,n);else{n([i(e)])}},l(a.prototype),a.prototype.add=function(e){var n;if("string"==typeof e)n=s(e),t.BINARY_EVENT==n.type||t.BINARY_ACK==n.type?(this.reconstructor=new c(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!h(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},c.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=f.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},c.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},751:function(e,t,n){var r=n(1202);e.exports=function(e){var t=e.xdomain,n=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(e){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},752:function(e,t,n){function r(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders}var i=n(327),o=n(753);e.exports=r,o(r.prototype),r.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},r.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)},r.prototype.onPacket=function(e){this.emit("packet",e)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},753:function(e,t){function n(e){if(e)return r(e)}function r(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){function n(){r.off(e,n),t.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},754:function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},9:function(e,t,n){(function(r){function i(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)}}function a(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function c(){try{return t.storage.debug}catch(e){}if(void 0!==r&&"env"in r)return Object({NODE_ENV:"production"}).DEBUG}t=e.exports=n(1763),t.log=a,t.formatArgs=o,t.save=s,t.load=c,t.useColors=i,t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(c())}).call(t,n(410))}},[2642]);